<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Metro User Guide</title><link rel="stylesheet" href="style/documentation.css" type="text/css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><script xmlns:fo="http://www.w3.org/1999/XSL/Format" type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2105126-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><small xmlns:fo="http://www.w3.org/1999/XSL/Format" class="small">Links: <a href="index.html">Table of Contents</a> | <a href="user-guide.html">Single HTML</a> | <a href="user-guide.pdf">Single PDF</a></small><div lang="en" class="book" title="Metro User Guide"><div class="titlepage"><div><div><h1 class="title"><a name="user-guide"></a>Metro User Guide</h1></div></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="preface"><a href="#preface">Preface</a></span></dt><dt><span class="chapter"><a href="#ahiaj">1. Introduction to Metro</a></span></dt><dd><dl><dt><span class="section"><a href="#ahiae">1.1. Required Software</a></span></dt><dt><span class="section"><a href="#ahiak">1.2. What is WSIT?</a></span></dt><dd><dl><dt><span class="section"><a href="#ahiam">1.2.1. Bootstrapping and Configuration</a></span></dt><dt><span class="section"><a href="#ahiao">1.2.2. Message Optimization Technology</a></span></dt><dt><span class="section"><a href="#ahiap">1.2.3. Reliable Messaging Technology</a></span></dt><dt><span class="section"><a href="#ahiaq">1.2.4. Security Technology</a></span></dt></dl></dd><dt><span class="section"><a href="#ahiar">1.3. How Metro Relates to .NET Windows Communication Foundation
        (WCF)</a></span></dt><dt><span class="section"><a href="#ahias">1.4. Metro Specifications</a></span></dt><dd><dl><dt><span class="section"><a href="#ahiat">1.4.1. Bootstrapping and Configuration Specifications</a></span></dt><dt><span class="section"><a href="#ahiav">1.4.2. Message Optimization Specifications</a></span></dt><dt><span class="section"><a href="#ahiax">1.4.3. Reliable Messaging Specifications</a></span></dt><dt><span class="section"><a href="#ahiaz">1.4.4. Security Specifications</a></span></dt></dl></dd><dt><span class="section"><a href="#ahibb">1.5. How the Metro Technologies Work</a></span></dt><dd><dl><dt><span class="section"><a href="#ahibc">1.5.1. How Message Optimization Works</a></span></dt><dt><span class="section"><a href="#ahibd">1.5.2. How Reliable Messaging Works</a></span></dt><dt><span class="section"><a href="#ahibg">1.5.3. How Security Works</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#using-metro">2. Using Metro</a></span></dt><dd><dl><dt><span class="section"><a href="#metro-tools">2.1. Metro Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#useful-tools-for-your-toolbox">2.1.1. Useful tools for your toolbox</a></span></dt></dl></dd><dt><span class="section"><a href="#using-mavenized-metro-binaries">2.2. Using Mavenized Metro Binaries</a></span></dt><dd><dl><dt><span class="section"><a href="#using-metro-in-a-maven-project">2.2.1. Using Metro in a Maven project</a></span></dt><dt><span class="section"><a href="#using-metro-in-a-non-maven-project">2.2.2. Using Metro in a non-Maven project</a></span></dt></dl></dd><dt><span class="section"><a href="#using_metro-developing_with_nb">2.3. Developing with NetBeans</a></span></dt><dd><dl><dt><span class="section"><a href="#ahibo">2.3.1. Registering GlassFish with the IDE</a></span></dt><dt><span class="section"><a href="#ahibp">2.3.2. Creating a Web Service</a></span></dt><dt><span class="section"><a href="#ahibq">2.3.3. Configuring Metro's WSIT Features in the Web
            Service</a></span></dt><dt><span class="section"><a href="#ahibr">2.3.4. Deploying and Testing a Web Service</a></span></dt><dt><span class="section"><a href="#wsit_example_with_nb-creating_wsit_client">2.3.5. Creating a Client to Consume a WSIT-Enabled Web
            Service</a></span></dt></dl></dd><dt><span class="section"><a href="#developing-with-eclipse">2.4. Developing with Eclipse</a></span></dt><dd><dl><dt><span class="section"><a href="#setup">2.4.1. Setup</a></span></dt><dt><span class="section"><a href="#create-a-metro-web-services-endpoint">2.4.2. Create a Metro Web Services Endpoint</a></span></dt><dt><span class="section"><a href="#creating-web-service-client-using-wsimport-cli">2.4.3. Creating Web Service Client using Wsimport CLI</a></span></dt><dt><span class="section"><a href="#creating-web-service-client-using-wsimport-ant-task">2.4.4. Creating Web Service Client using Wsimport Ant Task</a></span></dt><dt><span class="section"><a href="#creating-web-service-client-using-soap-ui-plugin">2.4.5. Creating Web Service Client using SOAP UI Plugin</a></span></dt></dl></dd><dt><span class="section"><a href="#logging">2.5. Logging</a></span></dt><dd><dl><dt><span class="section"><a href="#dynamic_tube-based_message_logging">2.5.1. Dynamic tube-based message logging</a></span></dt><dt><span class="section"><a href="#dumping-soap-messages-on-client">2.5.2. Dumping SOAP messages on client</a></span></dt><dt><span class="section"><a href="#dumping-soap-messages-on-server">2.5.3. Dumping SOAP messages on server</a></span></dt></dl></dd><dt><span class="section"><a href="#using-jax-ws-2.x---metro-1.x-2.0-with-java-se-6">2.6. Using JAX-WS / Metro with Java SE</a></span></dt><dd><dl><dt><span class="section"><a href="#mustanga1">2.6.1. Using JAX-WS with Java SE</a></span></dt><dt><span class="section"><a href="#mustanga3">2.6.2. Using Metro with Java SE</a></span></dt></dl></dd><dt><span class="section"><a href="#deploying-metro-endpoint">2.7. Deploying Metro endpoint</a></span></dt><dd><dl><dt><span class="section"><a href="#the-war-contents">2.7.1. The WAR Contents</a></span></dt><dt><span class="section"><a href="#using-sun-jaxws.xml">2.7.2. Using sun-jaxws.xml</a></span></dt><dt><span class="section"><a href="#using-109-deployment-descriptor">2.7.3. Using 109 Deployment Descriptor</a></span></dt><dt><span class="section"><a href="#using-spring">2.7.4. Using Spring</a></span></dt></dl></dd><dt><span class="section"><a href="#handlers-and-messagecontext">2.8. Handlers and MessageContext</a></span></dt><dd><dl><dt><span class="section"><a href="#messagecontext-in-jax-ws">2.8.1. MessageContext in JAX-WS</a></span></dt><dt><span class="section"><a href="#handlers-in-jax-ws">2.8.2. Handlers in JAX-WS</a></span></dt><dt><span class="section"><a href="#efficient-handlers-in-jax-ws-ri">2.8.3. Efficient Handlers in JAX-WS RI</a></span></dt></dl></dd><dt><span class="section"><a href="#deploying-jax-ws-with-...">2.9. Deploying Metro with ...</a></span></dt><dd><dl><dt><span class="section"><a href="#weblogic-10">2.9.1. WebLogic 12</a></span></dt></dl></dd><dt><span class="section"><a href="#developing-client-application-with-locally-packaged-wsdl">2.10. Developing client application with locally packaged
        WSDL</a></span></dt><dd><dl><dt><span class="section"><a href="#service-api-to-pass-the-wsdl-information">2.10.1. Service API to pass the WSDL information</a></span></dt><dt><span class="section"><a href="#xml-catalog">2.10.2. Xml Catalog</a></span></dt><dt><span class="section"><a href="#using--wsdllocation-switch">2.10.3. Using -wsdlLocation switch</a></span></dt></dl></dd><dt><span class="section"><a href="#how-to-invoke-and-endpoint-by-overriding-endpoint-address-in-the-wsdl">2.11. How to invoke and endpoint by overriding endpoint address in
        the WSDL</a></span></dt><dd><dl><dt><span class="section"><a href="#bindingprovider.endpoint_address_property">2.11.1. BindingProvider.ENDPOINT_ADDRESS_PROPERTY</a></span></dt><dt><span class="section"><a href="#create-service-using-updated-wsdl">2.11.2. Create Service using updated WSDL</a></span></dt></dl></dd><dt><span class="section"><a href="#maintaining-state-in-web-services">2.12. Maintaining State in Web Services</a></span></dt><dt><span class="section"><a href="#fastinfoset">2.13. FastInfoset</a></span></dt><dd><dl><dt><span class="section"><a href="#using-fastinfoset">2.13.1. Using FastInfoset</a></span></dt></dl></dd><dt><span class="section"><a href="#using_metro-ha_support">2.14. High Availability Support in Metro</a></span></dt></dl></dd><dt><span class="chapter"><a href="#compiling-wsdl">3. Compiling WSDL</a></span></dt><dd><dl><dt><span class="section"><a href="#compiling-multiple-wsdls-that-share-a-common-schema">3.1. Compiling multiple WSDLs that share a common schema</a></span></dt><dt><span class="section"><a href="#dealing-with-schemas-that-are-not-referenced">3.2. Dealing with schemas that are not referenced</a></span></dt><dt><span class="section"><a href="#customizing-xml-schema-binding">3.3. Customizing XML Schema binding</a></span></dt><dd><dl><dt><span class="section"><a href="#how-to-get-simple-and-better-typed-binding">3.3.1. How to get simple and better typed binding</a></span></dt></dl></dd><dt><span class="section"><a href="#generating-javadocs-from-wsdl-documentation">3.4. Generating Javadocs from WSDL documentation</a></span></dt><dt><span class="section"><a href="#passing-java-compiler-options-to-wsimport">3.5. Passing Java Compiler options to Wsimport</a></span></dt></dl></dd><dt><span class="chapter"><a href="#soap">4. SOAP</a></span></dt><dd><dl><dt><span class="section"><a href="#soap-headers">4.1. SOAP headers</a></span></dt><dd><dl><dt><span class="section"><a href="#adding-soap-headers-when-sending-requests">4.1.1. Adding SOAP headers when sending requests</a></span></dt><dt><span class="section"><a href="#accessing-soap-headers-for-incoming-messages">4.1.2. Accessing SOAP headers for incoming messages</a></span></dt><dt><span class="section"><a href="#adding-soap-headers-when-sending-replies">4.1.3. Adding SOAP headers when sending replies</a></span></dt><dt><span class="section"><a href="#mapping-additional-wsdl-headers-to-method-parameters">4.1.4. Mapping additional WSDL headers to method
            parameters</a></span></dt></dl></dd><dt><span class="section"><a href="#schema-validation">4.2. Schema Validation</a></span></dt><dd><dl><dt><span class="section"><a href="#server-side-schema-validation">4.2.1. Server Side Schema Validation</a></span></dt><dt><span class="section"><a href="#client-side-schema-validation">4.2.2. Client Side Schema Validation</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#http">5. HTTP</a></span></dt><dd><dl><dt><span class="section"><a href="#http-headers">5.1. HTTP headers</a></span></dt><dd><dl><dt><span class="section"><a href="#sending-http-headers-on-request">5.1.1. Sending HTTP headers on request</a></span></dt><dt><span class="section"><a href="#accessing-http-headers-of-the-response">5.1.2. Accessing HTTP headers of the response</a></span></dt></dl></dd><dt><span class="section"><a href="#http-compression">5.2. HTTP compression</a></span></dt><dt><span class="section"><a href="#http-cookies">5.3. HTTP cookies</a></span></dt><dd><dl><dt><span class="section"><a href="#enabling-cookie-support">5.3.1. Enabling cookie support</a></span></dt><dt><span class="section"><a href="#accessing-http-cookies-in-the-response">5.3.2. Accessing HTTP cookies in the response</a></span></dt><dt><span class="section"><a href="#accessing-http-cookies-on-the-server">5.3.3. Accessing HTTP cookies on the server</a></span></dt></dl></dd><dt><span class="section"><a href="#http-client-streaming-support">5.4. HTTP client streaming support</a></span></dt><dt><span class="section"><a href="#access-http-headers-in-a-handler">5.5. Access HTTP headers in a Handler</a></span></dt><dd><dl><dt><span class="section"><a href="#from-client-side-handler">5.5.1. From Client side handler</a></span></dt><dt><span class="section"><a href="#from-server-side-handler">5.5.2. From Server side handler</a></span></dt></dl></dd><dt><span class="section"><a href="#http-timeouts">5.6. HTTP Timeouts</a></span></dt><dt><span class="section"><a href="#http-persistent-connections-keep-alive">5.7. HTTP Persistent Connections (keep-alive)</a></span></dt><dt><span class="section"><a href="#https-hostnameverifier">5.8. HTTPS HostnameVerifier</a></span></dt><dt><span class="section"><a href="#https-sslsocketfactory">5.9. HTTPS SSLSocketFactory</a></span></dt><dt><span class="section"><a href="#http-address-in-soapaddress-and-import-locations">5.10. HTTP address in soap:address and import locations</a></span></dt></dl></dd><dt><span class="chapter"><a href="#processing-large-data">6. Processing Large Data</a></span></dt><dd><dl><dt><span class="section"><a href="#receiving-large-soap-requests">6.1. Receiving large SOAP requests</a></span></dt><dd><dl><dt><span class="section"><a href="#providermessage">6.1.1. Provider&lt;Message&gt;</a></span></dt></dl></dd><dt><span class="section"><a href="#binary-attachments-mtom">6.2. Binary Attachments (MTOM)</a></span></dt><dd><dl><dt><span class="section"><a href="#mtom">6.2.1. MTOM</a></span></dt><dt><span class="section"><a href="#enabling-mtom-on-server">6.2.2. Enabling MTOM on server</a></span></dt><dt><span class="section"><a href="#enabling-mtom-on-client">6.2.3. Enabling MTOM on client</a></span></dt><dt><span class="section"><a href="#mtom-threshold">6.2.4. MTOM threshold</a></span></dt><dt><span class="section"><a href="#net-interoperability">6.2.5. .NET interoperability</a></span></dt></dl></dd><dt><span class="section"><a href="#large-attachments">6.3. Large Attachments</a></span></dt><dd><dl><dt><span class="section"><a href="#client-side">6.3.1. Client Side</a></span></dt><dt><span class="section"><a href="#server-side">6.3.2. Server Side</a></span></dt><dt><span class="section"><a href="#configuration">6.3.3. Configuration</a></span></dt><dt><span class="section"><a href="#large-attachments-summary">6.3.4. Large Attachments Summary</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#bootstrap_config">7. Bootstrapping and Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#bootstrap_config-server_endpoint">7.1. What is a Server-Side Endpoint?</a></span></dt><dt><span class="section"><a href="#bootstrap_config-client_from_wsdl">7.2. Creating a Client from WSDL</a></span></dt><dt><span class="section"><a href="#bootstrap_config-client_from_wsdl_examples">7.3. Client From WSDL Examples</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ahibx">8. Message Optimization</a></span></dt><dd><dl><dt><span class="section"><a href="#ahiby">8.1. Creating a MTOM Web Service</a></span></dt><dt><span class="section"><a href="#ahibz">8.2. Configuring Message Optimization in a Web Service</a></span></dt><dt><span class="section"><a href="#ahica">8.3. Deploying and Testing a Web Service with Message Optimization
        Enabled</a></span></dt><dt><span class="section"><a href="#ahicb">8.4. Creating a Client to Consume a Message Optimization-enabled Web
        Service</a></span></dt><dt><span class="section"><a href="#ahicc">8.5. Message Optimization and Secure Conversation</a></span></dt></dl></dd><dt><span class="chapter"><a href="#soaptcpa">9. SOAP/TCP Web Service transport</a></span></dt><dd><dl><dt><span class="section"><a href="#soaptcpb">9.1. What is SOAP/TCP?</a></span></dt><dt><span class="section"><a href="#soaptcpc">9.2. Creating a SOAP/TCP enabled Web Service</a></span></dt><dt><span class="section"><a href="#soaptcpd">9.3. Configuring Web Service to be able to operate over SOAP/TCP
        transport</a></span></dt><dt><span class="section"><a href="#soaptcpe">9.4. Deploying and Testing a Web Service with SOAP/TCP Transport
        Enabled</a></span></dt><dt><span class="section"><a href="#soaptcpf">9.5. Creating a Client to Consume a SOAP/TCP-enabled Web
        Service</a></span></dt><dt><span class="section"><a href="#soaptcpg">9.6. Configuring Web Service client to operate over SOAP/TCP
        transport</a></span></dt></dl></dd><dt><span class="chapter"><a href="#using_rm">10. Using Reliable Messaging</a></span></dt><dd><dl><dt><span class="section"><a href="#using_rm-config">10.1. Introduction to Reliable Messaging</a></span></dt><dt><span class="section"><a href="#using_rm-config_endpoint">10.2. Configuring Web Service Endpoint</a></span></dt><dt><span class="section"><a href="#using_rm-config_client">10.3. Configuring Web Service Client</a></span></dt><dt><span class="section"><a href="#advanced_rm_configuration">10.4. Configurable features summary</a></span></dt><dt><span class="section"><a href="#using_rm-creating_ws_and_client">10.5. Creating Web Service Providers and Clients that use Reliable
        Messaging</a></span></dt><dt><span class="section"><a href="#using_rm-with_sc">10.6. Using Secure Conversation With Reliable Messaging</a></span></dt><dt><span class="section"><a href="#using_rm-ha_support">10.7. High Availability Support in Reliable Messaging</a></span></dt></dl></dd><dt><span class="chapter"><a href="#using-mc">11. WS-MakeConnection support</a></span></dt><dd><dl><dt><span class="section"><a href="#using-mc-introduction">11.1. Introduction to WS-MakeConnection</a></span></dt><dt><span class="section"><a href="#using-mc-config_endpoint">11.2. Configuring Web Service Endpoint</a></span></dt><dd><dl><dt><span class="section"><a href="#using-mc-config_endpoint-wspolicy">11.2.1. Configuration via an WS-Policy expression</a></span></dt><dt><span class="section"><a href="#using-mc-config_endpoint-annotation">11.2.2. Configuration via a Java annotation</a></span></dt></dl></dd><dt><span class="section"><a href="#using-mc-config-client">11.3. Configuring Web Service Client</a></span></dt></dl></dd><dt><span class="chapter"><a href="#ahici">12. Using WSIT Security</a></span></dt><dd><dl><dt><span class="section"><a href="#ahicj">12.1. Configuring Security Using NetBeans IDE</a></span></dt><dt><span class="section"><a href="#ahicm">12.2. Summary of Configuration Requirements</a></span></dt><dd><dl><dt><span class="section"><a href="#ahicn">12.2.1. Summary of Service-Side Configuration Requirements</a></span></dt><dt><span class="section"><a href="#ahicp">12.2.2. Summary of Client-Side Configuration Requirements</a></span></dt></dl></dd><dt><span class="section"><a href="#ahicu">12.3. Security Mechanisms</a></span></dt><dd><dl><dt><span class="section"><a href="#ahicv">12.3.1. Username Authentication with Symmetric Key</a></span></dt><dt><span class="section"><a href="#ahicv1">12.3.2. Username Authentication with Password Derived Keys</a></span></dt><dt><span class="section"><a href="#ahicw">12.3.3. Mutual Certificates Security</a></span></dt><dt><span class="section"><a href="#SymmBindingKerberos">12.3.4. Symmetric Binding with Kerberos Tokens</a></span></dt><dt><span class="section"><a href="#ahicx">12.3.5. Transport Security (SSL)</a></span></dt><dt><span class="section"><a href="#ahicz">12.3.6. Message Authentication over SSL</a></span></dt><dt><span class="section"><a href="#ahida">12.3.7. SAML Authorization over SSL</a></span></dt><dt><span class="section"><a href="#ahidb">12.3.8. Endorsing Certificate</a></span></dt><dt><span class="section"><a href="#ahidc">12.3.9. SAML Sender Vouches with Certificates</a></span></dt><dt><span class="section"><a href="#ahidd">12.3.10. SAML Holder of Key</a></span></dt><dt><span class="section"><a href="#ahide">12.3.11. STS Issued Token</a></span></dt><dt><span class="section"><a href="#ahidf">12.3.12. STS Issued Token with Service Certificate</a></span></dt><dt><span class="section"><a href="#ahidg">12.3.13. STS Issued Endorsing Token</a></span></dt></dl></dd><dt><span class="section"><a href="#ahidh">12.4. Configuring SSL and Authorized Users</a></span></dt><dd><dl><dt><span class="section"><a href="#ahidi">12.4.1. Configuring SSL For Your Applications</a></span></dt><dt><span class="section"><a href="#ahidj">12.4.2. Adding Users to GlassFish</a></span></dt></dl></dd><dt><span class="section"><a href="#ahidm">12.5. Configuring Keystores and Truststores</a></span></dt><dd><dl><dt><span class="section"><a href="#ahido">12.5.1. Specifying Aliases with the Updated Stores</a></span></dt><dt><span class="section"><a href="#ahidr">12.5.2. Configuring the Keystore and Truststore</a></span></dt><dt><span class="section"><a href="#ahidx">12.5.3. Configuring Validators</a></span></dt></dl></dd><dt><span class="section"><a href="#ConfiguringKerberos">12.6. Configuring Kerberos for Glassfish and Tomcat</a></span></dt><dd><dl><dt><span class="section"><a href="#KerberosForGlassfish">12.6.1. For Glassfish</a></span></dt><dt><span class="section"><a href="#KerberosForTomcat">12.6.2. For Tomcat</a></span></dt></dl></dd><dt><span class="section"><a href="#ahidy">12.7. Securing Operations and Messages</a></span></dt><dd><dl><dt><span class="section"><a href="#ahiea">12.7.1. Supporting Token Options</a></span></dt></dl></dd><dt><span class="section"><a href="#ahieb">12.8. Configuring A Secure Token Service (STS)</a></span></dt><dt><span class="section"><a href="#ahiei">12.9. Example Applications</a></span></dt><dd><dl><dt><span class="section"><a href="#ahiej">12.9.1. Example: Username Authentication with Symmetric Key
            (UA)</a></span></dt><dt><span class="section"><a href="#UsernameWithDigestPasswords">12.9.2. Example: Username with Digest Passwords</a></span></dt><dt><span class="section"><a href="#ahiem">12.9.3. Example: Mutual Certificates Security (MCS)</a></span></dt><dt><span class="section"><a href="#ahiep">12.9.4. Example: Transport Security (SSL)</a></span></dt><dt><span class="section"><a href="#ahies">12.9.5. Example: SAML Authorization over SSL (SA)</a></span></dt><dt><span class="section"><a href="#ahiev">12.9.6. Example: SAML Sender Vouches with Certificates (SV)</a></span></dt><dt><span class="section"><a href="#ahiey">12.9.7. Example: STS Issued Token (STS)</a></span></dt><dt><span class="section"><a href="#ahiex">12.9.8. Example: Broker Trust STS (BT)</a></span></dt><dt><span class="section"><a href="#ahiez">12.9.9. Example: STS Issued Token With SecureConversation
            (STS+SC)</a></span></dt><dt><span class="section"><a href="#gfzhh">12.9.10. Example: Kerberos Token (Kerb)</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ahife">13. WSIT Security Features: Advanced: Topics</a></span></dt><dd><dl><dt><span class="section"><a href="#ahiff">13.1. Using Security Mechanisms</a></span></dt><dt><span class="section"><a href="#ahifg">13.2. Understanding WSIT Configuration Files</a></span></dt><dd><dl><dt><span class="section"><a href="#ahifh">13.2.1. Service-Side WSIT Configuration Files</a></span></dt><dt><span class="section"><a href="#ahifi">13.2.2. Client-Side WSIT Configuration Files</a></span></dt></dl></dd><dt><span class="section"><a href="#ahifj">13.3. Security Mechanism Configuration Options</a></span></dt><dt><span class="section"><a href="#custom-sts">13.4. Building custom STS</a></span></dt><dd><dl><dt><span class="section"><a href="#sts-claims">13.4.1. Handling Claims with Metro STS</a></span></dt></dl></dd><dt><span class="section"><a href="#sts-client-run-time-config">13.5. Handling Token and Key Requirements at Run Time</a></span></dt><dt><span class="section"><a href="#advanced-sts-usage">13.6. Advanced Usages of STS in Security</a></span></dt><dd><dl><dt><span class="section"><a href="#sts-sso">13.6.1. Token Caching and Sharing</a></span></dt><dt><span class="section"><a href="#sts-delegation">13.6.2. ActAs and Identity Delegation</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ahifl">14. WSIT Example Using a Web Container Without NetBeans IDE</a></span></dt><dd><dl><dt><span class="section"><a href="#ahifm">14.1. Environment Configuration Settings</a></span></dt><dd><dl><dt><span class="section"><a href="#ahifn">14.1.1. Setting the Web Container Listener Port</a></span></dt><dt><span class="section"><a href="#ahifo">14.1.2. Setting the Web Container Home Directory</a></span></dt></dl></dd><dt><span class="section"><a href="#ahifp">14.2. WSIT Configuration and WS-Policy Assertions</a></span></dt><dt><span class="section"><a href="#ahifq">14.3. Creating a Web Service without NetBeans</a></span></dt><dd><dl><dt><span class="section"><a href="#ahifr">14.3.1. Creating a Web Service From Java</a></span></dt><dt><span class="section"><a href="#ahifu">14.3.2. Creating a Web Service From WSDL</a></span></dt></dl></dd><dt><span class="section"><a href="#ahifx">14.4. Building and Deploying the Web Service</a></span></dt><dd><dl><dt><span class="section"><a href="#ahify">14.4.1. Building and Deploying a Web Service Created From
            Java</a></span></dt><dt><span class="section"><a href="#ahifz">14.4.2. Building and Deploying a Web Service Created From
            WSDL</a></span></dt><dt><span class="section"><a href="#ahiga">14.4.3. Deploying the Web Service to a Web Container</a></span></dt><dt><span class="section"><a href="#ahigd">14.4.4. Verifying Deployment</a></span></dt></dl></dd><dt><span class="section"><a href="#ahige">14.5. Creating a Web Service Client</a></span></dt><dd><dl><dt><span class="section"><a href="#ahigf">14.5.1. Creating a Client from Java</a></span></dt><dt><span class="section"><a href="#ahigi">14.5.2. Creating a Client from WSDL</a></span></dt></dl></dd><dt><span class="section"><a href="#ahigl">14.6. Building and Deploying a Client</a></span></dt><dt><span class="section"><a href="#ahigm">14.7. Running a Web Service Client</a></span></dt><dt><span class="section"><a href="#ahign">14.8. Undeploying a Web Service</a></span></dt></dl></dd><dt><span class="chapter"><a href="#accessing-metro-using-wcf-client">15. Accessing Metro Services Using WCF Clients</a></span></dt><dd><dl><dt><span class="section"><a href="#ahigp">15.1. Creating a WCF Client</a></span></dt><dd><dl><dt><span class="section"><a href="#ahigq">15.1.1. Prerequisites to Creating the WCF Client</a></span></dt><dt><span class="section"><a href="#ahigr">15.1.2. Examining the Client Class</a></span></dt><dt><span class="section"><a href="#ahigs">15.1.3. Building and Running the Client</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#ahigx">16. Data Contracts</a></span></dt><dd><dl><dt><span class="section"><a href="#ahigy">16.1. Web Service - Start from Java</a></span></dt><dd><dl><dt><span class="section"><a href="#ahigz">16.1.1. Data Types</a></span></dt><dt><span class="section"><a href="#ahihn">16.1.2. Fields and Properties</a></span></dt><dt><span class="section"><a href="#ahihr">16.1.3. Java Classes</a></span></dt><dt><span class="section"><a href="#ahihv">16.1.4. Open Content</a></span></dt><dt><span class="section"><a href="#ahihw">16.1.5. Enum Type</a></span></dt><dt><span class="section"><a href="#ahihx">16.1.6. Package-level Annotations</a></span></dt></dl></dd><dt><span class="section"><a href="#ahiia">16.2. Web Service - Start from WSDL</a></span></dt><dt><span class="section"><a href="#ahiic">16.3. Customizations for WCF Service WSDL</a></span></dt><dd><dl><dt><span class="section"><a href="#ahiid">16.3.1. generateElementProperty Attribute</a></span></dt></dl></dd><dt><span class="section"><a href="#ahiii">16.4. Developing a Microsoft .NET Client</a></span></dt><dt><span class="section"><a href="#ahiij">16.5. BP 1.1 Conformance</a></span></dt></dl></dd><dt><span class="chapter"><a href="#modulardbinding">17. Modular Databinding</a></span></dt><dd><dl><dt><span class="section"><a href="#md-introduction">17.1. Introduction</a></span></dt><dt><span class="section"><a href="#md-jvm">17.2. Configure databinding for JVM</a></span></dt><dt><span class="section"><a href="#md-endpoint">17.3. Configure databinding for an endpoint</a></span></dt></dl></dd><dt><span class="chapter"><a href="#using_at">18. Using Atomic Transactions</a></span></dt><dd><dl><dt><span class="section"><a href="#using_wsat">18.1. Using Web Services Atomic Transactions</a></span></dt><dd><dl><dt><span class="section"><a href="#using_wsat-overview">18.1.1. Overview of Web Services Atomic Transactions</a></span></dt><dt><span class="section"><a href="#using_wsat-enable_endpoint">18.1.2. Enabling Web Services Atomic Transactions on Web Service
            Endpoint</a></span></dt><dt><span class="section"><a href="#using_wsat-enable_client">18.1.3. Enabling Web Services Atomic Transactions on Web Service
            Clients</a></span></dt><dt><span class="section"><a href="#using_wsat-system_level_config">18.1.4. System Level Configuration</a></span></dt><dt><span class="section"><a href="#compatibility">18.1.5. Compatibility</a></span></dt></dl></dd><dt><span class="section"><a href="#ahiim">18.2. About the basicWSTX Example</a></span></dt><dt><span class="section"><a href="#ahiip">18.3. Building, Deploying and Running the basicWSTX Example</a></span></dt></dl></dd><dt><span class="chapter"><a href="#policiesa">19. Managing Policies</a></span></dt><dd><dl><dt><span class="section"><a href="#managing-policies">19.1. Managing Policies</a></span></dt><dd><dl><dt><span class="section"><a href="#introduction">19.1.1. Introduction</a></span></dt><dt><span class="section"><a href="#policy-references">19.1.2. Policy References</a></span></dt><dt><span class="section"><a href="#policies-wsdl-import">19.1.3. WSDL Import</a></span></dt><dt><span class="section"><a href="#external-policy-references">19.1.4. External Policy References</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#monitoringandmanagement">20. Monitoring and Management</a></span></dt><dd><dl><dt><span class="section"><a href="#monitoring-intro">20.1. Introduction to Metro JMX Monitoring</a></span></dt><dt><span class="section"><a href="#monitoring-enabling">20.2. Enabling and Disabling Monitoring</a></span></dt><dd><dl><dt><span class="section"><a href="#monitoring-enabling-properties">20.2.1. Enabling and disabling Metro monitoring via system
            properties</a></span></dt><dt><span class="section"><a href="#monitoring-enabling-policy-endpoint">20.2.2. Enabling and disabling endpoint monitoring via
            policy</a></span></dt><dt><span class="section"><a href="#monitoring-enabling-policy-client">20.2.3. Enabling and disabling client monitoring via policy</a></span></dt></dl></dd><dt><span class="section"><a href="#monitoring-identifiers">20.3. Monitoring Identifiers</a></span></dt><dd><dl><dt><span class="section"><a href="#monitoring-identifiers-endpoints">20.3.1. Endpoint Monitoring Identifiers</a></span></dt><dt><span class="section"><a href="#monitoring-identifiers-clients">20.3.2. Client monitoring identifiers</a></span></dt><dt><span class="section"><a href="#monitoring-identifier-character-mapping">20.3.3. Identifier Character Mapping</a></span></dt><dt><span class="section"><a href="#monitoring-resolving-name-conflicts">20.3.4. Resolving Monitoring Root Name Conflicts</a></span></dt></dl></dd><dt><span class="section"><a href="#monitoring-available-information">20.4. Available Monitoring Information</a></span></dt><dd><dl><dt><span class="section"><a href="#monitoring-wsclient-information">20.4.1. WSClient Information</a></span></dt><dt><span class="section"><a href="#monitoring-wsendpoint-information">20.4.2. WSEndpoint Information</a></span></dt><dt><span class="section"><a href="#monitoring-wsnoncemanager-information">20.4.3. WSNonceManager Information</a></span></dt><dt><span class="section"><a href="#monitoring-wsrmscsessionmanager-information">20.4.4. WSRMSCSessionManager Information</a></span></dt><dt><span class="section"><a href="#monitoring-wsrmssequencemanager-information">20.4.5. WSRMSequenceManager Information</a></span></dt></dl></dd><dt><span class="section"><a href="#monitoring-notes">20.5. Notes</a></span></dt></dl></dd><dt><span class="chapter"><a href="#springa">21. Using Metro With Spring</a></span></dt><dd><dl><dt><span class="section"><a href="#spring-introduction">21.1. Spring Introduction</a></span></dt><dt><span class="section"><a href="#springa1">21.2. Using Metro With Spring and NetBeans 6.1</a></span></dt><dd><dl><dt><span class="section"><a href="#spring-netbeans-6.1-introduction">21.2.1. Spring NetBeans 6.1 Introduction</a></span></dt><dt><span class="section"><a href="#creating-a-netbeans-6.1-spring-project">21.2.2. Creating a Netbeans 6.1 Spring Project</a></span></dt><dt><span class="section"><a href="#adding-a-web-service">21.2.3. Adding a Web Service</a></span></dt></dl></dd><dt><span class="section"><a href="#springa2">21.3. Using Metro With Spring and NetBeans 6.5</a></span></dt><dd><dl><dt><span class="section"><a href="#spring-netbeans-6.5-introduction">21.3.1. Spring NetBeans 6.5 Introduction</a></span></dt><dt><span class="section"><a href="#creating-a-netbeans-6.5-spring-project">21.3.2. Creating a NetBeans 6.5 Spring Project</a></span></dt><dt><span class="section"><a href="#adding-a-web-service-">21.3.3. Adding a Web Service</a></span></dt></dl></dd><dt><span class="section"><a href="#using-wsit-functionality-with-spring">21.4. Using WSIT Functionality With Spring</a></span></dt></dl></dd><dt><span class="chapter"><a href="#furtherinfo">22. Further Information</a></span></dt><dd><dl><dt><span class="section"><a href="#ahifd">22.1. Links to more information</a></span></dt></dl></dd></dl></div><div class="list-of-figures"><p><b>List of Figures</b></p><dl><dt>1.1. <a href="#ahial">Metro's WSIT Web Services Features</a></dt><dt>1.2. <a href="#ahian">Bootstrapping and Configuration</a></dt><dt>1.3. <a href="#ahiau">Bootstrapping and Configuration Specifications</a></dt><dt>1.4. <a href="#ahiaw">Message Optimization Specifications</a></dt><dt>1.5. <a href="#ahiay">Reliable Messaging Specifications</a></dt><dt>1.6. <a href="#ahiba">Web Services Security Specifications</a></dt><dt>1.7. <a href="#ahibe">Application Message Exchange Without Reliable
                Messaging</a></dt><dt>1.8. <a href="#ahibf">Application Message Exchange with Reliable Messaging
                Enabled</a></dt><dt>1.9. <a href="#ahibi">Security Policy Exchange</a></dt><dt>1.10. <a href="#ahibk">Trust and Secure Conversation</a></dt><dt>1.11. <a href="#ahibm">Secure Conversation</a></dt><dt>2.1. <a href="#gfrat">Editing Web Service Attributes</a></dt><dt>2.2. <a href="#gfrby">Reliable Messaging Configuration
                            Window</a></dt><dt>2.3. <a href="#f0.44313571959891807">SOAP UI - JAX-WS Artifacts</a></dt><dt>2.4. <a href="#f0.7200744608386892">SOAP UI - Preferences</a></dt><dt>8.1. <a href="#gfrdw">Enabling MTOM</a></dt><dt>9.1. <a href="#soaptcpsrvimg">Enabling SOAP/TCP</a></dt><dt>9.2. <a href="#soaptcpclntimg">Enabling SOAP/TCP for a Web Service
                        client</a></dt><dt>10.1. <a href="#f0.21865766008323695">Quality of Service (NetBeans)</a></dt><dt>10.2. <a href="#f0.19917454831806913">Quality of Service - Advanced (NetBeans)</a></dt><dt>10.3. <a href="#f0.006706294753032083">Advanced Reliable Messaging Attributes
                (NetBeans)</a></dt><dt>12.1. <a href="#gfrct">Web Service Attributes Editor Page</a></dt><dt>12.2. <a href="#gfrda">Web Service References Attributes Editor Page
                        for Web Service Clients</a></dt><dt>12.3. <a href="#ahics">Quality of Service - Client -
                                    Security</a></dt><dt>12.4. <a href="#gfrgi">Deployment Descriptor Page</a></dt><dt>12.5. <a href="#ahidt">Keystore Configuration Dialog</a></dt><dt>12.6. <a href="#gfrgy">Web Service Attributes Editor Page: Operation
                            Level</a></dt><dt>12.7. <a href="#gfrhz">Web Service Attributes Editor Page: Message
                        Parts</a></dt><dt>12.8. <a href="#kerberosServerConfig">Kerberos Configuration Attributes -
                                Service</a></dt><dt>12.9. <a href="#kerberosClientConfig">Kerberos Configuration Attributes -
                            Client</a></dt><dt>13.1. <a href="#sts_actas_page">ActAs and Identity Delegation</a></dt><dt>18.1. <a href="#f0.3738067790934235">Web Services Atomic Transactions Framework</a></dt><dt>18.2. <a href="#f0.34418460497260706">Atomic Transaction - Interaction between two
                Servers</a></dt><dt>18.3. <a href="#ahiin">WS-Coordination and WS-AtomicTransaction Protocols in Two
            GlassFish Domains</a></dt><dt>18.4. <a href="#ahiio">Components in the basicWSTX Example</a></dt><dt>18.5. <a href="#gfrdv">basicWSTX Results</a></dt><dt>20.1. <a href="#f0.4755328135644029">Monitoring - One client and two services running inside
                the same instance of GlassFish</a></dt><dt>20.2. <a href="#f0.2892391260409608">Monitoring - top-level information available for
                    each client</a></dt><dt>20.3. <a href="#f0.3177156319073998">Monitoring - WSEndpoint information</a></dt><dt>20.4. <a href="#f0.5153231558395726">Monitoring - WSRMSequenceManager
                    Information</a></dt><dt>21.1. <a href="#f0.3909234054066213">Netbeans 6.1 - Creating a Web Application</a></dt><dt>21.2. <a href="#f0.14436660694298054">Netbeans 6.1 - Creating a Web Application</a></dt><dt>21.3. <a href="#f0.9597861719931743">Netbeans 6.1 - Creating a Web Application - Spring
                    dependencies</a></dt><dt>21.4. <a href="#f0.48554218961773654">Netbeans 6.1 - Creating a Web Application - Adding
                    libraries</a></dt><dt>21.5. <a href="#f0.2952713070263785">Netbeans 6.1 - Adding a Webservice</a></dt><dt>21.6. <a href="#f0.6896137896548253">Netbeans 6.5 - Creating a Web Application</a></dt><dt>21.7. <a href="#f0.44980859181463606">Netbeans 6.5 - Creating a Web Application</a></dt><dt>21.8. <a href="#f0.7488236063243116">Netbeans 6.5 - Creating a Web Application - Servers
                    and Settings</a></dt><dt>21.9. <a href="#f0.70966785130944">Netbeans 6.5 - Creating a Web Application - Spring
                    dependencies</a></dt><dt>21.10. <a href="#f0.12494192198301834">Netbeans 6.5 - Creating a Web Application - Adding
                    libraries</a></dt><dt>21.11. <a href="#f0.8720359728656875">Netbeans 6.5 - Adding a Web Service</a></dt><dt>21.12. <a href="#f0.5173347854521261">Netbeans - Edit Web Service Attributes</a></dt></dl></div><div class="list-of-tables"><p><b>List of Tables</b></p><dl><dt>1.1. <a href="#gfrxa">Metro Specification Versions</a></dt><dt>2.1. <a href="#d0e2560">Endpoint attributes</a></dt><dt>3.1. <a href="#d0e3293"><code class="code">wsdl:documentation</code> to Javadoc mapping</a></dt><dt>6.1. <a href="#d0e3849">JAXB Mapping Rules</a></dt><dt>10.1. <a href="#endpoint_rm_config_options">Reliable Messaging Configuration Options for Service
            Endpoint</a></dt><dt>10.2. <a href="#client_rm_config_options">Reliable Messaging Configuration Options for Service
            Client</a></dt><dt>10.3. <a href="#rm_assertion_namespaces">Namespaces used within Metro Reliable Messaging WS-Policy
            Assertions</a></dt><dt>10.4. <a href="#rm_feature_summary">Reliable Messaging Configuration Features - Layout</a></dt><dt>10.5. <a href="#d0e5099">Enable Reliable Messaging + version</a></dt><dt>10.6. <a href="#d0e5119">Sequence Inactivity Timeout</a></dt><dt>10.7. <a href="#d0e5139">Acknowledgement interval</a></dt><dt>10.8. <a href="#d0e5159">Retransmission Interval</a></dt><dt>10.9. <a href="#d0e5181">Retransmission Interval Adjustment Algorithm</a></dt><dt>10.10. <a href="#d0e5204">Maximum Retransmission Count</a></dt><dt>10.11. <a href="#d0e5226">Close sequence timeout</a></dt><dt>10.12. <a href="#d0e5249">Acknowledgement request interval</a></dt><dt>10.13. <a href="#d0e5269">Bind RM sequence to security token</a></dt><dt>10.14. <a href="#d0e5288">Bind RM sequence to secured transport</a></dt><dt>10.15. <a href="#d0e5307">Exactly once delivery</a></dt><dt>10.16. <a href="#d0e5326">At Most once delivery</a></dt><dt>10.17. <a href="#d0e5345">At Least once delivery</a></dt><dt>10.18. <a href="#d0e5365">InOrder delivery</a></dt><dt>10.19. <a href="#d0e5385">Flow Control</a></dt><dt>10.20. <a href="#d0e5405">Maximum Flow Control Buffer Size</a></dt><dt>10.21. <a href="#d0e5425">Maximum concurrent RM sessions</a></dt><dt>10.22. <a href="#d0e5444">Reliable Messaging Persistence</a></dt><dt>10.23. <a href="#d0e5463">Sequence manager maintenace task execution period</a></dt><dt>12.1. <a href="#ahico">Summary of Service-Side Configuration
                Requirements</a></dt><dt>12.2. <a href="#ahicq">Summary of Client-Side Configuration
                Requirements</a></dt><dt>12.3. <a href="#ahidp">Keystore and Truststore Aliases</a></dt><dt>12.4. <a href="#ahidq">Keystore and Truststore Aliases for STS</a></dt><dt>13.1. <a href="#ahifk">Security Mechanism Configuration Options</a></dt><dt>16.1. <a href="#ahiih">CLR to XML Schema Type Mapping</a></dt><dt>18.1. <a href="#using_wsat-components_table">Components of Web Services Atomic Transactions</a></dt><dt>18.2. <a href="#using_wsat-config_table">Web Services Atomic Transactions Configuration
                Options</a></dt><dt>18.3. <a href="#using_wsat-flow_types_table">Flow Types Values</a></dt><dt>18.4. <a href="#using_wsat-wsat_1-2_assertion_values">Web Services Atomic Transaction Policy Assertion
                    Values (WS-AtomicTransaction 1.2)</a></dt></dl></div><div class="preface" title="Preface"><div class="titlepage"><div><div><h2 class="title"><a name="preface"></a>Preface</h2></div></div></div><p>
            This document explains <span class="emphasis"><em>various</em></span> interesting/complex/tricky aspects of Metro, based on questions posted on the
            <a class="link" href="http://home.java.net/forums/glassfish/metro-and-jaxb" target="_top">Metro users forum</a> and answers provided.
            This is still a work-in-progress. Any <a class="link" href="mailto:users@metro.java.net" target="_top">feedback</a> is appreciated.<span class="command"><strong></strong></span>
        </p></div><div lang="en" class="chapter" title="Chapter&nbsp;1.&nbsp;Introduction to Metro"><div class="titlepage"><div><div><h2 class="title"><a name="ahiaj"></a>Chapter&nbsp;1.&nbsp;Introduction to Metro</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#ahiae">1.1. Required Software</a></span></dt><dt><span class="section"><a href="#ahiak">1.2. What is WSIT?</a></span></dt><dd><dl><dt><span class="section"><a href="#ahiam">1.2.1. Bootstrapping and Configuration</a></span></dt><dt><span class="section"><a href="#ahiao">1.2.2. Message Optimization Technology</a></span></dt><dt><span class="section"><a href="#ahiap">1.2.3. Reliable Messaging Technology</a></span></dt><dt><span class="section"><a href="#ahiaq">1.2.4. Security Technology</a></span></dt></dl></dd><dt><span class="section"><a href="#ahiar">1.3. How Metro Relates to .NET Windows Communication Foundation
        (WCF)</a></span></dt><dt><span class="section"><a href="#ahias">1.4. Metro Specifications</a></span></dt><dd><dl><dt><span class="section"><a href="#ahiat">1.4.1. Bootstrapping and Configuration Specifications</a></span></dt><dt><span class="section"><a href="#ahiav">1.4.2. Message Optimization Specifications</a></span></dt><dt><span class="section"><a href="#ahiax">1.4.3. Reliable Messaging Specifications</a></span></dt><dt><span class="section"><a href="#ahiaz">1.4.4. Security Specifications</a></span></dt></dl></dd><dt><span class="section"><a href="#ahibb">1.5. How the Metro Technologies Work</a></span></dt><dd><dl><dt><span class="section"><a href="#ahibc">1.5.1. How Message Optimization Works</a></span></dt><dt><span class="section"><a href="#ahibd">1.5.2. How Reliable Messaging Works</a></span></dt><dt><span class="section"><a href="#ahibg">1.5.3. How Security Works</a></span></dt></dl></dd></dl></div><div class="section" title="1.1.&nbsp;Required Software"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahiae"></a>1.1.&nbsp;Required Software</h2></div></div></div><p>To use this guide, download and install the following
        software:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="link" href="http://download.oracle.com/javase/" target="_top">Oracle JavaSE
                Runtime or Development Kit</a></p></li><li class="listitem"><p>Container (note: Metro can be run on any Servlet
                container) </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p><a class="link" href="http://glassfish.java.net/public/downloadsindex.html" target="_top">GlassFish
                            Server</a></p></li><li class="listitem"><p><a class="link" href="http://tomcat.apache.org/" target="_top">Tomcat
                            Servlet Container</a></p></li></ul></div></li><li class="listitem"><p><a class="link" href="http://metro.java.net/" target="_top">Metro</a>
                binary. See the particular release page for instructions about
                downloading and installing Metro in a servlet
                container.</p></li><li class="listitem"><p><a class="link" href="http://netbeans.org/downloads/index.html" target="_top">NetBeans
                IDE</a> (Java version)</p></li></ul></div></div><div class="section" title="1.2.&nbsp;What is WSIT?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahiak"></a>1.2.&nbsp;What is WSIT?</h2></div></div></div><p>For three years (and continuing) Sun has worked closely with
        Microsoft to ensure interoperability of web services enterprise
        technologies such as security , reliable messaging, and atomic
        transactions. That portion of Metro is known as WSIT (Web Service
        Interoperability Technologies). Metro's WSIT subsystem is an
        implementation of a number of open web services specifications to
        support enterprise features. In addition to security, reliable
        messaging, and atomic transactions, Metro includes a bootstrapping and
        configuration technology. <a class="xref" href="#ahial" title="Figure&nbsp;1.1.&nbsp;Metro's WSIT Web Services Features">Metro's WSIT Web Services Features</a> shows the underlying services that were
        implemented for each technology.</p><div class="figure"><a name="ahial"></a><p class="title"><b>Figure&nbsp;1.1.&nbsp;Metro's WSIT Web Services Features</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/WSITwebServicesFeatures.png" height="360" alt="Metro's WSIT Web Services Features"></td></tr></table></div></div></div><br class="figure-break"><p>Starting with the core XML support currently built into the Java
        platform, Metro uses or extends existing features and adds new support
        for interoperable web services. See the following sections for an
        overview of each feature:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahiam" title="1.2.1.&nbsp;Bootstrapping and Configuration">Bootstrapping and Configuration</a></p></li><li class="listitem"><p><a class="xref" href="#ahiao" title="1.2.2.&nbsp;Message Optimization Technology">Message Optimization Technology</a></p></li><li class="listitem"><p><a class="xref" href="#ahiap" title="1.2.3.&nbsp;Reliable Messaging Technology">Reliable Messaging Technology</a></p></li><li class="listitem"><p><a class="xref" href="#ahiaq" title="1.2.4.&nbsp;Security Technology">Security Technology</a></p></li></ul></div><div class="section" title="1.2.1.&nbsp;Bootstrapping and Configuration"><div class="titlepage"><div><div><h3 class="title"><a name="ahiam"></a>1.2.1.&nbsp;Bootstrapping and Configuration</h3></div></div></div><p>Bootstrapping and configuration consists of using a URL to
            access a web service, retrieving its WSDL file, and using the WSDL
            file to create a web service client that can access and consume a
            web service. The process consists of the following steps, which
            are shown in <a class="xref" href="#ahian" title="Figure&nbsp;1.2.&nbsp;Bootstrapping and Configuration">Bootstrapping and Configuration</a>.</p><div class="figure"><a name="ahian"></a><p class="title"><b>Figure&nbsp;1.2.&nbsp;Bootstrapping and Configuration</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/bootstrappingConfiguration.png" height="360" alt="Bootstrapping and Configuration"></td></tr></table></div></div></div><br class="figure-break"><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Client acquires the URL for a web service that it
                    wants to access and consume. How you acquire the URL is
                    outside the scope of this tutorial. For example, you might
                    look up the URL in a Web Services registry.</p></li><li class="listitem"><p>The client uses the URL and the
                    <code class="code">wsimport</code> tool to send a WS-MetadataExchange
                    Request to access the web service and retrieve the WSDL
                    file. The WSDL file contains a description of the web
                    service endpoint, including WS-Policy assertions that
                    describe the security, reliability, transactional, etc.,
                    capabilities and requirements of the service. The
                    description describes the requirements that must be
                    satisfied to access and consume the web service.</p></li><li class="listitem"><p>The client uses the WSDL file to create the web
                    service client.</p></li><li class="listitem"><p>The web service client accesses and consumes the web
                    service.</p></li></ol></div><p><a class="xref" href="#bootstrap_config" title="Chapter&nbsp;7.&nbsp;Bootstrapping and Configuration"><i>Bootstrapping and Configuration</i></a>
            explains how to bootstrap and configure a web service client and a
            web service endpoint that use the Metro's WSIT
            technologies.</p></div><div class="section" title="1.2.2.&nbsp;Message Optimization Technology"><div class="titlepage"><div><div><h3 class="title"><a name="ahiao"></a>1.2.2.&nbsp;Message Optimization Technology</h3></div></div></div><p>A primary function of web services applications is to share
            data among applications over the Internet. The data shared can
            vary in format and include large binary payloads, such as
            documents, images, music files, and so on. When large binary
            objects are encoded into XML format for inclusion in SOAP
            messages, even larger files are produced. When a web service
            processes and transmits these large files over the network, the
            performance of the web service application and the network are
            negatively affected. In the worst case scenario the effects are as
            follows:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The performance of the web service application
                    degrades to a point that it is no longer useful.</p></li><li class="listitem"><p>The network gets bogged down with more traffic than
                    the allotted bandwidth can handle.</p></li></ul></div><p>One way to deal with this problem is to encode the binary
            objects so as to optimize both the SOAP application processing
            time and the bandwidth required to transmit the SOAP message over
            the network. In short, XML needs to be optimized for web services.
            This is the exactly what the Message Optimization technology does.
            It ensures that web services messages are transmitted over the
            Internet in the most efficient manner.</p><p>Sun recommends that you use message optimization if your web
            service client or web service endpoint will be required to process
            binary encoded XML documents larger than 1KB.</p><p>For instructions on how to use the Message Optimization
            technology, see <a class="xref" href="#ahibx" title="Chapter&nbsp;8.&nbsp;Message Optimization"><i>Message Optimization</i></a>.</p></div><div class="section" title="1.2.3.&nbsp;Reliable Messaging Technology"><div class="titlepage"><div><div><h3 class="title"><a name="ahiap"></a>1.2.3.&nbsp;Reliable Messaging Technology</h3></div></div></div><p>Reliable Messaging is a Quality of Service (QoS) technology
            for building more reliable web services. Reliability (in terms of
            what is provided by WS-ReliableMessaging) is measured by a
            system's ability to deliver messages from point A to point B. The
            primary purpose of Reliable Messaging is to ensure the delivery of
            application messages to web service endpoints.</p><p>The reliable messaging technology ensures that messages in a
            given message sequence are delivered at least once and not more
            than once and optionally in the correct order. When messages in a
            given sequence are lost in transit or delivered out of order, this
            technology enables systems to recover from such failures. If a
            message is lost in transit, the sending system retransmits the
            message until its receipt is acknowledged by the receiving system.
            If messages are received out of order, the receiving system may
            re-order the messages into the correct order.</p><p>You should consider using reliable messaging if the web
            service is experiencing the following types of problems:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Communication failures are occurring that result in
                    the network being unavailable or connections being
                    dropped</p></li><li class="listitem"><p>Application messages are being lost in
                    transit</p></li><li class="listitem"><p>Application messages are arriving at their
                    destination out of order and ordered delivery is a
                    requirement</p></li></ul></div><p>To help decide whether or not to use reliable messaging,
            weigh the following advantages and disadvantages:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Enabling reliable messaging ensures that messages
                    are delivered exactly once from the source to the
                    destination and, if the ordered-delivery option is
                    enabled, ensures that messages are delivered in
                    order.</p></li><li class="listitem"><p>Enabling reliable messaging uses more memory
                    (especially if the ordered delivery option is enabled)
                    since messages must be stored (even after they are sent)
                    until receipt is acknowledged.</p></li><li class="listitem"><p>Non-reliable messaging clients cannot interoperate
                    with web services that have reliable messaging
                    enabled.</p></li></ul></div><p>For instructions on how to use the Reliable Messaging
            technology, see <a class="xref" href="#using_rm" title="Chapter&nbsp;10.&nbsp;Using Reliable Messaging"><i>Using Reliable Messaging</i></a>.</p></div><div class="section" title="1.2.4.&nbsp;Security Technology"><div class="titlepage"><div><div><h3 class="title"><a name="ahiaq"></a>1.2.4.&nbsp;Security Technology</h3></div></div></div><p>Until now, web services have relied on transport-based
            security such as SSL to provide point-to-point security. Metro
            implements WS-Security so as to provide interoperable message
            content integrity and confidentiality, even when messages pass
            through intermediary nodes before reaching their destination
            endpoint. WS-Security as provided by Metro is in addition to
            existing transport-level security, which may still be used.</p><p>Metro also enhances security by implementing WS-Secure
            Conversation, which enables a consumer and provider to establish a
            shared security context when a multiple-message-exchange sequence
            is first initiated. Subsequent messages use derived session keys
            that increase the overall security while reducing the security
            processing overhead for each message.</p><p>Further, Metro implements two additional features to improve
            security in web services:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Web Services Trust</em></span>: Enables web
                    service applications to use SOAP messages to request
                    security tokens that can then be used to establish trusted
                    communications between a client and a web service.</p></li><li class="listitem"><p><span class="emphasis"><em>Web Services Security Policy</em></span>:
                    Enables web services to use security assertions to clearly
                    represent security preferences and requirements for web
                    service endpoints.</p></li></ul></div><p>Metro implements these features in such a way as to ensure
            that web service binding security requirements, as defined in the
            WSDL file, can interoperate with and be consumed by Metro and WCF
            endpoints.</p><p>For instructions on how to use the WS-Security technology,
            see <a class="xref" href="#ahici" title="Chapter&nbsp;12.&nbsp;Using WSIT Security"><i>Using WSIT Security</i></a>.</p></div></div><div class="section" title="1.3.&nbsp;How Metro Relates to .NET Windows Communication Foundation (WCF)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahiar"></a>1.3.&nbsp;How Metro Relates to .NET Windows Communication Foundation
        (WCF)</h2></div></div></div><p>Web services interoperability is an initiative of Sun and
        Microsoft. We test and deliver products to market that interoperate
        across different platforms.</p><p>Metro is the product of Sun's web services interoperability
        initiative. Windows Communication Foundation (WCF) in .NET is
        Microsoft's unified programming model for building connected systems.
        WCF, which is available as part of the .NET Framework 3.x product,
        includes application programming interfaces (APIs) for building
        secure, reliable, transacted web services that interoperate with
        non-Microsoft platforms.</p><p>Sun Microsystems and Microsoft jointly test Metro against WCF to
        ensure that Sun web service clients (consumers) and web services
        (producers) do in fact interoperate with WCF web services applications
        and vice versa. This testing ensures that the following
        interoperability goals are realized:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Metro web services clients can access and consume WCF
                web services.</p></li><li class="listitem"><p>WCF web services clients can access and consume Metro
                web services.</p></li></ul></div><p>Sun provides Metro on the Java platform and Microsoft provides
        WCF on the .NET 3.0 and .NET 3.5 platforms. The sections that follow
        describe the web services specifications implemented by Sun
        Microsystems in Web Services Interoperability Technologies (WSIT) and
        provide high-level descriptions of how each WSIT technology
        works.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Because Metro-based clients and services are interoperable,
            you can gain the benefits of Metro without using WCF.</p></div></div><div class="section" title="1.4.&nbsp;Metro Specifications"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahias"></a>1.4.&nbsp;Metro Specifications</h2></div></div></div><p>The specifications for bootstrapping and configuration, message
        optimization, reliable messaging, and security technologies are
        discussed in the following sections:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahiat" title="1.4.1.&nbsp;Bootstrapping and Configuration Specifications">Bootstrapping and Configuration Specifications</a></p></li><li class="listitem"><p><a class="xref" href="#ahiav" title="1.4.2.&nbsp;Message Optimization Specifications">Message Optimization Specifications</a></p></li><li class="listitem"><p><a class="xref" href="#ahiax" title="1.4.3.&nbsp;Reliable Messaging Specifications">Reliable Messaging Specifications</a></p></li><li class="listitem"><p><a class="xref" href="#ahiaz" title="1.4.4.&nbsp;Security Specifications">Security Specifications</a></p></li></ul></div><p>Metro implements the following WS-* specifications.</p><div class="table"><a name="gfrxa"></a><p class="title"><b>Table&nbsp;1.1.&nbsp;Metro Specification Versions</b></p><div class="table-contents"><table summary="Metro Specification Versions" border="1"><colgroup><col><col></colgroup><thead><tr><th>Technology</th><th>Metro Version</th></tr></thead><tbody><tr><td>Bootstrapping</td><td>since v1.0 : <a class="link" href="http://specs.xmlsoap.org/ws/2004/09/mex/WS-MetadataExchange.pdf" target="_top">WS-MetadataExchange
                        v1.1</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"></td></tr><tr><td>Policy (W3C standards)</td><td>since v1.0 : <a class="link" href="http://www.w3.org/Submission/WS-Policy/" target="_top">WS-Policy
                        v1.2</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v1.0 : <a class="link" href="http://www.w3.org/Submission/WS-PolicyAttachment/" target="_top">WS-PolicyAttachment
                        v1.2</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v1.3 : <a class="link" href="http://www.w3.org/TR/2007/PR-ws-policy-20070706/" target="_top">WS-Policy
                        v1.5</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v1.3 : <a class="link" href="http://www.w3.org/TR/2007/PR-ws-policy-attach-20070706/" target="_top">WS-PolicyAttachment
                        v1.5</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"></td></tr><tr><td>Reliable Messaging (OASIS standards)</td><td>since v1.0 : <a class="link" href="http://specs.xmlsoap.org/ws/2005/02/rm/ws-reliablemessaging.pdf" target="_top">WS-ReliableMessaging
                        v1.0</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v1.0 : <a class="link" href="http://specs.xmlsoap.org/ws/2005/02/rm/WS-RMPolicy.pdf" target="_top">WS-ReliableMessaging
                        Policy v1.0</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v1.3 : <a class="link" href="http://www.oasis-open.org/committees/documents.php?wg_abbrev=ws-rx" target="_top">WS-ReliableMessaging
                        v1.1</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v1.3 :
                        WS-ReliableMessaging Policy v1.1<br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since
                        v2.0 : <a class="link" href="http://docs.oasis-open.org/ws-rx/wsrm/v1.2/wsrm.html" target="_top">WS-ReliableMessaging
                        v1.2</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v2.0 : <a class="link" href="http://docs.oasis-open.org/ws-rx/wsrmp/v1.2/wsrmp.html" target="_top">WS-ReliableMessaging
                        Policy v1.2</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v2.0 : <a class="link" href="http://docs.oasis-open.org/ws-rx/wsmc/v1.1/wsmc.html" target="_top">WS-MakeConnection
                        v1.1</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"></td></tr><tr><td>Atomic Transactions (OASIS standards)</td><td>since v2.1 : <a class="link" href="http://docs.oasis-open.org/ws-tx/wstx-wsat-1.2-spec-os.pdf" target="_top">WS-AtomicTransaction
                        v1.2</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v2.1 : <a class="link" href="http://docs.oasis-open.org/ws-tx/wstx-wscoor-1.2-spec-os.pdf" target="_top">WS-Coordination
                        v1.2</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"></td></tr><tr><td>Security (OASIS standards)</td><td>since v1.0 : <a class="link" href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf" target="_top">WS-Security
                        v1.0</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v1.0 : <a class="link" href="http://www.oasis-open.org/committees/download.php/16790/wss-v1.1-spec-os-SOAPMessageSecurity.pdf" target="_top">WS-Security
                        v1.1</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v1.0 : <a class="link" href="http://specs.xmlsoap.org/ws/2005/07/securitypolicy/ws-securitypolicy.pdf" target="_top">WS-SecurityPolicy
                        v1.1</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v1.3 : <a class="link" href="http://docs.oasis-open.org/ws-sx/ws-securitypolicy/200702/ws-securitypolicy-1.2-spec-cs.html" target="_top">WS-SecurityPolicy
                        v1.2</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v1.0 : <a class="link" href="http://specs.xmlsoap.org/ws/2005/02/trust/WS-Trust.pdf" target="_top">WS-Trust
                        v1.2</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v1.3 : <a class="link" href="http://docs.oasis-open.org/ws-sx/ws-trust/200512/ws-trust-1.3-os.html" target="_top">WS-Trust
                        v1.3</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v2.0 : <a class="link" href="http://docs.oasis-open.org/ws-sx/ws-trust/v1.4/os/ws-trust-1.4-spec-os.html" target="_top">WS-Trust
                        v1.4</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v1.0 : <a class="link" href="http://specs.xmlsoap.org/ws/2005/02/sc/WS-SecureConversation.pdf" target="_top">WS-SecureConversation
                        v1.2</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v1.3 : <a class="link" href="http://docs.oasis-open.org/ws-sx/ws-secureconversation/200512/ws-secureconversation-1.3-os.html" target="_top">WS-SecureConversation
                        v1.3</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"> since v2.0 : <a class="link" href="http://docs.oasis-open.org/ws-sx/ws-secureconversation/v1.4/os/ws-secureconversation-1.4-spec-os.html" target="_top">WS-SecureConversation
                        v1.4</a> <br xmlns:fo="http://www.w3.org/1999/XSL/Format"></td></tr><tr><td>Security Profiles (OASIS standards)</td><td>since v1.3 All 1.0 and 1.1 profiles listed
                        <a class="link" href="http://www.oasis-open.org/committees/tc_home.php?wg_abbrev=wss" target="_top">here</a>
                        except <a class="link" href="http://docs.oasis-open.org/wss/oasis-wss-rel-token-profile-1.0.pdf" target="_top">Web
                        Services Security REL Token Profile V1.0</a>
                        <br xmlns:fo="http://www.w3.org/1999/XSL/Format"></td></tr></tbody></table></div></div><br class="table-break"><p>Metro 1.3 + and WCF in .NET 3.5 implement the same
        specifications.</p><p>Metro 1.0 - 1.2 and WCF in .NET 3.0 implement the same
        specifications.</p><div class="section" title="1.4.1.&nbsp;Bootstrapping and Configuration Specifications"><div class="titlepage"><div><div><h3 class="title"><a name="ahiat"></a>1.4.1.&nbsp;Bootstrapping and Configuration Specifications</h3></div></div></div><p>Bootstrapping and configuring involves a client getting a
            web service URL (perhaps from a service registry) and obtaining
            the information needed to build a web services client that is
            capable of accessing and consuming a web service over the
            Internet. This information is usually obtained from a WSDL file.
            <a class="xref" href="#ahiau" title="Figure&nbsp;1.3.&nbsp;Bootstrapping and Configuration Specifications">Bootstrapping and Configuration Specifications</a> shows the
            specifications that were implemented to support bootstrapping and
            configuration.</p><div class="figure"><a name="ahiau"></a><p class="title"><b>Figure&nbsp;1.3.&nbsp;Bootstrapping and Configuration Specifications</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/BootstrappingConfigStandards.png" height="360" alt="Bootstrapping and Configuration Specifications"></td></tr></table></div></div></div><br class="figure-break"><p>In addition to the Core XML specifications, bootstrapping
            and configuration was implemented using the following
            specifications:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>WSDL</em></span>: WSDL is a standardized
                    XML format for describing network services. The
                    description includes the name of the service, the location
                    of the service, and ways to communicate with the service,
                    that is, what transport to use. WSDL descriptions can be
                    stored in service registries, published on the Internet,
                    or both.</p></li><li class="listitem"><p><span class="emphasis"><em>Web Services Policy</em></span>: This
                    specification provides a flexible and extensible grammar
                    for expressing the capabilities, requirements, and general
                    characteristics of a web service. It provides the
                    mechanisms needed to enable web services applications to
                    specify policy information in a standardized way. However,
                    this specification does not provide a protocol that
                    constitutes a negotiation or message exchange solution for
                    web Services. Rather, it specifies a building block that
                    is used in conjunction with the WS-Metadata Exchange
                    protocol. When applied in the web services model, policy
                    is used to convey conditions on interactions between two
                    web service endpoints. Typically, the provider of a web
                    service exposes a policy to convey conditions under which
                    it provides the service. A requester might use the policy
                    to decide whether or not to use the service.</p></li><li class="listitem"><p><span class="emphasis"><em>Web Services Metadata Exchange</em></span>:
                    This specification defines a protocol to enable a consumer
                    to obtain a web service's metadata, that is, its WSDL and
                    policies. It can be thought of as a bootstrap mechanism
                    for communication.</p></li></ul></div></div><div class="section" title="1.4.2.&nbsp;Message Optimization Specifications"><div class="titlepage"><div><div><h3 class="title"><a name="ahiav"></a>1.4.2.&nbsp;Message Optimization Specifications</h3></div></div></div><p>Message optimization is the process of transmitting web
            services messages in the most efficient manner. It is achieved in
            web services communication by encoding messages prior to
            transmission and then de-encoding them when they reach their final
            destination.</p><p><a class="xref" href="#ahiaw" title="Figure&nbsp;1.4.&nbsp;Message Optimization Specifications">Message Optimization Specifications</a> shows the
            specifications that were implemented to optimize communication
            between two web service endpoints.</p><div class="figure"><a name="ahiaw"></a><p class="title"><b>Figure&nbsp;1.4.&nbsp;Message Optimization Specifications</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/MessageOptimizationStandards.png" height="360" alt="Message Optimization Specifications"></td></tr></table></div></div></div><br class="figure-break"><p>In addition to the Core XML specifications, optimization was
            implemented using the following specifications:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>SOAP</em></span>: With SOAP
                    implementations, client requests and web service responses
                    are most often transmitted as SOAP messages over HTTP to
                    enable a completely interoperable exchange between clients
                    and web services, all running on different platforms and
                    at various locations on the Internet. HTTP is a familiar
                    request-and response standard for sending messages over
                    the Internet, and SOAP is an XML-based protocol that
                    follows the HTTP request-and-response model. In SOAP 1.1,
                    the SOAP portion of a transported message handles the
                    following: </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Defines an XML-based envelope to describe what
                                is in the message and how to process the
                                message.</p></li><li class="listitem"><p>Includes XML-based encoding rules to express
                                instances of application-defined data types within
                                the message.</p></li><li class="listitem"><p>Defines an XML-based convention for
                                representing the request to the remote service and
                                the resulting response.</p><p>In SOAP 1.2 implementations, web service
                                endpoint addresses can be included in the XML-based
                                SOAP envelope, rather than in the transport header
                                (for example in the HTTP transport header), thus
                                enabling SOAP messages to be transport
                                independent.</p></li></ul></div></li><li class="listitem"><p><span class="emphasis"><em>Web Services Addressing</em></span>: This
                    specification defines a endpoint reference representation.
                    A web service endpoint is an entity, processor, or
                    resource that can be referenced and to which web services
                    messages can be addressed. Endpoint references convey the
                    information needed to address a web service endpoint. The
                    specification defines two constructs: message addressing
                    properties and endpoint references, that normalize the
                    information typically provided by transport protocols and
                    messaging systems in a way that is independent of any
                    particular transport or messaging system. This is
                    accomplished by defining XML tags for including web
                    service addresses in the SOAP message, instead of the HTTP
                    header. The implementation of these features enables
                    messaging systems to support message transmission in a
                    transport-neutral manner through networks that include
                    processing nodes such as endpoint managers, firewalls, and
                    gateways.</p></li><li class="listitem"><p><span class="emphasis"><em>Web Services Secure
                    Conversation</em></span>: This specification provides
                    better message-level security and efficiency in
                    multiple-message exchanges in a standardized way. It
                    defines basic mechanisms on top of which secure messaging
                    semantics can be defined for multiple-message exchanges
                    and allows for contexts to be established and potentially
                    more efficient keys or new key material to be exchanged,
                    thereby increasing the overall performance and security of
                    the subsequent exchanges.</p></li><li class="listitem"><p><span class="emphasis"><em>SOAP MTOM</em></span>: The SOAP Message
                    Transmission Optimization Mechanism (MTOM), paired with
                    the XML-binary Optimized Packaging (XOP), provides
                    standard mechanisms for optimizing the transmission format
                    of SOAP messages by selectively encoding portions of the
                    SOAP message, while still presenting an XML Infoset to the
                    SOAP application. This mechanism enables the definition of
                    a hop-by-hop contract between a SOAP node and the next
                    SOAP node in the SOAP message path so as to facilitate the
                    efficient pass-through of optimized data contained within
                    headers or bodies of SOAP messages that are relayed by an
                    intermediary. Further, it enables message optimization to
                    be done in a binding independent way.</p></li></ul></div></div><div class="section" title="1.4.3.&nbsp;Reliable Messaging Specifications"><div class="titlepage"><div><div><h3 class="title"><a name="ahiax"></a>1.4.3.&nbsp;Reliable Messaging Specifications</h3></div></div></div><p>Reliability (in terms of WS-ReliableMessaging) is measured
            by a system's ability to deliver messages from point A to point B
            regardless of network errors. <a class="xref" href="#ahiay" title="Figure&nbsp;1.5.&nbsp;Reliable Messaging Specifications">Reliable Messaging Specifications</a> shows the specifications that were
            implemented to ensure reliable delivery of messages between two
            web services endpoints.</p><div class="figure"><a name="ahiay"></a><p class="title"><b>Figure&nbsp;1.5.&nbsp;Reliable Messaging Specifications</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/reliableMessagingStandards.png" height="360" alt="Reliable Messaging Specifications"></td></tr></table></div></div></div><br class="figure-break"><p>In addition to the Core XML specifications and supporting
            standards (Web Services Security and Web Services Policy, which
            are required building blocks), the reliability feature is
            implemented using the following specifications:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Web Services Reliable
                    Messaging</em></span>: This specification defines a
                    standardized way to identify, track, and manage the
                    reliable delivery of messages between exactly two parties,
                    a source and a destination, so as to recover from failures
                    caused by messages being lost or received out of order.
                    The specification is also extensible so it allows
                    additional functionality, such as security, to be tightly
                    integrated. The implementation of this specification
                    integrates with and complements the Web Services Security,
                    and the Web Services Policy implementations.</p></li><li class="listitem"><p><span class="emphasis"><em>Web Services Coordination</em></span>: This
                    specification defines a framework for providing protocols
                    that coordinate the actions of distributed applications.
                    This framework is used by Web Services Atomic
                    Transactions. The implementation of this specification
                    enables the following capabilities: </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Enables an application service to create the
                                context needed to propagate an activity to other
                                services and to register for coordination
                                protocols.</p></li><li class="listitem"><p>Enables existing transaction processing,
                                workflow, and other coordination systems to hide
                                their proprietary protocols and to operate in a
                                heterogeneous environment.</p></li><li class="listitem"><p>Defines the structure of context and the
                                requirements so that context can be propagated
                                between cooperating services.</p></li></ul></div></li><li class="listitem"><p><span class="emphasis"><em>Web Services Atomic
                    Transactions</em></span>: This specification defines a
                    standardized way to support two-phase commit semantics
                    such that either all operations invoked within an atomic
                    transaction succeed or are all rolled back.
                    Implementations of this specification require the
                    implementation of the Web Services Coordination
                    specification.</p></li></ul></div></div><div class="section" title="1.4.4.&nbsp;Security Specifications"><div class="titlepage"><div><div><h3 class="title"><a name="ahiaz"></a>1.4.4.&nbsp;Security Specifications</h3></div></div></div><p><a class="xref" href="#ahiba" title="Figure&nbsp;1.6.&nbsp;Web Services Security Specifications">Web Services Security Specifications</a> shows the
            specifications implemented to secure communication between two web
            service endpoints and across intermediate endpoints.</p><div class="figure"><a name="ahiba"></a><p class="title"><b>Figure&nbsp;1.6.&nbsp;Web Services Security Specifications</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/webServicesSecurityStandards.png" height="360" alt="Web Services Security Specifications"></td></tr></table></div></div></div><br class="figure-break"><p>In addition to the Core XML specifications, the security
            feature is implemented using the following specifications:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Web Services Security</em></span>: This
                    specification defines a standard set of SOAP extensions
                    that can be used when building secure web services to
                    implement message content integrity and confidentiality.
                    The implementation provides message content integrity and
                    confidentiality even when communication traverses
                    intermediate nodes, thus overcoming a short coming of SSL.
                    The implementation can be used within a wide variety of
                    security models including PKI, Kerberos, and SSL and
                    provides support for multiple security token formats,
                    multiple trust domains, multiple signature formats, and
                    multiple encryption technologies.</p></li><li class="listitem"><p><span class="emphasis"><em>Web Services Policy</em></span>: This
                    specification provides a flexible and extensible grammar
                    for expressing the capabilities, requirements, and general
                    characteristics of a web service. It provides a framework
                    and a model for the expression of these properties as
                    policies and is a building block for Web Services Security
                    policy.</p></li><li class="listitem"><p><span class="emphasis"><em>Web Services Trust</em></span>: This
                    specification supports the following capabilities in a
                    standardized way: </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Defines extensions to Web Services Security
                                that provide methods for issuing, renewing, and
                                validating security tokens used by Web services
                                security.</p></li><li class="listitem"><p>Establishes, assesses the presence of, and
                                brokers trust relationships.</p></li></ul></div></li><li class="listitem"><p><span class="emphasis"><em>Web Services Secure
                    Conversation</em></span>: This specification defines a
                    standardized way to provide better message-level security
                    and efficiency in multiple-message exchanges. The Metro
                    implementation provides basic mechanisms on top of which
                    secure messaging semantics can be defined for
                    multiple-message exchanges and allows for contexts to be
                    established along with more efficient keys or new key
                    material. This approach increases the overall performance
                    and security of the subsequent exchanges. While the Web
                    Services Security specification, described above, focuses
                    on the message authentication model, it does leave
                    openings for several forms of attacks. The Secure
                    Conversation authentication specification defines a
                    standardized way to authenticate a series of messages,
                    thereby addressing the short comings of Web Services
                    Security. With the Web Services Security Conversation
                    model, the security context is defined as a new Web
                    Services security token type that is obtained using a
                    binding of Web Services Trust.</p></li><li class="listitem"><p><span class="emphasis"><em>Web Services Security Policy</em></span>:
                    This specification defines a standard set of patterns or
                    sets of assertions that represent common ways to describe
                    how messages are secured on a communications path. The
                    Metro implementation allows flexibility in terms of
                    tokens, cryptography, and mechanisms used, including
                    leveraging transport security, but is specific enough to
                    ensure interoperability based on assertion matching by web
                    service clients and web services providers.</p></li></ul></div></div></div><div class="section" title="1.5.&nbsp;How the Metro Technologies Work"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahibb"></a>1.5.&nbsp;How the Metro Technologies Work</h2></div></div></div><p>The following sections provide a high-level description of how
        the message optimization, reliable messaging, and security
        technologies work.</p><div class="section" title="1.5.1.&nbsp;How Message Optimization Works"><div class="titlepage"><div><div><h3 class="title"><a name="ahibc"></a>1.5.1.&nbsp;How Message Optimization Works</h3></div></div></div><p>Message optimization ensures that web services messages are
            transmitted over the Internet in the most efficient manner.
            Because XML is a textual format, binary files must be represented
            using character sequences before they can be embedded in an XML
            document. A popular encoding that permits this embedding is known
            as base64 encoding, which corresponds to the XML Schema data type
            xsd:base64Binary. In a web services toolkit that supports a
            binding framework, a value of this type must be encoded before
            transmission and decoded before binding. The encoding and decoding
            process is expensive and the costs increase linearly as the size
            of the binary object increases.</p><p>Message optimization enables web service endpoints to
            identify large binary message payloads, remove the message
            payloads from the body of the SOAP message, encode the message
            payloads using an efficient encoding mechanism (effectively
            reducing the size of the payloads), re-insert the message payloads
            into the SOAP message as attachments (the file is linked to the
            SOAP message body by means of an Include tag). Thus, message
            optimization is achieved by encoding binary objects prior to
            transmission and then de-encoding them when they reach there final
            destination.</p><p>The optimization process is really quite simple. To effect
            optimized message transmissions, the sending endpoint checks the
            body of the SOAP message for XML encoded binary objects that
            exceed a predetermined size and encodes those objects for
            efficient transmission over the Internet.</p><p>SOAP MTOM, paired with the XML-binary Optimized Packaging
            (XOP), addresses the inefficiencies related to the transmission of
            binary data in SOAP documents. Using MTOM and XOP, XML messages
            are dissected in order to transmit binary files as MIME
            attachments in a way that is transparent to the application. This
            transformation is restricted to base64 content in canonical form
            as defined in XSD Datatypes as specified in XML Schema Part 2:
            Datatypes Second Edition, W3C Recommendation 28 October
            2004.</p><p>Thus, the Metro technology achieves message optimization
            through an implementation of the MTOM and XOP specifications. With
            the message optimization feature enabled, small binary objects are
            sent in-line in the SOAP body. For large binary objects, this
            becomes quite inefficient, so the binary object is separated from
            the SOAP body, encoded, sent as an attachment to the SOAP message,
            and decoded when it reaches its destination endpoint.</p></div><div class="section" title="1.5.2.&nbsp;How Reliable Messaging Works"><div class="titlepage"><div><div><h3 class="title"><a name="ahibd"></a>1.5.2.&nbsp;How Reliable Messaging Works</h3></div></div></div><p>When reliable messaging is enabled, messages are grouped
            into sequences, which are defined by the client's proxies. Each
            proxy corresponds to a message sequence, which consists of all of
            the request messages for that proxy. Each message contains a
            sequence header. The header includes a sequence identifier that
            identifies the sequence and a unique message number that indicates
            the order of the message in the sequence. The web service endpoint
            uses the sequence header information to group the messages and, if
            the Ordered Delivery option is selected, to process them in the
            proper order. Additionally, if secure conversation is enabled,
            each message sequence is assigned its own security context token.
            The security context token is used to sign the handshake messages
            that initialize communication between two web service endpoints
            and subsequent application messages.</p><p>Thus, using the Reliable Messaging technology, web service
            endpoints collaborate to determine which messages in a particular
            application message sequence arrived at the destination endpoint
            and which messages require resending. The reliable messaging
            protocol requires that the destination endpoint return
            message-receipt acknowledgements that include the sequence
            identifier and the message number of each message received. If the
            source determines that a message was not received by the
            destination, it resends the message and requests an
            acknowledgement. Once the source has sent all messages for a given
            sequence and their receipt has been acknowledged by the
            destination, the source terminates the sequence.</p><p>The web service destination endpoint in turn sends the
            application messages along to the application. If ordered delivery
            is configured (optional), the destination endpoint reconstructs a
            complete stream of messages for each sequence in the exact order
            in which the messages were sent and sends them along to the
            destination application. Thus, through the use of the reliable
            messaging protocol, the destination endpoint is able to provide
            the following delivery assurances to the web service
            application:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Each message is delivered to the destination
                    application at least once.</p></li><li class="listitem"><p>Each message is delivered to the destination
                    application at most once.</p></li><li class="listitem"><p>Sequences of messages are grouped by sequence
                    identifiers and delivered to the destination application
                    in the order defined by the message numbers.</p></li></ul></div><p><a class="xref" href="#ahibe" title="Figure&nbsp;1.7.&nbsp;Application Message Exchange Without Reliable Messaging">Application Message Exchange Without Reliable
                Messaging</a> shows a
            simplified view of client and web service application message
            exchanges when the Reliable Messaging protocol is not used.</p><div class="figure"><a name="ahibe"></a><p class="title"><b>Figure&nbsp;1.7.&nbsp;Application Message Exchange Without Reliable
                Messaging</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/appMessageExWORM.png" height="360" alt="Application Message Exchange Without Reliable Messaging"></td></tr></table></div></div></div><br class="figure-break"><p>When the Reliable Messaging protocol is not used,
            application messages flow over the HTTP connection with no
            delivery assurances. If messages are lost in transit or delivered
            out of order, the communicating endpoints have no way of
            knowing.</p><p><a class="xref" href="#ahibf" title="Figure&nbsp;1.8.&nbsp;Application Message Exchange with Reliable Messaging Enabled">Application Message Exchange with Reliable Messaging
                Enabled</a> shows a
            simplified view of client and web service application message
            exchanges when reliable messaging is enabled.</p><div class="figure"><a name="ahibf"></a><p class="title"><b>Figure&nbsp;1.8.&nbsp;Application Message Exchange with Reliable Messaging
                Enabled</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/appMessageExWRM.png" height="360" alt="Application Message Exchange with Reliable Messaging Enabled"></td></tr></table></div></div></div><br class="figure-break"><p>With reliable messaging enabled, the Reliable Messaging
            source module is plugged into the Metro web service client. The
            source module transmits the application messages and keeps copies
            of the messages until their receipt is acknowledged by the
            destination module through the exchange of protocol messages. The
            destination module acknowledges messages and optionally buffers
            them for ordered-delivery guarantee. After guaranteeing order, if
            configured, the destination module allows the messages to proceed
            through the Metro dispatch for delivery to the endpoint or
            application destination.</p></div><div class="section" title="1.5.3.&nbsp;How Security Works"><div class="titlepage"><div><div><h3 class="title"><a name="ahibg"></a>1.5.3.&nbsp;How Security Works</h3></div></div></div><p>The following sections describe how the Metro security
            technologies, security policy, trust, and secure conversation
            work.</p><div class="section" title="1.5.3.1.&nbsp;How Security Policy Works"><div class="titlepage"><div><div><h4 class="title"><a name="ahibh"></a>1.5.3.1.&nbsp;How Security Policy Works</h4></div></div></div><p>The Metro Web Service Security Policy implementation
                builds on the features provided by the Web Service Policy
                implementation in Metro. It enables users to use XML elements
                to specify the security requirements of a web service
                endpoint, that is, how messages are secured on the
                communication path between the client and the web service. The
                web service endpoint specifies the security requirements to
                the client as assertions (see <a class="xref" href="#ahibi" title="Figure&nbsp;1.9.&nbsp;Security Policy Exchange">Security Policy Exchange</a>).</p><div class="figure"><a name="ahibi"></a><p class="title"><b>Figure&nbsp;1.9.&nbsp;Security Policy Exchange</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/securityPolicyExchange.png" height="360" alt="Security Policy Exchange"></td></tr></table></div></div></div><br class="figure-break"><p>The security policy model uses the policy specified in
                the WSDL file for associating policy assertions with web
                service communication. As a result, whenever possible, the
                security policy assertions do not use parameters or
                attributes. This enables first-level, <code class="code">QName</code>-based
                assertion matching to be done at the framework level without
                security domain-specific knowledge. The first-level matching
                provides a narrowed set of policy alternatives that are shared
                by the client and web service endpoint when they attempt to
                establish a secure communication path.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>A <code class="code">QName</code> is a qualified name, as
                    specified by the <a class="link" href="http://www.w3.org/TR/xmlschema-2/#QName" target="_top">XML
                    Schema Part2: Datatypes specification</a>, <a class="link" href="http://www.w3.org/TR/REC-xml-names/#ns-qualnames" target="_top">Namespaces
                    in XML</a>, and <a class="link" href="http://www.w3.org/XML/xml-names-19990114-errata" target="_top">Namespaces
                    in XML Errata</a>. A qualified name is made up of a
                    namespace URI, a local part, and a prefix.</p></div><p>The benefit of representing security requirements as
                assertions is that <code class="code">QName</code> matching is sufficient
                to find common security alternatives and that many aspects of
                security can be factored out and reused. For example, it may
                be common that the security mechanism is constant for a web
                service endpoint, but that the message parts that are
                protected, or secured, may vary by message action.</p><p>The following types of assertions are supported:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Protection assertions</em></span>:
                        Define the scope of security protection. These
                        assertions identify the message parts that are to be
                        protected and how they are to be protected, that is,
                        whether data integrity and confidentiality mechanisms
                        are to be used.</p></li><li class="listitem"><p><span class="emphasis"><em>Conditional assertions</em></span>:
                        Define general aspects or preconditions of the
                        security. These assertions define the relationships
                        within and the characteristics of the environment in
                        which security is being applied, such as the tokens
                        that can be used, which tokens are for integrity or
                        confidentiality protection, applicable algorithms to
                        use, and so on.</p></li><li class="listitem"><p><span class="emphasis"><em>Security binding
                        assertions</em></span>: Define the security mechanism
                        that is used to provide security. These assertions are
                        a logical grouping that defines how the conditional
                        assertions are used to protect the indicated message
                        parts. For example, the assertions might specify that
                        an asymmetric token is to be used with a digital
                        signature to provide integrity protection, and that
                        parts are to be encrypted with a symmetric key, which
                        is then encrypted using the public key of the
                        recipient. In their simplest form, the security
                        binding assertions restrict what can be placed in the
                        <code class="code">wsse:Security</code> header and the associated
                        processing rules.</p></li><li class="listitem"><p><span class="emphasis"><em>Supporting token
                        assertions</em></span>: Define the token types and
                        usage patterns that can be used to secure individual
                        operations and/or parts of messages.</p></li><li class="listitem"><p><span class="emphasis"><em>Web Services Security and Trust
                        assertions</em></span>: Define the token referencing
                        and trust options that can be used.</p></li></ul></div></div><div class="section" title="1.5.3.2.&nbsp;How Trust Works"><div class="titlepage"><div><div><h4 class="title"><a name="ahibj"></a>1.5.3.2.&nbsp;How Trust Works</h4></div></div></div><p><a class="xref" href="#ahibk" title="Figure&nbsp;1.10.&nbsp;Trust and Secure Conversation">Trust and Secure Conversation</a> shows
                how the Web Services Trust technology establishes
                trust.</p><div class="figure"><a name="ahibk"></a><p class="title"><b>Figure&nbsp;1.10.&nbsp;Trust and Secure Conversation</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/trustSecureConversation.png" height="360" alt="Trust and Secure Conversation"></td></tr></table></div></div></div><br class="figure-break"><p>To establish trust between a client, a Security Token
                Service, and a web service:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The client establishes an HTTPS connection with
                        the Secure Token Service using one of the following
                        methods: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Username Authentication and
                                    Transport Security</em></span>: The client
                                    authenticates to the Security Token Service using a
                                    username token. The Security Token Service uses a
                                    certificate to authenticate to the Client. Transport
                                    security is used for message protection.</p></li><li class="listitem"><p><span class="emphasis"><em>Mutual Authentication</em></span>:
                                    Both the client-side and server-side use X509
                                    certificates to authenticate to each other. The
                                    client request is signed using Client's X509
                                    certificate, then signed using ephemeral key. The
                                    web service signs the response using keys derived
                                    from the client's key.</p></li></ul></div></li><li class="listitem"><p>The client sends a RequestSecurityToken message
                        to the Security Token Service.</p></li><li class="listitem"><p>The Security Token Service sends a Security
                        Assertion Markup Language (SAML) token to the
                        Client.</p></li><li class="listitem"><p>The client uses the SAML token to authenticate
                        itself to the web service and trust is
                        established.</p></li></ol></div><p>All communication uses SOAP messages.</p></div><div class="section" title="1.5.3.3.&nbsp;How Secure Conversation Works"><div class="titlepage"><div><div><h4 class="title"><a name="ahibl"></a>1.5.3.3.&nbsp;How Secure Conversation Works</h4></div></div></div><p><a class="xref" href="#ahibm" title="Figure&nbsp;1.11.&nbsp;Secure Conversation">Secure Conversation</a> shows
                how the Web Services Secure Conversation technology
                establishes a secure conversation when the Trust technology is
                not used.</p><div class="figure"><a name="ahibm"></a><p class="title"><b>Figure&nbsp;1.11.&nbsp;Secure Conversation</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/secureConversation.png" height="360" alt="Secure Conversation"></td></tr></table></div></div></div><br class="figure-break"><p>To establish a secure conversation between a Client and
                a web service:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The client sends a X509 Certificate to
                        authenticate itself to the web service.</p></li><li class="listitem"><p>The web service sends a X509 Certificate to
                        authenticate itself to the client.</p></li></ol></div><p>All communication uses SOAP messages.</p></div></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;2.&nbsp;Using Metro"><div class="titlepage"><div><div><h2 class="title"><a name="using-metro"></a>Chapter&nbsp;2.&nbsp;Using Metro</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#metro-tools">2.1. Metro Tools</a></span></dt><dd><dl><dt><span class="section"><a href="#useful-tools-for-your-toolbox">2.1.1. Useful tools for your toolbox</a></span></dt></dl></dd><dt><span class="section"><a href="#using-mavenized-metro-binaries">2.2. Using Mavenized Metro Binaries</a></span></dt><dd><dl><dt><span class="section"><a href="#using-metro-in-a-maven-project">2.2.1. Using Metro in a Maven project</a></span></dt><dt><span class="section"><a href="#using-metro-in-a-non-maven-project">2.2.2. Using Metro in a non-Maven project</a></span></dt></dl></dd><dt><span class="section"><a href="#using_metro-developing_with_nb">2.3. Developing with NetBeans</a></span></dt><dd><dl><dt><span class="section"><a href="#ahibo">2.3.1. Registering GlassFish with the IDE</a></span></dt><dt><span class="section"><a href="#ahibp">2.3.2. Creating a Web Service</a></span></dt><dt><span class="section"><a href="#ahibq">2.3.3. Configuring Metro's WSIT Features in the Web
            Service</a></span></dt><dt><span class="section"><a href="#ahibr">2.3.4. Deploying and Testing a Web Service</a></span></dt><dt><span class="section"><a href="#wsit_example_with_nb-creating_wsit_client">2.3.5. Creating a Client to Consume a WSIT-Enabled Web
            Service</a></span></dt></dl></dd><dt><span class="section"><a href="#developing-with-eclipse">2.4. Developing with Eclipse</a></span></dt><dd><dl><dt><span class="section"><a href="#setup">2.4.1. Setup</a></span></dt><dt><span class="section"><a href="#create-a-metro-web-services-endpoint">2.4.2. Create a Metro Web Services Endpoint</a></span></dt><dt><span class="section"><a href="#creating-web-service-client-using-wsimport-cli">2.4.3. Creating Web Service Client using Wsimport CLI</a></span></dt><dt><span class="section"><a href="#creating-web-service-client-using-wsimport-ant-task">2.4.4. Creating Web Service Client using Wsimport Ant Task</a></span></dt><dt><span class="section"><a href="#creating-web-service-client-using-soap-ui-plugin">2.4.5. Creating Web Service Client using SOAP UI Plugin</a></span></dt></dl></dd><dt><span class="section"><a href="#logging">2.5. Logging</a></span></dt><dd><dl><dt><span class="section"><a href="#dynamic_tube-based_message_logging">2.5.1. Dynamic tube-based message logging</a></span></dt><dt><span class="section"><a href="#dumping-soap-messages-on-client">2.5.2. Dumping SOAP messages on client</a></span></dt><dt><span class="section"><a href="#dumping-soap-messages-on-server">2.5.3. Dumping SOAP messages on server</a></span></dt></dl></dd><dt><span class="section"><a href="#using-jax-ws-2.x---metro-1.x-2.0-with-java-se-6">2.6. Using JAX-WS / Metro with Java SE</a></span></dt><dd><dl><dt><span class="section"><a href="#mustanga1">2.6.1. Using JAX-WS with Java SE</a></span></dt><dt><span class="section"><a href="#mustanga3">2.6.2. Using Metro with Java SE</a></span></dt></dl></dd><dt><span class="section"><a href="#deploying-metro-endpoint">2.7. Deploying Metro endpoint</a></span></dt><dd><dl><dt><span class="section"><a href="#the-war-contents">2.7.1. The WAR Contents</a></span></dt><dt><span class="section"><a href="#using-sun-jaxws.xml">2.7.2. Using sun-jaxws.xml</a></span></dt><dt><span class="section"><a href="#using-109-deployment-descriptor">2.7.3. Using 109 Deployment Descriptor</a></span></dt><dt><span class="section"><a href="#using-spring">2.7.4. Using Spring</a></span></dt></dl></dd><dt><span class="section"><a href="#handlers-and-messagecontext">2.8. Handlers and MessageContext</a></span></dt><dd><dl><dt><span class="section"><a href="#messagecontext-in-jax-ws">2.8.1. MessageContext in JAX-WS</a></span></dt><dt><span class="section"><a href="#handlers-in-jax-ws">2.8.2. Handlers in JAX-WS</a></span></dt><dt><span class="section"><a href="#efficient-handlers-in-jax-ws-ri">2.8.3. Efficient Handlers in JAX-WS RI</a></span></dt></dl></dd><dt><span class="section"><a href="#deploying-jax-ws-with-...">2.9. Deploying Metro with ...</a></span></dt><dd><dl><dt><span class="section"><a href="#weblogic-10">2.9.1. WebLogic 12</a></span></dt></dl></dd><dt><span class="section"><a href="#developing-client-application-with-locally-packaged-wsdl">2.10. Developing client application with locally packaged
        WSDL</a></span></dt><dd><dl><dt><span class="section"><a href="#service-api-to-pass-the-wsdl-information">2.10.1. Service API to pass the WSDL information</a></span></dt><dt><span class="section"><a href="#xml-catalog">2.10.2. Xml Catalog</a></span></dt><dt><span class="section"><a href="#using--wsdllocation-switch">2.10.3. Using -wsdlLocation switch</a></span></dt></dl></dd><dt><span class="section"><a href="#how-to-invoke-and-endpoint-by-overriding-endpoint-address-in-the-wsdl">2.11. How to invoke and endpoint by overriding endpoint address in
        the WSDL</a></span></dt><dd><dl><dt><span class="section"><a href="#bindingprovider.endpoint_address_property">2.11.1. BindingProvider.ENDPOINT_ADDRESS_PROPERTY</a></span></dt><dt><span class="section"><a href="#create-service-using-updated-wsdl">2.11.2. Create Service using updated WSDL</a></span></dt></dl></dd><dt><span class="section"><a href="#maintaining-state-in-web-services">2.12. Maintaining State in Web Services</a></span></dt><dt><span class="section"><a href="#fastinfoset">2.13. FastInfoset</a></span></dt><dd><dl><dt><span class="section"><a href="#using-fastinfoset">2.13.1. Using FastInfoset</a></span></dt></dl></dd><dt><span class="section"><a href="#using_metro-ha_support">2.14. High Availability Support in Metro</a></span></dt></dl></div><div class="section" title="2.1.&nbsp;Metro Tools"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="metro-tools"></a>2.1.&nbsp;Metro Tools</h2></div></div></div><p>Metro provides these tools to help develop Web services
        applications:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><a class="link" href="http://jax-ws.java.net/2.2.10/docs/release-documentation.html#tools" target="_top">Overview</a></p></li><li class="listitem"><p><a class="link" href="http://jax-ws.java.net/2.2.10/docs/release-documentation.html#tools-wsimport" target="_top">Wsimport CLI</a></p></li><li class="listitem"><p><a class="link" href="http://jax-ws.java.net/2.2.10/docs/release-documentation.html#tools-wsimport-ant-task" target="_top">Wsimport Ant Task</a></p></li><li class="listitem"><p><a class="link" href="http://jax-ws.java.net/2.2.10/docs/release-documentation.html#tools-wsgen" target="_top">Wsgen CLI</a></p></li><li class="listitem"><p><a class="link" href="http://jax-ws.java.net/2.2.10/docs/release-documentation.html#tools-wsgen-ant-task" target="_top">Wsgen Ant Task</a></p></li><li class="listitem"><p><a class="link" href="http://jax-ws.java.net/2.2.10/docs/release-documentation.html#tools-apt" target="_top">Apt</a></p></li><li class="listitem"><p><a class="link" href="http://jax-ws-commons.java.net/jaxws-maven-plugin/" target="_top">Wsimport
                and Wsgen Maven2 plugin</a></p></li></ol></div><p>Note that these tools are located in the
        <code class="code">webservices-tools.jar</code> file in the <code class="code">lib/</code>
        subdirectory of Metro (standalone)
        download. In GlassFish these tools are located in the
        <code class="code">webservices-osgi.jar</code> under <code class="code">glassfish/modules</code>
        subdirectory. Shell script versions that of the tools are located
        under <code class="code">glassfish/bin</code>.</p><div class="section" title="2.1.1.&nbsp;Useful tools for your toolbox"><div class="titlepage"><div><div><h3 class="title"><a name="useful-tools-for-your-toolbox"></a>2.1.1.&nbsp;Useful tools for your toolbox</h3></div></div></div><p>Over the years, the Metro team has found the following tools
            to be useful for our users when working with web services.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><a class="link" href="http://www.soapui.org/" target="_top">soapUI</a> is a
                    great tool for manually sending SOAP messages to test your
                    web services quickly, or even to automate those
                    testing.</p></li><li class="listitem"><p><a class="link" href="http://wsmonitor.java.net/" target="_top">wsmonitor</a>
                    and <a class="link" href="http://tcpmon.java.net/" target="_top">tcpmon</a> are
                    great tools to monitor the communication between the
                    client and the server.</p></li></ol></div></div></div><div class="section" title="2.2.&nbsp;Using Mavenized Metro Binaries"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using-mavenized-metro-binaries"></a>2.2.&nbsp;Using Mavenized Metro Binaries</h2></div></div></div><p>Initially, all Metro releases were built using Ant-based
        infrastructure. As usual, this approach had some advantages as well as
        some disadvantages. Perhaps the main disadvantage was that it was
        difficult to manage the set of all the Metro dependencies. As a
        result, we were not able to provide first class support for our
        Maven-based users.</p><p>This has changed with <a class="link" href="http://metro.java.net/2.1/" target="_top">Metro 2.1 release</a>.
        Metro 2.1 has brought a significant change to the Metro build process
        as one of the major tasks in the release was to switch Metro build
        system from Ant to Maven. The main Metro build as well as the whole
        <a class="link" href="http://wsit.java.net" target="_top">WSIT project</a> modules
        have been fully mavenized and currently Metro is built, assembled and
        installed using Maven. Metro releases are deployed to Maven central. 
        The Metro modules share a new common root
        <code class="code">groupId</code> with a value of <code class="code">org.glassfish.metro</code>
        and can be browsed at the following location: <a class="link" href="http://search.maven.org/#search%7Cga%7C1%7Corg.glassfish.metro" target="_top">http://search.maven.org/#search%7Cga%7C1%7Corg.glassfish.metro</a>.
        All Metro binaries, sources as well as javadoc and samples are all
        available in the maven repository.
        </p><div class="section" title="2.2.1.&nbsp;Using Metro in a Maven project"><div class="titlepage"><div><div><h3 class="title"><a name="using-metro-in-a-maven-project"></a>2.2.1.&nbsp;Using Metro in a Maven project</h3></div></div></div><p>If you want to use Metro in a Maven project, you need to
            declare a dependency on the Metro runtime bundle:</p><div class="example"><a name="d0e904"></a><p class="title"><b>Example&nbsp;2.1.&nbsp;Declaring Metro non-OSGi dependencies</b></p><div class="example-contents"><pre class="programlisting">&lt;project&gt;
    ...
    &lt;dependencies&gt;
        ...
        &lt;dependency&gt;
            &lt;groupId&gt;org.glassfish.metro&lt;/groupId&gt;
            &lt;artifactId&gt;webservices-rt&lt;/artifactId&gt;
            &lt;version&gt;2.3&lt;/version&gt;
        &lt;/dependency&gt;
        ...
    &lt;/dependencies&gt;
    ...
&lt;/project&gt;</pre></div></div><br class="example-break"><p>Specifying this dependency, Maven resolves all the
            transitive dependencies and gets all the jars that
            <code class="code">webservices-rt</code> module depends on. Should you want to
            use OSGi-fied Metro bundle, you need to declare the following
            dependency instead:</p><div class="example"><a name="d0e914"></a><p class="title"><b>Example&nbsp;2.2.&nbsp;Declaring Metro OSGi dependencies</b></p><div class="example-contents"><pre class="programlisting">&lt;project&gt;
    ...
    &lt;dependencies&gt;
        ...
        &lt;dependency&gt;
            &lt;groupId&gt;org.glassfish.metro&lt;/groupId&gt;
            &lt;artifactId&gt;webservices-osgi&lt;/artifactId&gt;
            &lt;version&gt;2.3&lt;/version&gt;
        &lt;/dependency&gt;
        ...
    &lt;/dependencies&gt;
    ...
&lt;/project&gt;</pre></div></div><br class="example-break"><div class="section" title="2.2.1.1.&nbsp;Using Metro Tools from Maven"><div class="titlepage"><div><div><h4 class="title"><a name="using-metro-tools-from-maven"></a>2.2.1.1.&nbsp;Using Metro Tools from Maven</h4></div></div></div><p>Metro has Maven plugins for standard JAX-WS WSImport and
                WSGen tools and this <a class="link" href="http://jax-ws-commons.java.net/jaxws-maven-plugin/usage.html" target="_top">snippet
                from pom.xml</a> shows the usage of these maven plugins.
                More information on using these plugins is available at <a class="link" href="http://jax-ws-commons.java.net/jaxws-maven-plugin/" target="_top">JAX-WS
                Maven Plugin Project</a> site.</p></div></div><div class="section" title="2.2.2.&nbsp;Using Metro in a non-Maven project"><div class="titlepage"><div><div><h3 class="title"><a name="using-metro-in-a-non-maven-project"></a>2.2.2.&nbsp;Using Metro in a non-Maven project</h3></div></div></div><p>Even though Metro is currently Maven-based and fully
            available from a Maven repository, you can, of course, still use
            it in a non-Maven project or install it manually to your
            container. First, you need to go to the <a class="link" href="http://search.maven.org/#search%7Cga%7C1%7Ca%3A%22metro-standalone%22" target="_top">Metro
            Standalone Bundle</a> root in the Maven repository and download
            and unzip a version of your choice. For further instructions, please
            consult the <code class="code">readme.html</code> file available under the
            unzipped <code class="code">metro</code> root directory.</p></div></div><div class="section" title="2.3.&nbsp;Developing with NetBeans"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using_metro-developing_with_nb"></a>2.3.&nbsp;Developing with NetBeans</h2></div></div></div><div class="section" title="2.3.1.&nbsp;Registering GlassFish with the IDE"><div class="titlepage"><div><div><h3 class="title"><a name="ahibo"></a>2.3.1.&nbsp;Registering GlassFish with the IDE</h3></div></div></div><p>Before you create the web service, make sure GlassFish has
            been registered with the NetBeans IDE. The registered server list
            can be viewed from the <span class="guimenu">Tools</span> &#8594; <span class="guimenuitem">Servers</span> menu item.</p><div class="task" title="If necessary, to register GlassFish with the IDE:"><p class="title"><b>If necessary, to register GlassFish with the
                IDE:</b></p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Start the IDE. Choose
                        <span class="guimenu">Tools</span> &#8594; <span class="guimenuitem">Servers</span> from the main menu.
                        </strong></span></p><p>The Servers window appears.</p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Click <span class="guibutton">Add
                        Server</span>. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Select <span class="guilabel">GlassFish
                        V2 or V3</span> or <span class="guilabel">Sun Java System
                        Application Server</span>, and click
                        <span class="guibutton">Next</span>. </strong></span></p><p>The platform folder location window
                        displays.</p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Specify the platform
                        location of the server instance and the domain to
                        which you want to register, then click
                        <span class="guilabel">Next</span>. </strong></span></p><p>The Servers window displays.</p></li><li class="step" title="Step 5"><p><span class="bold"><strong>If requested, type the
                        admin username and password that you supplied when you
                        installed the web container (the defaults are
                        <code class="code">admin</code> and <code class="code">adminadmin</code>), then
                        click <span class="guilabel">Finish</span>.</strong></span></p></li></ol></div></div></div><div class="section" title="2.3.2.&nbsp;Creating a Web Service"><div class="titlepage"><div><div><h3 class="title"><a name="ahibp"></a>2.3.2.&nbsp;Creating a Web Service</h3></div></div></div><p>The starting point for developing a web service with Metro
            is a Java class file annotated with the
            <code class="code">javax.jws.WebService</code> annotation. The
            <code class="code">WebService</code> annotation defines the class as a web
            service endpoint. The following Java code shows a web service. The
            IDE will create most of this Java code for you.</p><div class="example"><a name="d0e1032"></a><p class="title"><b>Example&nbsp;2.3.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">package org.me.calculator;

import javax.jws.WebService;
import javax.jws.WebMethod;
import javax.jws.WebParam;

@WebService()
public class Calculator {
    @WebMethod(action="sample_operation")
    public String operation(@WebParam(name="param_name")
            String param) {
        // implement the web service operation here
        return param;
    }

    @WebMethod(action="add")
    public int add(@WebParam(name = "i") int i,
           @WebParam(name = "j") int j) {
        int k = i + j;
        return k;
    }
}</pre></div></div><br class="example-break"><p>Notice that this web service performs a very simple
            operation. It takes two integers, adds them, and returns the
            result.</p><div class="task" title="To Create the Web Service"><p class="title"><b>To Create the Web Service</b></p><div class="tasksummary">
                    <p>Perform the following steps to use the IDE to create
                    this web service.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Click the
                        <span class="guilabel">Services</span> tab in the left pane,
                        expand the <span class="guilabel">Servers</span> node, and
                        verify that GlassFish is listed in the left pane. If
                        it is not listed, register it by following the steps
                        in <a class="xref" href="#ahibo" title="2.3.1.&nbsp;Registering GlassFish with the IDE">Registering GlassFish with the IDE</a>.</strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Choose <span class="guimenu">File</span> &#8594; <span class="guimenuitem">New Project</span>, select <span class="guilabel">Java Web from
                        Category</span>, select <span class="guilabel">Web
                        Application</span> from
                        <span class="guilabel">Projects</span>, and click
                        <span class="guibutton">Next</span>.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Assign the project a name
                        that is representative of services that will be
                        provided by the web service (for example,
                        CalculatorApplication), set the <span class="guilabel">Project
                        Location</span> to the location where you'd like
                        to create the project, and click
                        <span class="guibutton">Next</span>. Verify that GlassFish V2
                        or V3 is the Server and that Java EE Version is Java
                        EE 5 or above. Click
                        <span class="guibutton">Finish</span>.</strong></span></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>When you create the web service project, be
                            sure to define a <span class="guilabel">Project
                            Location</span> that does not include spaces in
                            the directory name. Spaces in the directory might
                            cause the web service and web service clients to
                            fail to build and deploy properly. To avoid this
                            problem, Sun recommends that you create a directory,
                            for example <code class="code">C:\work</code>, and put your
                            project there.</p></div></li><li class="step" title="Step 4"><p><span class="bold"><strong>Right-click the
                        CalculatorApplication node and choose <span class="guimenu">New</span> &#8594; <span class="guimenuitem">Web Service</span>.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Type the web service name
                        (<code class="code">CalculatorWS</code>) and the package name
                        (<code class="code">org.me.calculator</code>) in the <span class="guilabel">Web
                        Service Name</span> and the
                        <span class="guilabel">Package</span> fields
                        respectively.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong>Select <span class="guibutton">Create
                        Web Service from Scratch</span> and click
                        <span class="guibutton">Finish</span>.</strong></span></p><p>The IDE then creates a skeleton
                        <code class="code">CalculatorWS.java</code> file for the web
                        service. This file displays in Source mode in the
                        right pane.</p></li><li class="step" title="Step 7"><p><span class="bold"><strong>In the
                        <span class="guilabel">Operations</span> box of the
                        <span class="guilabel">Design</span> view of CalculatorWS.java,
                        click <span class="guibutton">Add Operation</span>.
                        </strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong>In the upper part of the
                        <span class="guilabel">Add Operation</span> dialog box, type
                        <code class="code">add</code> in <span class="guilabel">Name</span>.
                        </strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Type <code class="code">int</code> into
                        the <span class="guilabel">Return Type</span>
                        field.</strong></span></p><p>In the Return Type field, you can either enter a
                        primitive data type or select
                        <span class="guibutton">Browse</span> to select a complex data
                        type.</p></li><li class="step" title="Step 10"><p><span class="bold"><strong>In the lower part of the
                        <span class="guilabel">Add Operation</span> dialog box, click
                        <span class="guibutton">Add</span> and create a parameter
                        named <code class="code">i</code> of type <code class="code">int</code>. Click
                        <span class="guibutton">Add</span> again and create a
                        parameter named <code class="code">j</code> of type
                        <code class="code">int</code>. </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong>Click OK at the bottom of
                        the <span class="guilabel">Add Operation</span> dialog
                        box.</strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong>Notice that the
                        <code class="code">add</code> method has been added in the
                        <span class="guilabel">Operations</span> design
                        box.</strong></span></p></li><li class="step" title="Step 13"><p><span class="bold"><strong>Click the
                        <span class="guilabel">Source</span> tab for CalculatorWS.java
                        in the right pane. Notice that the <code class="code">add</code>
                        method has been added to the source
                        code.</strong></span></p><div class="example"><a name="d0e1239"></a><p class="title"><b>Example&nbsp;2.4.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">@WebMethod(operationName="add")
public int add(@WebParam(name = "i") int i, @WebParam(name = "j") int j) {
    // TODO write your implementation code here
    return 0;
}</pre></div></div><br class="example-break"></li><li class="step" title="Step 14"><p><span class="bold"><strong>Change the
                        <code class="code">add</code> method to the following
                        :</strong></span></p><div class="example"><a name="d0e1249"></a><p class="title"><b>Example&nbsp;2.5.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">@WebMethod(operationName="add")
public int add(@WebParam(name = "i") int i, @WebParam(name = "j") int j) {
    int k = i + j;
    return k;
}</pre></div></div><br class="example-break"></li><li class="step" title="Step 15"><p><span class="bold"><strong>Save the
                        <code class="code">CalculatorWS.java</code> file.</strong></span></p></li></ol></div></div></div><div class="section" title="2.3.3.&nbsp;Configuring Metro's WSIT Features in the Web Service"><div class="titlepage"><div><div><h3 class="title"><a name="ahibq"></a>2.3.3.&nbsp;Configuring Metro's WSIT Features in the Web
            Service</h3></div></div></div><p>Now that you have coded a web service, you can configure the
            web service to use Metro's WSIT technologies.</p><p>You have a possibility to choose which .NET / METRO version
            you want your service to be compatible with. There are two
            choices: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>.NET 3.5 / METRO 1.3</p></li><li class="listitem"><p>.NET 3.0 / METRO 1.0</p></li></ol></div><p>Choose the version appropriate for your web
            service development (Note the Metro 2.0 library provided by the
            latest NetBeans and GlassFish products support either version.)
            .NET 3.5 / METRO 1.3 is selected by default. There are several
            differences in between the two versions. For .NET 3.0 / METRO 1.0
            documentation please follow this link: <a class="link" href="http://wsit-docs.java.net/releases/1-0-FCS/" target="_top">Metro 1.0
            documentation</a>.</p><p>This section describes just how to configure the Reliable
            Messaging. For a discussion of reliable messaging, see <a class="xref" href="#using_rm" title="Chapter&nbsp;10.&nbsp;Using Reliable Messaging"><i>Using Reliable Messaging</i></a>. To see how to
            secure the web service, see <a class="xref" href="#ahici" title="Chapter&nbsp;12.&nbsp;Using WSIT Security"><i>Using WSIT Security</i></a>.</p><div class="task" title="To Configure Metro's WSIT Features in the Web Service"><a name="gfrbu"></a><p class="title"><b>To Configure Metro's WSIT Features in the Web
                Service</b></p><div class="tasksummary">
                    <p>To configure a web service to use Reliable
                    Messaging, perform the following steps:</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>In the
                        <span class="guilabel">Projects</span> window, expand the
                        <span class="guilabel">Web Services</span> node under the
                        CalculatorApplication node, right-click the
                        <span class="guilabel">CalculatorWSService</span> node, and
                        choose <span class="guimenuitem">Edit Web Service
                        Attributes</span>, as shown in <a class="xref" href="#gfrat" title="Figure&nbsp;2.1.&nbsp;Editing Web Service Attributes">Editing Web Service Attributes</a>.</strong></span></p><div class="figure"><a name="gfrat"></a><p class="title"><b>Figure&nbsp;2.1.&nbsp;Editing Web Service Attributes</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/edit_ws_attribs_screen.png" height="360" alt="Editing Web Service Attributes"></td></tr></table></div></div></div><br class="figure-break"></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select the
                        <span class="guilabel">Reliable Message Delivery</span> check
                        box, as shown in <a class="xref" href="#gfrby" title="Figure&nbsp;2.2.&nbsp;Reliable Messaging Configuration Window">Reliable Messaging Configuration
                            Window</a>, and click
                        <span class="guibutton">OK</span>.</strong></span></p><div class="figure"><a name="gfrby"></a><p class="title"><b>Figure&nbsp;2.2.&nbsp;Reliable Messaging Configuration
                            Window</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/rel_mess_screen.png" height="360" alt="Reliable Messaging Configuration Window"></td></tr></table></div></div></div><br class="figure-break"><p>This setting ensures that the service sends an
                        acknowledgement to the clients for each message that
                        is delivered, thus enabling clients to recognize
                        message delivery failures and to retransmit the
                        message. This capability makes the web service a
                        "reliable" web service.</p></li><li class="step" title="Step 3"><p><span class="bold"><strong>In the left pane, expand
                        the <span class="guilabel">Web Pages</span> node and the
                        <span class="guilabel">WEB-INF</span> node, and double-click
                        the <code class="code">wsit-endpoint-classname.xml</code>
                        (<code class="code">wsit-org.me.calculator.CalculatorWS.xml</code>)
                        file to view this file. Click the
                        <span class="guilabel">Source</span> tab.</strong></span></p><p>The following tags enable reliable
                        messaging:</p><pre class="programlisting">&lt;wsp:Policy wsu:Id="CalculatorWSPortBindingPolicy"&gt;
    &lt;wsp:ExactlyOne&gt;
        &lt;wsp:All&gt;
            &lt;wsam:Addressing wsp:Optional="false"/&gt;
            &lt;wsrm:RMAssertion/&gt;
        &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
&lt;/wsp:Policy&gt;</pre></li></ol></div></div></div><div class="section" title="2.3.4.&nbsp;Deploying and Testing a Web Service"><div class="titlepage"><div><div><h3 class="title"><a name="ahibr"></a>2.3.4.&nbsp;Deploying and Testing a Web Service</h3></div></div></div><p>Now that you have configured the web service to use Metro's
            WSIT technologies, you can deploy and test it.</p><div class="task" title="To Deploy and Test a Web Service"><p class="title"><b>To Deploy and Test a Web Service</b></p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Right-click
                        <span class="guilabel">CalculatorApplication</span> in the
                        <span class="guilabel">Project</span> node, and select
                        <span class="guimenuitem">Properties</span>, then select
                        <span class="guilabel">Run</span>.</strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Type
                        <code class="code">/CalculatorWSService?wsdl</code> in the
                        <span class="guilabel">Relative URL</span> field and click
                        <span class="guibutton">OK</span>.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Right-click the
                        <span class="guilabel">Project</span> node and choose
                        <span class="guimenuitem">Run</span>. The first time
                        GlassFish is started, you will be prompted for the
                        admin password. </strong></span></p><p>The IDE starts the web container, builds the
                        application, and displays the WSDL file page in your
                        browser. You have now successfully deployed a
                        Metro-based web service.</p></li></ol></div></div></div><div class="section" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service"><div class="titlepage"><div><div><h3 class="title"><a name="wsit_example_with_nb-creating_wsit_client"></a>2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web
            Service</h3></div></div></div><p>Now that you have built and tested a web service that uses
            Metro's WSIT technologies, you can create a client that accesses
            and consumes that web service. The client will use the web
            service's WSDL to create the functionality necessary to satisfy
            the interoperability requirements of the web service.</p><div class="task" title="To Create a Client to Consume a WSIT-Enabled Web Service"><a name="gfrcf"></a><p class="title"><b>To Create a Client to Consume a WSIT-Enabled Web
                Service</b></p><div class="tasksummary">
                    <p>To create a client to access and consume the web
                    service, perform the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Choose <span class="guimenu">File</span> &#8594; <span class="guimenuitem">New Project</span>, select <span class="guilabel">Web
                        Application</span> from the <span class="guilabel">Java
                        Web</span> category and click
                        <span class="guibutton">Next</span>.</strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Name the project, for
                        example, CalculatorWSServletClient, and click
                        <span class="guibutton">Next</span>.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Verify that GlassFish V2
                        or V3 is the <span class="guilabel">Server</span> and that
                        <span class="guilabel">Java EE Version</span> is Java EE 5 or
                        above. Click <span class="guibutton">Finish</span>.
                        </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Right-click the
                        <span class="guilabel">CalculatorWSServletClient</span> node
                        and select <span class="guimenu">New</span> &#8594; <span class="guimenuitem">Web Service Client</span>. </strong></span></p><p>The <span class="guimenu">New</span> &#8594; <span class="guimenuitem">Web Service Client</span> window displays.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>NetBeans submenus are dynamic, so the
                            <span class="guilabel">Web Service Client</span> option may
                            not appear. If you do not see the <span class="guilabel">Web
                            Service Client</span> option, select <span class="guimenu">New</span> &#8594; <span class="guisubmenu">File\Folder</span> &#8594; <span class="guisubmenu">Webservices</span> &#8594; <span class="guimenuitem">Web Service Client</span>.</p></div></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select the <span class="guilabel">WSDL
                        URL</span> option.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong>Cut and paste the URL of
                        the web service that you want the client to consume
                        into the <span class="guilabel">WSDL URL</span> field.
                        </strong></span></p><p>For example, here is the URL for the
                        <code class="code">CalculatorWS</code> web service:</p><div class="example"><a name="d0e1538"></a><p class="title"><b>Example&nbsp;2.6.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">http://localhost:8080/CalculatorApplication/CalculatorWSService?wsdl</pre></div></div><br class="example-break"><p>When JAX-WS generates the web service, it
                        appends <code class="code">Service</code> to the class name by
                        default.</p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click
                        <span class="guibutton">Finish</span>. </strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong>Right-click the
                        <span class="guilabel">CalculatorWSServletClient</span> project
                        node and choose <span class="guimenu">New</span> &#8594; <span class="guimenuitem">Servlet</span>.</strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Name the servlet
                        <code class="code">ClientServlet</code>, specify the package name,
                        for example, <code class="code">org.me.calculator.client</code> and
                        click <span class="guilabel">Finish</span>.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong>To make the servlet the
                        entry point to your application, right-click the
                        <span class="guilabel">CalculatorWSServletClient</span> project
                        node, choose <span class="guimenuitem">Properties</span>,
                        click <span class="guilabel">Run</span>, type
                        <code class="code">/ClientServlet</code> in the <span class="guilabel">Relative
                        URL</span> field, and click
                        <span class="guibutton">OK</span>.</strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong>If
                        <code class="code">ClientServlet.java</code> is not already open in
                        the <span class="guilabel">Source Editor</span>, open
                        it.</strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong>In the <span class="guilabel">Source
                        Editor</span>, remove the line that comments out
                        the body of the <code class="code">processRequest</code> method.
                        </strong></span></p><p>This is the start-comment line that starts the
                        section that comments out the code:</p><div class="example"><a name="d0e1623"></a><p class="title"><b>Example&nbsp;2.7.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">/* TODO output your page here</pre></div></div><br class="example-break"></li><li class="step" title="Step 13"><p><span class="bold"><strong>Delete the end-comment
                        line that ends the section of commented out
                        code:</strong></span></p><div class="example"><a name="d0e1630"></a><p class="title"><b>Example&nbsp;2.8.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">*/</pre></div></div><br class="example-break"></li><li class="step" title="Step 14"><p><span class="bold"><strong>Add some empty lines after
                        the following line:</strong></span></p><div class="example"><a name="d0e1637"></a><p class="title"><b>Example&nbsp;2.9.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">out.println("&lt;h1&gt;Servlet ClientServlet at " +
        request.getContextPath () + "&lt;/h1&gt;");</pre></div></div><br class="example-break"></li><li class="step" title="Step 15"><p><span class="bold"><strong>Right-click in one of the
                        empty lines that you added, then choose
                        <span class="guimenuitem">Insert Code...</span> action and
                        select <span class="guibutton">Call Web Service
                        Operation</span>. Note that for older NetBeans
                        releases, this action was present under "<span class="guisubmenu">Web Service Client
                                Resources</span> &#8594; <span class="guimenuitem">Call Web Service
                                Operation</span>".</strong></span></p><p>Then <span class="guilabel">Select Operation to
                        Invoke</span> dialog box appears.</p></li><li class="step" title="Step 16"><p><span class="bold"><strong>Browse to the
                        <span class="guilabel">Add operation</span> and click
                        <span class="guibutton">OK</span>. </strong></span></p><p>The <code class="code">processRequest</code> method is as
                        follows, with bold indicating code added by the
                        IDE:</p><div class="example"><a name="d0e1676"></a><p class="title"><b>Example&nbsp;2.10.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">protected void processRequest(HttpServletRequest request,
        HttpServletResponse response) 
        throws ServletException, IOException {
    response.setContentType("text/html;charset=UTF-8");
    PrintWriter out = response.getWriter();
    out.println("&lt;html&gt;");
    out.println("&lt;head&gt;");
    out.println("&lt;title&gt;Servlet ClientServlet&lt;/title&gt;");
    out.println("&lt;/head&gt;");
    out.println("&lt;body&gt;");
    out.println("&lt;h1&gt;Servlet ClientServlet at " + request
            .getContextPath() + "&lt;/h1&gt;");
    try { // Call Web Service Operation
        org.me.calculator.client.CalculatorWS port = service
                .getCalculatorWSPort();
        // TODO initialize WS operation arguments here
        int i = 0;
        int j = 0;
        // TODO process result here
        int result = port.add(i, j);
        out.println("Result = " + result);
    } catch (Exception ex) {
        // TODO handle custom exceptions here
    }
    out.println("&lt;/body&gt;");
    out.println("&lt;/html&gt;");
    out.close();
}</pre></div></div><br class="example-break"></li><li class="step" title="Step 17"><p><span class="bold"><strong>Change the values for
                        <code class="code">int i</code> and <code class="code">int j</code> to other
                        numbers, such as 3 and 4.</strong></span></p></li><li class="step" title="Step 18"><p><span class="bold"><strong>Add a line that prints out
                        an exception, if an exception is thrown.
                        </strong></span></p><p>The <code class="code">try/catch</code> block is as follows
                        (new and changed lines from this step and the previous
                        step are highlighted in bold text):</p><div class="example"><a name="d0e1698"></a><p class="title"><b>Example&nbsp;2.11.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">try { // Call Web Service Operation
    org.me.calculator.client.CalculatorWS port =
            service.getCalculatorWSPort();
    // TODO initialize WS operation arguments here
    int i = 3;
    int j = 4;
    // TODO process result here
    int result = port.add(i, j);
    out.println("&lt;p&gt;Result: " + result);
} catch (Exception ex) {
    out.println("&lt;p&gt;Exception: " + ex);
}</pre></div></div><br class="example-break"></li><li class="step" title="Step 19"><a name="nb-create-client-to-consume-19"></a><p><span class="bold"><strong>If Reliable Messaging is
                        enabled, the client needs to close the port when done
                        or the server log will be overwhelmed with messages.
                        To close the port, first add the following line to the
                        import statements at the top of the
                        file:</strong></span></p><div class="example"><a name="d0e1705"></a><p class="title"><b>Example&nbsp;2.12.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">import com.sun.xml.ws.Closeable;</pre></div></div><br class="example-break"><p>Then add the line in bold at the end of the
                        <code class="code">try</code> block, as shown below.</p><div class="example"><a name="d0e1713"></a><p class="title"><b>Example&nbsp;2.13.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">try { // Call Web Service Operation
    org.me.calculator.client.CalculatorWS port =
            service.getCalculatorWSPort();
    // TODO initialize WS operation arguments here
    int i = 3;
    int j = 4;
    // TODO process result here
    int result = port.add(i, j);
    out.println("&lt;p&gt;Result: " + result);
    ((Closeable)port).close();
} catch (Exception ex) {
    out.println("&lt;p&gt;Exception: " + ex);
}</pre></div></div><br class="example-break"></li><li class="step" title="Step 20"><p><span class="bold"><strong>Save
                        <code class="code">ClientServlet.java</code>.</strong></span></p></li><li class="step" title="Step 21"><p><span class="bold"><strong>Right-click the project
                        node and choose <span class="guimenuitem">Run</span>.
                        </strong></span></p><p>The server starts (if it was not running
                        already), the application is built, deployed, and run.
                        The browser opens and displays the calculation
                        result.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>For NetBeans 6.x and GlassFish v3, if you are
                            getting GlassFish errors with a
                            "<code class="code">java.lang.IllegalStateException: Servlet
                            [CompletionInitiatorPortTypeImpl] and Servlet
                            [ParticipantPortTypeImpl] have the same url
                            pattern</code>" message, make sure the Metro 2.0
                            JARs were excluded from the client servlet WAR file
                            as explained in <a class="xref" href="#nb-create-client-to-consume-19" title="Step 19">Step 19</a>.</p></div></li></ol></div></div></div></div><div class="section" title="2.4.&nbsp;Developing with Eclipse"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="developing-with-eclipse"></a>2.4.&nbsp;Developing with Eclipse</h2></div></div></div><p>This document describes developing Metro WebServices on Eclipse.
        The instructions below are for <span class="bold"><strong>Eclipse for
        JavaEE</strong></span></p><div class="section" title="2.4.1.&nbsp;Setup"><div class="titlepage"><div><div><h3 class="title"><a name="setup"></a>2.4.1.&nbsp;Setup</h3></div></div></div><p>This is one time setup.</p><div class="task" title="To setup the environment in Eclipse"><p class="title"><b>To setup the environment in Eclipse</b></p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>After starting Eclipse, select the J2EE
                        perspective: <span class="guimenu">Windows</span> &#8594; <span class="guisubmenu">Open Perspective</span> &#8594; <span class="guisubmenu">Others</span> &#8594; <span class="guimenuitem">J2EE</span></p></li><li class="step" title="Step 2"><p>In the lower window you should see a tab with
                        label <span class="guilabel">Servers</span>. Select the tab and
                        right click in the window and select <span class="guisubmenu">new</span> &#8594; <span class="guimenuitem">Server</span>.</p></li><li class="step" title="Step 3"><p>To download the GlassFish server, select
                        <span class="guilabel">Download additional server
                        adapters</span>. Accept the license and wait for
                        Eclipse to restart.</p></li><li class="step" title="Step 4"><p>After Eclipse has restarted, you can create a
                        new GlassFish V2 Java EE5 server.</p></li><li class="step" title="Step 5"><p>In the creation dialog select
                        <span class="guilabel">Installed Runtimes</span> and select the
                        directory where your GlassFish installation
                        resides.</p></li></ol></div></div></div><div class="section" title="2.4.2.&nbsp;Create a Metro Web Services Endpoint"><div class="titlepage"><div><div><h3 class="title"><a name="create-a-metro-web-services-endpoint"></a>2.4.2.&nbsp;Create a Metro Web Services Endpoint</h3></div></div></div><div class="task" title="To create a Metro Web Services Endpoint"><p class="title"><b>To create a Metro Web Services Endpoint</b></p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>To create the HelloWorld service, create a new
                        dynamic Web project. Give it a name (e.g. helloworld)
                        and select as target runtime GlassFish</p></li><li class="step" title="Step 2"><div class="example"><a name="d0e1813"></a><p class="title"><b>Example&nbsp;2.14.&nbsp;HelloWorld.java</b></p><div class="example-contents"><pre class="programlisting">package sample;

import javax.jws.WebService;

@WebService
public class HelloWorld {
    public String hello(String param){
    return param + ", World";
    }
}              </pre></div></div><p><br class="example-break"></p></li><li class="step" title="Step 3"><p>Deploy the service by selecting the project and
                        select <span class="guisubmenu">Run as</span> &#8594; <span class="guimenuitem">Run on server</span>.</p></li><li class="step" title="Step 4"><p>Check in the server Window that the helloworld
                        project has a status of
                        <span class="guilabel">Synchronized</span>. If this is not the
                        case, right-click in the server window and select
                        publish.</p></li><li class="step" title="Step 5"><p>You can check that the GlassFish server is
                        started and contains the Web service by going to the
                        GlassFish admin console (<a class="link" href="http://localhost:4848/" target="_top">localhost:4848</a>)</p></li></ol></div></div><p>See Arun's <a class="link" href="http://download.java.net/javaee5/screencasts/glassfish-in-europa/ id=zlo8" target="_top">screen
            cast</a>, it talks about the above steps.</p></div><div class="section" title="2.4.3.&nbsp;Creating Web Service Client using Wsimport CLI"><div class="titlepage"><div><div><h3 class="title"><a name="creating-web-service-client-using-wsimport-cli"></a>2.4.3.&nbsp;Creating Web Service Client using Wsimport CLI</h3></div></div></div><div class="task" title="To create a Web Service Client using Wsimport CLI"><p class="title"><b>To create a Web Service Client using Wsimport
                CLI</b></p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Create a new project for the HelloWorld client
                        (an ordinary Java project suffices).</p></li><li class="step" title="Step 2"><p>Select Add Glassfish v2 as Server Runtime in
                        Build Path.</p></li><li class="step" title="Step 3"><p>Open a command window and go into the source
                        directory of that project in Eclipse. For example, if
                        the Eclipse workspace is in path </p><div class="example"><a name="d0e1863"></a><p class="title"><b>Example&nbsp;2.15.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">c:\home\vivekp\workspace</pre></div></div><p><br class="example-break"> and the name of the project is
                        HelloWorldClient, then you need to go to </p><div class="example"><a name="d0e1867"></a><p class="title"><b>Example&nbsp;2.16.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">c:\home\vivekp\workspace\helloworld\src</pre></div></div><p><br class="example-break">In this directory execute </p><div class="example"><a name="d0e1871"></a><p class="title"><b>Example&nbsp;2.17.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">wsimport -keep http://localhost:8080/helloworld/HelloWorldService?wsdl</pre></div></div><p><br class="example-break">On Linux or with Cygwin on Windows, you
                        need to escape the ? by using \? instead.</p></li><li class="step" title="Step 4"><p>Select refresh in the project view to see the
                        generated files.</p></li><li class="step" title="Step 5"><p>Now you can create the client class
                        HelloWorldClient</p></li><li class="step" title="Step 6"><p>You can execute the client, by selecting the
                        HelloWorldClient in the package explorer of Eclipse
                        and selecting <span class="guisubmenu">Run</span> &#8594; <span class="guimenuitem">Java Application</span>. In the console window of Eclipse,
                        you should see "Hello World".</p></li></ol></div></div></div><div class="section" title="2.4.4.&nbsp;Creating Web Service Client using Wsimport Ant Task"><div class="titlepage"><div><div><h3 class="title"><a name="creating-web-service-client-using-wsimport-ant-task"></a>2.4.4.&nbsp;Creating Web Service Client using Wsimport Ant Task</h3></div></div></div><p>You can pretty much avoid steps 3 - 5 above by using an Ant
            build.xml file.</p><div class="task" title="To create Web Service Client using Wsimport Ant Task"><p class="title"><b>To create Web Service Client using Wsimport Ant
                Task</b></p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Select helloworldclient in Package Exp and
                        create a new file build.xml</p></li><li class="step" title="Step 2"><p>In this file (build.xml) copy the <a class="link" href="http://weblogs.java.net/blog/vivekp/archive/tools/build.xml" target="_top">sample</a>
                        ant build script</p></li><li class="step" title="Step 3"><p>Then select build.xml in the package explorer,
                        then right click <span class="guisubmenu">Run As</span> &#8594; <span class="guimenuitem">Ant Build...</span></p></li><li class="step" title="Step 4"><p>Invoke client target, it will run wsimport ant
                        task and generate the client side stubs</p></li><li class="step" title="Step 5"><p>Invoke run to invoke the endpoint and run the
                        client or you can execute the client, by selecting the
                        HelloWorldClient in the package explorer of Eclipse
                        and selecting <span class="guisubmenu">Run</span> &#8594; <span class="guimenuitem">Java Application</span>. In the console window of Eclipse,
                        you should see "Hello World".</p></li></ol></div></div></div><div class="section" title="2.4.5.&nbsp;Creating Web Service Client using SOAP UI Plugin"><div class="titlepage"><div><div><h3 class="title"><a name="creating-web-service-client-using-soap-ui-plugin"></a>2.4.5.&nbsp;Creating Web Service Client using SOAP UI Plugin</h3></div></div></div><div class="task" title="To create Web Service Client using SOAP UI Plugin"><p class="title"><b>To create Web Service Client using SOAP UI
                Plugin</b></p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Inside Eclipse, install SOAP UI Plugin</p></li><li class="step" title="Step 2"><p>Select <span class="guimenu">Help</span> &#8594; <span class="guisubmenu">Software Updates</span> &#8594; <span class="guisubmenu">Find and Install...</span></p></li><li class="step" title="Step 3"><p>Press the <span class="guibutton">New Remote Site</span>
                        button and add
                        http://www.soapui.org/eclipse/update/site.xml as the
                        plugin URL</p></li><li class="step" title="Step 4"><p>Select <span class="guibutton">Finish</span> and the
                        follow the dialogs to install the soapUI
                        feature</p></li><li class="step" title="Step 5"><p>Create a new project for the HelloWorld client
                        (an ordinary Java project suffices).</p></li><li class="step" title="Step 6"><p>Select Add Glassfish v2 as Server Runtime in
                        Build Path.</p></li><li class="step" title="Step 7"><p>right click <span class="guilabel">BuildPath</span>+<span class="guilabel">Add Library</span>+<span class="guilabel">ServerRuntime</span>+<span class="guilabel">Glassfish v2</span></p></li><li class="step" title="Step 8"><p>Select the project and right click <span class="guisubmenu">Soap UI</span> &#8594; <span class="guimenuitem">Add SOAPUI Nature</span>, SOAP UI WebService item will be
                        added in <span class="guilabel">Project Explorer</span></p></li><li class="step" title="Step 9"><p>Select
                        <span class="guilabel">HelloWorldPortBinding</span> and right
                        click <span class="guisubmenu">GenerateCode</span> &#8594; <span class="guimenuitem">JAX-WS Artifacts</span></p></li><li class="step" title="Step 10"><p>Enter the appropriate info in the JAX-WS
                        Artifacts window </p><div class="figure"><a name="f0.44313571959891807"></a><p class="title"><b>Figure&nbsp;2.3.&nbsp;SOAP UI - JAX-WS Artifacts</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/soapui1.png" height="360" alt="SOAP UI - JAX-WS Artifacts"></td></tr></table></div></div></div><p><br class="figure-break"></p></li><li class="step" title="Step 11"><p>Click Tools and enter the location of JAX-WS
                        Wsimport, for example <code class="code">c:\glassfish\bin</code>
                        </p><div class="figure"><a name="f0.7200744608386892"></a><p class="title"><b>Figure&nbsp;2.4.&nbsp;SOAP UI - Preferences</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/soapui2.png" height="360" alt="SOAP UI - Preferences"></td></tr></table></div></div></div><p><br class="figure-break"></p></li><li class="step" title="Step 12"><p>Click OK</p></li><li class="step" title="Step 13"><p>Then click <span class="guilabel">Generate</span> on
                        JAX-WS Artifacts window, it will display a dialog box
                        that the operation was successful. Switch back to
                        <span class="guilabel">Java Perspective</span>, then refresh
                        the src folder and you can see the wsimport generated
                        classes</p></li><li class="step" title="Step 14"><p>Now implement your client code </p><div class="example"><a name="d0e2042"></a><p class="title"><b>Example&nbsp;2.18.&nbsp;HelloWorldClient.java</b></p><div class="example-contents"><pre class="programlisting">package sample;

public class HelloWorldClient {

   /**
    * @param args
    */
    public static void main(String[] args) {
        //Create Service
        HelloWorldService service = new HelloWorldService();

        //create proxy
        HelloWorld proxy = service.getHelloWorldPort();

        //invoke
        System.out.println(proxy.hello("hello"));
    }
}          </pre></div></div><p><br class="example-break"></p></li><li class="step" title="Step 15"><p>You can execute the client by selecting the
                        HelloWorldClient in the package explorer of Eclipse
                        and selecting <span class="guisubmenu">Run</span> &#8594; <span class="guimenuitem">Java Application</span>. In the console window of Eclipse,
                        you should see "Hello World".</p></li></ol></div></div></div><div class="simplesect"><div class="titlepage"></div><p>You can also use Wsimport and Wsgen Maven2 tools. For
            details see <a class="link" href="http://jax-ws-commons.java.net/jaxws-maven-plugin/" target="_top">here</a>.
            Netbeans offers an easy to use a comprehensive Metro tooling
            choice. On Eclipse you can use SOAP UI or ant build script or CLI
            or even Maven based tools, which does not look bad. There is <a class="link" href="https://bugs.eclipse.org/bugs/show_bug.cgi?id=163334" target="_top">RFE
            on Eclipse</a> and looks like it is being looked at. For the
            Quality Of Service features (WS-* features) it is little difficult
            as manually creating/modifying WSIT configuration is hard, so we
            will need an equivalent of the <a class="link" href="http://websvc.netbeans.org/wsit/" target="_top">WSIT Plugin</a>
            in NetBeans for Eclipse. Please let <a class="link" href="mailto:users@metro.java.net" target="_top">us</a> know if you are
            willing to write a WSIT plugin for Eclipse.</p></div></div><div class="section" title="2.5.&nbsp;Logging"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="logging"></a>2.5.&nbsp;Logging</h2></div></div></div><div class="section" title="2.5.1.&nbsp;Dynamic tube-based message logging"><div class="titlepage"><div><div><h3 class="title"><a name="dynamic_tube-based_message_logging"></a>2.5.1.&nbsp;Dynamic tube-based message logging</h3></div></div></div><p>As you may know, Metro creates a tubeline for each WS
            endpoint and endoint client to process SOAP messages flowing from
            and to the endpoint and or its client. Each tubeline consist of a
            set of tube instances chained together. A tube is a basic SOAP
            message processing unit. Standard Metro tubes are used to
            implement processing logic for different SOAP processing aspects
            (validation, Java-XML mapping etc.) and higher-level QoS domains
            (security, reliable messaging etc.) As an experimental feature,
            custom tubes are supported as well.</p><p>When developing an advanced web service that requires
            Quality of Service features or adding a custom tube into the
            default Metro tubeline, the ability to see the SOAP message
            content at different processing stages as the message flows
            through the tubeline may be very useful. As Metro tubeline get's
            dynamically created for each endpoint or client, Metro (since
            version 2.0) provides a new message logging facility that copes
            with the dynamics of a tubeline creation by defining a set of
            templating rules that provide a generic way for constructing
            system-level properties able to control message content logging
            before and/or after each tube's processing.</p><p>To turn on the logging for any particular tube (or a set of
            tubes) created by a specific tube factory, the developer needs to
            set one or more of the following system properties, depending on
            the target scope: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">&lt;tube_factory_class_name&gt;.dump</code>
                        - expects boolean string, if set to <code class="code">true</code>
                        turns on the logging before and after tube's
                        processing</p></li><li class="listitem"><p><code class="code">&lt;tube_factory_class_name&gt;.dump.before</code>
                        - expects boolean string, if set to <code class="code">true</code>
                        turns on the logging before tube's processing
                        </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>overrides anything set by
                                    <code class="code">&lt;tube_factory_class_name&gt;.dump</code></p></li></ul></div></li><li class="listitem"><p><code class="code">&lt;tube_factory_class_name&gt;.dump.after</code>
                        - expects boolean string, if set to <code class="code">true</code>
                        turns on the logging after tube's processing
                        </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>overrides anything set by
                                    <code class="code">&lt;tube_factory_class_name&gt;.dump</code></p></li></ul></div></li><li class="listitem"><p><code class="code">&lt;tube_factory_class_name&gt;.dump.level</code>
                        - expects string representing
                        <code class="code">java.util.logging.Level</code> , if set,
                        overrides the default message dumping level for the
                        class, which is
                        <code class="code">java.util.logging.Level.INFO</code></p></li></ul></div><p>There is a set of common system properties that control
            logging for all tubes and take the lowest precedence so that they
            can be overriden by a tube-specific properties: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">com.sun.metro.soap.dump</code> - expects a
                        boolean string, if set to <code class="code">true</code> turns on
                        the message dumping before and after each tube's
                        processing on both sides client and endpoint</p></li><li class="listitem"><p><code class="code">com.sun.metro.soap.dump.before/after</code>
                        - expects a boolean string, if set to
                        <code class="code">true</code> turns on the message dumping
                        before/after each tube's processing on both sides
                        client and endpoint.</p></li><li class="listitem"><p><code class="code">com.sun.metro.soap.dump.client/endpoint</code>
                        - expects a boolean string, if set to
                        <code class="code">true</code> turns on the message dumping before
                        and after each tube's processing on the respective
                        side (client or endpoint).</p></li><li class="listitem"><p><code class="code">com.sun.metro.soap.dump.client/endpoint.before/after</code>
                        - expects a boolean string, if set to
                        <code class="code">true</code> turns on the message dumping
                        before/after each tube's processing on the respective
                        side (client or endpoint).</p></li><li class="listitem"><p><code class="code">com.sun.metro.soap.dump.level</code> and
                        <code class="code">com.sun.metro.soap.dump.client/endpoint.level</code>
                        - controls the logging level for the whole
                        tubeline</p></li></ul></div><p> The logger root used for message dumping is
            <code class="code">&lt;tube_factory_class_name&gt;</code>.</p><p>Most of the factories create tubes on both client and
            endpoint side. To narrow down the message dumping scope, following
            system properties can be used: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">&lt;tube_factory_class_name&gt;.dump.client/endpoint</code>
                        - expects boolean string, if set to <code class="code">true</code>
                        turns on the logging before and after tube's
                        processing </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>overrides anything set by
                                    <code class="code">&lt;tube_factory_class_name&gt;.dump</code></p></li></ul></div></li><li class="listitem"><p><code class="code">&lt;tube_factory_class_name&gt;.dump.client/endpoint.before</code>
                        - expects boolean string, if set to <code class="code">true</code>
                        turns on the logging before tube's processing
                        </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>overrides anything set by
                                    <code class="code">&lt;tube_factory_class_name&gt;.dump</code>
                                    and/or
                                    <code class="code">&lt;tube_factory_class_name&gt;.dump.client/endpoint</code></p></li></ul></div></li><li class="listitem"><p><code class="code">&lt;tube_factory_class_name&gt;.dump.client/endpoint.after</code>
                        - expects boolean string, if set to <code class="code">true</code>
                        turns on the logging after tube's processing
                        </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>overrides anything set by
                                    <code class="code">&lt;tube_factory_class_name&gt;.dump</code>
                                    and/or
                                    <code class="code">&lt;tube_factory_class_name&gt;.dump.client/endpoint</code></p></li></ul></div></li><li class="listitem"><p><code class="code">&lt;tube_factory_class_name&gt;.dump.client/endpoint.level</code>
                        - expects string representing
                        <code class="code">java.util.logging.Level</code> , if set,
                        overrides anything set by
                        <code class="code">&lt;tube_factory_class_name&gt;.level</code> and
                        or the default message dumping level for the class,
                        which is
                        <code class="code">java.util.logging.Level.INFO</code></p></li></ul></div><div class="section" title="2.5.1.1.&nbsp;Examples"><div class="titlepage"><div><div><h4 class="title"><a name="examples"></a>2.5.1.1.&nbsp;Examples</h4></div></div></div><p>In the following examples we will be working with the
                <code class="code">metro-default.xml</code> file that defines the default
                Metro tubeline and looks like this:</p><div class="example"><a name="d0e2250"></a><p class="title"><b>Example&nbsp;2.19.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;metro xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
       xmlns='http://java.sun.com/xml/ns/metro/config'
       version="1.0"&gt;
   &lt;tubelines default="#default-metro-tubeline"&gt;
      &lt;tubeline name="default-metro-tubeline"&gt;
         &lt;client-side&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.assembler.jaxws.TerminalTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.assembler.jaxws.HandlerTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.assembler.jaxws.ValidationTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.assembler.jaxws.MustUnderstandTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.assembler.jaxws.MonitoringTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.assembler.jaxws.AddressingTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.tx.runtime.TxTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.rx.rm.runtime.RmTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.rx.mc.runtime.McTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.wss.provider.wsit.SecurityTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.dump.ActionDumpTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.rx.testing.PacketFilteringTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.dump.MessageDumpingTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.assembler.jaxws.TransportTubeFactory"/&gt;
         &lt;/client-side&gt;
         &lt;endpoint-side&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.assembler.jaxws.TransportTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.dump.MessageDumpingTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.rx.testing.PacketFilteringTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.dump.ActionDumpTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.wss.provider.wsit.SecurityTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.rx.mc.runtime.McTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.assembler.jaxws.AddressingTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.rx.rm.runtime.RmTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.tx.runtime.TxTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.assembler.jaxws.MonitoringTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.assembler.jaxws.MustUnderstandTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.assembler.jaxws.HandlerTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.assembler.jaxws.ValidationTubeFactory"/&gt;
            &lt;tube-factory
                    className="com.sun.xml.ws.assembler.jaxws.TerminalTubeFactory"/&gt;
         &lt;/endpoint-side&gt;
      &lt;/tubeline&gt;
   &lt;/tubelines&gt;
&lt;/metro&gt;</pre></div></div><br class="example-break"><h5><a name="d0e2254"></a>Example 1</h5><p>To turn on the the message dumping before and after
                security tube's processing on both, client and endpoint side,
                following system property needs to be set to true:
                </p><pre class="programlisting">com.sun.xml.wss.provider.wsit.SecurityTubeFactory.dump=true
com.sun.xml.wss.provider.wsit.SecurityTubeFactory.dump=true</pre><h5><a name="d0e2260"></a>Example 2</h5><p>To turn on the the message dumping only after security
                tube's processing on both, client and server side, following
                system property needs to be set to true: </p><pre class="programlisting">com.sun.xml.wss.provider.wsit.SecurityTubeFactory.dump.after=true
com.sun.xml.wss.provider.wsit.SecurityTubeFactory.dump.after=true</pre><h5><a name="d0e2266"></a>Example 3</h5><p>To turn on the the message dumping only after security
                tube's processing only on the client side, following system
                property needs to be set to true: </p><pre class="programlisting">com.sun.xml.wss.provider.wsit.SecurityTubeFactory.dump.client.after=true
com.sun.xml.wss.provider.wsit.SecurityTubeFactory.dump.client.after=true</pre><h5><a name="d0e2272"></a>Example 4</h5><p>This example sets message dumping before and after
                security processing, except for before security processing on
                the endpoint side. The logging level for message dumps is set
                to <code class="code">FINE</code> on both sides: </p><pre class="programlisting">com.sun.xml.wss.provider.wsit.SecurityTubeFactory.dump=true
com.sun.xml.wss.provider.wsit.SecurityTubeFactory.dump.endpoint.before=false
com.sun.xml.wss.provider.wsit.SecurityTubeFactory.dump.level=FINE</pre></div></div><div class="section" title="2.5.2.&nbsp;Dumping SOAP messages on client"><div class="titlepage"><div><div><h3 class="title"><a name="dumping-soap-messages-on-client"></a>2.5.2.&nbsp;Dumping SOAP messages on client</h3></div></div></div><div class="section" title="2.5.2.1.&nbsp;Transport level dump"><div class="titlepage"><div><div><h4 class="title"><a name="transport-level-dump"></a>2.5.2.1.&nbsp;Transport level dump</h4></div></div></div><p>One of the things people want to do while developing Web
                Services is to look at what the client is sending and
                receiving. To monitor soap traffic, there are some GUI tools
                like <a class="link" href="http://tcpmon.java.net/" target="_top">TCP
                Monitor</a> and <a class="link" href="http://wsmonitor.java.net/" target="_top">WSMonitor</a>.
                These monitors are implemented with a 'man in the middle'
                approach where-in, the monitor listens to a port (Client send
                requests to this port) and forwards it to another port (Server
                listens to this port). Since these tools use port forwarding,
                you need to change your Web Service client to send request to
                the port where the monitor listens (Especially, if you are
                using static clients generated by wsimport, the default
                endpoint address taken from the wsdl needs to be overidden by
                setting <code class="code">ENDPOINT_ADDRESS_PROPERTY</code> on the
                proxy).</p><p>In JAX-WS, you can monitor the request and response
                messages without changing the client. When you invoke the Web
                Service, just pass the system property <span class="bold"><strong>com.sun.xml.ws.transport.http.client.HttpTransportPipe.dump=true</strong></span>,
                it prints out the request and response message.</p><p>If you are using an Apache Ant script to run your
                client, this system property can be set as a
                <code class="code">&lt;jvmarg/&gt;</code> element:</p><div class="example"><a name="d0e2308"></a><p class="title"><b>Example&nbsp;2.20.&nbsp;Setting system properties via Ant</b></p><div class="example-contents"><pre class="programlisting">&lt;project name="metro client" basedir="."&gt;
   &lt;property environment="env"/&gt;
   &lt;property name="build.dir" location="$${basedir}/build"/&gt;
   &lt;property name="build.classes.dir" location="$${build.dir}/classes"/&gt;

   &lt;target name="run"&gt;
      &lt;java classname="client.MyClient" fork="yes"&gt;
         &lt;arg value="xxx"/&gt;
         &lt;!-- optional args[0] sent to MyClient.main() --&gt;
         &lt;arg value="xxx"/&gt;
         &lt;!-- optional args[1], etc. --&gt;
         &lt;classpath&gt;
            &lt;pathelement location="$${build.classes.dir}"/&gt;
            &lt;pathelement location="$${env.AS_HOME}/lib/javaee.jar"/&gt;
            &lt;pathelement location="$${env.AS_HOME}/lib/webservices-rt.jar"/&gt;
            &lt;pathelement location="$${env.AS_HOME}/lib/activation.jar"/&gt;
         &lt;/classpath&gt;
         &lt;jvmarg value="-Dcom
         .sun.xml.ws.transport.http.client.HttpTransportPipe.dump=true"/&gt;
      &lt;/java&gt;
   &lt;/target&gt;
&lt;/project&gt;</pre></div></div><br class="example-break"><p>Alternatively you can execute
                <code class="code">com.sun.xml.ws.transport.http.client.HttpTransportPipe.dump=true;</code>
                from your Java program to programatically enable/disable
                logging. Since you often run JAX-WS in a container where
                setting system properties can be tedious, you might find this
                easier.</p><p>With this switch enabled, you'll see message dumps like
                the following in <code class="code">System.out</code>.</p><div class="example"><a name="d0e2323"></a><p class="title"><b>Example&nbsp;2.21.&nbsp;Sample dump</b></p><div class="example-contents"><pre class="programlisting">---[HTTP request]---
SOAPAction: 
Content-Type: text/xml
Accept: text/xml, multipart/related, text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2
&lt;?xml version="1.0" ?&gt;&lt;S:Envelope xmlns:S="http://schemas.xmlsoap.org/soap/envelope/"&gt;&lt;S:Body&gt;&lt;addNumbers xmlns="http://duke.example.org"&gt;&lt;arg0&gt;10&lt;/arg0&gt;&lt;arg1&gt;20&lt;/arg1&gt;&lt;/addNumbers&gt;&lt;/S:Body&gt;&lt;/S:Envelope&gt;--------------------

---[HTTP response 200]---
Date: Thu, 17 Aug 2006 00:35:42 GMT
Content-type: text/xml
Transfer-encoding: chunked
Server: Apache-Coyote/1.1
null: HTTP/1.1 200 OK

&lt;?xml version="1.0" ?&gt;&lt;S:Envelope xmlns:S="http://schemas.xmlsoap.org/soap/envelope/"&gt;&lt;S:Body&gt;&lt;addNumbersResponse xmlns="http://duke.example.org"&gt;&lt;return&gt;30&lt;/return&gt;&lt;/addNumbersResponse&gt;&lt;/S:Body&gt;&lt;/S:Envelope&gt;--------------------
</pre></div></div><br class="example-break"><p>A similar property <span class="bold"><strong>com.sun.xml.ws.transport.local.LocalTransportPipe.dump=true</strong></span>
                is available for the local transport.</p></div><div class="section" title="2.5.2.2.&nbsp;Transport-agnostic dump"><div class="titlepage"><div><div><h4 class="title"><a name="transport-agnostic-dump"></a>2.5.2.2.&nbsp;Transport-agnostic dump</h4></div></div></div><p>The dump mechanism explained above allows you to get the
                actual bytes that are sent over the wire, as well as any
                transport specific information (such as HTTP headers), but the
                mechanism is different from transports to transports. JAX-WS
                also defines a transport-agnostic dump, which works regardless
                of what transport you use.</p><p>This dump happens after JAX-WS parses the incoming
                message into XML infoset. So you will not be able to
                investigate a well-formedness error with this dump.</p><p>To enable such dump, set the system property <span class="bold"><strong>com.sun.xml.ws.util.pipe.StandaloneTubeAssembler.dump=true</strong></span>
                or execute that as a Java program.</p></div></div><div class="section" title="2.5.3.&nbsp;Dumping SOAP messages on server"><div class="titlepage"><div><div><h3 class="title"><a name="dumping-soap-messages-on-server"></a>2.5.3.&nbsp;Dumping SOAP messages on server</h3></div></div></div><p>You can dump incoming HTTP requests and responses to
            <code class="code">System.out</code> on the server side by using the system
            property <span class="bold"><strong>com.sun.xml.ws.transport.http.HttpAdapter.dump=true</strong></span>.
            This works exactly like above (except that this works on server,
            not client.) You can also set this property programatically by
            executing <span class="bold"><strong>com.sun.xml.ws.transport.http.HttpAdapter.dump=true;</strong></span>
            as Java progrma.</p><p>The transport agnostic dump as explained above also works on
            the server for incoming messages and responses.</p></div></div><div class="section" title="2.6.&nbsp;Using JAX-WS / Metro with Java SE"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using-jax-ws-2.x---metro-1.x-2.0-with-java-se-6"></a>2.6.&nbsp;Using JAX-WS / Metro with Java SE</h2></div></div></div><div class="section" title="2.6.1.&nbsp;Using JAX-WS with Java SE"><div class="titlepage"><div><div><h3 class="title"><a name="mustanga1"></a>2.6.1.&nbsp;Using JAX-WS with Java SE</h3></div></div></div><p>Java SE ships with JAX-WS API and implementation. Unless you 
            are taking precautions, applications that use the JAX-WS API will run 
            with the JAX-WS API version built into Java SE and not a newer version 
            of JAX-WS on the application classpath. Applications that use new 
            functions of the JAX-WS API will therefore fail to run. This section 
            discusses how to work around this issue by using the <a class="link" href="http://download.oracle.com/javase/6/docs/technotes/guides/standards/" target="_top">endorsed
            standards override mechanism</a>.</p><p>Java SE 5 does not include the JAX-WS API at all and does
            not suffer from the issues discussed in this chapter.</p><div class="section" title="2.6.1.1.&nbsp;Endorsed directory"><div class="titlepage"><div><div><h4 class="title"><a name="mustanga1b"></a>2.6.1.1.&nbsp;Endorsed directory</h4></div></div></div><p>You can upgrade to JAX-WS 2.2 by copying
                <code class="code">jaxws-api.jar</code> and <code class="code">jaxb-api.jar</code> into
                the JRE endorsed directory, which is
                <code class="code">$JRE_HOME/lib/endorsed</code> (or
                <code class="code">$JDK_HOME/jre/lib/endorsed</code>). (Both of these JARs
                are available in the <a class="link" href="http://jax-ws.java.net/" target="_top">JAX-WS RI 2.2.x
                download</a>.) The directory might not exist yet and in
                that case you will have to create it yourself.</p><p>Some application containers, such as Glassfish, Tomcat,
                modify the location of the endorsed directory to a different
                place. From inside the JVM, you can check the current location
                by doing
                <code class="code">System.out.println(System.getProperty("java.endorsed.dirs"));</code></p><p>Obviously you still need all the other JAX-WS jars in
                your classpath.</p><p>Please do not put all JAX-WS jars into the endorsed
                directory. This makes it impossible for JAX-WS RI to see other
                classes that it needs for its operation, such as Servlet
                classes on the server-side, or Ant classes in the tool time.
                As those are not loaded by the bootstrap classloader, you will
                get <code class="code">NoClassDefError</code> on Servlet/Ant
                classes.</p><p>Also consider that by putting the JAX-WS libraries into
                <code class="code">$JRE_HOME/lib/endorsed</code>, all applications running
                under this Java installation will run with the endorsed JAX-WS
                libraries.</p></div></div><div class="section" title="2.6.2.&nbsp;Using Metro with Java SE"><div class="titlepage"><div><div><h3 class="title"><a name="mustanga3"></a>2.6.2.&nbsp;Using Metro with Java SE</h3></div></div></div><p>Metro ships with the JAX-WS API Java SE contain JAX-WS API, too. 
            Unless you are taking precautions, applications that use the JAX-WS 
            API will run with the JAX-WS API version built into Java SE and not 
            with the JAX-WS API built into Metro on the application classpath.
            Applications that use new functions of the JAX-WS API or other
            Metro functionality will therefore fail to run.</p><p>Do not install any other JAX-WS or Metro libraries than the
            ones discussed below into an endorsed directory at the same time,
            otherwise Metro code may not be able to load classes from the
            application classpath.</p><div class="section" title="2.6.2.1.&nbsp;Tomcat"><div class="titlepage"><div><div><h4 class="title"><a name="tomcat-and-glassfish-v2.x"></a>2.6.2.1.&nbsp;Tomcat</h4></div></div></div><p>If you are running an application in Tomcat, 
                    make sure you are using the
                <code class="code">metro-on-tomcat.xml</code> installation script. They
                will copy all files into the Tomcat specific
                endorsed directories. Without that step, web applications and
                EJBs will not be able to pick up the proper JAX-WS API. In other
                words, including the Metro libraries in the WEB-INF/lib of a
                web application does not make use of the endorsed mechanism
                and the JAX-WS API cannot be used by the web
                application.</p></div><div class="section" title="2.6.2.2.&nbsp;GlassFish"><div class="titlepage"><div><div><h4 class="title"><a name="glassfish-v3"></a>2.6.2.2.&nbsp;GlassFish</h4></div></div></div><p>If you are running an application in GlassFish, Metro is 
                already included. You may install updates with the
                    <code class="code">metro-on-glassfish.xml</code> Ant script.</p></div><div class="section" title="2.6.2.3.&nbsp;Stand-alone applications"><div class="titlepage"><div><div><h4 class="title"><a name="stand-alone-applications"></a>2.6.2.3.&nbsp;Stand-alone applications</h4></div></div></div><p>If you want to run an application or Web Service client
                outside the Tomcat or GlassFish containers, you have to
                install the file <code class="code">webservices-api.jar</code> into the JRE
                endorsed directory, <code class="code">$JRE_HOME/lib/endorsed</code> (or
                <code class="code">$JDK_HOME/jre/lib/endorsed</code>). The directory might
                not exist yet and in that case you will have to create it
                yourself.</p><p>Alternatively, you can set the Java system property
                <code class="code">java.endorsed.dirs</code> to an application specific
                directory and copy the files there. See <a class="link" href="http://download.oracle.com/javase/6/docs/technotes/guides/standards/" target="_top">endorsed
                standards override mechanism</a> for more details on how to
                set an application specific endorsed directory.</p><p>You may also use the <code class="code">metro-on-glassfish.xml</code>
                or <code class="code">metro-on-tomcat.xml</code> Ant scripts to do the
                installation of webservices-api.jar into the JRE endorsed
                directory for you. Simply invoke <code class="code">ant -f
                metro-on-glassfish.xml install-api</code>. The
                <code class="code">install-api</code> target will only install
                <code class="code">webservices-api.jar</code> and will not install Metro
                into Tomcat or GlassFish. Note that you need to run this
                command as a user that has write permissions to the JRE
                endorsed directory.</p></div></div></div><div class="section" title="2.7.&nbsp;Deploying Metro endpoint"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="deploying-metro-endpoint"></a>2.7.&nbsp;Deploying Metro endpoint</h2></div></div></div><p>Before you deploy or publish your endpoint, you will need to
        package your endpoint application into a WAR file. The requirements
        when building a WAR:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>All WSDLs, Schema files should be packaged under
                WEB-INF/wsdl dir. It is recommended not to package the WSDL if
                you are doing Java-first development.</p></li><li class="listitem"><p>WebService implementation class should contain
                <code class="code">@WebService</code> annotation. Provider based endpoints
                should have <code class="code">@WebServiceProvider</code>
                annotation.</p></li><li class="listitem"><p>wsdl, service, port attributes are mandatory for
                Provider based endpoints and can be specified in
                <code class="code">@WebServiceProvider</code> annotation or deployment
                descriptor (sun-jaxws.xml).</p></li><li class="listitem"><p>Deployment descriptors, web.xml, web services deployment
                descriptor (sun-jaxws.xml or 109 or spring)</p></li></ul></div><div class="section" title="2.7.1.&nbsp;The WAR Contents"><div class="titlepage"><div><div><h3 class="title"><a name="the-war-contents"></a>2.7.1.&nbsp;The WAR Contents</h3></div></div></div><p>Typically, one creates the WAR file with a GUI development
            tool or with the <code class="code">ant</code> <code class="code">war</code> task from the
            generated artifacts from <code class="code">wsimport</code>,
            <code class="code">wsgen</code>, or <code class="code">apt</code> tools.</p><p>For example, a sample WAR file starting from a WSDL
            file:</p><div class="example"><a name="d0e2521"></a><p class="title"><b>Example&nbsp;2.22.&nbsp;Sample WAR contents (WSDL First)</b></p><div class="example-contents"><pre class="programlisting">WEB-INF/classes/hello/HelloIF.class SEI
WEB-INF/classes/hello/HelloImpl.class Endpoint
WEB-INF/sun-jaxws.xml JAX-WS RI deployment descriptor
WEB-INF/web.xml Web deployment descriptor
WEB-INF/wsdl/HelloService.wsdl WSDL
WEB-INF/wsdl/schema.xsd WSDL imports this Schema</pre></div></div><br class="example-break"></div><div class="section" title="2.7.2.&nbsp;Using sun-jaxws.xml"><div class="titlepage"><div><div><h3 class="title"><a name="using-sun-jaxws.xml"></a>2.7.2.&nbsp;Using sun-jaxws.xml</h3></div></div></div><p>Metro defines its own deployment descriptor, which is also
            known as JAX-WS RI deployment descriptor - sun-jaxws.xml.</p><p>Here is the schema for sun-jaxws.xml:</p><div class="example"><a name="d0e2533"></a><p class="title"><b>Example&nbsp;2.23.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!--

    DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS HEADER.

    Copyright (c) 1997-2012 Oracle and/or its affiliates. All rights reserved.

    The contents of this file are subject to the terms of either the GNU
    General Public License Version 2 only ("GPL") or the Common Development
    and Distribution License("CDDL") (collectively, the "License").  You
    may not use this file except in compliance with the License.  You can
    obtain a copy of the License at
    http://glassfish.java.net/public/CDDL+GPL_1_1.html
    or packager/legal/LICENSE.txt.  See the License for the specific
    language governing permissions and limitations under the License.

    When distributing the software, include this License Header Notice in each
    file and include the License file at packager/legal/LICENSE.txt.

    GPL Classpath Exception:
    Oracle designates this particular file as subject to the "Classpath"
    exception as provided by Oracle in the GPL Version 2 section of the License
    file that accompanied this code.

    Modifications:
    If applicable, add the following below the License Header, with the fields
    enclosed by brackets [] replaced by your own identifying information:
    "Portions Copyright [year] [name of copyright owner]"

    Contributor(s):
    If you wish your version of this file to be governed by only the CDDL or
    only the GPL Version 2, indicate your decision by adding "[Contributor]
    elects to include this software in this distribution under the [CDDL or GPL
    Version 2] license."  If you don't indicate a single choice of license, a
    recipient has the option to distribute your version of this file under
    either the CDDL, the GPL Version 2 or to extend the choice of license to
    its licensees as provided above.  However, if you add GPL Version 2 code
    and therefore, elected the GPL Version 2 license, then the option applies
    only if the new code is made subject to such option by the copyright
    holder.

--&gt;

&lt;xsd:schema
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:tns="http://java.sun.com/xml/ns/jax-ws/ri/runtime"
        xmlns:javaee="http://java.sun.com/xml/ns/javaee"
        targetNamespace="http://java.sun.com/xml/ns/jax-ws/ri/runtime"
        elementFormDefault="qualified"
        attributeFormDefault="unqualified"
        version="1.0"&gt;

    &lt;xsd:import namespace="http://java.sun.com/xml/ns/javaee"
                schemaLocation="http://java.sun.com/xml/ns/javaee/javaee_web_services_metadata_handler_2_0.xsd"/&gt;

    &lt;xsd:element name="endpoints"&gt;
        &lt;xsd:complexType&gt;
            &lt;xsd:sequence&gt;
                &lt;xsd:element name="endpoint" type="tns:endpointType" minOccurs="0" maxOccurs="unbounded"/&gt;
            &lt;/xsd:sequence&gt;
            &lt;xsd:attribute name="version" type="xsd:string" use="required"/&gt;
        &lt;/xsd:complexType&gt;
    &lt;/xsd:element&gt;

    &lt;xsd:complexType name="externalMetadata"&gt;
        &lt;xsd:attribute name="file" type="xsd:string" use="optional"/&gt;
        &lt;xsd:attribute name="resource" type="xsd:string" use="optional"/&gt;
    &lt;/xsd:complexType&gt;

    &lt;xsd:complexType name="endpointType"&gt;
        &lt;xsd:annotation&gt;
            &lt;xsd:documentation&gt;
                An endpoint definition has several attributes:
                &lt;ul&gt;
                    &lt;li&gt;name&lt;/li&gt;
                    - the endpoint name
                    &lt;li&gt;implementation&lt;/li&gt;
                    - the name of the endpoint implementation class
                    &lt;li&gt;wsdl&lt;/li&gt;
                    - the name of a resource corresponding to the WSDL document for the endpoint
                    &lt;li&gt;service&lt;/li&gt;
                    - the QName of the WSDL service that owns this endpoint;
                    &lt;li&gt;port&lt;/li&gt;
                    - the QName of the WSDL port for this endpoint;
                    &lt;li&gt;url-pattern&lt;/li&gt;
                    - the URL pattern this endpoint is mapped to.
                    &lt;li&gt;binding&lt;/li&gt;
                    - specify binding id for SOAP1.1 or SOAP1.2
                    &lt;li&gt;databinding&lt;/li&gt;
                    - specify databinding type - "glassfish.jaxb" for JAX-B RI (default), "eclipselink.jaxb" for Toplink
                    MOXy
                    &lt;li&gt;enable-mtom&lt;/li&gt;
                    - Enables MTOM optimization
                &lt;/ul&gt;
                &lt;p&gt;
                    &lt;b&gt;wsdl, service, port&lt;/b&gt;
                    attributes are required for provider based endpoints
                &lt;/p&gt;
                &lt;p&gt;Allowed nested element(s) is
                    &lt;b&gt;external-metadata&lt;/b&gt;
                    defining xml descriptor to be used to supplement or override annotation metadata. One element
                    defines one resource/file.
                &lt;/p&gt;
            &lt;/xsd:documentation&gt;
        &lt;/xsd:annotation&gt;

        &lt;xsd:sequence&gt;
            &lt;xsd:element name="external-metadata" type="tns:externalMetadata" minOccurs="0" maxOccurs="unbounded"/&gt;
            &lt;xsd:element ref="javaee:handler-chains" minOccurs="0" maxOccurs="1"/&gt;
        &lt;/xsd:sequence&gt;
        &lt;xsd:attribute name="name" type="xsd:string" use="required"/&gt;
        &lt;xsd:attribute name="implementation" type="xsd:string" use="required"/&gt;
        &lt;xsd:attribute name="wsdl" type="xsd:anyURI"/&gt;
        &lt;xsd:attribute name="service" type="xsd:anyURI"/&gt;
        &lt;xsd:attribute name="port" type="xsd:anyURI"/&gt;
        &lt;xsd:attribute name="url-pattern" type="xsd:anyURI" use="required"/&gt;
        &lt;xsd:attribute name="databinding" type="xsd:string"/&gt;
        &lt;xsd:attribute name="binding" type="xsd:string"/&gt;
        &lt;xsd:attribute name="enable-mtom" type="xsd:boolean"/&gt;
    &lt;/xsd:complexType&gt;

&lt;/xsd:schema&gt;</pre></div></div><br class="example-break"><p>The <code class="code">&lt;endpoints&gt;</code> element contain one or
            more <code class="code">&lt;endpoint&gt;</code> elements. Each endpoint
            represents a port in the WSDL and it contains all information
            about implementation class, servlet url-pattern, binding, WSDL,
            service, port QNames. The following shows a
            <code class="code">sun-jaxws.xml</code> file for a simple
            <code class="code">HelloWorld</code> service. sun-jaxws.xml is the schema
            instance of <a class="link" href="sun-jaxws.html" target="_top">sun-jaxws.xml</a>.</p><div class="example"><a name="d0e2553"></a><p class="title"><b>Example&nbsp;2.24.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;endpoints
        xmlns="http://java.sun.com/xml/ns/jax-ws/ri/runtime"
        version="2.0"&gt;
    &lt;endpoint
            name="MyHello"
            implementation="hello.HelloImpl"
            url-pattern="/hello"/&gt;
&lt;/endpoints&gt;</pre></div></div><br class="example-break"><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Endpoint attribute </p><div class="table"><a name="d0e2560"></a><p class="title"><b>Table&nbsp;2.1.&nbsp;Endpoint attributes</b></p><div class="table-contents"><table summary="Endpoint attributes" border="1"><colgroup><col><col align="center"><col></colgroup><thead><tr><th>Attribute</th><th align="center">Optional</th><th>Use</th></tr></thead><tbody><tr><td><code class="code">name</code></td><td align="center">N</td><td>Name of the endpoint</td></tr><tr><td><code class="code">wsdl</code></td><td align="center">Y</td><td>Primary wsdl file location in the WAR file.
                                        E.g. WEB-INF/wsdl/HelloService.wsdl. If this isn't
                                        specified, JAX-WS will generate and publish a new
                                        WSDL. When the service is developed from Java, it is
                                        recommended to omit this attribute.</td></tr><tr><td><code class="code">service</code></td><td align="center">Y</td><td>QName of WSDL service. For e.g.
                                        {http://example.org/}HelloService. When the service
                                        is developed from java, it is recommended to omit
                                        this attribute.</td></tr><tr><td><code class="code">port</code></td><td align="center">Y</td><td>QName of WSDL port. For e.g.
                                        {http://example.org/}HelloPort. When the service is
                                        developed from Java, it is recommended to omit this
                                        attribute.</td></tr><tr><td><code class="code">implementation</code></td><td align="center">N</td><td>Endpoint implementation class name. For e.g:
                                        hello.HelloImpl. The class should have
                                        <code class="code">@WebService</code> annotation. Provider based
                                        implementation class should have
                                        <code class="code">@WebServiceProvider</code> annotation.</td></tr><tr><td><code class="code">url-pattern</code></td><td align="center">N</td><td>Should match &lt;url-pattern&gt; in
                                        web.xml</td></tr><tr><td><code class="code">binding</code></td><td align="center">Y</td><td>Binding id defined in the JAX-WS API. The
                                        possible values are:
                                        <code class="code">"http://schemas.xmlsoap.org/wsdl/soap/http","http://www.w3.org/2003/05/soap/bindings/HTTP/"</code>
                                        If omitted, it is considered SOAP1.1
                                        binding.</td></tr><tr><td><code class="code">enable-mtom</code></td><td align="center">Y</td><td>Enables MTOM optimization. true or false.
                                        Default is false.</td></tr></tbody></table></div></div><p><br class="table-break"></p></li><li class="listitem"><p>Specifying Handler Chains </p><div class="example"><a name="d0e2652"></a><p class="title"><b>Example&nbsp;2.25.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;endpoints xmlns="http://java.sun.com/xml/ns/jax-ws/ri/runtime"
           version="2.0"&gt;
    &lt;endpoint name="MyHello"&gt;
        &lt;handler-chains xmlns="http://java.sun.com/xml/ns/javaee"&gt;
            &lt;handler-chain&gt;
                &lt;handler&gt;
                    &lt;handler-name&gt;MyHandler&lt;/handler-name&gt;
                    &lt;handler-class&gt;hello.MyHandler&lt;/handler-class&gt;
                &lt;/handler&gt;
            &lt;/handler-chain&gt;
        &lt;handler-chains&gt;
    &lt;/endpoint&gt;
&lt;/endpoints&gt;    </pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>External Web Service Metadata</p><div class="example"><a name="d0e2658"></a><p class="title"><b>Example&nbsp;2.26.&nbsp;</b></p><div class="example-contents"><p>
                            If there is a need to use existing implementation for web service and it is impossible to
                            change the source code to provide necessary java annotations, it is possible to use external
                            web service metadata configuration. For more information on this topic see
                            <a class="link" href="http://jax-ws.java.net/2.2.10/docs/release-documentation.html#users-guide-external-metadata" target="_top">
                                External Web Service Metadata</a>
                        </p><pre class="programlisting">&lt;?xml encoding="UTF-8" version="1.0" ?&gt;
&lt;endpoints xmlns="http://java.sun.com/xml/ns/jax-ws/ri/runtime" version="2.0"&gt;
    &lt;endpoint implementation="org.example.server.BlackboxService" url-pattern="/WS" name="WS"&gt;
        &lt;external-metadata resource="external-metadata-org.example.server.BlackboxService.xml" /&gt;
    &lt;/endpoint&gt;
&lt;/endpoints&gt;</pre></div></div><p><br class="example-break"></p></li></ul></div><div class="section" title="2.7.2.1.&nbsp;The web.xml File"><div class="titlepage"><div><div><h4 class="title"><a name="the-web.xml-file"></a>2.7.2.1.&nbsp;The web.xml File</h4></div></div></div><p>The following shows a web.xml file for a simple
                HelloWorld service. It shows the listener and servlet classes
                that need to be used when deploying Metro-based web
                services.</p><div class="example"><a name="d0e2671"></a><p class="title"><b>Example&nbsp;2.27.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE web-app PUBLIC
        "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
        "http://java.sun.com/j2ee/dtds/web-app_2_3.dtd"&gt;

&lt;web-app&gt;
   &lt;listener&gt;
      &lt;listener-class&gt;
         com.sun.xml.ws.transport.http.servlet.WSServletContextListener
      &lt;/listener-class&gt;
   &lt;/listener&gt;
   &lt;servlet&gt;
      &lt;servlet-name&gt;hello&lt;/servlet-name&gt;
      &lt;servlet-class&gt;com.sun.xml.ws.transport.http.servlet.WSServlet
      &lt;/servlet-class&gt;
      &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
   &lt;/servlet&gt;
   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;hello&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/hello&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;
   &lt;session-config&gt;
      &lt;session-timeout&gt;60&lt;/session-timeout&gt;
   &lt;/session-config&gt;
&lt;/web-app&gt;</pre></div></div><br class="example-break"></div></div><div class="section" title="2.7.3.&nbsp;Using 109 Deployment Descriptor"><div class="titlepage"><div><div><h3 class="title"><a name="using-109-deployment-descriptor"></a>2.7.3.&nbsp;Using 109 Deployment Descriptor</h3></div></div></div><p>TODO</p></div><div class="section" title="2.7.4.&nbsp;Using Spring"><div class="titlepage"><div><div><h3 class="title"><a name="using-spring"></a>2.7.4.&nbsp;Using Spring</h3></div></div></div><p>See <a class="xref" href="#springa" title="Chapter&nbsp;21.&nbsp;Using Metro With Spring"><i>Using Metro With Spring</i></a>.</p></div></div><div class="section" title="2.8.&nbsp;Handlers and MessageContext"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="handlers-and-messagecontext"></a>2.8.&nbsp;Handlers and MessageContext</h2></div></div></div><div class="section" title="2.8.1.&nbsp;MessageContext in JAX-WS"><div class="titlepage"><div><div><h3 class="title"><a name="messagecontext-in-jax-ws"></a>2.8.1.&nbsp;MessageContext in JAX-WS</h3></div></div></div><p><a class="link" href="http://jax-ws.java.net/articles/MessageContext.html" target="_top">
            A little bit about Message Context in JAX-WS </a>:This article
            explains about the context that is available to Client
            application, Handlers and Service that can be used to
            access/propagate additional contextual information.</p></div><div class="section" title="2.8.2.&nbsp;Handlers in JAX-WS"><div class="titlepage"><div><div><h3 class="title"><a name="handlers-in-jax-ws"></a>2.8.2.&nbsp;Handlers in JAX-WS</h3></div></div></div><p><a class="link" href="http://jax-ws.java.net/articles/handlers_introduction.html" target="_top">
            Introduction to Handlers in JAX-WS</a>: This article introduces
            to Handler framework in JAX-WS.</p></div><div class="section" title="2.8.3.&nbsp;Efficient Handlers in JAX-WS RI"><div class="titlepage"><div><div><h3 class="title"><a name="efficient-handlers-in-jax-ws-ri"></a>2.8.3.&nbsp;Efficient Handlers in JAX-WS RI</h3></div></div></div><p><a class="link" href="http://weblogs.java.net/blog/ramapulavarthi/archive/2007/12/extend_your_web.html" target="_top">
            Extend your Web Service applications with the new efficient
            Handlers in JAX-WS RI </a>: Use this RI extension to take
            advantage of the JAX-WS RI Message API for efficient access to
            message and other contextual information.</p></div></div><div class="section" title="2.9.&nbsp;Deploying Metro with ..."><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="deploying-jax-ws-with-..."></a>2.9.&nbsp;Deploying Metro with ...</h2></div></div></div><div class="section" title="2.9.1.&nbsp;WebLogic 12"><div class="titlepage"><div><div><h3 class="title"><a name="weblogic-10"></a>2.9.1.&nbsp;WebLogic 12</h3></div></div></div><p>Here are the steps to use the Metro 2.x/JAX-WS
            implementation instead of Oracle's JAX-WS implementation in
            Weblogic 12.1.1.0 without affecting the Weblogic domain or other
            applications under the same domain:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Create an <code class="literal">EAR</code> file and include
                    your <code class="literal">WAR</code> file inside it. Here is the
                    directory structure of the <code class="literal">EAR</code>
                    file:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="literal">META-INF/</code></p></li><li class="listitem"><p><code class="literal">META-INF/MANIFEST.MF</code></p></li><li class="listitem"><p><code class="literal">META-INF/application.xml</code></p></li><li class="listitem"><p><code class="literal">META-INF/weblogic-application.xml</code></p></li><li class="listitem"><p><code class="literal">metro-custom-tubes.war</code>
                            (your <code class="literal">.war</code> application)</p></li><li class="listitem"><p><code class="literal">APP-INF/</code></p></li><li class="listitem"><p><code class="literal">APP-INF/lib/</code></p></li><li class="listitem"><p><code class="literal">APP-INF/lib/stax-api.jar</code></p></li><li class="listitem"><p><code class="literal">APP-INF/lib/webservices-api.jar</code></p></li><li class="listitem"><p><code class="literal">APP-INF/lib/webservices-extra-api.jar</code></p></li><li class="listitem"><p><code class="literal">APP-INF/lib/webservices-extra.jar</code></p></li><li class="listitem"><p><code class="literal">APP-INF/lib/webservices-rt.jar</code></p></li><li class="listitem"><p><code class="literal">APP-INF/lib/webservices-tools.jar</code></p></li><li class="listitem"><p><code class="literal">APP-INF/classes/</code></p></li></ul></div></li><li class="listitem"><p>Include a
                    <code class="literal">META-INF/application.xml</code> file to point
                    out the name of the <code class="literal">EAR</code> file and the
                    location and context of the <code class="literal">WAR</code>
                    file:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;application xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns="http://java.sun.com/xml/ns/javaee"
             xmlns:application="http://java.sun.com/xml/ns/javaee/application_5.xsd"
             xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
                 http://java.sun.com/xml/ns/javaee/application_5.xsd"
             id="Application_ID" version="5"&gt;
  &lt;module&gt;
    &lt;web&gt;
      &lt;web-uri&gt;metro-custom-tubes.war&lt;/web-uri&gt;
      &lt;context-root&gt;metro-custom-tubes&lt;/context-root&gt;
    &lt;/web&gt;
  &lt;/module&gt;  
&lt;/application&gt;</pre></li><li class="listitem"><p>Include a
                    <code class="literal">META-INF/weblogic-application.xml</code> file
                    that uses Weblogic's class loading filtering feature to
                    override the System class loader packages and resources
                    with the ones from the application class loader:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;wls:weblogic-application xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:wls="http://www.bea.com/ns/weblogic/weblogic-application"
        xsi:schemaLocation="
            http://www.bea.com/ns/weblogic/weblogic-application
            http://www.bea.com/ns/weblogic/weblogic-application.xsd
            http://java.sun.com/xml/ns/j2ee
            http://java.sun.com/xml/ns/j2ee/j2ee_1_4.xsd"&gt;
    &lt;wls:application-param&gt;
        &lt;wls:param-name&gt;webapp.encoding.default&lt;/wls:param-name&gt;
        &lt;wls:param-value&gt;UTF-8&lt;/wls:param-value&gt;
    &lt;/wls:application-param&gt;
    &lt;wls:prefer-application-packages&gt;
        &lt;wls:package-name&gt;com.ctc.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;com.sun.xml.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;com.sun.istack.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;com.sun.msv.datatype.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;com.sun.msv.driver.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;com.sun.msv.grammar.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;com.sun.msv.reader.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;com.sun.msv.relaxns.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;com.sun.msv.scanner.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;com.sun.msv.util.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;com.sun.msv.verifier.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;com.sun.msv.writer.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;com.sun.org.apache.xml.internal.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;com.sun.wsit.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;javax.jws.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;javax.xml.bind.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;javax.xml.soap.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;javax.xml.stream.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;javax.xml.ws.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;javax.xml.activation.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;javax.xml.annotation.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;javax.xml.mail.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;javax.xml.security.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;javax.xml.registry.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;javax.xml.rpc.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;javax.xml.crypto.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;javanet.staxutils.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;jp.gr.xml.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;org.codehaus.stax2.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;org.glassfish.gmbal.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;org.iso_relax.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;org.jcp.xml.dsig.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;org.jvnet.*&lt;/wls:package-name&gt;
        &lt;wls:package-name&gt;org.relaxng.*&lt;/wls:package-name&gt;
    &lt;/wls:prefer-application-packages&gt;
    &lt;wls:prefer-application-resources&gt;
        &lt;wls:resource-name&gt;META-INF/services/javax.xml.ws.*&lt;/wls:resource-name&gt;
        &lt;wls:resource-name&gt;META-INF/services/com.sun.xml.ws.*&lt;/wls:resource-name&gt;
        &lt;wls:resource-name&gt;META-INF/services/com.sun.tools.ws.*&lt;/wls:resource-name&gt;
    &lt;/wls:prefer-application-resources&gt;
&lt;/wls:weblogic-application&gt;</pre></li><li class="listitem"><p>Make sure the <code class="literal">webservices-*.jar</code>
                    files are placed in the <code class="literal">APP-INF/lib</code>
                    directory.</p></li><li class="listitem"><p>Make sure any Metro classes you are overriding are
                    placed in the <code class="literal">APP-INF/classes</code>
                    directory.</p></li><li class="listitem"><p>Here is the directory structure of the
                    <code class="literal">WAR</code> file:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="literal">META-INF/</code></p></li><li class="listitem"><p><code class="literal">META-INF/MANIFEST.MF</code></p></li><li class="listitem"><p><code class="literal">WEB-INF/</code></p></li><li class="listitem"><p><code class="literal">WEB-INF/web.xml</code></p></li><li class="listitem"><p><code class="literal">WEB-INF/sun-jaxws.xml</code></p></li><li class="listitem"><p><code class="literal">WEB-INF/weblogic.xml</code></p></li><li class="listitem"><p><code class="literal">WEB-INF/metro.xml</code></p></li><li class="listitem"><p><code class="literal">WEB-INF/wsdl/</code></p></li><li class="listitem"><p><code class="literal">WEB-INF/wsdl/AddNumbers.wsdl</code></p></li><li class="listitem"><p><code class="literal">WEB-INF/classes/</code></p></li><li class="listitem"><p><code class="literal">WEB-INF/classes/*</code></p></li></ul></div></li><li class="listitem"><p>Include a <code class="literal">WEB-INF\weblogic.xml</code>
                    file with the <code class="literal">prefer-web-inf-classes</code>
                    entry to override the System class loader classes with the
                    ones in the <code class="literal">WEB-INF\lib</code>
                    directory:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;weblogic-web-app xmlns="http://www.bea.com/ns/weblogic/90"&gt;
    &lt;container-descriptor&gt;
        &lt;prefer-web-inf-classes&gt;true&lt;/prefer-web-inf-classes&gt;
    &lt;/container-descriptor&gt;
&lt;/weblogic-web-app&gt;</pre></li></ol></div><div class="section" title="2.9.1.1.&nbsp;Known Issues"><div class="titlepage"><div><div><h4 class="title"><a name="d0e2894"></a>2.9.1.1.&nbsp;Known Issues</h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Make sure your <code class="literal">web.xml</code> file
                        does not include the
                        <code class="literal">&lt;display-name&gt;</code> and
                        <code class="literal">&lt;description&gt;</code> elements under
                        <code class="literal">&lt;servlet&gt;</code> element because
                        they are not supported in the following 2.4 or 2.5 Web
                        Deployment Descriptor XSDs:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="link" href="http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd" target="_top">http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd</a></p></li><li class="listitem"><p><a class="link" href="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" target="_top">http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd</a></p></li></ul></div><p>Weblogic will throw this schema validation error
                        if they are present:</p><pre class="programlisting">Message icon - Error VALIDATION PROBLEMS WERE FOUND problem: 
cvc-complex-type.2.4a: Expected elements 
'servlet-class@http://java.sun.com/xml/ns/javaee  
jsp-file@http://java.sun.com/xml/ns/javaee' instead of 
'display-name@http://java.sun.com/xml/ns/javaee' here in element 
servlet@http://java.sun.com/xml/ns/javaee:&lt;null&gt; problem: cvc-complex-type.2.4a: 
Expected elements 'servlet-class@http://java.sun.com/xml/ns/javaee  
jsp-file@http://java.sun.com/xml/ns/javaee' instead of 
'description@http://java.sun.com/xml/ns/javaee' here in element 
servlet@http://java.sun.com/xml/ns/javaee:&lt;null&gt;</pre></li><li class="listitem"><p>Make sure any Oneway methods / operations in
                        your service implementation class have the
                        <code class="literal">@Oneway</code> annotation in order to
                        avoid this
                        <code class="literal">NullPointerException</code>:</p><pre class="programlisting">com.sun.xml.ws.transport.http.servlet.WSServletContextListener contextInitialized 
     SEVERE: WSSERVLET11: failed to parse runtime descriptor: 
java.lang.NullPointerException 
     java.lang.NullPointerException 
         at com.sun.xml.ws.model.JavaMethodImpl.freeze(JavaMethodImpl.java:375) 
         at com.sun.xml.ws.model.AbstractSEIModelImpl.freeze(AbstractSEIModelImpl</pre></li><li class="listitem"><p>If you're getting an exception similar to the
                        following one, extract the contents of the file <a class="link" href="download/MemberSubmissionEndpointReference.zip" target="_top">MemberSubmissionEndpointReference.zip</a>
                        into the <code class="literal">APP-INF/classes</code> directory
                        in the <code class="literal">EAR</code> (subclasses
                        <code class="literal">MemberSubmissionEndpointReference.Address</code>
                        and
                        <code class="literal">MemberSubmissionEndpointReference.Elements</code>
                        have been annotated with
                        <code class="literal">@XmlType(name="elements",
                        namespace=MemberSubmissionEndpointReference.MSNS)</code>
                        and <code class="literal">@XmlType(name="address",
                        namespace=MemberSubmissionEndpointReference.MSNS)</code>
                        respectively and recompiled). Make sure to preserve
                        the hierarchy of the file (all classes from the file
                        should be located in the directory
                        <code class="literal">APP-INF/classes/com/sun/xml/ws/developer/</code>).</p><pre class="programlisting">com.sun.xml.ws.transport.http.servlet.WSServletDelegate doGet
SEVERE: caught throwable
java.lang.ExceptionInInitializerError
        at com.sun.xml.ws.api.addressing.WSEndpointReference.toSpec(WSEndpointReference.java:637)
        at com.sun.xml.ws.rx.rm.runtime.ServerTube.handleCreateSequenceAction(ServerTube.java:334)
        at com.sun.xml.ws.rx.rm.runtime.ServerTube.processProtocolMessage(ServerTube.java:302)
        at com.sun.xml.ws.rx.rm.runtime.ServerTube.processRequest(ServerTube.java:169)
        at com.sun.xml.ws.api.pipe.Fiber.__doRun(Fiber.java:641)
        at com.sun.xml.ws.api.pipe.Fiber._doRun(Fiber.java:600)
        at com.sun.xml.ws.api.pipe.Fiber.doRun(Fiber.java:585)
        at com.sun.xml.ws.api.pipe.Fiber.runSync(Fiber.java:482)
        at com.sun.xml.ws.server.WSEndpointImpl$2.process(WSEndpointImpl.java:314)
        at com.sun.xml.ws.transport.http.HttpAdapter$HttpToolkit.handle(HttpAdapter.java:608)
        at com.sun.xml.ws.transport.http.HttpAdapter.handle(HttpAdapter.java:259)
        at com.sun.xml.ws.transport.http.servlet.ServletAdapter.invokeAsync(ServletAdapter.java:213)
        at com.sun.xml.ws.transport.http.servlet.WSServletDelegate.doGet(WSServletDelegate.java:159)
        at com.sun.xml.ws.transport.http.servlet.WSServletDelegate.doPost(WSServletDelegate.java:194)
        at com.sun.xml.ws.transport.http.servlet.WSServlet.doPost(WSServlet.java:80)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:751)
        at javax.servlet.http.HttpServlet.service(HttpServlet.java:844)
        at weblogic.servlet.internal.StubSecurityHelper$ServletServiceAction.run(StubSecurityHelper.java:242)
        at weblogic.servlet.internal.StubSecurityHelper$ServletServiceAction.run(StubSecurityHelper.java:216)
        at weblogic.servlet.internal.StubSecurityHelper.invokeServlet(StubSecurityHelper.java:132)
        at weblogic.servlet.internal.ServletStubImpl.execute(ServletStubImpl.java:352)
        at weblogic.servlet.internal.ServletStubImpl.execute(ServletStubImpl.java:235)
        at weblogic.servlet.internal.WebAppServletContext$ServletInvocationAction.wrapRun(WebAppServletContext.java:3284)
        at weblogic.servlet.internal.WebAppServletContext$ServletInvocationAction.run(WebAppServletContext.java:3254)
        at weblogic.security.acl.internal.AuthenticatedSubject.doAs(AuthenticatedSubject.java:321)
        at weblogic.security.service.SecurityManager.runAs(SecurityManager.java:120)
        at weblogic.servlet.provider.WlsSubjectHandle.run(WlsSubjectHandle.java:57)
        at weblogic.servlet.internal.WebAppServletContext.doSecuredExecute(WebAppServletContext.java:2163)
        at weblogic.servlet.internal.WebAppServletContext.securedExecute(WebAppServletContext.java:2089)
        at weblogic.servlet.internal.WebAppServletContext.execute(WebAppServletContext.java:2074)
        at weblogic.servlet.internal.ServletRequestImpl.run(ServletRequestImpl.java:1512)
        at weblogic.servlet.provider.ContainerSupportProviderImpl$WlsRequestExecutor.run(ContainerSupportProviderImpl.java:254)
        at weblogic.work.ExecuteThread.execute(ExecuteThread.java:256)
        at weblogic.work.ExecuteThread.run(ExecuteThread.java:221)
Caused by: javax.xml.ws.WebServiceException: Error creating JAXBContext for W3CEndpointReference.
        at com.sun.xml.ws.spi.ProviderImpl$2.run(ProviderImpl.java:266)
        at com.sun.xml.ws.spi.ProviderImpl$2.run(ProviderImpl.java:262)
        at java.security.AccessController.doPrivileged(Native Method)
        at com.sun.xml.ws.spi.ProviderImpl.getEPRJaxbContext(ProviderImpl.java:261)
        at com.sun.xml.ws.spi.ProviderImpl.&lt;clinit&gt;(ProviderImpl.java:95)
        ... 34 more
Caused by: com.sun.xml.bind.v2.runtime.IllegalAnnotationsException: 2 counts of IllegalAnnotationExceptions
Two classes have the same XML type name "address". Use @XmlType.name and @XmlType.namespace to assign different names to them.
        this problem is related to the following location:
                at com.sun.xml.ws.developer.MemberSubmissionEndpointReference$Address
                at public com.sun.xml.ws.developer.MemberSubmissionEndpointReference$Address com.sun.xml.ws.developer.MemberSubmissionEndpointReference.address
                at com.sun.xml.ws.developer.MemberSubmissionEndpointReference
        this problem is related to the following location:
                at javax.xml.ws.wsaddressing.W3CEndpointReference$Address
                at private javax.xml.ws.wsaddressing.W3CEndpointReference$Address javax.xml.ws.wsaddressing.W3CEndpointReference.address
                at javax.xml.ws.wsaddressing.W3CEndpointReference
Two classes have the same XML type name "elements". Use @XmlType.name and @XmlType.namespace to assign different names to them.
        this problem is related to the following location:
                at com.sun.xml.ws.developer.MemberSubmissionEndpointReference$Elements
                at public com.sun.xml.ws.developer.MemberSubmissionEndpointReference$Elements com.sun.xml.ws.developer.MemberSubmissionEndpointReference.referenceProperties
                at com.sun.xml.ws.developer.MemberSubmissionEndpointReference
        this problem is related to the following location:
                at javax.xml.ws.wsaddressing.W3CEndpointReference$Elements
                at private javax.xml.ws.wsaddressing.W3CEndpointReference$Elements javax.xml.ws.wsaddressing.W3CEndpointReference.referenceParameters
                at javax.xml.ws.wsaddressing.W3CEndpointReference

        at com.sun.xml.bind.v2.runtime.IllegalAnnotationsException$Builder.check(IllegalAnnotationsException.java:106)
        at com.sun.xml.bind.v2.runtime.JAXBContextImpl.getTypeInfoSet(JAXBContextImpl.java:466)
        at com.sun.xml.bind.v2.runtime.JAXBContextImpl.&lt;init&gt;(JAXBContextImpl.java:298)
        at com.sun.xml.bind.v2.runtime.JAXBContextImpl.&lt;init&gt;(JAXBContextImpl.java:141)
        at com.sun.xml.bind.v2.runtime.JAXBContextImpl$JAXBContextBuilder.build(JAXBContextImpl.java:1157)
        at com.sun.xml.bind.v2.ContextFactory.createContext(ContextFactory.java:145)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:601)
        at javax.xml.bind.ContextFinder.newInstance(ContextFinder.java:263)
        at javax.xml.bind.ContextFinder.newInstance(ContextFinder.java:250)
        at javax.xml.bind.ContextFinder.find(ContextFinder.java:447)
        at javax.xml.bind.JAXBContext.newInstance(JAXBContext.java:652)
        at javax.xml.bind.JAXBContext.newInstance(JAXBContext.java:599)
        at com.sun.xml.ws.spi.ProviderImpl$2.run(ProviderImpl.java:264)
        ... 38 more</pre></li></ol></div></div></div></div><div class="section" title="2.10.&nbsp;Developing client application with locally packaged WSDL"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="developing-client-application-with-locally-packaged-wsdl"></a>2.10.&nbsp;Developing client application with locally packaged
        WSDL</h2></div></div></div><p>In the JAX-WS programming model, to develop a web services
        client you compile the deployed WSDL using wsimport and then at
        runtime the same WSDL is used to determine binding information. The
        default WSDL used can be determined by looking in the
        javax.xml.ws.Service subclass generated by wsimport. You can choose
        another location (network or local file directory) for the WSDL other
        than the one you used wsimport with, for example if you do not want
        runtime accesses of the WSDL to go over the network or if you want to
        edit a copy of the WSDL to work around some bug (dangerous but we do
        it sometimes).</p><p>There are the different ways in which you can provide the local
        WSDL information to the JAX-WS runtime:</p><div class="section" title="2.10.1.&nbsp;Service API to pass the WSDL information"><div class="titlepage"><div><div><h3 class="title"><a name="service-api-to-pass-the-wsdl-information"></a>2.10.1.&nbsp;Service API to pass the WSDL information</h3></div></div></div><div class="example"><a name="d0e2976"></a><p class="title"><b>Example&nbsp;2.28.&nbsp;Sample service creation using local WSDL</b></p><div class="example-contents"><pre class="programlisting">URL baseUrl = client.MtomService.class.getResource(".");
URL url = new URL(baseUrl, "../Soap11MtomUtf8.svc.xml");
MtomService service = new MtomService(url, new QName("http://tempuri.org/", "MtomService"));
IMtomTest proxy = service.getBasicHttpBindingIMtomTest();
String input="Hello World";
byte[] response = proxy.echoStringAsBinary(input);</pre></div></div><br class="example-break"></div><div class="section" title="2.10.2.&nbsp;Xml Catalog"><div class="titlepage"><div><div><h3 class="title"><a name="xml-catalog"></a>2.10.2.&nbsp;Xml Catalog</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Create a catalog file</p></li><li class="listitem"><p>META-INF/jax-ws-catalog.xml </p><div class="example"><a name="d0e2991"></a><p class="title"><b>Example&nbsp;2.29.&nbsp;jax-ws-catalog.xml</b></p><div class="example-contents"><pre class="programlisting">&lt;catalog xmlns="urn:oasis:names:tc:entity:xmlns:xml:catalog" prefer="system"&gt;
    &lt;system systemId="http://131.107.72.15/MTOM_Service_Indigo/Soap11MtomUtf8.svc?wsdl"
            uri="Soap11MtomUtf8.svc.xml"/&gt;
&lt;/catalog&gt;</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>For details see the details on <a class="link" href="http://jax-ws.java.net/2.2.10/docs/release-documentation.html#users-guide-catalog" target="_top">using
                    catalog scheme</a></p></li></ul></div><p>This works well but requires some work, such as composing
            the right catalog file then package it appropriately.</p></div><div class="section" title="2.10.3.&nbsp;Using -wsdlLocation switch"><div class="titlepage"><div><div><h3 class="title"><a name="using--wsdllocation-switch"></a>2.10.3.&nbsp;Using -wsdlLocation switch</h3></div></div></div><p>There is another easy way to do it - just run wsimport with
            -wsdlLocation switch and provide the WSDL location value which is
            relative to the generated Service class and provide the WSDL
            location value which is relative to the generated Service class
            and you need to put this WSDL file at this relative
            location.</p><p>Let us try to create a client for the <a class="link" href="http://131.107.72.15/MTOM_Service_Indigo/Soap11MtomUtf8.svc" target="_top">NET
            3.0 MTOM endpoint</a>. I am using <a class="link" href="http://metro.java.net/1.0/" target="_top">Metro 1.0</a>.</p><p>First I save the .NET 3.0 MTOM <a class="link" href="http://131.107.72.15/MTOM_Service_Indigo/Soap11MtomUtf8.svc?wsdl" target="_top">WSDL</a>
            locally then run wsimport giving the relative location to where
            you will package the wsdl with your application</p><div class="example"><a name="d0e3021"></a><p class="title"><b>Example&nbsp;2.30.&nbsp;Sample wsimport command</b></p><div class="example-contents"><pre class="programlisting">wsimport -keep -d build/classes -p client etc/Soap11MtomUtf8.svc.xml -wsdlLocation ../Soap11MtomUtf8.svc.xml</pre></div></div><br class="example-break"><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Why is the relative location is
                ../Soap11MtomUtf8.svc.xml? Basically the generated Service
                will be at build/classes/client location and I would copy this
                WSDL at build/classes, see option -d and -p.</p></div><p>Here is excerpt from the generated MtomService class. You
            can see how the wsdlLocation value is generated inside it and is
            used internally to create the Service.</p><div class="example"><a name="d0e3031"></a><p class="title"><b>Example&nbsp;2.31.&nbsp;MtomService.java</b></p><div class="example-contents"><pre class="programlisting">/**
 * This class was generated by the JAX-WS RI.
 * JAX-WS RI 2.1.2-hudson-53-SNAPSHOT
 * Generated source version: 2.1
 */
@WebServiceClient(name = "MtomService",
        targetNamespace = "http://tempuri.org/",
        "../Soap11MtomUtf8.svc.xml")
public class MtomService extends Service {

    private final static URL MTOMSERVICE_WSDL_LOCATION;
    private final static Logger logger = Logger.getLogger(client
            .MtomService.class.getName());

    static {
        URLurl = null;
        try {
            URLbaseUrl;

            baseUrl = client.MtomService.class.getResource(".");
            url = new URL(baseUrl, "../Soap11MtomUtf8.svc.xml");
        } catch (MalformedURLException e) {
            logger.warning("Failed to create URL for the wsdl Location: ." +
                    "./Soap11MtomUtf8.svc.xml");
            logger.warning(e.getMessage());
        }
        MTOMSERVICE_WSDL_LOCATION = url;
    }

    public MtomService() {
        super(MTOMSERVICE_WSDL_LOCATION,
                new QName("http://tempuri.org/", "MtomService"));
    }

    ...
    </pre></div></div><br class="example-break"><p>See <code class="code">Client.java</code> below it invokes the .NET 3.0
            service. You may notice here that you dont need to enable MTOM
            explicitly. Metro bring in .NET 3.0 interop thru WSIT and due to
            this the MTOM policy assertions in the .NET 3.0 WSDL, it correctly
            interpreted and the IMtomTest port is configured with MTOM
            enabled.</p><div class="example"><a name="d0e3041"></a><p class="title"><b>Example&nbsp;2.32.&nbsp;MtomService.java</b></p><div class="example-contents"><pre class="programlisting">package client;

import com.sun.xml.ws.transport.http.client.HttpTransportPipe;

/**
 * Client that invokes .NET 3.0 MTOM endpoint using a local wsdl
 */
public class Client {

    public static void main(String[] args) {

        //enble SOAP Message logging
        HttpTransportPipe.dump = true;

        //Create IMtomTest proxy to invoke .NET 3.0 MTOM service
        IMtomTest proxy = new MtomService().getBasicHttpBindingIMtomTest();
        String input = "Hello World";
        byte[] response = proxy.echoStringAsBinary(input);
        System.out.println("Sent: " + input + ", Received: " + new String
                (response));
    }
}</pre></div></div><br class="example-break"><p>Get the complete client bundle from <a class="link" href="download/portable-client-withwsdl.zip" target="_top"> here</a>
            and see the enclosed <code class="code">Readme.txt</code> for instructions on
            how to run it.</p></div></div><div class="section" title="2.11.&nbsp;How to invoke and endpoint by overriding endpoint address in the WSDL"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="how-to-invoke-and-endpoint-by-overriding-endpoint-address-in-the-wsdl"></a>2.11.&nbsp;How to invoke and endpoint by overriding endpoint address in
        the WSDL</h2></div></div></div><p>Often times there is need to override the endpoint address that
        is obtained from the WSDL referenced by the generated Service class.
        This is how you can do this:</p><div class="section" title="2.11.1.&nbsp;BindingProvider.ENDPOINT_ADDRESS_PROPERTY"><div class="titlepage"><div><div><h3 class="title"><a name="bindingprovider.endpoint_address_property"></a>2.11.1.&nbsp;BindingProvider.ENDPOINT_ADDRESS_PROPERTY</h3></div></div></div><p>You can use
            <code class="code">BindingProvider.ENDPOINT_ADDRESS_PROPERTY</code> to set the
            endpoint address in your client application code.</p><div class="example"><a name="d0e3067"></a><p class="title"><b>Example&nbsp;2.33.&nbsp;Sample</b></p><div class="example-contents"><pre class="programlisting">//Create service and proxy from the generated Service class.
HelloService service = new HelloService();
HelloPort proxy = service.getHelloPort();

((BindingProvider) proxy).getRequestContext().put(BindingProvider
        .ENDPOINT_ADDRESS_PROPERTY, "http://new/endpointaddress");

proxy.sayHello("Hello World!");           </pre></div></div><br class="example-break"></div><div class="section" title="2.11.2.&nbsp;Create Service using updated WSDL"><div class="titlepage"><div><div><h3 class="title"><a name="create-service-using-updated-wsdl"></a>2.11.2.&nbsp;Create Service using updated WSDL</h3></div></div></div><p>In case you have access to the updated WSDL which has the
            right endpoint address, you can simply create the Service using
            this WSDL and there will be no need to set the
            <code class="code">BindingProvider.ENDPOINT_ADDRESS</code> property.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>This updated WSDL must have the same wsdl:service and
                wsdl:port as in the original wsdl. Otherwise you may get an
                error while creating the Service or Port.</p></div><div class="example"><a name="d0e3083"></a><p class="title"><b>Example&nbsp;2.34.&nbsp;Sample</b></p><div class="example-contents"><pre class="programlisting">//Create service and proxy from the generated Service class.
HelloService service = new HelloService(serviceName,
        "http://new/endpointaddress?wsdl");
HelloPort proxy = service.getHelloPort();

proxy.sayHello("Hello World!");</pre></div></div><br class="example-break"></div></div><div class="section" title="2.12.&nbsp;Maintaining State in Web Services"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="maintaining-state-in-web-services"></a>2.12.&nbsp;Maintaining State in Web Services</h2></div></div></div><p>These articles provide details on maintaing state with JAX-WS
        Web Services. </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="link" href="http://weblogs.java.net/blog/ramapulavarthi/archive/2006/06/maintaining_ses.html" target="_top">Maintaining
                    Session With JAX-WS</a></p></li><li class="listitem"><p><a class="link" href="http://jax-ws-commons.java.net/http-session-scope/" target="_top">Making
                    it easier with @HttpSessionScope.</a></p></li><li class="listitem"><p><a class="link" href="http://jax-ws.java.net/2.2.10/docs/release-documentation.html#users-guide-stateful-webservice" target="_top">Transport
                    neutral mechanism to maintain state</a></p></li></ul></div></div><div class="section" title="2.13.&nbsp;FastInfoset"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="fastinfoset"></a>2.13.&nbsp;FastInfoset</h2></div></div></div><p>The Fast Infoset specification (ITU-T Rec. X.891 | ISO/IEC
        24824-1) describes an open, standards-based "binary XML" format that
        is based on the<a class="link" href="http://www.w3.org/TR/xml-infoset/" target="_top">XML Information
        Set</a>. Metro supports this optimized encoding JAX-WS
        implementation. For ease of deployment, JAX-WS also support a form of
        HTTP content negotiation that can be used to turn on Fast Infoset
        during message exchanges. By default, the Fast Infoset encoding is
        turned off. For more information on how to use this feature see the
        following section.</p><p>The XML Information Set specifies the result of parsing an XML
        document, referred to as an XML infoset (or simply an infoset), and a
        glossary of terms to identify infoset components, referred to as
        information items and properties. An XML infoset is an abstract model
        of the information stored in an XML document; it establishes a
        separation between data and information in a way that suits most
        common uses of XML. In fact, several of the concrete XML data models
        are defined by referring to XML infoset items and their properties.
        For example, <a class="link" href="http://www.w3.org/TR/soap12-part1/" target="_top">SOAP Version
        1.2</a> makes use of this abstraction to define the information in
        a SOAP message without ever referring to XML 1.X, and the SOAP HTTP
        binding specifically allows for alternative media types that "provide
        for at least the transfer of the SOAP XML Infoset".</p><p>The Fast Infoset specification is jointly standardized at the
        ITU-T and ISO. The specification is available to all ITU-T sector
        members and can also be obtained via the corresponding ISO national
        body in your location. These specifications recommend the use of the
        MIME type application/fastinfoset, which has been approved by the
        Internet Engineering Steering Group (IESG) for documents serialized
        using this format.</p><p><a class="link" href="http://fi.java.net/" target="_top">FI</a> is an
        open-source project initiated by Sun Microsystems to provide access to
        a fast, fully-featured and robust implementation of the Fast Infoset
        specification. Metro employs the basic Fast Infoset parsers and
        serializers available from that project.</p><div class="section" title="2.13.1.&nbsp;Using FastInfoset"><div class="titlepage"><div><div><h3 class="title"><a name="using-fastinfoset"></a>2.13.1.&nbsp;Using FastInfoset</h3></div></div></div><p>Content negotiation is completely driven by the client and
            uses the standard HTTP headers <code class="code">Accept</code> and
            <code class="code">Content-Type</code>. The initial request is always encoded
            in XML, but the client has the option of including the MIME type
            application/fastinfoset as part of the HTTP Accept header list. If
            the request is received by a Fast Infoset-enabled service, the
            reply will be encoded in Fast Infoset. The remainder of the
            conversation between the client and the service will also be
            encoded in Fast Infoset as long as the client continues to use the
            same client object (e.g., the same stub instance) to converse with
            the server. We call this form of negotiation pessimistic, in
            contrast to the optimistic case in which a client directly
            initiates a message exchange using the more efficient
            encoding.</p><p>Content negotiation can be enabled in two different ways:
            (i) by setting a system property on the VM used to run the client,
            and (ii) by setting a property on the proxy object. In either
            case, both the property name and its value are identical. For
            JAX-WS, the name of the property is
            <code class="code">com.sun.xml.ws.client.ContentNegotiation</code>. In either
            case, the accepted property values are none (the default) and
            pessimistic, optimistic. Note that due to JDK repackaging, if you 
            are using JAX-WS implementation directly from JDK you need to use this 
            property name: <code class="code">com.sun.xml.internal.ws.client.ContentNegotiation</code>.
            </p><div class="example"><a name="d0e3144"></a><p class="title"><b>Example&nbsp;2.35.&nbsp;Enabling FastInfoset by configuring proxy</b></p><div class="example-contents"><pre class="programlisting">// Enabling FI in pessimistic mode
Map&lt;String, Object&gt; ctxt = ((BindingProvider)proxy).getRequestContext();
ctxt.put("com.sun.xml.ws.client.ContentNegotiation", "pessimistic");</pre></div></div><br class="example-break"><pre class="programlisting">java -Dcom.sun.xml.ws.client.ContentNegotiation=pessimistic ...</pre></div></div><div class="section" title="2.14.&nbsp;High Availability Support in Metro"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using_metro-ha_support"></a>2.14.&nbsp;High Availability Support in Metro</h2></div></div></div><p>Starting with the <a class="link" href="http://metro.java.net/2.1/" target="_top">Metro 2.1 release</a> Metro
        officially supports deployment in clustered environment configurations
        including the support for stateful Metro features, namely Reliable
        Messaging (see <a class="xref" href="#using_rm-ha_support" title="10.7.&nbsp;High Availability Support in Reliable Messaging">High Availability Support in Reliable Messaging</a> for limitations), Secure Conversation,
        Security NONCE Manager and Stateful Web Services. Currently this
        support is tested with and limited to the <a class="link" href="http://glassfish.java.net" target="_top">GlassFish</a> Application
        Server.</p><p>Clustering support in Metro is automatic, which means that once
        configured and enabled in the container, there is no extra
        configuration required on the Metro side to enable Metro High
        Availability support. The <code class="code">GlassFish Metro Glue Module</code>
        that is responsible for Metro - GlassFish integration does all the
        necessary configuration automatically during the Metro module
        initialization by injecting the required configuration information
        into the Metro runtime using a private API contract.</p><p>For more information on configuring Clustering environment in
        GlassFish, please consult the <a class="link" href="http://glassfish.java.net" target="_top">GlassFish</a> Application
        Server User Guide or watch this <a class="link" href="http://www.youtube.com/user/GlassFishVideos#p/c/1808040BD1409BF0/3/LDjXjm9_Q5A" target="_top">very
        comprehensible basic screencast</a> or another a <a class="link" href="http://www.youtube.com/user/GlassFishVideos#p/f/0/xSiZHKJLOh4" target="_top">more
        recent screen cast</a> available at <a class="link" href="http://www.youtube.com/user/GlassFishVideos" target="_top">The GlassFish
        YouTube Channel</a>.</p></div></div><div lang="en" class="chapter" title="Chapter&nbsp;3.&nbsp;Compiling WSDL"><div class="titlepage"><div><div><h2 class="title"><a name="compiling-wsdl"></a>Chapter&nbsp;3.&nbsp;Compiling WSDL</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#compiling-multiple-wsdls-that-share-a-common-schema">3.1. Compiling multiple WSDLs that share a common schema</a></span></dt><dt><span class="section"><a href="#dealing-with-schemas-that-are-not-referenced">3.2. Dealing with schemas that are not referenced</a></span></dt><dt><span class="section"><a href="#customizing-xml-schema-binding">3.3. Customizing XML Schema binding</a></span></dt><dd><dl><dt><span class="section"><a href="#how-to-get-simple-and-better-typed-binding">3.3.1. How to get simple and better typed binding</a></span></dt></dl></dd><dt><span class="section"><a href="#generating-javadocs-from-wsdl-documentation">3.4. Generating Javadocs from WSDL documentation</a></span></dt><dt><span class="section"><a href="#passing-java-compiler-options-to-wsimport">3.5. Passing Java Compiler options to Wsimport</a></span></dt></dl></div><div class="section" title="3.1.&nbsp;Compiling multiple WSDLs that share a common schema"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="compiling-multiple-wsdls-that-share-a-common-schema"></a>3.1.&nbsp;Compiling multiple WSDLs that share a common schema</h2></div></div></div><p>Occasionally, a server will expose multiple services that share
        common schema types. Perhaps the "common schema types" are from an
        industry-standard schema, or perhaps the server was developed by a
        Java-first web service toolkit and the services all use the same Java
        classes as parameter/return values. When compiling such a WSDL, it's
        desirable for the shared portion to produce the same Java classes to
        avoid duplicates. There are two ways to do this.</p><p>The easy way is for you to compile all the WSDLs into the same
        package:</p><pre class="programlisting">$ wsimport -p org.acme.foo first.wsdl
$ wsimport -p org.acme.foo second.wsdl</pre><p>The Java classes that correspond to the common part will be
        overwritten multiple times, but since they are identical, in the end
        this will produce the desired result. If the common part is separated
        into its own namespace, you can use <a class="link" href="http://jaxb.java.net/guide/Customizing_Java_packages.html" target="_top">a
        JAXB customization</a> so that the common part will go to the
        overwritten package while everything else will get its own
        package.</p><pre class="programlisting">$ cat common.jaxb
&lt;bindings xmlns="http://java.sun.com/xml/ns/jaxb" version="2.1"&gt;
  &lt;bindings scd="x-schema::tns" xmlns:tns="http://common.schema.ns/"&gt;
    &lt;schemaBindings&gt;
      &lt;package name="org.acme.foo.common" /&gt;
    &lt;/schemaBindings&gt;
  &lt;/bindings&gt;
&lt;/bindings&gt;
$ wsimport -p org.acme.foo.first  first.wsdl  -b common.jaxb
$ wsimport -p org.acme.foo.second second.wsdl -b common.jaxb</pre><p>You can also compile the schema upfront by xjc, then use <a class="link" href="http://weblogs.java.net/blog/kohsuke/archive/2006/09/separate_compil.html" target="_top">its
        episode file</a> when later invoking wsimport. For this to work,
        the common schema needs to have a URL that you can pass into xjc. If
        the schema is inlined inside the WSDL, you'll have to pull it out into
        a separate file.</p><pre class="programlisting">$ xjc -episode common.episode common.xsd
$ wsimport wsdl-that-uses-common-schema.wsdl -b common.episode</pre><p>This will cause wsimport to refer to classes that are generated
        from XJC earlier.</p><p>For more discussion on this, please see <a class="link" href="http://forums.java.net/jive/thread.jspa?threadID=28673" target="_top">this
        forum thread</a>.</p></div><div class="section" title="3.2.&nbsp;Dealing with schemas that are not referenced"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="dealing-with-schemas-that-are-not-referenced"></a>3.2.&nbsp;Dealing with schemas that are not referenced</h2></div></div></div><p>Because of ambiguity in the XML Schema spec, some WSDLs are
        published that reference other schemas without specifying their
        locations. This happens most commonly with the reference to the schema
        for XML Schema, like this:</p><div class="example"><a name="d0e3222"></a><p class="title"><b>Example&nbsp;3.1.&nbsp;Location-less reference to a schema</b></p><div class="example-contents"><pre class="programlisting">&lt;!-- notice there's no schemaLocation attribute --&gt;
&lt;xs:import namespace="http://www.w3.org/2001/XMLSchema" /&gt;</pre></div></div><br class="example-break"><p>When you run wsimport with such a schema, this is what
        happens:</p><pre class="programlisting">$ wsimport  SecureConversation.wsdl
[ERROR] undefined element declaration 'xs:schema'
line 1 of http://131.107.72.15/Security_WsSecurity_Service_Indigo/WSSecureConversation.svc?xsd=xsd0</pre><p>To fix this, two things need to be done:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Run wsimport with the -b option and pass the URL/path of
                the actual schema (in the case of XML Schema, it's <a class="link" href="http://www.w3.org/2001/XMLSchema.xsd" target="_top">here</a>.
                This is to provide the real resolvable schema for the missing
                schema.</p></li><li class="listitem"><p>For the schema for Schema, potential name conflicts may
                arise. This was discussed <a class="link" href="http://forums.java.net/jive/thread.jspa?messageID=205301" target="_top">here
                at length</a> and a JAXB <a class="link" href="http://weblogs.java.net/blog/kohsuke/archive/20070228/xsd.xjb" target="_top">customization</a>
                has been created to resolve such conflicts.</p></li></ol></div><p>So your wsimport command will be:</p><pre class="programlisting">$ wsimport -b  http://www.w3.org/2001/XMLSchema.xsd  -b  customization.xjb  SecureConversation.wsdl</pre><p>You can do the same with NetBeans 5.5.1 by providing local
        copies of these schema and customization files. If you are facing this
        issue try it and let us know if you have any problems.</p></div><div class="section" title="3.3.&nbsp;Customizing XML Schema binding"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="customizing-xml-schema-binding"></a>3.3.&nbsp;Customizing XML Schema binding</h2></div></div></div><div class="section" title="3.3.1.&nbsp;How to get simple and better typed binding"><div class="titlepage"><div><div><h3 class="title"><a name="how-to-get-simple-and-better-typed-binding"></a>3.3.1.&nbsp;How to get simple and better typed binding</h3></div></div></div><p>wsimport uses JAXB RI's XJC tool internally to achive XML
            Schema to Java binding. The default behaviour is strictly as per
            JAXB 2.x specification. However it does not work for everyone, for
            example if you want to map xs:anyURI to java.net.URI instead of
            java.lang.String (default mapping).</p><p>There is a JAXB global customization that can help you
            achieve these tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Eliminating JAXBElements as much as possible</p></li><li class="listitem"><p>Giving you a better, more typed binding in
                    general</p></li><li class="listitem"><p>Using plural property names where applicable</p></li></ul></div><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jaxb:bindings
  xmlns:jaxb="http://java.sun.com/xml/ns/jaxb" jaxb:version="2.0"
  xmlns:xjc= "http://java.sun.com/xml/ns/jaxb/xjc" jaxb:extensionBindingPrefixes="xjc"&gt;

  &lt;jaxb:globalBindings&gt;
    &lt;xjc:simple /&gt;
  &lt;/jaxb:globalBindings&gt;
&lt;/jaxb:bindings&gt;</pre><p>Then simply run your wsimport and pass this binding
            customization file</p><pre class="programlisting">wsimport -p mypackage -keep -b simple.xjb myservice.wsdl</pre><p>See Kohsuke's <a class="link" href="http://weblogs.java.net/blog/kohsuke/archive/2007/01/using_jaxb_ris.html" target="_top">blog</a>
            for more details.</p></div></div><div class="section" title="3.4.&nbsp;Generating Javadocs from WSDL documentation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="generating-javadocs-from-wsdl-documentation"></a>3.4.&nbsp;Generating Javadocs from WSDL documentation</h2></div></div></div><p>wsimport can map the documentation inside the WSDL that can map
        as corresponding Javadoc on the generated classes. The documentation
        inside the WSDL should be done using standard WSDL 1.1 element:
        &lt;wsdl:documentation&gt;.</p><p>It is important to note that not everythign in the WSDL maps to
        Java class, the table below shows wsdl:documentation to Javadoc
        mapping for various WSDL compoenents that correspond to the generated
        Java class.</p><div class="table"><a name="d0e3293"></a><p class="title"><b>Table&nbsp;3.1.&nbsp;<code class="code">wsdl:documentation</code> to Javadoc mapping</b></p><div class="table-contents"><table summary="wsdl:documentation to Javadoc mapping" border="1"><colgroup><col><col></colgroup><tbody><tr><td>WSDL documentation (wsdl:documentation)</td><td>Javadoc</td></tr><tr><td>wsdl:portType</td><td>As a Javadoc on the generated Service Endpoint
                        Interface (SEI) class</td></tr><tr><td>wsdl:portType/wsdl:operation</td><td>As a Javadoc on the corresponding method of the
                        generated SEI class</td></tr><tr><td>wsdl:service</td><td>As a Javadoc on the generated Service
                        class</td></tr><tr><td>wsdl:service/wsdlport</td><td>As a Javadoc on the generated getXYZPort()
                        methods of the Service class</td></tr></tbody></table></div></div><br class="table-break"><p>Let us see a sample wsdl with documentation and the generated
        Java classes:</p><div class="example"><a name="d0e3327"></a><p class="title"><b>Example&nbsp;3.2.&nbsp;WSDL with documentation</b></p><div class="example-contents"><pre class="programlisting">&lt;wsdl:portType name="HelloWorld"&gt;
   &lt;wsdl:documentation&gt;This is a simple HelloWorld service.
   &lt;/wsdl:documentation&gt;
   &lt;wsdl:operation name="echo"&gt;
      &lt;wsdl:documentation&gt;This operation simply echoes back whatever it
         receives
      &lt;/wsdl:documentation&gt;
      &lt;wsdl:input message="tns:echoRequest"/&gt;
      &lt;wsdl:output message="tns:echoResponse"/&gt;
   &lt;/wsdl:operation&gt;
&lt;/wsdl:portType&gt;

&lt;service name="HelloService"&gt;
   &lt;wsdl:documentation&gt;This is a simple HelloWorld service.
   &lt;/wsdl:documentation&gt;
   &lt;port name="HelloWorldPort" binding="tns:HelloWorldBinding"&gt;
      &lt;wsdl:documentation&gt;A SOAP 1.1 port&lt;/wsdl:documentation&gt;
      &lt;soap:address location="http://localhost/HelloService"/&gt;
   &lt;/port&gt;
&lt;/service&gt;</pre></div></div><br class="example-break"><p>In the above WSDL the documentation is mentioned using standard
        WSDL 1.1 element: &lt;wsdl:documentation&gt;. Running wsimport on this
        will generate Javadoc on the SEI and Service class.</p><div class="example"><a name="d0e3334"></a><p class="title"><b>Example&nbsp;3.3.&nbsp;Generated SEI - HellowWorld.java</b></p><div class="example-contents"><pre class="programlisting">/**
 * This is a simple HelloWorld service.
 *
 * This class was generated by the JAX-WS RI.
 * JAX-WS RI 2.1.3-11/27/2007 02:44 PM(vivekp)-
 * Generated source version: 2.1
 *
 */
@WebService(name = "HelloWorld",
        targetNamespace = "http://example.com/wsdl")
@XmlSeeAlso({
        ObjectFactory.class
})
public interface HelloWorld {


    /**
     * This operation simply echoes back whatever it receives
     *
     * @param reqInfo
     * @return
     *     returns java.lang.String
     */
    @WebMethod
    @WebResult(name = "respInfo",
            targetNamespace = "http://example.com/types")
    @RequestWrapper(localName = "echo",
            targetNamespace = "http://example.com/types",
            className = "sample.EchoType")
    @ResponseWrapper(localName = "echoResponse",
            targetNamespace = "http://example.com/types",
            className = "sample.EchoResponseType")
    public String echo(
            @WebParam(name = "reqInfo",
                    targetNamespace = "http://example.com/types")
            String reqInfo);

}</pre></div></div><br class="example-break"><div class="example"><a name="d0e3339"></a><p class="title"><b>Example&nbsp;3.4.&nbsp;Generated Service class HelloWorldService.java</b></p><div class="example-contents"><pre class="programlisting">/**
 * This is a simple HelloWorld service.
 *
 * This class was generated by the JAX-WS RI.
 * JAX-WS RI 2.1.3-11/27/2007 02:44 PM(vivekp)-
 * Generated source version: 2.1
 *
 */
@WebServiceClient(name = "HelloService",
        targetNamespace = "http://example.com/wsdl",
        wsdlLocation = "file:/C:/issues/wsdl/sample.wsdl")
public class HelloService
        extends Service
{

    private final static URL HELLOSERVICE_WSDL_LOCATION;
    private final static Logger logger =
            Logger.getLogger(sample.HelloService.class.getName());

    static {
        URL url = null;
        try {
            URL baseUrl;
            baseUrl = sample.HelloService.class.getResource(".");
            url = new URL(baseUrl, "file:/C:/issues/wsdl/sample.wsdl");
        } catch (MalformedURLException e) {
            logger.warning("Failed to create URL for the wsdl Location: " +
                    "'file:/C:/issues/wsdl/sample.wsdl', " +
                    "retrying as a local file");
            logger.warning(e.getMessage());
        }
        HELLOSERVICE_WSDL_LOCATION = url;
    }

    public HelloService(URL wsdlLocation, QName serviceName) {
        super(wsdlLocation, serviceName);
    }

    public HelloService() {
        super(HELLOSERVICE_WSDL_LOCATION,
                new QName("http://example.com/wsdl", "HelloService"));
    }

    /**
     * A SOAP 1.1 port
     *
     * @return
     *     returns HelloWorld
     */
    @WebEndpoint(name = "HelloWorldPort")
    public HelloWorld getHelloWorldPort() {
        return super.getPort(
                new QName("http://example.com/wsdl", "HelloWorldPort"),
                HelloWorld.class);
    }</pre></div></div><br class="example-break"></div><div class="section" title="3.5.&nbsp;Passing Java Compiler options to Wsimport"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="passing-java-compiler-options-to-wsimport"></a>3.5.&nbsp;Passing Java Compiler options to Wsimport</h2></div></div></div><p>wsimport invokes Javac to compile the generated classes. There
        is no option currently to pass any options to the compiler. You can
        use -Xnocompile option of wsimport to not compile the generated
        classes. But, this would require you to compile the generated sources
        separately in your project.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>This would be useful, if you are developing the Web
            service/Client on JDK 6 and you want to deploy it on JDK 5. Since
            there is no option to pass Javac tool option "-target 1.5"
            directly, you can use -Xnocompile option of wsimport and further
            compile it yourself.</p></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;4.&nbsp;SOAP"><div class="titlepage"><div><div><h2 class="title"><a name="soap"></a>Chapter&nbsp;4.&nbsp;SOAP</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#soap-headers">4.1. SOAP headers</a></span></dt><dd><dl><dt><span class="section"><a href="#adding-soap-headers-when-sending-requests">4.1.1. Adding SOAP headers when sending requests</a></span></dt><dt><span class="section"><a href="#accessing-soap-headers-for-incoming-messages">4.1.2. Accessing SOAP headers for incoming messages</a></span></dt><dt><span class="section"><a href="#adding-soap-headers-when-sending-replies">4.1.3. Adding SOAP headers when sending replies</a></span></dt><dt><span class="section"><a href="#mapping-additional-wsdl-headers-to-method-parameters">4.1.4. Mapping additional WSDL headers to method
            parameters</a></span></dt></dl></dd><dt><span class="section"><a href="#schema-validation">4.2. Schema Validation</a></span></dt><dd><dl><dt><span class="section"><a href="#server-side-schema-validation">4.2.1. Server Side Schema Validation</a></span></dt><dt><span class="section"><a href="#client-side-schema-validation">4.2.2. Client Side Schema Validation</a></span></dt></dl></dd></dl></div><div class="section" title="4.1.&nbsp;SOAP headers"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soap-headers"></a>4.1.&nbsp;SOAP headers</h2></div></div></div><p>When the WSDL you are compiling specifies that some parts of a
        message are bound to SOAP headers, <code class="code">wsimport</code> generates the
        right stuff (<code class="code">@WebParam</code> <code class="code">(header=true)</code>), so
        you can pass headers as arguments to the method invocation. When
        starting from Java, you can use this same annotation to indicate that
        some parameters be sent as headers.</p><p>That said, there are many WSDLs out there that do not specify
        SOAP headers explicitly, yet the protocol still requires such headers
        to be sent, so the JAX-WS RI offers convenient ways for you to
        send/receive additional headers at runtime.</p><div class="section" title="4.1.1.&nbsp;Adding SOAP headers when sending requests"><div class="titlepage"><div><div><h3 class="title"><a name="adding-soap-headers-when-sending-requests"></a>4.1.1.&nbsp;Adding SOAP headers when sending requests</h3></div></div></div><p>The portable way of doing this is that you creaate a
            <code class="code">SOAPHandler</code> and mess with SAAJ, but the RI provides a
            better way of doing this.</p><p>When you create a proxy or dispatch object, they implement
            <code class="code">BindingProvider</code> interface. When you use the JAX-WS
            RI, you can downcast to <code class="code">WSBindingProvider</code> which
            defines a few more methods provided only by the JAX-WS RI.</p><p>This interface lets you set an arbitrary number of
            <code class="code">Header</code> object, each representing a SOAP header. You
            can implement it on your own if you want, but most likely you'd
            use one of the factory methods defined on <code class="code">Headers</code>
            class to create one.</p><div class="example"><a name="d0e3396"></a><p class="title"><b>Example&nbsp;4.1.&nbsp;Adding custom headers</b></p><div class="example-contents"><pre class="programlisting">import com.sun.xml.ws.developer.WSBindingProvider;

HelloPort port = helloService.getHelloPort();  // or something like that...
WSBindingProvider bp = (WSBindingProvider) port;

bp.setOutboundHeader(
        // simple string value as a header, 
        // like &lt;simpleHeader&gt;stringValue&lt;/simpleHeader&gt;
        Headers.create(new QName("simpleHeader"), "stringValue"),
        // create a header from JAXB object
        Headers.create(jaxbContext, myJaxbObject)
);</pre></div></div><br class="example-break"><p>Once set, it will take effect on all the successive methods.
            If you'd like to see more factory methods on Headers, please let
            us know.</p></div><div class="section" title="4.1.2.&nbsp;Accessing SOAP headers for incoming messages"><div class="titlepage"><div><div><h3 class="title"><a name="accessing-soap-headers-for-incoming-messages"></a>4.1.2.&nbsp;Accessing SOAP headers for incoming messages</h3></div></div></div><p>Server can access all the SOAP headers of the incoming
            messages by using the
            <code class="code">JAXWSProperties#INBOUND_HEADER_LIST_PROPERTY</code> property
            like this:</p><div class="example"><a name="d0e3411"></a><p class="title"><b>Example&nbsp;4.2.&nbsp;Accessing incoming headers</b></p><div class="example-contents"><pre class="programlisting">@WebService
public class FooService {
    @Resource
    WebServiceContext context;

    @WebMethod
    public void sayHelloTo(String name) {
        HeaderList hl = context.getMessageContext().get(JAXWSProperties
                .INBOUND_HEADER_LIST_PROPERTY);
        Header h = hl.get(MYHEADER);
    }

    private static final QName MYHEADER = new QName("myNsUri", "myHeader");
}</pre></div></div><br class="example-break"><p>Clients can similarly access all the SOAP headers of the
            incoming messages:</p><div class="example"><a name="d0e3418"></a><p class="title"><b>Example&nbsp;4.3.&nbsp;Accessing incoming headers</b></p><div class="example-contents"><pre class="programlisting">HelloPort port = helloService.getHelloPort();  // or something like that...
port.sayHelloTo("duke");
HeaderList hl = port.getResponseContext().get(JAXWSProperties
        .INBOUND_HEADER_LIST_PROPERTY);
Header h = hl.get(MYHEADER);</pre></div></div><br class="example-break"><p>See the <code class="code">Header</code> interface for more details about
            how to access the header values.</p></div><div class="section" title="4.1.3.&nbsp;Adding SOAP headers when sending replies"><div class="titlepage"><div><div><h3 class="title"><a name="adding-soap-headers-when-sending-replies"></a>4.1.3.&nbsp;Adding SOAP headers when sending replies</h3></div></div></div><p>Servers tend to be developed "from-Java" style, so we feel
            the necessity of adding out-of-band headers is smaller (you can
            just define headers as method
            <code class="code">@WebParam(mode=OUT,header=true)</code> parameters.)
            Therefore, currently there's no support for adding out-of-band
            SOAP headers into response messages.</p><p>If you'd like us to improve on this front, please let us
            know.</p></div><div class="section" title="4.1.4.&nbsp;Mapping additional WSDL headers to method parameters"><div class="titlepage"><div><div><h3 class="title"><a name="mapping-additional-wsdl-headers-to-method-parameters"></a>4.1.4.&nbsp;Mapping additional WSDL headers to method
            parameters</h3></div></div></div><p>Sometimes WSDLs in the binding section reference soap:header
            messages that are not part of the input or output contract defined
            in the portType operation. For example:</p><div class="example"><a name="d0e3443"></a><p class="title"><b>Example&nbsp;4.4.&nbsp;Sample WSDL with additional header bindings</b></p><div class="example-contents"><pre class="programlisting">&lt;message name="additionalHeader"&gt;
   &lt;part name="additionalHeader" element="types:additionalHeader"/&gt;
&lt;/message&gt;

&lt;wsdl:portType name="HelloPortType"&gt;
   &lt;wsdl:operation name="echo"&gt;
      &lt;wsdl:input message="tns:echoRequest"/&gt;
      &lt;wsdl:output message="tns:echoResponse"/&gt;
   &lt;/wsdl:operation&gt;
&lt;/wsdl:portType&gt;

&lt;wsdl:binding name="HelloBinding" type="tns:HelloPortType"&gt;
   &lt;soap:binding style="document"
                 transport="http://schemas.xmlsoap.org/soap/http"/&gt;
   &lt;wsdl:operation name="echo"&gt;
      &lt;soap:operation/&gt;
      &lt;wsdl:input&gt;
         &lt;soap:body message="tns:echoRequest"/&gt;
         &lt;soap:header message="tns:additionalHeader"
                      part="additionalHeader"/&gt;
      &lt;/wsdl:input&gt;
      &lt;wsdl:output&gt;
         &lt;soap:body message="tns:echoResponse"/&gt;
      &lt;/wsdl:output&gt;
   &lt;/wsdl:operation&gt;
&lt;/wsdl:binding&gt;</pre></div></div><br class="example-break"><p>In the above schema in the wsdl:binding section
            tns:additionalHeader is bound but if you see this header is not
            part of the <span class="bold"><strong>echo</strong></span> abstract
            contract (i.e., the wsdl:portType section). According to JAX-WS
            2.1 specification only the wsdl:part's from the abstract portion
            are mapped to Java method parameters.</p><p>Running wsimport on this wsdl will generate this method
            signature:</p><pre class="programlisting">wsimport sample.wsdl</pre><div class="example"><a name="d0e3457"></a><p class="title"><b>Example&nbsp;4.5.&nbsp;Default mapping</b></p><div class="example-contents"><pre class="programlisting">public String echo(String request);</pre></div></div><br class="example-break"><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Since JAX-WS RI 2.1.3, wsimport has a new option
                -XadditionalHeaders, this option will map such additional
                headers as method parameters.</p></div><pre class="programlisting">wsimport -XadditionalHeaders sample.wsdl</pre><div class="example"><a name="d0e3467"></a><p class="title"><b>Example&nbsp;4.6.&nbsp;WSDL to Java mapping with -XadditionalHeaders
                switch</b></p><div class="example-contents"><pre class="programlisting">public String echo(String request, String additionalHeader);</pre></div></div><br class="example-break"></div></div><div class="section" title="4.2.&nbsp;Schema Validation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="schema-validation"></a>4.2.&nbsp;Schema Validation</h2></div></div></div><p>SOAP messages are not validated against schemas by default with
        the JAX-WS RI. However, this can be enabled for doc/lit cases. The
        JAXWS-RI uses JAXP's <a class="link" href="http://download.oracle.com/javase/6/docs/api/javax/xml/validation/SchemaFactory.html" target="_top">SchemaFactory</a>
        API to do the validation.</p><div class="section" title="4.2.1.&nbsp;Server Side Schema Validation"><div class="titlepage"><div><div><h3 class="title"><a name="server-side-schema-validation"></a>4.2.1.&nbsp;Server Side Schema Validation</h3></div></div></div><p>The <a class="link" href="http://java.net/projects/jax-ws-architecture-document/sources/svn/content/trunk/www/doc/com/sun/xml/ws/developer/SchemaValidation.html?raw=true" target="_top">
            <code class="code">@SchemaValidation</code> </a> annotation needs to be
            specified on the endpoint implementation to enable server side
            validation. Both the incoming SOAP request and outgoing SOAP
            response will be validated, with exceptions returned to the client
            for any validation errors that occur.</p><div class="example"><a name="d0e3491"></a><p class="title"><b>Example&nbsp;4.7.&nbsp;Enabling Schema Validation for an Endpoint</b></p><div class="example-contents"><pre class="programlisting">import com.sun.xml.ws.developer.SchemaValidation;
...

@SchemaValidation
@WebService
public class HelloImpl {
}</pre></div></div><br class="example-break"><p>If a application wants to have complete control over
            validation error handling, it can set up a <a class="link" href="http://java.net/projects/jax-ws-architecture-document/sources/svn/content/trunk/www/doc/com/sun/xml/ws/developer/ValidationErrorHandler.html?raw=true" target="_top"><code class="code">ValidationErrorHandler</code></a>
            to receive notification of errors. The handler has access to the
            <a class="link" href="http://java.net/projects/jax-ws-architecture-document/sources/svn/content/trunk/www/doc/com/sun/xml/ws/api/message/Packet.html?raw=true" target="_top"><code class="code">Packet</code></a>
            and can store any information in its invocationProperties. These
            properties are accessible from the endpoint's
            <code class="code">MessageContext</code>.</p><div class="example"><a name="d0e3509"></a><p class="title"><b>Example&nbsp;4.8.&nbsp;Customizing Schema Validation</b></p><div class="example-contents"><pre class="programlisting">@SchemaValidation(handler = MyErrorHandler.class)
@WebService
public class HelloImpl {
}

import com.sun.xml.ws.developer.ValidationErrorHandler;
import org.xml.sax.SAXParseException;
import org.xml.sax.SAXException;

public class MyErrorHandler extends ValidationErrorHandler {
    public void warning(SAXParseException e) throws SAXException {
        // Store warnings in the packet so that they can be retrieved 
        // from the endpoint
        packet.invocationProperties.put("error", e);
    }

    public void error(SAXParseException e) throws SAXException {
        throw e;
    }

    public void fatalError(SAXParseException e) throws SAXException {
        ; // noop
    }
}</pre></div></div><br class="example-break"></div><div class="section" title="4.2.2.&nbsp;Client Side Schema Validation"><div class="titlepage"><div><div><h3 class="title"><a name="client-side-schema-validation"></a>4.2.2.&nbsp;Client Side Schema Validation</h3></div></div></div><p>Proxy needs to be created with <a class="link" href="http://java.net/projects/jax-ws-architecture-document/sources/svn/content/trunk/www/doc/com/sun/xml/ws/developer/SchemaValidationFeature.html?raw=true" target="_top"><code class="code">SchemaValidationFeature</code></a>
            to enable client side validation. Both the outgoing SOAP request
            and incoming SOAP response will be validated.</p><div class="example"><a name="d0e3523"></a><p class="title"><b>Example&nbsp;4.9.&nbsp;Enabling Proxy with Schema Validation</b></p><div class="example-contents"><pre class="programlisting">import com.sun.xml.ws.developer.SchemaValidationFeature;
...

SchemaValidationFeature feature = new SchemaValidationFeature();
HelloPort port = new HelloService.getHelloPort(feature);
// All invocations on this port are validated</pre></div></div><br class="example-break"><p>If a client application wants to have complete control over
            validation error handling, it can set up a
            <code class="code">ValidationErrorHandler</code> to receive notification of
            errors. The handler has access to the <code class="code">Packet</code> and can
            store any information in its invocationProperties. These
            properties are accessible from proxy's response context.</p><div class="example"><a name="d0e3536"></a><p class="title"><b>Example&nbsp;4.10.&nbsp;Customizing Schema Validation</b></p><div class="example-contents"><pre class="programlisting">SchemaValidationFeature feature =
        new SchemaValidationFeature(MyErrorHandler.class);
HelloPort port = new HelloService.getHelloPort(feature);
// All invocations on this port will be validated</pre></div></div><br class="example-break"></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;5.&nbsp;HTTP"><div class="titlepage"><div><div><h2 class="title"><a name="http"></a>Chapter&nbsp;5.&nbsp;HTTP</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#http-headers">5.1. HTTP headers</a></span></dt><dd><dl><dt><span class="section"><a href="#sending-http-headers-on-request">5.1.1. Sending HTTP headers on request</a></span></dt><dt><span class="section"><a href="#accessing-http-headers-of-the-response">5.1.2. Accessing HTTP headers of the response</a></span></dt></dl></dd><dt><span class="section"><a href="#http-compression">5.2. HTTP compression</a></span></dt><dt><span class="section"><a href="#http-cookies">5.3. HTTP cookies</a></span></dt><dd><dl><dt><span class="section"><a href="#enabling-cookie-support">5.3.1. Enabling cookie support</a></span></dt><dt><span class="section"><a href="#accessing-http-cookies-in-the-response">5.3.2. Accessing HTTP cookies in the response</a></span></dt><dt><span class="section"><a href="#accessing-http-cookies-on-the-server">5.3.3. Accessing HTTP cookies on the server</a></span></dt></dl></dd><dt><span class="section"><a href="#http-client-streaming-support">5.4. HTTP client streaming support</a></span></dt><dt><span class="section"><a href="#access-http-headers-in-a-handler">5.5. Access HTTP headers in a Handler</a></span></dt><dd><dl><dt><span class="section"><a href="#from-client-side-handler">5.5.1. From Client side handler</a></span></dt><dt><span class="section"><a href="#from-server-side-handler">5.5.2. From Server side handler</a></span></dt></dl></dd><dt><span class="section"><a href="#http-timeouts">5.6. HTTP Timeouts</a></span></dt><dt><span class="section"><a href="#http-persistent-connections-keep-alive">5.7. HTTP Persistent Connections (keep-alive)</a></span></dt><dt><span class="section"><a href="#https-hostnameverifier">5.8. HTTPS HostnameVerifier</a></span></dt><dt><span class="section"><a href="#https-sslsocketfactory">5.9. HTTPS SSLSocketFactory</a></span></dt><dt><span class="section"><a href="#http-address-in-soapaddress-and-import-locations">5.10. HTTP address in soap:address and import locations</a></span></dt></dl></div><div class="section" title="5.1.&nbsp;HTTP headers"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-headers"></a>5.1.&nbsp;HTTP headers</h2></div></div></div><div class="section" title="5.1.1.&nbsp;Sending HTTP headers on request"><div class="titlepage"><div><div><h3 class="title"><a name="sending-http-headers-on-request"></a>5.1.1.&nbsp;Sending HTTP headers on request</h3></div></div></div><p>Client can set additional HTTP headers for making a requests
            by using <code class="code">MessageContext.HTTP_REQUEST_HEADERS</code>. See the
            following code for an example:</p><div class="example"><a name="d0e3556"></a><p class="title"><b>Example&nbsp;5.1.&nbsp;Sending HTTP headers</b></p><div class="example-contents"><pre class="programlisting">import java.util.Collections;
import javax.xml.ws.BindingProvider;
import javax.xml.ws.handler.MessageContext; 

HelloPort port =...;
((BindingProvider) port).getRequestContext().put(MessageContext
        .HTTP_REQUEST_HEADERS, Collections.singletonMap
        ("X-Client-Version", Collections.singletonList("1.0-RC")));

// the header will be sent to all successive invocations
port.sayHelloTo("duke");
port.sayHelloTo("duke");</pre></div></div><br class="example-break"><p>Note that the property takes
            <code class="code">Map&lt;String,List&lt;String&gt;&gt;</code> as the
            type.</p></div><div class="section" title="5.1.2.&nbsp;Accessing HTTP headers of the response"><div class="titlepage"><div><div><h3 class="title"><a name="accessing-http-headers-of-the-response"></a>5.1.2.&nbsp;Accessing HTTP headers of the response</h3></div></div></div><p>Clients can access the HTTP headers of the response by using
            <code class="code">MessageContext.HTTP_RESPONSE_HEADERS</code>. See the
            following code for example:</p><div class="example"><a name="d0e3574"></a><p class="title"><b>Example&nbsp;5.2.&nbsp;Accessing HTTP headers</b></p><div class="example-contents"><pre class="programlisting">HelloPort port = ...;
port.sayHelloTo("duke");

headers = (Map&lt;String, List&lt;String&gt;&gt;) ((BindingProvider) port)
        .getResponseContext().get(MessageContext.HTTP_RESPONSE_HEADERS);</pre></div></div><br class="example-break"></div></div><div class="section" title="5.2.&nbsp;HTTP compression"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-compression"></a>5.2.&nbsp;HTTP compression</h2></div></div></div><p>HTTP supports compression of data <a class="link" href="http://www.websiteoptimization.com/speed/tweak/compress/" target="_top">at
        the transport level</a>, which can substantially reduce the size of
        the data (at the expense of an additional CPU load.)</p><p>When sending a request to a server, a client can inform the
        server that it can receive compressed response like this:</p><div class="example"><a name="d0e3589"></a><p class="title"><b>Example&nbsp;5.3.&nbsp;Request HTTP Compression</b></p><div class="example-contents"><pre class="programlisting">Map&lt;String, List&lt;String&gt; httpHeaders = new HashMap&lt;String, List&lt;String&gt;&gt;();
httpHeaders.put("Accept-Encoding", Collections.singletonList("gzip"));
Map&lt;String, Object&gt; reqContext = ((bindingProvider)proxy).getRequestContext();
requestContext.put(MessageContext.HTTP_REQUEST_HEADERS, httpHeaders);</pre></div></div><br class="example-break"><p>This works even if the server isn't capable of doing
        compression; it will simply respond with uncompressed response and it
        will work transparently.</p><p>If a client knows that the server is capable of receiving a
        compressed request, it can send a compressed request by adding one
        more HTTP header as follows:</p><div class="example"><a name="d0e3598"></a><p class="title"><b>Example&nbsp;5.4.&nbsp;Sending Compressed Request</b></p><div class="example-contents"><pre class="programlisting">Map&lt;String, List&lt;String&gt; httpHeaders = new HashMap&lt;String, List&lt;String&gt;&gt;();
httpHeaders.put("Content-Encoding", Collections.singletonList("gzip"));
httpHeaders.put("Accept-Encoding", Collections.singletonList("gzip"));
Map&lt;String, Object&gt; reqContext = ((bindingProvider) proxy)
        .getRequestContext();
requestContext.put(MessageContext.HTTP_REQUEST_HEADERS, httpHeaders);</pre></div></div><br class="example-break"><p>Note that this will fail if the server is incapable of dealing
        with compressed HTTP traffic. Most modern HTTP servers understand it,
        but this is not guaranteed.</p></div><div class="section" title="5.3.&nbsp;HTTP cookies"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-cookies"></a>5.3.&nbsp;HTTP cookies</h2></div></div></div><div class="section" title="5.3.1.&nbsp;Enabling cookie support"><div class="titlepage"><div><div><h3 class="title"><a name="enabling-cookie-support"></a>5.3.1.&nbsp;Enabling cookie support</h3></div></div></div><p>To enable cookie support, you need to enable the session
            property. This causes requests sent via the port to use the same
            cookie jar, so if the server responds with a cookie, the next
            request will go out with those cookies. This allows the server to
            use the normal session tracking mechanism like
            <code class="code">HttpSession</code>.</p><div class="example"><a name="d0e3616"></a><p class="title"><b>Example&nbsp;5.5.&nbsp;Sending HTTP headers</b></p><div class="example-contents"><pre class="programlisting">HelloPort port = ...;
port.getRequestContext().put(BindingProvider.SESSION_MAINTAIN_PROPERTY,true);</pre></div></div><br class="example-break"></div><div class="section" title="5.3.2.&nbsp;Accessing HTTP cookies in the response"><div class="titlepage"><div><div><h3 class="title"><a name="accessing-http-cookies-in-the-response"></a>5.3.2.&nbsp;Accessing HTTP cookies in the response</h3></div></div></div><p>TODO</p></div><div class="section" title="5.3.3.&nbsp;Accessing HTTP cookies on the server"><div class="titlepage"><div><div><h3 class="title"><a name="accessing-http-cookies-on-the-server"></a>5.3.3.&nbsp;Accessing HTTP cookies on the server</h3></div></div></div><p>When the web service is using servlets as the transport
            mechanism, you can use <a class="link" href="http://www.google.com/search?q=servlet+cookie" target="_top">servlet's
            native support for cookies</a>. See the following code to how
            to access <code class="code">javax.servlet.http.HttpServletRequest</code> from
            your service.</p><div class="example"><a name="d0e3637"></a><p class="title"><b>Example&nbsp;5.6.&nbsp;Accessing cookies</b></p><div class="example-contents"><pre class="programlisting">class MyService {
    @Resource
    WebServiceContext context;

    public void foo() {
        HttpServletRequest rq = (HttpServletRequest) context
                .getMessageContext().get(MessageContext.SERVLET_REQUEST);
        HttpServletResponse rs = (HttpServletResponse) context
                .getMessageContext().get(MessageContext.SERVLET_RESPONSE);
    }
}</pre></div></div><br class="example-break"></div></div><div class="section" title="5.4.&nbsp;HTTP client streaming support"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-client-streaming-support"></a>5.4.&nbsp;HTTP client streaming support</h2></div></div></div><p>JAX-WS uses Java SE's <a class="link" href="http://download.oracle.com/javase/6/docs/api/java/net/HttpURLConnection.html" target="_top">HttpURLConnection</a>
        to send requests to web service. By default, HttpURLConnection buffers
        the entire request before sending it on the wire. To enable HTTP
        streaming support, one needs to enable <a class="link" href="http://download.oracle.com/javase/6/docs/api/java/net/HttpURLConnection.html#setChunkedStreamingMode%28int%29" target="_top">setChunkedStreamingMode()</a>
        on the connection. The same thing can be achieved by doing the
        following in JAX-WS clients.</p><div class="example"><a name="d0e3653"></a><p class="title"><b>Example&nbsp;5.7.&nbsp;HTTP client streaming support</b></p><div class="example-contents"><pre class="programlisting">int chunkSize = ...;
Map&lt;String, Object&gt; ctxt = ((BindingProvider)proxy).getRequestContext();
ctxt.put(JAXWSProperties.HTTP_CLIENT_STREAMING_CHUNK_SIZE, chunkSize);</pre></div></div><br class="example-break"></div><div class="section" title="5.5.&nbsp;Access HTTP headers in a Handler"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="access-http-headers-in-a-handler"></a>5.5.&nbsp;Access HTTP headers in a Handler</h2></div></div></div><p>HTTP headers can be accessed in a Handler. Here is how you can
        access the Content-Type HTTP header in a Handler:</p><div class="section" title="5.5.1.&nbsp;From Client side handler"><div class="titlepage"><div><div><h3 class="title"><a name="from-client-side-handler"></a>5.5.1.&nbsp;From Client side handler</h3></div></div></div><p>HTTP headers can be accessed in a client side Handler in an
            incoming response. Here is Handler code that demonstrates how to
            do this:</p><div class="example"><a name="d0e3668"></a><p class="title"><b>Example&nbsp;5.8.&nbsp;ClientHandler.java</b></p><div class="example-contents"><pre class="programlisting">public class ClientHandler implements SOAPHandler&lt;SOAPMessageContext&gt; {
    public boolean handleMessage(SOAPMessageContext context) {
        if (!(Boolean) context.get(MessageContext
                .MESSAGE_OUTBOUND_PROPERTY)) {
            
            Map&lt;String, List&lt;String&gt;&gt; map = (Map&lt;String, 
                    List&lt;String&gt;&gt;) context.get(MessageContext
                    .HTTP_RESPONSE_HEADERS);
            
            List&lt;String&gt; contentType = getHTTPHeader(map, "Content-Type");
            if (contentType != null) {
                StringBuffer strBuf = new StringBuffer();
                for (String type : contentType) {
                    strBuf.append(type);
                }
                System.out.println("Content-Type:" + strBuf.toString());
            }
        }
        return true;
    }


    private
    @Nullable
    List&lt;String&gt; getHTTPHeader(Map&lt;String, List&lt;String&gt;&gt; headers, 
                               String header) {
        for (Map.Entry&lt;String, List&lt;String&gt;&gt; entry : headers.entrySet()) {
            String name = entry.getKey();
            if (name.equalsIgnoreCase(header))
                return entry.getValue();
        }
        return null;
    }
}</pre></div></div><br class="example-break"></div><div class="section" title="5.5.2.&nbsp;From Server side handler"><div class="titlepage"><div><div><h3 class="title"><a name="from-server-side-handler"></a>5.5.2.&nbsp;From Server side handler</h3></div></div></div><p>HTTP headers can be accessed in a server side Handler on an
            incoming request. Here is Handler code that demonstrates how to do
            this:</p><div class="example"><a name="d0e3678"></a><p class="title"><b>Example&nbsp;5.9.&nbsp;ServerHandler.java</b></p><div class="example-contents"><pre class="programlisting">public class ServerHandler implements SOAPHandler&lt;SOAPMessageContext&gt; {
    public boolean handleMessage(SOAPMessageContext context) {

        if (!(Boolean) context.get(MessageContext
                .MESSAGE_OUTBOUND_PROPERTY)) {
            
            Map&lt;String, List&lt;String&gt;&gt; map = (Map&lt;String, 
                    List&lt;String&gt;&gt;) context.get(MessageContext
                    .HTTP_REQUEST_HEADERS);
            
            List&lt;String&gt; contentType = getHTTPHeader(map, "Content-Type");
            if (contentType != null) {
                StringBuffer strBuf = new StringBuffer();
                for (String type : contentType) {
                    strBuf.append(type);
                }
                System.out.println("Content-Type:" + strBuf.toString());
            }
        }

        return true;
    }

    private
    @Nullable
    List&lt;String&gt; getHTTPHeader(@NotNull Map&lt;String, 
            List&lt;String&gt;&gt; headers, @NotNull String header) {
        
        for (Map.Entry&lt;String, List&lt;String&gt;&gt; entry : headers.entrySet()) {
            String name = entry.getKey();
            if (name.equalsIgnoreCase(header))
                return entry.getValue();
        }
        return null;
    }
}</pre></div></div><br class="example-break"></div></div><div class="section" title="5.6.&nbsp;HTTP Timeouts"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-timeouts"></a>5.6.&nbsp;HTTP Timeouts</h2></div></div></div><p>JAX-WS uses Java SE's <a class="link" href="http://download.oracle.com/javase/6/docs/api/java/net/HttpURLConnection.html" target="_top">HttpURLConnection</a>
        to send requests to web services. URLConnection offers <a class="link" href="http://download.oracle.com/javase/6/docs/api/java/net/URLConnection.html#setConnectTimeout%28int%29" target="_top">setConnectTimeout()</a>
        and <a class="link" href="http://download.oracle.com/javase/6/docs/api/java/net/URLConnection.html#setReadTimeout%28int%29" target="_top">setReadTimeout()</a>
        methods so that clients can control connection timeouts. The same
        things can be achieved by doing the following in JAX-WS
        clients:</p><div class="example"><a name="d0e3697"></a><p class="title"><b>Example&nbsp;5.10.&nbsp;HTTP client timeouts</b></p><div class="example-contents"><pre class="programlisting">// setConnectTimeout()
int timeout = ...;
Map&lt;String, Object&gt; ctxt = ((BindingProvider)proxy).getRequestContext();
ctxt.put(JAXWSProperties.CONNECT_TIMEOUT, timeout);

// setReadTimeout()
int timeout = ...;
Map&lt;String, Object&gt; ctxt = ((BindingProvider)proxy).getRequestContext();
ctxt.put("com.sun.xml.ws.request.timeout", timeout);</pre></div></div><br class="example-break"></div><div class="section" title="5.7.&nbsp;HTTP Persistent Connections (keep-alive)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-persistent-connections-keep-alive"></a>5.7.&nbsp;HTTP Persistent Connections (keep-alive)</h2></div></div></div><p>Persistent connections improve performance by allowing the
        underlying socket connection to be reused for multiple http requests.
        JAX-WS uses Java SE's <a class="link" href="http://download.oracle.com/javase/6/docs/api/java/net/HttpURLConnection.html" target="_top">HttpURLConnection</a>
        to send requests to web services. HTTP keep-alive behavior can be
        controlled by the http.keepAlive (default: true) and
        http.maxConnections (default: 5) system properties. For more
        information, see <a class="link" href="http://download.oracle.com/javase/6/docs/technotes/guides/net/properties.html" target="_top">Networking
        Properties</a></p></div><div class="section" title="5.8.&nbsp;HTTPS HostnameVerifier"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="https-hostnameverifier"></a>5.8.&nbsp;HTTPS HostnameVerifier</h2></div></div></div><p>JAX-WS uses Java SE's <a class="link" href="http://download.oracle.com/javase/6/docs/api/javax/net/ssl/HttpsURLConnection.html" target="_top">HttpsURLConnection</a>
        to send requests to web services that use the HTTPS transport.
        HttpsURLConnection offers a <a class="link" href="http://download.oracle.com/javase/6/docs/api/javax/net/ssl/HttpsURLConnection.html#setHostnameVerifier%28javax.net.ssl.HostnameVerifier%29" target="_top">setHostnameVerifier()</a>
        method so that the client's verification callback can be called to
        determine whether a connection is allowed. The same thing can be
        achieved by doing the following in JAX-WS clients:</p><div class="example"><a name="d0e3723"></a><p class="title"><b>Example&nbsp;5.11.&nbsp;SSL Hostname Verification</b></p><div class="example-contents"><pre class="programlisting">HostNameVerifier hostNameVerifier = ...;
int timeout = ...;
Map&lt;String, Object&gt; ctxt = ((BindingProvider)proxy).getRequestContext();
ctxt.put(JAXWSProperties.HOSTNAME_VERIFIER, hostNameVerifier);</pre></div></div><br class="example-break"></div><div class="section" title="5.9.&nbsp;HTTPS SSLSocketFactory"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="https-sslsocketfactory"></a>5.9.&nbsp;HTTPS SSLSocketFactory</h2></div></div></div><p>JAX-WS uses Java SE's <a class="link" href="http://download.oracle.com/javase/6/docs/api/javax/net/ssl/HttpsURLConnection.html" target="_top">HttpsURLConnection</a>
        to send requests to web services that use HTTPS transport.
        HttpsURLConnection offers <a class="link" href="http://java.sun.com/j2se/1.5.0/docs/api/javax/net/ssl/HttpsURLConnection.html#setSSLSocketFactory(javax.net.ssl.SSLSocketFactory)" target="_top">setSSLSocketFactory()</a>
        method and that factory is used when creating sockets for secure https
        URL connections. The same thing can be achieved by doing the following
        in JAX-WS clients:</p><div class="example"><a name="d0e3739"></a><p class="title"><b>Example&nbsp;5.12.&nbsp;HTTPS SSLSocketFactory</b></p><div class="example-contents"><pre class="programlisting">SSLSocketFactory sslSocketFactory = ...;
Map&lt;String, Object&gt; ctxt = ((BindingProvider)proxy).getRequestContext();
ctxt.put(JAXWSProperties.SSL_SOCKET_FACTORY, sslSocketFactory);</pre></div></div><br class="example-break"></div><div class="section" title="5.10.&nbsp;HTTP address in soap:address and import locations"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="http-address-in-soapaddress-and-import-locations"></a>5.10.&nbsp;HTTP address in soap:address and import locations</h2></div></div></div><p>A service may be hosted in a servlet container that is behind
        firewall/load balancer. Then a published WSDL's soap:address,
        wsdl:import, xsd:import locations may point to the internal
        address(not to the external firewall/loadbalancer address). Metro uses
        the HttpServletRequest's getServerName() and getServerPort() to figure
        out the server's address and port respectively. This works in many
        cases, but you may need to configure the servlet container's server
        address in some cases. </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>This is supported in GlassFish, by configuring
                    "server-name" attribute of &lt;http-listener&gt; in
                    domain.xml. For example, set it to
                    "http://firewall-host:firewall-port"</p></li><li class="listitem"><p>This is supported in Tomcat, by using the
                    "proxyName" and "proxyPort" attributes on
                    &lt;Connector&gt;. See <a class="link" href="http://tomcat.apache.org/tomcat-5.5-doc/proxy-howto.html" target="_top">tomcat
                    configuration</a></p></li></ul></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;6.&nbsp;Processing Large Data"><div class="titlepage"><div><div><h2 class="title"><a name="processing-large-data"></a>Chapter&nbsp;6.&nbsp;Processing Large Data</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#receiving-large-soap-requests">6.1. Receiving large SOAP requests</a></span></dt><dd><dl><dt><span class="section"><a href="#providermessage">6.1.1. Provider&lt;Message&gt;</a></span></dt></dl></dd><dt><span class="section"><a href="#binary-attachments-mtom">6.2. Binary Attachments (MTOM)</a></span></dt><dd><dl><dt><span class="section"><a href="#mtom">6.2.1. MTOM</a></span></dt><dt><span class="section"><a href="#enabling-mtom-on-server">6.2.2. Enabling MTOM on server</a></span></dt><dt><span class="section"><a href="#enabling-mtom-on-client">6.2.3. Enabling MTOM on client</a></span></dt><dt><span class="section"><a href="#mtom-threshold">6.2.4. MTOM threshold</a></span></dt><dt><span class="section"><a href="#net-interoperability">6.2.5. .NET interoperability</a></span></dt></dl></dd><dt><span class="section"><a href="#large-attachments">6.3. Large Attachments</a></span></dt><dd><dl><dt><span class="section"><a href="#client-side">6.3.1. Client Side</a></span></dt><dt><span class="section"><a href="#server-side">6.3.2. Server Side</a></span></dt><dt><span class="section"><a href="#configuration">6.3.3. Configuration</a></span></dt><dt><span class="section"><a href="#large-attachments-summary">6.3.4. Large Attachments Summary</a></span></dt></dl></dd></dl></div><div class="section" title="6.1.&nbsp;Receiving large SOAP requests"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="receiving-large-soap-requests"></a>6.1.&nbsp;Receiving large SOAP requests</h2></div></div></div><p>Processing of large incoming SOAP requests can be made more
        efficient with some additional effort.</p><div class="section" title="6.1.1.&nbsp;Provider<Message&gt;"><div class="titlepage"><div><div><h3 class="title"><a name="providermessage"></a>6.1.1.&nbsp;Provider&lt;Message&gt;</h3></div></div></div><p><a class="link" href="http://weblogs.java.net/blog/kohsuke/archive/2007/03/dispatch_and_pr.html" target="_top">JAX-WS
            RI extension Provider&lt;Message&gt;</a> can be used to read an
            incoming SOAP message by using <code class="code">XMLStreamReader</code> (among
            other things.) This allows you to read the SOAP message on-demand
            lazily, without needing to buffer the whole message in
            memory.</p><p>See <a class="link" href="http://jaxb.java.net/guide/Dealing_with_large_documents.html" target="_top">the
            relevant JAXB users guide section</a> for how to combine JAXB
            with such streaming processing.</p></div></div><div class="section" title="6.2.&nbsp;Binary Attachments (MTOM)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="binary-attachments-mtom"></a>6.2.&nbsp;Binary Attachments (MTOM)</h2></div></div></div><div class="section" title="6.2.1.&nbsp;MTOM"><div class="titlepage"><div><div><h3 class="title"><a name="mtom"></a>6.2.1.&nbsp;MTOM</h3></div></div></div><p><a class="link" href="http://www.w3.org/TR/soap12-mtom/" target="_top">MTOM</a> (and
            <a class="link" href="http://www.w3.org/TR/xop10/" target="_top">XOP</a>) allows
            you to send and receive binary attachments (such as files and
            images) efficiently and in an interoperable manner.</p><div class="section" title="6.2.1.1.&nbsp;What is MTOM?"><div class="titlepage"><div><div><h4 class="title"><a name="what-is-mtom"></a>6.2.1.1.&nbsp;What is MTOM?</h4></div></div></div><p>Perhaps the best way to understand the pros and cons of
                MTOM is to see an actual on-the-wire message. See an example
                below:</p><div class="example"><a name="d0e3800"></a><p class="title"><b>Example&nbsp;6.1.&nbsp;Sample MTOM message</b></p><div class="example-contents"><pre class="programlisting">Content-Type: Multipart/Related; start-info="text/xml"; type="application/xop+xml"; boundary="----=_Part_0_1744155.1118953559416"
Content-Length: 3453
SOAPAction: ""

------=_Part_1_4558657.1118953559446
Content-Type: application/xop+xml; type="text/xml"; charset=utf-8

&lt;S:Envelope xmlns:S="http://schemas.xmlsoap.org/soap/envelope/"&gt;
  &lt;S:Body&gt;
    &lt;Detail xmlns="http://example.org/mtom/data"&gt;
      &lt;image&gt;
        &lt;xop:Include xmlns:xop="http://www.w3.org/2004/08/xop/include" href="cid:5aeaa450-17f0-4484-b845-a8480c363444@example.org" /&gt;
      &lt;/image&gt;
    &lt;/Detail&gt;
  &lt;/S:Body&gt;
&lt;/S:Envelope&gt;


------=_Part_1_4558657.1118953559446
Content-Type: image/jpeg
Content-ID: &lt;5aeaa450-17f0-4484-b845-a8480c363444@example.org&gt;


... binary data ...</pre></div></div><br class="example-break"><p>The noteworthy points are:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The binary attachment is packaged in a MIME
                        multi-part message (the same mechanism used in e-mail
                        to handle attachments.)</p></li><li class="listitem"><p>An &lt;xop:Include&gt; element is used to mark
                        where the binary data is.</p></li><li class="listitem"><p>The actual binary data is kept in a different
                        MIME part.</p></li></ol></div><p>MTOM is efficient, in the sense that it doesn't have the
                33% size increase penalty that <code class="code">xs:base64Binary</code>
                has. It is interoperable, in the sense that it is a W3C
                standard. However, MIME multipart incurs a small cost
                proportional to the number of attachments, so it is not
                suitable for a large number of tiny attachments.</p><p>The schema that describes the above message is below.
                The MTOM spec is designed to work below the XML infoset level,
                so the schema describes the image as being of type
                <code class="code">xs:base64Binary</code>, even though it can be attached
                as seen above. When using MTOM, any base64Binary can be
                attached or inlined.</p><div class="example"><a name="d0e3827"></a><p class="title"><b>Example&nbsp;6.2.&nbsp;Schema</b></p><div class="example-contents"><pre class="programlisting">&lt;element name="Detail" type="types:DetailType"/&gt;
&lt;complexType name="DetailType"&gt;
  &lt;sequence&gt;
    &lt;element name="image" type="base64Binary" /&gt;
  &lt;/sequence&gt;
&lt;/complexType&gt;</pre></div></div><br class="example-break"></div><div class="section" title="6.2.1.2.&nbsp;xmime:expectedContentType to Java type mapping"><div class="titlepage"><div><div><h4 class="title"><a name="xmimeexpectedcontenttype-to-java-type-mapping"></a>6.2.1.2.&nbsp;xmime:expectedContentType to Java type mapping</h4></div></div></div><p>Schema elements of type <code class="code">xs:base64Binary</code> or
                <code class="code">xs:hexBinary</code> can be annotated by using the <a class="link" href="http://www.w3.org/TR/xml-media-types/" target="_top">xmime:expectedContentType</a>
                attribute to indicate the type of binary that is expected.
                <code class="code">wsimport</code> recognizes this annotation and will map
                the binary data to its proper Java representation instead. The
                table below is taken from JAXB spec Table 9-1, which shows the
                mapping rules:</p><div class="table"><a name="d0e3849"></a><p class="title"><b>Table&nbsp;6.1.&nbsp;JAXB Mapping Rules</b></p><div class="table-contents"><table summary="JAXB Mapping Rules" border="1"><colgroup><col><col></colgroup><thead><tr><th>MIME Type</th><th>Java Type</th></tr></thead><tbody><tr><td>image/*</td><td>java.awt.Image</td></tr><tr><td>text/plain</td><td>java.lang.String</td></tr><tr><td>application/xml, text/xml</td><td>javax.xml.transform.Source</td></tr><tr><td>(others)</td><td>javax.activation.DataHandler</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" title="6.2.1.3.&nbsp;xmime:contentType attribute"><div class="titlepage"><div><div><h4 class="title"><a name="xmimecontenttype-attribute"></a>6.2.1.3.&nbsp;xmime:contentType attribute</h4></div></div></div><p>The schema can further use the <a class="link" href="http://www.w3.org/TR/xml-media-types/" target="_top">xmime:contentType</a>
                attribute to designate the actual content type of the binary
                data used in the message. (In contrast,
                <code class="code">xmime:expectedContentTypes</code> specifies what are
                allowed. This combination allows you to say "image/* is
                expected but this message contains image/jpeg".)</p><p>This attribute can be used with elements whose content
                is either <code class="code">xs:base64Binary</code> or
                <code class="code">xs:hexBinary</code>. Consider the following
                example:</p><div class="example"><a name="d0e3899"></a><p class="title"><b>Example&nbsp;6.3.&nbsp;Using xmime:contentType</b></p><div class="example-contents"><pre class="programlisting">&lt;element name="TestMtomXmimeContentType" type="types:PictureType"/&gt;

&lt;complexType name="PictureType"&gt;
  &lt;simpleContent&gt;
    &lt;restriction base="xmime:base64Binary"&gt;
      &lt;attribute ref="xmime:contentType" use="required" /&gt;
    &lt;/restriction&gt;
  &lt;/simpleContent&gt;
&lt;/complexType&gt;</pre></div></div><br class="example-break"><p>Here <code class="code">xmime:base64Binary</code> is defined by <a class="link" href="http://www.w3.org/TR/xml-media-types/#schema" target="_top">Describing
                Media Content of Binary Data in XML</a>. The following code
                shows how your program can set the MIME type to the generated
                beans:</p><div class="example"><a name="d0e3912"></a><p class="title"><b>Example&nbsp;6.4.&nbsp;Setting content type</b></p><div class="example-contents"><pre class="programlisting">PictureType req = new PictureType();
req.setValue(name.getBytes());
req.setContentType("application/xml");</pre></div></div><br class="example-break"><p>On the wire this is how it looks:</p><div class="example"><a name="d0e3919"></a><p class="title"><b>Example&nbsp;6.5.&nbsp;SOAP Message that uses xmime:contentType</b></p><div class="example-contents"><pre class="programlisting">&lt;S:Envelope xmlns:S="http://schemas.xmlsoap.org/soap/envelope/"
  xmlns:xsd="http://www.w3.org/2001/XMLSchema"
  xmlns:ns1="http://example.org/mtom/data"
  xmlns:ns2="http://www.w3.org/2005/05/xmlmime"&gt;
  &lt;S:Body&gt;
    &lt;ns1:TestMtomXmimeContentTypeResponse ns2:contentType="application/xml"&gt;
      &lt;xop:Include
          xmlns:xop="http://www.w3.org/2004/08/xop/include"
          href="cid:193ed174-d313-4325-8eed-16cc25595e4e@example.org"/&gt;
    &lt;/ns1:TestMtomXmimeContentTypeResponse&gt;
  &lt;/S:Body&gt;
&lt;/S:Envelope&gt;</pre></div></div><br class="example-break"></div></div><div class="section" title="6.2.2.&nbsp;Enabling MTOM on server"><div class="titlepage"><div><div><h3 class="title"><a name="enabling-mtom-on-server"></a>6.2.2.&nbsp;Enabling MTOM on server</h3></div></div></div><p>There are several ways to enable MTOM.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>By using the @MTOM annotation on SEI. This is
                    convenience and preferable for developers. </p><div class="example"><a name="d0e3933"></a><p class="title"><b>Example&nbsp;6.6.&nbsp;Annotating SEI with @MTOM</b></p><div class="example-contents"><pre class="programlisting">@javax.xml.ws.soap.MTOM
@WebService
public class HelloImpl implements Hello {
    ....
}</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>By using the <code class="code">enable-mtom</code> attribute in
                    the <code class="code">sun-jaxws.xml</code> configuration file. This
                    allows the MTOM setting to be changed at deployment time.
                    </p><div class="example"><a name="d0e3947"></a><p class="title"><b>Example&nbsp;6.7.&nbsp;Enabling MTOM in sun-jaxws.xml</b></p><div class="example-contents"><pre class="programlisting">&lt;endpoints xmlns='http://java.sun.com/xml/ns/jax-ws/ri/runtime' version='2.0'&gt;
  &lt;endpoint name="Mtom" implementation="mtom.server.HelloImpl"
    url-pattern="/hello"
    enable-mtom="true"/&gt;
&lt;/endpoints&gt;</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>If you are using JAX-WS RI via Spring, you can also
                    enable MTOM from the bean definition file. See the JAX-WS
                    spring extension for more.</p></li></ol></div></div><div class="section" title="6.2.3.&nbsp;Enabling MTOM on client"><div class="titlepage"><div><div><h3 class="title"><a name="enabling-mtom-on-client"></a>6.2.3.&nbsp;Enabling MTOM on client</h3></div></div></div><p>There are several ways to enable MTOM.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>By doing nothing. If the server WSDL advertises that
                    it supports MTOM, the MTOM support in the client will be
                    automatically enabled. This is the preferable way.</p></li><li class="listitem"><p>By passing <code class="code">MTOMFeature</code> as
                    <code class="code">WebServiceFeature</code> parameter while creating a
                    <code class="code">proxy</code> or a <code class="code">Dispatch</code>. See the
                    example below: </p><div class="example"><a name="d0e3979"></a><p class="title"><b>Example&nbsp;6.8.&nbsp;Passing MTOMFeature</b></p><div class="example-contents"><pre class="programlisting">Hello port = new HelloService().getHelloPort(new MTOMFeature());
Dispatch d = new HelloService().createDispatch(....,new MTOMFeature());</pre></div></div><p><br class="example-break"></p></li></ol></div></div><div class="section" title="6.2.4.&nbsp;MTOM threshold"><div class="titlepage"><div><div><h3 class="title"><a name="mtom-threshold"></a>6.2.4.&nbsp;MTOM threshold</h3></div></div></div><p>As discussed above, in rare situations where you have a lot
            of tiny attachments, the overhead of MTOM may outweigh the benefit
            of binary transfer. To cope with this situation, the JAX-WS RI
            supports the notion of "threshold" --- if an attachment is smaller
            than the size specified in threshold, it will simply inline the
            binary data as base64 binary instead of making it an attachment.
            Because of the way MTOM spec is designed, such inline vs
            attachment decision is handled by the toolkits of both ends and
            will not harm the application running on both sides.</p><p>There are two ways to control the threshold:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>By using the
                    <code class="code">com.sun.xml.ws.developer.JAXWSProperties.MTOM_THRESHOLD_VALUE</code>
                    property in the <code class="code">RequestContext</code> on the client
                    side and in the <code class="code">MessageContext</code> on the server
                    side.</p></li><li class="listitem"><p>By adding parameter to the <code class="code">@MTOM</code>
                    annotation, such as
                    <code class="code">@MTOM(threshold=3000)</code></p></li><li class="listitem"><p>By adding parameter to the <code class="code">MTOMFeature</code>
                    object, such as <code class="code">new MTOM(3000)</code></p></li></ol></div></div><div class="section" title="6.2.5.&nbsp;.NET interoperability"><div class="titlepage"><div><div><h3 class="title"><a name="net-interoperability"></a>6.2.5.&nbsp;.NET interoperability</h3></div></div></div><div class="section" title="6.2.5.1.&nbsp;Using Metro distribution"><div class="titlepage"><div><div><h4 class="title"><a name="using-metro-distribution"></a>6.2.5.1.&nbsp;Using Metro distribution</h4></div></div></div><p>MTOM support is fully interoperable with .NET clients
                and servers. If you are working with <span class="bold"><strong>Metro</strong></span> then your MTOM solution as a
                endpoint or as client will work out of the box.</p></div><div class="section" title="6.2.5.2.&nbsp;Using JAX-WS RI distribution"><div class="titlepage"><div><div><h4 class="title"><a name="using-jax-ws-ri-distribution"></a>6.2.5.2.&nbsp;Using JAX-WS RI distribution</h4></div></div></div><p>If you are using JAX-WS RI distribution, MTOM interop
                with .NET client or server will not work out of the box. The
                reason behind this is that JAX-WS RI does not have built in
                support for WS-Policy and .NET 3.0/.NET 3.5 looks for an MTOM
                policy assertion in the WSDL before turning on MTOM encoding.
                So, you will need to turn it on explicitly on your .NET
                3.0/3.5 or JAX-WS RI client.</p><p>The MTOM policy assertion that .NET 3.0/.NET 3.5
                understands is: <span class="bold"><strong>&lt;wsoma:OptimizedMimeSerialization/&gt;</strong></span></p><div class="section" title="6.2.5.2.1.&nbsp;JAX-WS RI endpoint and .NET client"><div class="titlepage"><div><div><h5 class="title"><a name="jax-ws-ri-endpoint-and-net-client"></a>6.2.5.2.1.&nbsp;JAX-WS RI endpoint and .NET client</h5></div></div></div><p>Turn on MTOM explicitly on your .NET client using
                    the WCF editor available with Visual Studio 2005.</p></div><div class="section" title="6.2.5.2.2.&nbsp;JAX-WS RI client and .NET endpoint"><div class="titlepage"><div><div><h5 class="title"><a name="jax-ws-ri-client-and-net-endpoint"></a>6.2.5.2.2.&nbsp;JAX-WS RI client and .NET endpoint</h5></div></div></div><p>Turn on MTOM on JAX-WS RI client as defined above.</p></div><div class="simplesect"><div class="titlepage"></div><p>Here is a sample <a class="link" href="download/MetroMtomService.zip" target="_top">Metro MTOM
                    endpoint</a> and a <a class="link" href="download/WCFMtomClient.zip" target="_top">.NET 3.0
                    client</a>.</p></div></div></div></div><div class="section" title="6.3.&nbsp;Large Attachments"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="large-attachments"></a>6.3.&nbsp;Large Attachments</h2></div></div></div><p>JAX-WS RI provides support for sending and receiving large
        attachments in a streaming fashion. Often times, large attachments
        need to be stored on the file system since they cannot be kept in
        memory(limited by heap size). But in certain cases, streaming of
        attachments is possible without ever storing the content on the file
        system. RI will try to stream the attachments whenever it is possible.
        Otherwise, it would store the large attachments on the file
        system.</p><p>The programming model is based on MTOM and DataHandler. You want
        to send large data as a SOAP attachment, see <a class="link" href="Binary_Attachments__MTOM_.html" target="_top">this section</a> for
        more details. Also you want to bind large data to
        <code class="code">DataHandler</code> instead of <code class="code">byte[]</code>. RI provides a
        <code class="code">StreamingDataHandler</code>, a DataHandler implementation that
        can be used to access the data efficiently in a streaming
        fashion.</p><div class="section" title="6.3.1.&nbsp;Client Side"><div class="titlepage"><div><div><h3 class="title"><a name="client-side"></a>6.3.1.&nbsp;Client Side</h3></div></div></div><p>RI uses Java SE's <a class="link" href="http://download.oracle.com/javase/6/docs/api/java/net/HttpURLConnection.html" target="_top">HttpURLConnection</a>
            for web service invocations. <code class="code">HttpURLConnection</code>
            buffers the request data by default. So the client applications
            need to enable streaming explicitly, see <a class="link" href="HTTP_client_streaming_support.html" target="_top">http client
            streaming</a>. The following sample show how to send and
            receive large data.</p><div class="example"><a name="d0e4095"></a><p class="title"><b>Example&nbsp;6.9.&nbsp;Sample client for large attachments</b></p><div class="example-contents"><pre class="programlisting">import com.sun.xml.ws.developer.JAXWSProperties;
import com.sun.xml.ws.developer.StreamingDataHandler;

MTOMFeature feature = new MTOMFeature();
MyService service = new MyService();
MyProxy proxy = service.getProxyPort(feature);
Map&lt;String, Object&gt; ctxt = ((BindingProvider)proxy).getRequestContext();
// Enable HTTP chunking mode, otherwise HttpURLConnection buffers
ctxt.put(JAXWSProperties.HTTP_CLIENT_STREAMING_CHUNK_SIZE, 8192); 
DataHandler dh = proxy.fileUpload(...);
StreamingDataHandler sdh = (StreamingDataHandler)dh;
InputStream in = sdh.readOnce();
...
in.close();
sdh.close();</pre></div></div><br class="example-break"></div><div class="section" title="6.3.2.&nbsp;Server Side"><div class="titlepage"><div><div><h3 class="title"><a name="server-side"></a>6.3.2.&nbsp;Server Side</h3></div></div></div><p>Use @MTOM feature for a service and <code class="code">DataHandler</code>
            parameter for large data. If the WSDL contains
            xmime:expectedContentTypes="application/octet-stream", it would be
            mapped to DataHandler in the generated SEI. If the service is
            starting from java, @XmlMimeType("application/octet-stream") can
            be used to generate an appropriate schema type in the generated
            WSDL.</p><p>The following sample shows how to upload files. It uses
            <code class="code">StreamingDataHandler.moveTo(File)</code> convenient method
            to store the contents of the attachment to a file.</p><div class="example"><a name="d0e4113"></a><p class="title"><b>Example&nbsp;6.10.&nbsp;Sample service for large attachments</b></p><div class="example-contents"><pre class="programlisting">import com.sun.xml.ws.developer.StreamingDataHandler;
...

@MTOM
@WebService
public class UploadImpl {

    // Use @XmlMimeType to map to DataHandler on the client side
    public void fileUpload(String name, 
                           @XmlMimeType("application/octet-stream") 
                           DataHandler data) {
        try {
            StreamingDataHandler dh = (StreamingDataHandler) data;
            File file = File.createTempFile(name, "");
            dh.moveTo(file);
            dh.close();
        } catch (Exception e) {
            throw new WebServiceException(e);
        }
    }
}</pre></div></div><br class="example-break"></div><div class="section" title="6.3.3.&nbsp;Configuration"><div class="titlepage"><div><div><h3 class="title"><a name="configuration"></a>6.3.3.&nbsp;Configuration</h3></div></div></div><p>You can configure streaming attachments behaviour using
            <code class="code">@StreamingAttachment</code> on the server side, and using
            <code class="code">StreamingAttachmentFeature</code> on the client side. Using
            this feature, you can configure only certain sized attachments are
            written to a file.</p><div class="example"><a name="d0e4129"></a><p class="title"><b>Example&nbsp;6.11.&nbsp;Sample Service Configuration</b></p><div class="example-contents"><pre class="programlisting">import com.sun.xml.ws.developer.StreamingAttachment;

// Configure such that whole MIME message is parsed eagerly,
// Attachments under 4MB are kept in memory
@MTOM
@StreamingAttachment(parseEagerly=true, memoryThreshold=4000000L)
@WebService
public class UploadImpl {
}</pre></div></div><br class="example-break"><div class="example"><a name="d0e4134"></a><p class="title"><b>Example&nbsp;6.12.&nbsp;Sample client configuration</b></p><div class="example-contents"><pre class="programlisting">import com.sun.xml.ws.developer.StreamingAttachmentFeature;

MTOMFeature mtom = new MTOMFeature();
// Configure such that whole MIME message is parsed eagerly,
// Attachments under 4MB are kept in memory
StreamingAttachmentFeature stf =
        new StreamingAttachmentFeature(null, true, 4000000L);
MyService service = new MyService();
MyProxy proxy = service.getProxyPort(feature, stf);</pre></div></div><br class="example-break"></div><div class="section" title="6.3.4.&nbsp;Large Attachments Summary"><div class="titlepage"><div><div><h3 class="title"><a name="large-attachments-summary"></a>6.3.4.&nbsp;Large Attachments Summary</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Use MTOM and DataHandler in the programming
                    model.</p></li><li class="listitem"><p>Cast the DataHandler to StreamingDataHandler and use
                    its methods.</p></li><li class="listitem"><p>Make sure you call StreamingDataHandler.close() and
                    also close the StreamingDataHandler.readOnce()
                    stream.</p></li><li class="listitem"><p>Enable HTTP chunking on the client-side.</p></li></ul></div></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;7.&nbsp;Bootstrapping and Configuration"><div class="titlepage"><div><div><h2 class="title"><a name="bootstrap_config"></a>Chapter&nbsp;7.&nbsp;Bootstrapping and Configuration</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#bootstrap_config-server_endpoint">7.1. What is a Server-Side Endpoint?</a></span></dt><dt><span class="section"><a href="#bootstrap_config-client_from_wsdl">7.2. Creating a Client from WSDL</a></span></dt><dt><span class="section"><a href="#bootstrap_config-client_from_wsdl_examples">7.3. Client From WSDL Examples</a></span></dt></dl></div><div class="section" title="7.1.&nbsp;What is a Server-Side Endpoint?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="bootstrap_config-server_endpoint"></a>7.1.&nbsp;What is a Server-Side Endpoint?</h2></div></div></div><p>Web services expose one or more endpoints to which messages can
        be sent. A web service endpoint is an entity, processor, or resource
        that can be referenced and to which web services messages can be
        addressed. Endpoint references convey the information needed to
        address a web service endpoint. Clients need to know this information
        before they can access a service.</p><p>Typically, web services package endpoint descriptions and use a
        WSDL file to share these descriptions with clients. Clients use the
        web service endpoint description to generate code that can send SOAP
        messages to and receive SOAP messages from the web service
        endpoint.</p></div><div class="section" title="7.2.&nbsp;Creating a Client from WSDL"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="bootstrap_config-client_from_wsdl"></a>7.2.&nbsp;Creating a Client from WSDL</h2></div></div></div><p>To create a web service client that can access and consume a web
        service provider, you must obtain the information that defines the
        interoperability requirements of the web service provider. Providers
        make this information available by means of WSDL files. WSDL files may
        be made available in service registries or published on the Internet
        using a URL (or both). You can use a web browser or NetBeans IDE to
        obtain WSDL files.</p><p>A WSDL file contains descriptions of the following:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Network services</em></span>: The description
                includes the name of the service, the location of the service,
                and ways to communicate with the service, that is, what
                transport to use.</p></li><li class="listitem"><p><span class="emphasis"><em>Web services policies</em></span>: Policies
                express the capabilities, requirements, and general
                characteristics of a web service. Web service providers use
                policies to specify policy information in a standardized way.
                Policies convey conditions on interactions between two web
                service endpoints. Typically, the provider of a web service
                exposes a policy to convey conditions under which it provides
                the service. A requester (a client) might use the policy to
                decide whether or not to use the service.</p></li></ul></div><p>Web Services Metadata Exchange (WS-MEX) is the protocol for
        requesting and transferring the WSDL from the provider to the client.
        This protocol is a bootstrap mechanism for communication.</p></div><div class="section" title="7.3.&nbsp;Client From WSDL Examples"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="bootstrap_config-client_from_wsdl_examples"></a>7.3.&nbsp;Client From WSDL Examples</h2></div></div></div><p>The following sections, found in other chapters of this
        tutorial, explain how to create a client from a WSDL file using the
        example files in the tutorial bundle:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> shows how to create a client from
                WSDL using a web container and the NetBeans IDE.</p></li><li class="listitem"><p><a class="xref" href="#ahigi" title="14.5.2.&nbsp;Creating a Client from WSDL">Creating a Client from WSDL</a> shows
                how to create a client from WSDL using only a web
                container.</p></li></ul></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;8.&nbsp;Message Optimization"><div class="titlepage"><div><div><h2 class="title"><a name="ahibx"></a>Chapter&nbsp;8.&nbsp;Message Optimization</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#ahiby">8.1. Creating a MTOM Web Service</a></span></dt><dt><span class="section"><a href="#ahibz">8.2. Configuring Message Optimization in a Web Service</a></span></dt><dt><span class="section"><a href="#ahica">8.3. Deploying and Testing a Web Service with Message Optimization
        Enabled</a></span></dt><dt><span class="section"><a href="#ahicb">8.4. Creating a Client to Consume a Message Optimization-enabled Web
        Service</a></span></dt><dt><span class="section"><a href="#ahicc">8.5. Message Optimization and Secure Conversation</a></span></dt></dl></div><div class="section" title="8.1.&nbsp;Creating a MTOM Web Service"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahiby"></a>8.1.&nbsp;Creating a MTOM Web Service</h2></div></div></div><p>The starting point for developing a web service to use WSIT is a
        Java class file annotated with the <code class="code">javax.jws.WebService</code>
        annotation.</p><p>For detailed instructions for how to use NetBeans IDE to create
        a web service, see <a class="xref" href="#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a>.</p></div><div class="section" title="8.2.&nbsp;Configuring Message Optimization in a Web Service"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahibz"></a>8.2.&nbsp;Configuring Message Optimization in a Web Service</h2></div></div></div><p>To use the IDE to configure a web service for message
        optimization, perform the following steps.</p><div class="task" title="To Configure Message Optimization in a Web Service"><p class="title"><b>To Configure Message Optimization in a Web Service</b></p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>In the IDE
                    <span class="guilabel">Projects</span> window, expand the
                    <span class="guilabel">Web Services</span> node, right-click the
                    <span class="guilabel">CalculatorWSService</span> node, and choose
                    <span class="guilabel">Edit Web Service Attributes</span>.
                    </strong></span></p><p>The <span class="guilabel">Web Service Attributes</span>
                    editor appears.</p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select the <span class="guilabel">Optimize
                    Transfer of Binary Data (MTOM)</span> check box, as
                    shown in <a class="xref" href="#gfrdw" title="Figure&nbsp;8.1.&nbsp;Enabling MTOM">Enabling MTOM</a>, and click
                    <span class="guibutton">OK</span>.</strong></span></p><p>This setting configures the web service to optimize
                    messages that it transmits and to decode optimized
                    messages that it receives.</p><div class="figure"><a name="gfrdw"></a><p class="title"><b>Figure&nbsp;8.1.&nbsp;Enabling MTOM</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/MTOM_screen.png" height="360" alt="Enabling MTOM"></td></tr></table></div></div></div><br class="figure-break"></li></ol></div></div></div><div class="section" title="8.3.&nbsp;Deploying and Testing a Web Service with Message Optimization Enabled"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahica"></a>8.3.&nbsp;Deploying and Testing a Web Service with Message Optimization
        Enabled</h2></div></div></div><p>Now that you have configured the web service to use message
        optimization, you can deploy and test it.</p><div class="task" title="To Deploy and Test a Web Service with Message Optimization Enabled"><p class="title"><b>To Deploy and Test a Web Service with Message Optimization
            Enabled</b></p><div class="tasksummary">
                <p>To deploy and test the web service, perform the
                following steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Right-click the project node
                    and select <span class="guimenuitem">Properties</span>, then
                    select <span class="guimenuitem">Run</span>.</strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Type
                    <code class="code">/CalculatorWSService?wsdl</code> in the
                    <span class="guilabel">Relative URL</span> field and click
                    <span class="guibutton">OK</span>.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Right-click the project node
                    and choose <span class="guimenuitem">Run</span>.
                    </strong></span></p><p>The IDE starts the web container, builds the
                    application, and displays the WSDL file page in your
                    browser.</p><p>The following WSIT tags related to message
                    optimization display in the WSDL file:</p><div class="example"><a name="d0e4323"></a><p class="title"><b>Example&nbsp;8.1.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;ns1:Policy wsu:Id="CalculatorWSPortBindingPolicy"/&gt;
  &lt;ns1:ExactlyOne&gt;
    &lt;ns1:All&gt;
      &lt;ns2:OptimizedMimeSerialization/&gt;
        &lt;ns3:RMAssertion/&gt;
          &lt;ns4:UsingAddressing ns1:Optional="true"/&gt;
    &lt;/ns1:All&gt;
  &lt;/ns1:ExactlyOne&gt;
&lt;/ns1:Policy&gt;</pre></div></div><br class="example-break"></li></ol></div></div></div><div class="section" title="8.4.&nbsp;Creating a Client to Consume a Message Optimization-enabled Web Service"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahicb"></a>8.4.&nbsp;Creating a Client to Consume a Message Optimization-enabled Web
        Service</h2></div></div></div><p>Now that you have built and tested a web service that uses the
        WSIT Message Optimization technology, you can create a client that
        accesses and consumes that web service. The client will use the web
        service's WSDL to create the functionality necessary to satisfy the
        interoperability requirements of the web service.</p><div class="task" title="To Create a Client to Consume a WSIT-enabled Web Service"><a name="gfrcw"></a><p class="title"><b>To Create a Client to Consume a WSIT-enabled Web
            Service</b></p><div class="tasksummary">
                <p>To create a client to access and consume the web
                service, perform the following steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Choose <span class="guimenu">File</span> &#8594; <span class="guimenuitem">New Project</span>, select <span class="guilabel">Java Web</span>
                    from the <span class="guilabel">Web category</span> and click
                    <span class="guibutton">Next</span>.</strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Name the project, for example,
                    CalculatorWSServletClient, and click
                    <span class="guibutton">Finish</span>.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Right-click the
                    <span class="guilabel">CalculatorWSServletClient</span> node and
                    select <span class="guimenu">New</span> &#8594; <span class="guimenuitem">Web Service Client</span>. </strong></span></p><p>The <span class="guilabel">New Web Service Client</span>
                    window displays.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>NetBeans submenus are dynamic, so the
                        <span class="guilabel">Web Service Client</span> option may not
                        appear. If you do not see the <span class="guilabel">Web Service
                        Client</span> option, select <span class="guisubmenu">New</span> &#8594; <span class="guisubmenu">File\Folder</span> &#8594; <span class="guisubmenu">Webservices</span> &#8594; <span class="guimenuitem">Web Service Client</span>.</p></div></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select the <span class="guilabel">WSDL
                    URL</span> option.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Cut and paste the URL of the
                    web service that you want the client to consume into the
                    <span class="guilabel">WSDL URL</span> field. </strong></span></p><p>For example, here is the URL for the
                    <code class="code">CalculatorWS</code> web service:</p><div class="example"><a name="d0e4426"></a><p class="title"><b>Example&nbsp;8.2.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">http://localhost:8080/CalculatorApplication/CalculatorWSService?wsdl</pre></div></div><br class="example-break"><p>When JAX-WS generates the web service, it appends
                    <code class="code">Service</code> to the class name by default.</p></li><li class="step" title="Step 6"><p><span class="bold"><strong>Type
                    <code class="code">org.me.calculator.client</code> in the
                    <span class="guilabel">Package</span> field, and click
                    <span class="guibutton">Finish</span>. </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Right-click the
                    <span class="guilabel">CalculatorWSServletClient</span> project
                    node and choose <span class="guisubmenu">New</span> &#8594; <span class="guimenuitem">Servlet</span>.</strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong>Name the servlet
                    <code class="code">ClientServlet</code>, specify the package name, for
                    example, <code class="code">org.me.calculator.client</code> and click
                    <span class="guibutton">Finish</span>.</strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong>To make the servlet the entry
                    point to your application, right-click the
                    <span class="guilabel">CalculatorWSServletClient</span> project
                    node, choose <span class="guimenuitem">Properties</span>, click
                    <span class="guilabel">Run</span>, type <code class="code">/ClientServlet</code>
                    in the <span class="guilabel">Relative URL</span> field, and click
                    <span class="guibutton">OK</span>.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong>If
                    <code class="code">ClientServlet.java</code> is not already open in the
                    <span class="guilabel">Source Editor</span>, open
                    it.</strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong>In the <span class="guilabel">Source
                    Editor</span>, remove the line that comments out the
                    body of the <code class="code">processRequest</code> method.
                    </strong></span></p><p>This is the start-comment line that starts the
                    section that comments out the code:</p><div class="example"><a name="d0e4517"></a><p class="title"><b>Example&nbsp;8.3.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">/* TODO output your page here</pre></div></div><br class="example-break"></li><li class="step" title="Step 12"><p><span class="bold"><strong>Delete the end-comment line
                    that ends the section of commented out code:</strong></span>
                    </p><div class="example"><a name="d0e4525"></a><p class="title"><b>Example&nbsp;8.4.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">*/</pre></div></div><p><br class="example-break"></p></li><li class="step" title="Step 13"><p><span class="bold"><strong>Add some empty lines after the
                    following line:</strong></span> </p><div class="example"><a name="d0e4533"></a><p class="title"><b>Example&nbsp;8.5.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">out.println("&lt;h1&gt;Servlet ClientServlet at " +
        request.getContextPath () + "&lt;/h1&gt;");</pre></div></div><p><br class="example-break"></p></li><li class="step" title="Step 14"><p><span class="bold"><strong>Right-click in one of the
                    empty lines that you added, then choose <span class="guisubmenu">Web Service Client
                            Resources</span> &#8594; <span class="guimenuitem">Call Web Service
                            Operation</span>. </strong></span></p><p>The <span class="guilabel">Select Operation to Invoke</span>
                    dialog box appears.</p></li><li class="step" title="Step 15"><p><span class="bold"><strong>Browse to the <span class="guilabel">Add
                    operation</span> and click <span class="guibutton">OK</span>.
                    </strong></span></p><p>The <code class="code">processRequest</code> method is as
                    follows, with bold indicating code added by the
                    IDE:</p><div class="example"><a name="d0e4566"></a><p class="title"><b>Example&nbsp;8.6.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">protected void processRequest(HttpServletRequest request, 
                              HttpServletResponse response) throws 
        ServletException, IOException {
    
    response.setContentType("text/html;charset=UTF-8");
    PrintWriter out = response.getWriter();
    out.println("&lt;html&gt;");
    out.println("&lt;head&gt;");
    out.println("&lt;title&gt;Servlet ClientServlet&lt;/title&gt;");
    out.println("&lt;/head&gt;");
    out.println("&lt;body&gt;");
    out.println("&lt;h1&gt;Servlet ClientServlet at " + request
            .getContextPath() + "&lt;/h1&gt;");
    try { // Call Web Service Operation
        org.me.calculator.client.CalculatorWS port = service
                .getCalculatorWSPort();
        // TODO initialize WS operation arguments here
        int i = 0;
        int j = 0;
        // TODO process result here
        int result = port.add(i, j);
        out.println("Result = " + result);
    } catch (Exception ex) {
        // TODO handle custom exceptions here
    }
    out.println("&lt;/body&gt;");
    out.println("&lt;/html&gt;");
    out.close();
}</pre></div></div><br class="example-break"></li><li class="step" title="Step 16"><p><span class="bold"><strong>Change the values for
                    <code class="code">int i</code> and <code class="code">int j</code> to other
                    numbers, such as 3 and 4.</strong></span></p></li><li class="step" title="Step 17"><p><span class="bold"><strong>Add a line that prints out an
                    exception, if an exception is thrown. </strong></span></p><p>The <code class="code">try/catch</code> block is as follows (new
                    and changed lines from this step and the previous step are
                    highlighted in bold text):</p><div class="example"><a name="d0e4588"></a><p class="title"><b>Example&nbsp;8.7.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">try { // Call Web Service Operation
    org.me.calculator.client.CalculatorWS port = service
            .getCalculatorWSPort();
    // TODO initialize WS operation arguments here
    int i = 3;
    int j = 4;
    // TODO process result here
    int result = port.add(i, j);
    out.println("&lt;p&gt;Result: " + result);
} catch (Exception ex) {
    out.println("&lt;p&gt;Exception: " + ex);
}</pre></div></div><br class="example-break"></li><li class="step" title="Step 18"><p><span class="bold"><strong>Save
                    <code class="code">ClientServlet.java</code>.</strong></span></p></li><li class="step" title="Step 19"><p><span class="bold"><strong>Right-click the project node
                    and choose <span class="guimenuitem">Run</span>.
                    </strong></span></p><p>The server starts (if it was not running already),
                    the application is built, deployed, and run. The browser
                    opens and displays the calculation result.</p></li></ol></div></div></div><div class="section" title="8.5.&nbsp;Message Optimization and Secure Conversation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahicc"></a>8.5.&nbsp;Message Optimization and Secure Conversation</h2></div></div></div><p>The Web Services Secure Conversation technology has message
        optimization benefits. While providing better message-level security
        it also improves the efficiency of multiple-message exchanges. It
        accomplishes this by providing basic mechanisms on top of which secure
        messaging semantics can be defined for multiple-message exchanges.
        This feature allows for contexts to be established so that potentially
        more efficient keys or new key material can be exchanged. The result
        is that the overall performance of subsequent message exchanges is
        improved.</p><p>For more information on how to use Secure Conversation, see
        <a class="xref" href="#ahici" title="Chapter&nbsp;12.&nbsp;Using WSIT Security"><i>Using WSIT Security</i></a>.</p></div></div><div lang="en" class="chapter" title="Chapter&nbsp;9.&nbsp;SOAP/TCP Web Service transport"><div class="titlepage"><div><div><h2 class="title"><a name="soaptcpa"></a>Chapter&nbsp;9.&nbsp;SOAP/TCP Web Service transport</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#soaptcpb">9.1. What is SOAP/TCP?</a></span></dt><dt><span class="section"><a href="#soaptcpc">9.2. Creating a SOAP/TCP enabled Web Service</a></span></dt><dt><span class="section"><a href="#soaptcpd">9.3. Configuring Web Service to be able to operate over SOAP/TCP
        transport</a></span></dt><dt><span class="section"><a href="#soaptcpe">9.4. Deploying and Testing a Web Service with SOAP/TCP Transport
        Enabled</a></span></dt><dt><span class="section"><a href="#soaptcpf">9.5. Creating a Client to Consume a SOAP/TCP-enabled Web
        Service</a></span></dt><dt><span class="section"><a href="#soaptcpg">9.6. Configuring Web Service client to operate over SOAP/TCP
        transport</a></span></dt></dl></div><div class="section" title="9.1.&nbsp;What is SOAP/TCP?"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soaptcpb"></a>9.1.&nbsp;What is SOAP/TCP?</h2></div></div></div><p>SOAP/TCP is TCP transport for Web Services. By default SOAP/TCP
        uses FastInfoset encoding in stateful mode, which lets SOAP/TCP to
        index XML elements optimal way, taking into account specifics of each
        concrete Web Service.</p></div><div class="section" title="9.2.&nbsp;Creating a SOAP/TCP enabled Web Service"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soaptcpc"></a>9.2.&nbsp;Creating a SOAP/TCP enabled Web Service</h2></div></div></div><p>For detailed instructions for how to use NetBeans IDE to create
        a web service, see <a class="xref" href="#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a>.</p></div><div class="section" title="9.3.&nbsp;Configuring Web Service to be able to operate over SOAP/TCP transport"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soaptcpd"></a>9.3.&nbsp;Configuring Web Service to be able to operate over SOAP/TCP
        transport</h2></div></div></div><p>To use the IDE to configure a web service transport, perform the
        following steps.</p><div class="task" title="To Configure SOAP/TCP transport in a Web Service"><p class="title"><b>To Configure SOAP/TCP transport in a Web Service</b></p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>In the IDE Projects window,
                    expand the <span class="guilabel">Web Services</span> node,
                    right-click the <span class="guilabel">CalculatorWSService</span>
                    node, and choose <span class="guimenuitem">Edit Web Service
                    Attributes</span>. </strong></span></p><p>The <span class="guilabel">Web Service Attributes</span>
                    editor appears.</p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select the <span class="guilabel">Allow TCP
                    Transport</span> check box, as shown in <a class="xref" href="#soaptcpsrvimg" title="Figure&nbsp;9.1.&nbsp;Enabling SOAP/TCP">Enabling SOAP/TCP</a>, and
                    click <span class="guibutton">OK</span>.</strong></span></p><p>This setting configures the web service to be able
                    to operate over SOAP/TCP transport additionally to the
                    default HTTP.</p><div class="figure"><a name="soaptcpsrvimg"></a><p class="title"><b>Figure&nbsp;9.1.&nbsp;Enabling SOAP/TCP</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/soaptcp-enable.png" height="360" alt="Enabling SOAP/TCP"></td></tr></table></div></div></div><br class="figure-break"></li></ol></div></div></div><div class="section" title="9.4.&nbsp;Deploying and Testing a Web Service with SOAP/TCP Transport Enabled"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soaptcpe"></a>9.4.&nbsp;Deploying and Testing a Web Service with SOAP/TCP Transport
        Enabled</h2></div></div></div><p>Now that you have configured the web service to be able to
        operate over SOAP/TCP, you can deploy and test it.</p><div class="task" title="To Deploy and Test a Web Service with SOAP/TCP Enabled"><p class="title"><b>To Deploy and Test a Web Service with SOAP/TCP
            Enabled</b></p><div class="tasksummary">
                <p>To deploy and test the web service, perform the
                following steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Right-click the project node
                    and select <span class="guimenuitem">Properties</span>, then
                    select <span class="guilabel">Run</span>.</strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Type
                    <code class="code">/CalculatorWSService?wsdl</code> in the
                    <span class="guilabel">Relative URL</span> field and click
                    <span class="guibutton">OK</span>. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Right-click the project node
                    and choose
                    <span class="guimenuitem">Run</span>.</strong></span></p><p>The IDE starts the web container, builds the
                    application, and displays the WSDL file page in your
                    browser.</p><p>The following WSIT tags related to SOAP/TCP display
                    in the WSDL file:</p><div class="example"><a name="d0e4737"></a><p class="title"><b>Example&nbsp;9.1.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;wsp:Policy wsu:Id="CalculatorWSPortBindingPolicy"&gt;
    &lt;wsp:ExactlyOne&gt;
        &lt;wsp:All&gt;
            &lt;ns2:OptimizedTCPTransport enabled="true"/&gt;
        &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
&lt;/wsp:Policy&gt;</pre></div></div><br class="example-break"></li></ol></div></div></div><div class="section" title="9.5.&nbsp;Creating a Client to Consume a SOAP/TCP-enabled Web Service"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soaptcpf"></a>9.5.&nbsp;Creating a Client to Consume a SOAP/TCP-enabled Web
        Service</h2></div></div></div><p>For detailed instructions for how to use NetBeans IDE to create
        a web service client, see <a class="xref" href="#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a>.</p></div><div class="section" title="9.6.&nbsp;Configuring Web Service client to operate over SOAP/TCP transport"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="soaptcpg"></a>9.6.&nbsp;Configuring Web Service client to operate over SOAP/TCP
        transport</h2></div></div></div><p>To use the IDE to configure a web service client transport,
        perform the following steps.</p><div class="task" title="To Configure SOAP/TCP transport in a Web Service client"><p class="title"><b>To Configure SOAP/TCP transport in a Web Service
            client</b></p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>In the IDE
                    <span class="guilabel">Projects</span> window, expand the
                    <span class="guilabel">Web Service References</span> node,
                    right-click the <span class="guilabel">CalculatorWSService</span>
                    node, and choose <span class="guilabel">Edit Web Service
                    Attributes</span>.</strong></span></p><p>The <span class="guilabel">Web Service Attributes</span>
                    editor appears.</p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select the
                    <span class="guilabel">Automatically Select Optimal Transport
                    (HTTP/TCP)</span> check box, as shown in <a class="xref" href="#soaptcpclntimg" title="Figure&nbsp;9.2.&nbsp;Enabling SOAP/TCP for a Web Service client">Enabling SOAP/TCP for a Web Service
                        client</a>, and
                    click <span class="guibutton">OK</span>. </strong></span></p><p>This setting configures the web service client to
                    choose SOAP/TCP transport as prefferable, when working
                    with a Web Service.</p><div class="figure"><a name="soaptcpclntimg"></a><p class="title"><b>Figure&nbsp;9.2.&nbsp;Enabling SOAP/TCP for a Web Service
                        client</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/soaptcp-client-enable.png" height="360" alt="Enabling SOAP/TCP for a Web Service client"></td></tr></table></div></div></div><br class="figure-break"><p>After checking the SOAP/TCP check box, new policy
                    assertions will be added to the Web Service client policy
                    configuration file. Open
                    <code class="code">CalculatorWSService.xml</code> file, which is
                    situated under the project's <code class="code">Source
                    Packages/META-INF</code> folder.</p><p>The following WSIT tags related to SOAP/TCP display
                    in the Web Service client configuration file:</p><div class="example"><a name="d0e4813"></a><p class="title"><b>Example&nbsp;9.2.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;wsp:Policy wsu:Id="CalculatorWSPortBindingPolicy"&gt;
    &lt;wsp:ExactlyOne&gt;
        &lt;wsp:All&gt;
            &lt;tcp:AutomaticallySelectOptimalTransport/&gt;
        &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
&lt;/wsp:Policy&gt;</pre></div></div><br class="example-break"></li></ol></div></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;10.&nbsp;Using Reliable Messaging"><div class="titlepage"><div><div><h2 class="title"><a name="using_rm"></a>Chapter&nbsp;10.&nbsp;Using Reliable Messaging</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#using_rm-config">10.1. Introduction to Reliable Messaging</a></span></dt><dt><span class="section"><a href="#using_rm-config_endpoint">10.2. Configuring Web Service Endpoint</a></span></dt><dt><span class="section"><a href="#using_rm-config_client">10.3. Configuring Web Service Client</a></span></dt><dt><span class="section"><a href="#advanced_rm_configuration">10.4. Configurable features summary</a></span></dt><dt><span class="section"><a href="#using_rm-creating_ws_and_client">10.5. Creating Web Service Providers and Clients that use Reliable
        Messaging</a></span></dt><dt><span class="section"><a href="#using_rm-with_sc">10.6. Using Secure Conversation With Reliable Messaging</a></span></dt><dt><span class="section"><a href="#using_rm-ha_support">10.7. High Availability Support in Reliable Messaging</a></span></dt></dl></div><div class="section" title="10.1.&nbsp;Introduction to Reliable Messaging"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using_rm-config"></a>10.1.&nbsp;Introduction to Reliable Messaging</h2></div></div></div><p>In the SOAP messaging world, presence of software, system or
        network failures is a common issue web service developers need to deal
        with. This issue is even more obvious in mobile applications which
        access the corporate network through mobile-enabled channels with
        limited connectivity and connection quality, such as WiFi, UMTS or
        GPRS.</p><p>WS-ReliableMessaging specification, an OASIS standard, addresses
        this issue by defining a modular mechanism for reliable transfer of
        messages. It defines a messaging protocol to identify, track, and
        manage the reliable transfer of messages between a source and a
        destination in an interoperable fashion. The modularity and the
        extension points defined in the mechanism allows integration of other
        quality of service features, such as message level security.</p><p>Metro implementation of reliable messaging is based o
        WS-ReliableMessaging. As other Quality of Service features, Reliable
        Messaging is configured via WS-Policy expressions stored in the WSDL
        document of a web service or in the web service's WSIT configuration
        file. These XML-based expressions are designed for machine processing
        rather than for human readability. Metro comes with a tooling support
        in the form of a plug-in for <a class="link" href="http://www.netbeans.org" target="_top">NetBeans IDE</a> which
        provides a convenient way to configure reliable messaging feature for
        your web services. It provides a dialog-based wizard that lets you
        fine-tune a few reliable messaging configuration properties. In
        general, the properties you configure on the web service endpoint
        apply to the web service client as well. On the other hand, the
        client-side configuration options have only local effect and let you
        tweak the client-specific behavior.</p><p>In the following sections we will look at enabling reliable
        messaging with Metro in more detail. These sections also contain
        tables that describe configuration options in more detail for service
        endpoint (<a class="xref" href="#using_rm-config_endpoint" title="10.2.&nbsp;Configuring Web Service Endpoint">Configuring Web Service Endpoint</a>) as well as service client (<a class="xref" href="#client_rm_config_options" title="Table&nbsp;10.2.&nbsp;Reliable Messaging Configuration Options for Service Client">Reliable Messaging Configuration Options for Service
            Client</a>)
        side.</p></div><div class="section" title="10.2.&nbsp;Configuring Web Service Endpoint"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using_rm-config_endpoint"></a>10.2.&nbsp;Configuring Web Service Endpoint</h2></div></div></div><p>When creating a reliable web service, you first start by
        creating a web service using common steps described in section <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a>.
        Once the web service is created, a design view of the web service
        should open in the editor window. If the design view is not opened,
        locate your web service in the <span class="guilabel">Projects</span><span class="bold"><strong></strong></span> view and double-click the web service to open
        it in the editor window.</p><p>In the design view, there is a <span class="guilabel">Quality of
        Service</span> section as show on the picture below: </p><div class="figure"><a name="f0.21865766008323695"></a><p class="title"><b>Figure&nbsp;10.1.&nbsp;Quality of Service (NetBeans)</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/nb6_5-qos-ws-design-view.png" height="360" alt="Quality of Service (NetBeans)"></td></tr></table></div></div></div><p><br class="figure-break"> In this section you may either simply check the
        <span class="guilabel">Reliable Message Delivery</span> checkbox and accept the
        Reliable Messaging configuration defaults, which means that your RM
        configuration for your web service is done, or you may click the
        <span class="guibutton">Advanced</span> button to display the
        <span class="guilabel">Quality of Service</span> dialog as shown on the picture
        below. </p><div class="figure"><a name="f0.19917454831806913"></a><p class="title"><b>Figure&nbsp;10.2.&nbsp;Quality of Service - Advanced (NetBeans)</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/nb6_5-qos-dialog-main.png" height="360" alt="Quality of Service - Advanced (NetBeans)"></td></tr></table></div></div></div><p><br class="figure-break"> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>You may alternatively access the <span class="guilabel">Quality of
                Service</span> dialog by right clicking on a web service
                in the <span class="guilabel">Projects</span> view and selecting
                <span class="guilabel">Edit Web Service Attributes</span> from the
                context pop-up menu.</p></div><p> The Quality of Service dialog contains more configuration
        options for Reliable Messaging. Some of these are accessible direclty
        while the most advance configuration details are hidden behind the
        <span class="guilabel">Advanced</span> button in a seprate dialog presented on
        the next picture. </p><div class="figure"><a name="f0.006706294753032083"></a><p class="title"><b>Figure&nbsp;10.3.&nbsp;Advanced Reliable Messaging Attributes
                (NetBeans)</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/nb6_5-qos-dialog-advanced-rm.png" height="360" alt="Advanced Reliable Messaging Attributes (NetBeans)"></td></tr></table></div></div></div><p><br class="figure-break"></p><p>In order to provide better overview of the RM configuration
        options, we included the following table that povides a detailed
        description of all the reliable messaging configuration options
        available on the service endpoint.</p><div class="table"><a name="endpoint_rm_config_options"></a><p class="title"><b>Table&nbsp;10.1.&nbsp;Reliable Messaging Configuration Options for Service
            Endpoint</b></p><div class="table-contents"><table summary="Reliable Messaging Configuration Options for Service&#xA;            Endpoint" border="1"><colgroup><col><col></colgroup><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody><tr><td>Reliable&nbsp;Message&nbsp;Delivery</td><td>Enables or disables reliable messaging
                        feature.</td></tr><tr><td>Deliver&nbsp;Messages&nbsp;In&nbsp;Exact&nbsp;Order</td><td><p>Specifies whether the Reliable Messaging
                        protocol ensures that the application messages for a
                        given message sequence are delivered to the endpoint
                        application in the order indicated by the message
                        numbers.</p><p>This option increases the time to
                        process application message sequences and may result
                        in the degradation of web service performance.
                        Therefore, you should not enable this option unless
                        ordered delivery is required by the web
                        service.</p></td></tr><tr><td>Message&nbsp;Delivery&nbsp;Assurance</td><td>This option tells our Reliable Messaging
                        implementation what type of the message delivery
                        assurance is expected. Currently it can be set to
                        "Exactly Once" and "At Least Once". <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong>Exactly Once</strong></span>
                                    delivery assurance, as the name suggests, guarantees
                                    that each message request from the web service
                                    client will be delivered to the web service endpoint
                                    once and only once. By default, this delivery
                                    assurance strategy is applied.</p></li><li class="listitem"><p><span class="bold"><strong>At Least Once</strong></span>
                                    delivery assurance guarantees that each message
                                    request from the web service client will be
                                    delivered to the web service endpoint, however it is
                                    possible that duplicate messages may be delivered
                                    under some circumstances. In general, this type of
                                    delivery assurance may provide better
                                    performance.</p></li></ul></div></td></tr><tr><td>Flow&nbsp;Control</td><td>Enables or disables the flow control feature.
                        When enabled, this feature works in conjunction with
                        the Max Buffer Size setting to determine the maximum
                        number of messages for sequence that can be stored at
                        the endpoint awaiting delivery to the application.
                        Messages may have to be withheld from the application
                        if ordered delivery is required and some of their
                        predecessors have not arrived. If the number of stored
                        messages reaches the threshold specified in the Max
                        Buffer Size setting, incoming messages belonging to
                        the sequence are ignored.</td></tr><tr><td>Maximum&nbsp;Flow&nbsp;Control&nbsp;Buffer&nbsp;Size</td><td>If Flow control is enabled, this value
                        specifies the number of request messages that will be
                        buffered in the RM session. The default setting is 32.
                        For more information, see the description of the Flow
                        Control option.</td></tr><tr><td>Inactivity&nbsp;Timeout</td><td><p>Specifies the time interval beyond which
                        either source or destination may terminate the RM
                        session due to inactivity. The default setting is
                        600,000&nbsp;milliseconds (10&nbsp;minutes). A web service
                        endpoint will always terminate session whose
                        inactivity timeout has expired.</p><p>This
                        option may be used to ensure the early removal of
                        stale RM sequences and thus reduce the memory
                        footprint of the service endpoint. Note that setting
                        the value of this option affects also the web service
                        proxy usage patterns in the client
                        applications.</p></td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" title="10.3.&nbsp;Configuring Web Service Client"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using_rm-config_client"></a>10.3.&nbsp;Configuring Web Service Client</h2></div></div></div><p>While most of the Reliable Messaging options are configured on
        the web service endpoint, there are some details that may be
        fine-tuned on the client side as well. To configure the client-side
        details of Reliable Messaging you first need to create a web service
        proxy. Section <a class="xref" href="#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> describes all the necessary steps.</p><p>Once a web service proxy is created, you can find it in the
        <span class="guilabel">Projects</span> view under <span class="guilabel">Web Service
        References</span> item. By right-clicking on the we service proxy
        and selecting <span class="guilabel">Edit Web Service Attributes</span> from
        the opened context pop-up menu you may open a dialog that let's you
        specify additional RM details.</p><p>When dialog opens, it may have multiple tabs. The Reliable
        messaging configuration options are located on the <span class="guilabel">Quality
        of Service</span> tab in <span class="guilabel">Advanced
        Configuration</span> section. Following table describes all the
        reliable messaging configuration options available on the web service
        client side.</p><div class="table"><a name="client_rm_config_options"></a><p class="title"><b>Table&nbsp;10.2.&nbsp;Reliable Messaging Configuration Options for Service
            Client</b></p><div class="table-contents"><table summary="Reliable Messaging Configuration Options for Service&#xA;            Client" border="1"><colgroup><col><col></colgroup><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody><tr><td>RM&nbsp;Resend&nbsp;Interval</td><td>The time in milliseconds after which the sender
                        (RMSource) attempts to redeliver unacknowledged
                        messages to the Reliable Messaging Destination
                        (RM-enabled WS endpoint). By default, resend happen
                        every 2000ms.</td></tr><tr><td>RM&nbsp;Close&nbsp;Timeout</td><td>By default, the call to proxy.close() will not
                        return until all messages have been acknowledged. RM
                        close timeout is the interval (in milliseconds) that
                        the client runtime will block waiting for a call to
                        close() to return. If there are still unacknowledged
                        messages after this interval is reached, and the call
                        to close has returned, an error will be logged about
                        messages being lost.</td></tr><tr><td>RM&nbsp;Ack&nbsp;Request&nbsp;Interval</td><td>The suggested minimum time that the sender
                        (RMSource) should allow to elapse between sending
                        consecutive Acknowledgement request messages to the
                        Reliable Messaging Destination (RM-enabled WS
                        endpoint).</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" title="10.4.&nbsp;Configurable features summary"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced_rm_configuration"></a>10.4.&nbsp;Configurable features summary</h2></div></div></div><p>In the previous chapter we focused on configuring Metro reliable
        messaging using <a class="link" href="http://www.netbeans.org" target="_top">NetBeans
        IDE</a>. This section is a summary of all Metro reliable messaging
        runtime features that can be configured since Metro v2.0 and higher.
        The summary lists all the features discussed before as well as all
        other features that can be only configured by manually editing the
        WSIT config file.</p><p>Please note that this chapter focuses on features configurable
        with Metro v2.0 and higher.</p><div class="table"><a name="rm_assertion_namespaces"></a><p class="title"><b>Table&nbsp;10.3.&nbsp;Namespaces used within Metro Reliable Messaging WS-Policy
            Assertions</b></p><div class="table-contents"><table summary="Namespaces used within Metro Reliable Messaging WS-Policy&#xA;            Assertions" border="1"><colgroup><col><col></colgroup><thead><tr><th>Prefix</th><th>Namespace</th></tr></thead><tbody><tr><td>wsp</td><td>http://www.w3.org/ns/ws-policy</td></tr><tr><td>wsrmp10</td><td>http://schemas.xmlsoap.org/ws/2005/02/rm/policy</td></tr><tr><td>wsrmp</td><td>http://docs.oasis-open.org/ws-rx/wsrmp/200702</td></tr><tr><td>net30rmp</td><td>http://schemas.microsoft.com/net/2005/02/rm/policy</td></tr><tr><td>net35rmp</td><td>http://schemas.microsoft.com/ws-rx/wsrmp/200702</td></tr><tr><td>sunrmp</td><td>http://sun.com/2006/03/rm</td></tr><tr><td>sunrmcp</td><td>http://sun.com/2006/03/rm/client</td></tr><tr><td>metro</td><td>http://java.sun.com/xml/ns/metro/ws-rx/wsrmp/200702</td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="rm_feature_summary"></a><p class="title"><b>Table&nbsp;10.4.&nbsp;Reliable Messaging Configuration Features - Layout</b></p><div class="table-contents"><table summary="Reliable Messaging Configuration Features - Layout" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center"><span class="bold"><strong>Feature
                        name</strong></span></td></tr><tr><td align="center"><span class="bold"><strong>Description</strong></span></td></tr><tr><td align="center"><span class="bold"><strong>WS-RM 1.0 compatible
                        assertion</strong></span></td></tr><tr><td align="center"><span class="bold"><strong>WS-RM 1.1+ compatible
                        assertion</strong></span></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5099"></a><p class="title"><b>Table&nbsp;10.5.&nbsp;Enable Reliable Messaging + version</b></p><div class="table-contents"><table summary="Enable Reliable Messaging + version" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">Enable Reliable Messaging + version</td></tr><tr><td align="center">Specifies that WS-ReliableMessaging protocol
                        MUST be used when sending messages. Defines also the
                        version of the WS-RM protocol to be used.</td></tr><tr><td align="center"><code class="code">/wsrmp10:RMAssertion</code></td></tr><tr><td align="center"><code class="code">/wsrmp:RMAssertion</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5119"></a><p class="title"><b>Table&nbsp;10.6.&nbsp;Sequence Inactivity Timeout</b></p><div class="table-contents"><table summary="Sequence Inactivity Timeout" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">Sequence Inactivity Timeout</td></tr><tr><td align="center">Specifies the time interval beyond which either
                        RM Source or RM Destination may terminate the RM
                        sequence due to inactivity. The default setting is
                        600,000 milliseconds (10 minutes). A web service
                        endpoint will always terminate session whose
                        inactivity timeout has expired. Specified in
                        milliseconds.</td></tr><tr><td align="center"><code class="code">/wsrmp10:RMAssertion/wsrmp10:InactivityTimeout</code></td></tr><tr><td align="center"><code class="code">/net35rmp:InactivityTimeout</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5139"></a><p class="title"><b>Table&nbsp;10.7.&nbsp;Acknowledgement interval</b></p><div class="table-contents"><table summary="Acknowledgement interval" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">Acknowledgement interval</td></tr><tr><td align="center">Specifies the duration after which the RM
                        Destination will transmit an acknowledgement. If
                        omitted, there is no implied value. Specified in
                        milliseconds.</td></tr><tr><td align="center"><code class="code">/wsrmp10:RMAssertion/wsrmp10:AcknowledgementInterval</code></td></tr><tr><td align="center"><code class="code">/net35rmp:AcknowledgementInterval</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5159"></a><p class="title"><b>Table&nbsp;10.8.&nbsp;Retransmission Interval</b></p><div class="table-contents"><table summary="Retransmission Interval" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">Retransmission Interval</td></tr><tr><td align="center">Specifies how long the RM Source will wait
                        after transmitting a message and before retransmitting
                        the message. If omitted, there is no implied value.
                        Specified in milliseconds.</td></tr><tr><td align="center"><code class="code">/wsrmp10:RMAssertion/wsrmp10:BaseRetransmissionInterval</code><code class="code">/sunrmcp:ResendInterval</code></td></tr><tr><td align="center"><code class="code">/metro:RetransmissionConfig/metro:Interval</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5181"></a><p class="title"><b>Table&nbsp;10.9.&nbsp;Retransmission Interval Adjustment Algorithm</b></p><div class="table-contents"><table summary="Retransmission Interval Adjustment Algorithm" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">Retransmission Interval Adjustment
                        Algorithm</td></tr><tr><td align="center">Specifies that the retransmission interval will
                        be adjusted using a specific (e.g. exponential
                        back-off) algorithm.</td></tr><tr><td align="center"><p><code class="code">/wsrmp10:RMAssertion/wsrmp10:ExponentialBackoff</code></p><p>("Exponential
                        backoff" algorithm only)</p></td></tr><tr><td align="center"><code class="code">/metro:RetransmissionConfig/metro:Algorithm</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5204"></a><p class="title"><b>Table&nbsp;10.10.&nbsp;Maximum Retransmission Count</b></p><div class="table-contents"><table summary="Maximum Retransmission Count" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">Maximum Retransmission Count</td></tr><tr><td align="center"><p>A message is considered to be transferred
                        if its delivery at the recipient has been acknowledged
                        by the recipient.</p><p>If an acknowledgment has
                        not been received within a certain amount of time for
                        a message that has been transmitted, the
                        infrastructure automatically retransmits the message.
                        The infrastructure tries to send the message for at
                        most a preconfigured number of times. Not receiving an
                        acknowledgment before this limit is reached is
                        considered a fatal communication failure, and causes
                        the RM session to fail.</p></td></tr><tr><td align="center">N/A</td></tr><tr><td align="center"><code class="code">/metro:RetransmissionConfig/metro:MaxRetries</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5226"></a><p class="title"><b>Table&nbsp;10.11.&nbsp;Close sequence timeout</b></p><div class="table-contents"><table summary="Close sequence timeout" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">Close sequence timeout</td></tr><tr><td align="center">By default, the call to proxy.close() will not
                        return until all messages have been acknowledged. RM
                        close timeout is the interval (in milliseconds) that
                        the client runtime will block waiting for a call to
                        close() to return. If there are still unacknowledged
                        messages after this interval is reached, and the call
                        to close has returned, an error will be logged about
                        messages being lost.</td></tr><tr><td align="center"><p><code class="code">/sunrmcp:CloseTimeout</code></p><p>(client
                        side only)</p></td></tr><tr><td align="center"><code class="code">/metro:CloseSequenceTimeout</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5249"></a><p class="title"><b>Table&nbsp;10.12.&nbsp;Acknowledgement request interval</b></p><div class="table-contents"><table summary="Acknowledgement request interval" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">Acknowledgement request interval</td></tr><tr><td align="center">Defines the suggested minimum time that the
                        sender (RM Source) should allow to elapse between
                        sending consecutive Acknowledgement request messages
                        to the RM Destination.</td></tr><tr><td align="center"><code class="code">/sunrmcp:AckRequestInterval</code></td></tr><tr><td align="center"><code class="code">/metro:AckRequestInterval</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5269"></a><p class="title"><b>Table&nbsp;10.13.&nbsp;Bind RM sequence to security token</b></p><div class="table-contents"><table summary="Bind RM sequence to security token" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">Bind RM sequence to security token</td></tr><tr><td align="center">Defines the requirement that an RM Sequence
                        MUST be bound to an explicit token that is referenced
                        from a wsse:SecurityTokenReference in the
                        CreateSequence message.</td></tr><tr><td align="center">N/A</td></tr><tr><td align="center"><code class="code">/wsrmp:RMAssertion/wsp:Policy/wsrmp:SequenceSTR</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5288"></a><p class="title"><b>Table&nbsp;10.14.&nbsp;Bind RM sequence to secured transport</b></p><div class="table-contents"><table summary="Bind RM sequence to secured transport" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">Bind RM sequence to secured transport</td></tr><tr><td align="center">Defines the requirement that an RM Sequence
                        MUST be bound to the session(s) of the underlying
                        transport-level protocol used to carry the
                        CreateSequence and CreateSequenceResponse message.
                        (When present, this assertion MUST be used in
                        conjunction with the sp:TransportBinding
                        assertion.)</td></tr><tr><td align="center">N/A</td></tr><tr><td align="center"><code class="code">/wsrmp:RMAssertion/wsp:Policy/wsrmp:SequenceTransportSecurity</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5307"></a><p class="title"><b>Table&nbsp;10.15.&nbsp;Exactly once delivery</b></p><div class="table-contents"><table summary="Exactly once delivery" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">Exactly once delivery</td></tr><tr><td align="center">Each message is to be delivered exactly once;
                        if a message cannot be delivered then an error MUST be
                        raised by the RM Source and/or RM Destination. The
                        requirement on an RM Source is that it SHOULD retry
                        transmission of every message sent by the Application
                        Source until it receives an acknowledgement from the
                        RM Destination. The requirement on the RM Destination
                        is that it SHOULD retry the transfer to the
                        Application Destination of any message that it accepts
                        from the RM Source until that message has been
                        successfully delivered, and that it MUST NOT deliver a
                        duplicate of a message that has already been
                        delivered.</td></tr><tr><td align="center">default</td></tr><tr><td align="center"><code class="code">/wsrmp:RMAssertion/wsp:Policy/wsrmp:DeliveryAssurance/wsp:Policy/wsrmp:ExactlyOnce</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5326"></a><p class="title"><b>Table&nbsp;10.16.&nbsp;At Most once delivery</b></p><div class="table-contents"><table summary="At Most once delivery" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">At Most once delivery</td></tr><tr><td align="center">Each message is to be delivered at most once.
                        The RM Source MAY retry transmission of unacknowledged
                        messages, but is NOT REQUIRED to do so. The
                        requirement on the RM Destination is that it MUST
                        filter out duplicate messages, i.e. that it MUST NOT
                        deliver a duplicate of a message that has already been
                        delivered.</td></tr><tr><td align="center">N/A</td></tr><tr><td align="center"><code class="code">/wsrmp:RMAssertion/wsp:Policy/wsrmp:DeliveryAssurance/wsp:Policy/wsrmp:AtMostOnce</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5345"></a><p class="title"><b>Table&nbsp;10.17.&nbsp;At Least once delivery</b></p><div class="table-contents"><table summary="At Least once delivery" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">At Least once delivery</td></tr><tr><td align="center">Each message is to be delivered at least once,
                        or else an error MUST be raised by the RM Source
                        and/or RM Destination. The requirement on an RM Source
                        is that it SHOULD retry transmission of every message
                        sent by the Application Source until it receives an
                        acknowledgement from the RM Destination. The
                        requirement on the RM Destination is that it SHOULD
                        retry the transfer to the Application Destination of
                        any message that it accepts from the RM Source, until
                        that message has been successfully delivered. There is
                        no requirement for the RM Destination to apply
                        duplicate message filtering.</td></tr><tr><td align="center"><code class="code">/sunrmcp:AllowDuplicates</code></td></tr><tr><td align="center"><code class="code">/wsrmp:RMAssertion/wsp:Policy/wsrmp:DeliveryAssurance/wsp:Policy/wsrmp:AtLeastOnce</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5365"></a><p class="title"><b>Table&nbsp;10.18.&nbsp;InOrder delivery</b></p><div class="table-contents"><table summary="InOrder delivery" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">InOrder delivery</td></tr><tr><td align="center">Messages from each individual Sequence are to
                        be delivered in the same order they have been sent by
                        the Application Source. The requirement on an RM
                        Source is that it MUST ensure that the ordinal
                        position of each message in the Sequence (as indicated
                        by a message Sequence number) is consistent with the
                        order in which the messages have been sent from the
                        Application Source. The requirement on the RM
                        Destination is that it MUST deliver received messages
                        for each Sequence in the order indicated by the
                        message numbering. This DeliveryAssurance can be used
                        in combination with any of the AtLeastOnce, AtMostOnce
                        or ExactlyOnce assertions, and the requirements of
                        those assertions MUST also be met. In particular if
                        the AtLeastOnce or ExactlyOnce assertion applies and
                        the RM Destination detects a gap in the Sequence then
                        the RM Destination MUST NOT deliver any subsequent
                        messages from that Sequence until the missing messages
                        are received or until the Sequence is closed.</td></tr><tr><td align="center"><code class="code">/sunrmp:Ordered</code></td></tr><tr><td align="center"><code class="code">/wsrmp:RMAssertion/wsp:Policy/wsrmp:DeliveryAssurance/wsp:Policy/wsrmp:InOrder</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5385"></a><p class="title"><b>Table&nbsp;10.19.&nbsp;Flow Control</b></p><div class="table-contents"><table summary="Flow Control" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">Flow Control</td></tr><tr><td align="center">Enables or disables the flow control feature.
                        When enabled, this feature works in conjunction with
                        the Max Buffer Size setting to determine the maximum
                        number of messages for sequence that can be stored at
                        the endpoint awaiting delivery to the application.
                        Messages may have to be withheld from the application
                        if ordered delivery is required and some of their
                        predecessors have not arrived. If the number of stored
                        messages reaches the threshold specified in the Max
                        Buffer Size setting, incoming messages belonging to
                        the sequence are ignored.</td></tr><tr><td align="center"><code class="code">/net30rmp:RmFlowControl</code></td></tr><tr><td align="center"><code class="code">/net30rmp:RmFlowControl</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5405"></a><p class="title"><b>Table&nbsp;10.20.&nbsp;Maximum Flow Control Buffer Size</b></p><div class="table-contents"><table summary="Maximum Flow Control Buffer Size" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">Maximum Flow Control Buffer Size</td></tr><tr><td align="center">If Flow control is enabled, this value
                        specifies the number of request messages that will be
                        buffered in the RM session. The default setting is 32.
                        For more information, see the description of the Flow
                        Control option.</td></tr><tr><td align="center"><code class="code">/net30rmp:RmFlowControl/net30rmp:MaxReceiveBufferSize</code></td></tr><tr><td align="center"><code class="code">/net30rmp:RmFlowControl/net30rmp:MaxReceiveBufferSize</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5425"></a><p class="title"><b>Table&nbsp;10.21.&nbsp;Maximum concurrent RM sessions</b></p><div class="table-contents"><table summary="Maximum concurrent RM sessions" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">Maximum concurrent RM sessions</td></tr><tr><td align="center">Specifies how many concurrently active RM
                        sessions (measured based on inbound RM sequences) the
                        SequenceManager dedicated to the WS Endpoint accepts
                        before starting to refuse new requests for sequence
                        creation.</td></tr><tr><td align="center">N/A</td></tr><tr><td align="center"><code class="code">/metro:MaxConcurrentSessions</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5444"></a><p class="title"><b>Table&nbsp;10.22.&nbsp;Reliable Messaging Persistence</b></p><div class="table-contents"><table summary="Reliable Messaging Persistence" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">Reliable Messaging Persistence</td></tr><tr><td align="center">Specifies whether the runtime should use
                        persistent sequence and message storage or
                        not.</td></tr><tr><td align="center">N/A</td></tr><tr><td align="center"><code class="code">/metro:Persistent</code></td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e5463"></a><p class="title"><b>Table&nbsp;10.23.&nbsp;Sequence manager maintenace task execution period</b></p><div class="table-contents"><table summary="Sequence manager maintenace task execution period" border="1"><colgroup><col align="center"></colgroup><tbody><tr><td align="center">Sequence manager maintenace task execution
                        period</td></tr><tr><td align="center">Specifies the period (in milliseconds) of a
                        sequence maintenance task execution. Sequence
                        maintenance task takes care of terminating inactive
                        sequences and removing the terminated sequences from
                        the sequence repository.</td></tr><tr><td align="center">N/A</td></tr><tr><td align="center"><code class="code">/metro:MaintenanceTaskPeriod</code></td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" title="10.5.&nbsp;Creating Web Service Providers and Clients that use Reliable Messaging"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using_rm-creating_ws_and_client"></a>10.5.&nbsp;Creating Web Service Providers and Clients that use Reliable
        Messaging</h2></div></div></div><p>Examples and detailed instructions on how to create web service
        providers and clients that use reliable messaging are provided in the
        following chapters: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>For an example of creating a web service and a
                    client using a web container and NetBeans IDE, see <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a>.</p></li><li class="listitem"><p>For an example of creating a web service and a
                    client using only a web container, see <a class="xref" href="#ahifl" title="Chapter&nbsp;14.&nbsp;WSIT Example Using a Web Container Without NetBeans IDE"><i>WSIT Example Using a Web Container Without NetBeans IDE</i></a>.</p></li></ul></div></div><div class="section" title="10.6.&nbsp;Using Secure Conversation With Reliable Messaging"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using_rm-with_sc"></a>10.6.&nbsp;Using Secure Conversation With Reliable Messaging</h2></div></div></div><p>If Secure Conversation is enabled for the web service endpoint,
        the web service acquires a Security Context Token (SCT) for each
        application message sequence, that is, each message sequence is
        assigned a different SCT. The web service then uses that token to sign
        all messages exchanged for that message sequence between the source
        and destination for the life of the sequence. Hence, there are two
        benefits in using Secure Conversation with Reliable Messaging:
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The sequence messages are secure while in transit
                    between the source and destination endpoints.</p></li><li class="listitem"><p>If there are different users accessing data at the
                    source and destination endpoints, the SCT prevents users
                    from seeing someone else's data. </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Secure Conversation is a WS-Security option,
                            not a reliable messaging option. If Secure
                            Conversation is enabled on the web service endpoint,
                            Reliable Messaging uses Security Context
                            Tokens.</p></div></li></ul></div><p> For more information on how to use Secure
        Conversation, see <a class="xref" href="#ahici" title="Chapter&nbsp;12.&nbsp;Using WSIT Security"><i>Using WSIT Security</i></a>.</p></div><div class="section" title="10.7.&nbsp;High Availability Support in Reliable Messaging"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using_rm-ha_support"></a>10.7.&nbsp;High Availability Support in Reliable Messaging</h2></div></div></div><p>Starting with the <a class="link" href="http://metro.java.net/2.1/" target="_top">Metro 2.1 release</a> Metro
        implementation of reliable messaging supports deployment in clustered
        environment configurations of the <a class="link" href="http://glassfish.java.net" target="_top">GlassFish</a> Application
        Server 3.1 and higher. The only untested and thus currently officially
        unsupported reliable messaging feature in an HA environment is
        in-order message delivery. For more details see <a class="link" href="http://wsit.java.net/status-notes/status-notes-2-1-FCS.html#rm" target="_top">RM
        section of the WSIT 2.1 Release Notes</a>.</p><p>For a general overview of Metro High Availability support,
        please consult <a class="xref" href="#using_metro-ha_support" title="2.14.&nbsp;High Availability Support in Metro">High Availability Support in Metro</a> section.</p></div></div><div lang="en" class="chapter" title="Chapter&nbsp;11.&nbsp;WS-MakeConnection support"><div class="titlepage"><div><div><h2 class="title"><a name="using-mc"></a>Chapter&nbsp;11.&nbsp;WS-MakeConnection support</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#using-mc-introduction">11.1. Introduction to WS-MakeConnection</a></span></dt><dt><span class="section"><a href="#using-mc-config_endpoint">11.2. Configuring Web Service Endpoint</a></span></dt><dd><dl><dt><span class="section"><a href="#using-mc-config_endpoint-wspolicy">11.2.1. Configuration via an WS-Policy expression</a></span></dt><dt><span class="section"><a href="#using-mc-config_endpoint-annotation">11.2.2. Configuration via a Java annotation</a></span></dt></dl></dd><dt><span class="section"><a href="#using-mc-config-client">11.3. Configuring Web Service Client</a></span></dt></dl></div><div class="section" title="11.1.&nbsp;Introduction to WS-MakeConnection"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using-mc-introduction"></a>11.1.&nbsp;Introduction to WS-MakeConnection</h2></div></div></div><p>The <a class="link" href="http://docs.oasis-open.org/ws-rx/wsmc/v1.1/wsmc.html" target="_top">WS-MakeConnection</a>
        specification defines a protocol that allows messages to be
        transferred between WS-MakeConnection-aware nodes by using a
        transport-specific back-channel. The protocol itself is described in a
        transport-independent manner. This allows it to be implemented using
        different network technologies. To support interoperable Web services,
        a SOAP binding is defined within WS-MakeConnection
        specification.</p><p>The WS-MakeConnection mechanism for the transfer of messages
        between two endpoints is useful in situations when the sending
        endpoint is unable to initiate a new connection to the receiving
        endpoint. Such situation may typically occur when a connection from a
        non-adressable client is broken before a response to client's request
        has been delivered. Rather than discarding the old response, replaying
        the whole request/response message exchange and generating a new
        response, which may be computationally or otherwise resource
        intensive, WS-MakeConnection provides a way how to uniquely identify
        non-addressable endpoints, and a mechanism by which undelivered
        messages destined for those endpoints can be delivered.</p><p>As all of the WS-* technologies, WS-MakeConnection mechanism is
        extensible allowing additional functionality, such as security, to be
        tightly integrated. WS-MakeConnection specification integrates with
        and complements the WS-ReliableMessaging, WS-Security, WS-Policy, and
        other Web services specifications.</p></div><div class="section" title="11.2.&nbsp;Configuring Web Service Endpoint"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using-mc-config_endpoint"></a>11.2.&nbsp;Configuring Web Service Endpoint</h2></div></div></div><div class="section" title="11.2.1.&nbsp;Configuration via an WS-Policy expression"><div class="titlepage"><div><div><h3 class="title"><a name="using-mc-config_endpoint-wspolicy"></a>11.2.1.&nbsp;Configuration via an WS-Policy expression</h3></div></div></div><p>As all other WS-* features, WS-MakeConnection can be enabled
            using a WS-Policy assertion. Unfortunately, unlike many other WS-*
            features, <a class="link" href="http://netbeans.org/" target="_top">NetBeans
            IDE</a> in it's current version 6.8 don't provide a nice
            GUI-based support for enabling/disabling WS-MakeConnection feature
            on an endpoint. This means that in order to enable
            WS-MakeConnection, you need to manually put the assertion into
            your endpoint's WSIT config file. Here are the steps:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Open the existing WSIT config file for the endpoint.
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>If no config file has been created for the
                                endpoint yet, you can create an empty one with a
                                little help from NetBeans IDE by selecting and
                                unselecting any feature in the QoS dialog or the
                                "Design" tab of the web service endpoint.</p></li></ul></div></li><li class="listitem"><p>Add the WS-MakeConnection assertion namespace
                    definition into the root XML element of the WSIT config
                    file: </p><div class="example"><a name="d0e5572"></a><p class="title"><b>Example&nbsp;11.1.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">xmlns:wsmc="http://docs.oasis-open.org/ws-rx/wsmc/200702"</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>Create new WS-Policy expression in the config file:
                    </p><div class="example"><a name="d0e5578"></a><p class="title"><b>Example&nbsp;11.2.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;wsp:Policy wsu:Id="McTestEchoPortBindingPolicy"&gt;
    &lt;wsp:ExactlyOne&gt;
        &lt;wsp:All&gt;
            &lt;wsam:Addressing wsp:Optional="false"/&gt;
            &lt;wsmc:MCSupported /&gt;
        &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
&lt;/wsp:Policy&gt;</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>Attach newly created WS-Policy expression to the
                    endpoint binding using WS-Policy reference: </p><div class="example"><a name="d0e5584"></a><p class="title"><b>Example&nbsp;11.3.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;binding name="McTestEchoPortBinding" type="tns:McTestEcho"&gt;
    &lt;wsp:PolicyReference URI="#McTestEchoPortBindingPolicy"/&gt;

    ...

&lt;/binding&gt;</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>Build and run the service. Service will now have
                    WS-MakeConnection support enabled.</p></li></ol></div></div><div class="section" title="11.2.2.&nbsp;Configuration via a Java annotation"><div class="titlepage"><div><div><h3 class="title"><a name="using-mc-config_endpoint-annotation"></a>11.2.2.&nbsp;Configuration via a Java annotation</h3></div></div></div><p>In addition to using WS-Policy expression as discussed in
            <a class="xref" href="#using-mc-config_endpoint-wspolicy" title="11.2.1.&nbsp;Configuration via an WS-Policy expression">Configuration via an WS-Policy expression</a>, you may as well configure
            WS-MakeConnection support using a
            <code class="code">@MakeConnectionSupported</code> Java annotation provided by
            Metro. Please note, that this annotation is meant to annotate
            whole classes only. The resulting Java code for a sample web
            service would look like this:</p><div class="example"><a name="d0e5600"></a><p class="title"><b>Example&nbsp;11.4.&nbsp;Example of WS-MakeConnection enabled service class
                using @MakeConnectionSupported Java annotation</b></p><div class="example-contents"><pre class="programlisting">package com.sun.metro.mc.service;

import com.sun.xml.ws.rx.mc.MakeConnectionSupported;
import javax.jws.WebMethod;
import javax.jws.WebParam;
import javax.jws.WebService;

@WebService()
@MakeConnectionSupported
public class McTestEcho {

    /**
     * Web service operation
     */
    @WebMethod(operationName = "echo")
    public String echo(@WebParam(name = "message")
    final String message) {
        return "Received: " + message;
    }

}</pre></div></div><br class="example-break"></div></div><div class="section" title="11.3.&nbsp;Configuring Web Service Client"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using-mc-config-client"></a>11.3.&nbsp;Configuring Web Service Client</h2></div></div></div><p>Once the WS endpoint is properly configured in Metro to support
        WS-MakeConnection protocol messages, it advertises this ability in
        it's WSDL descriptor. In case you are developing a client for such an
        endpoint (which advertises WS-MakeConnection support in its WSDL), all
        the necessary configuration happens autmatically and you don't need to
        take any additional steps to enable WS-MakeConnection support on the
        client side.</p><p>There are however other web service frameworks that sometimes
        fail to advertise their advanced capabilities. In case of such an
        endpoint, which doesn't have the <code class="code">&lt;wsmc:MCSupported
        /&gt;</code> assertion specified in its WSDL descriptor but you know
        that it DOES support WS-MakeConnection, you can use the JAX-WS's WS
        Feature mechanism to explicitly enable WS-MakeConnection support on
        your client proxy by passing a
        <code class="code">com.sun.xml.ws.rx.mc.MakeConnectionSupportedFeature</code>
        instance as a parameter into a port getter method:</p><div class="example"><a name="d0e5618"></a><p class="title"><b>Example&nbsp;11.5.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">McTestEcho port = null;
try {
    McTestEchoService service = new McTestEchoService();
    port = service.getMcTestEchoPort(
        new com.sun.xml.ws.rx.mc.MakeConnectionSupportedFeature());

    String message = "Test";

    String result = port.echo(message);

    System.out.println("Result = "+result);
} catch (Exception ex) {
    ex.printStackTrace();
} finally {
    if (port != null) {
        try {
            ((java.io.Closeable) port).close();
        } catch (java.io.IOException ex) {
            ex.printStackTrace();
        }
    }
}</pre></div></div><br class="example-break"><p>Please note once again that passing the
        <code class="code">com.sun.xml.ws.rx.mc.MakeConnectionSupportedFeature</code>
        explicitly is required ONLY if the endpoint fails to advertise its
        support for WS-MakeConnection feature via the
        <code class="code">&lt;wsmc:MCSupported /&gt;</code> WS-Policy assertion.</p></div></div><div lang="en" class="chapter" title="Chapter&nbsp;12.&nbsp;Using WSIT Security"><div class="titlepage"><div><div><h2 class="title"><a name="ahici"></a>Chapter&nbsp;12.&nbsp;Using WSIT Security</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#ahicj">12.1. Configuring Security Using NetBeans IDE</a></span></dt><dt><span class="section"><a href="#ahicm">12.2. Summary of Configuration Requirements</a></span></dt><dd><dl><dt><span class="section"><a href="#ahicn">12.2.1. Summary of Service-Side Configuration Requirements</a></span></dt><dt><span class="section"><a href="#ahicp">12.2.2. Summary of Client-Side Configuration Requirements</a></span></dt></dl></dd><dt><span class="section"><a href="#ahicu">12.3. Security Mechanisms</a></span></dt><dd><dl><dt><span class="section"><a href="#ahicv">12.3.1. Username Authentication with Symmetric Key</a></span></dt><dt><span class="section"><a href="#ahicv1">12.3.2. Username Authentication with Password Derived Keys</a></span></dt><dt><span class="section"><a href="#ahicw">12.3.3. Mutual Certificates Security</a></span></dt><dt><span class="section"><a href="#SymmBindingKerberos">12.3.4. Symmetric Binding with Kerberos Tokens</a></span></dt><dt><span class="section"><a href="#ahicx">12.3.5. Transport Security (SSL)</a></span></dt><dt><span class="section"><a href="#ahicz">12.3.6. Message Authentication over SSL</a></span></dt><dt><span class="section"><a href="#ahida">12.3.7. SAML Authorization over SSL</a></span></dt><dt><span class="section"><a href="#ahidb">12.3.8. Endorsing Certificate</a></span></dt><dt><span class="section"><a href="#ahidc">12.3.9. SAML Sender Vouches with Certificates</a></span></dt><dt><span class="section"><a href="#ahidd">12.3.10. SAML Holder of Key</a></span></dt><dt><span class="section"><a href="#ahide">12.3.11. STS Issued Token</a></span></dt><dt><span class="section"><a href="#ahidf">12.3.12. STS Issued Token with Service Certificate</a></span></dt><dt><span class="section"><a href="#ahidg">12.3.13. STS Issued Endorsing Token</a></span></dt></dl></dd><dt><span class="section"><a href="#ahidh">12.4. Configuring SSL and Authorized Users</a></span></dt><dd><dl><dt><span class="section"><a href="#ahidi">12.4.1. Configuring SSL For Your Applications</a></span></dt><dt><span class="section"><a href="#ahidj">12.4.2. Adding Users to GlassFish</a></span></dt></dl></dd><dt><span class="section"><a href="#ahidm">12.5. Configuring Keystores and Truststores</a></span></dt><dd><dl><dt><span class="section"><a href="#ahido">12.5.1. Specifying Aliases with the Updated Stores</a></span></dt><dt><span class="section"><a href="#ahidr">12.5.2. Configuring the Keystore and Truststore</a></span></dt><dt><span class="section"><a href="#ahidx">12.5.3. Configuring Validators</a></span></dt></dl></dd><dt><span class="section"><a href="#ConfiguringKerberos">12.6. Configuring Kerberos for Glassfish and Tomcat</a></span></dt><dd><dl><dt><span class="section"><a href="#KerberosForGlassfish">12.6.1. For Glassfish</a></span></dt><dt><span class="section"><a href="#KerberosForTomcat">12.6.2. For Tomcat</a></span></dt></dl></dd><dt><span class="section"><a href="#ahidy">12.7. Securing Operations and Messages</a></span></dt><dd><dl><dt><span class="section"><a href="#ahiea">12.7.1. Supporting Token Options</a></span></dt></dl></dd><dt><span class="section"><a href="#ahieb">12.8. Configuring A Secure Token Service (STS)</a></span></dt><dt><span class="section"><a href="#ahiei">12.9. Example Applications</a></span></dt><dd><dl><dt><span class="section"><a href="#ahiej">12.9.1. Example: Username Authentication with Symmetric Key
            (UA)</a></span></dt><dt><span class="section"><a href="#UsernameWithDigestPasswords">12.9.2. Example: Username with Digest Passwords</a></span></dt><dt><span class="section"><a href="#ahiem">12.9.3. Example: Mutual Certificates Security (MCS)</a></span></dt><dt><span class="section"><a href="#ahiep">12.9.4. Example: Transport Security (SSL)</a></span></dt><dt><span class="section"><a href="#ahies">12.9.5. Example: SAML Authorization over SSL (SA)</a></span></dt><dt><span class="section"><a href="#ahiev">12.9.6. Example: SAML Sender Vouches with Certificates (SV)</a></span></dt><dt><span class="section"><a href="#ahiey">12.9.7. Example: STS Issued Token (STS)</a></span></dt><dt><span class="section"><a href="#ahiex">12.9.8. Example: Broker Trust STS (BT)</a></span></dt><dt><span class="section"><a href="#ahiez">12.9.9. Example: STS Issued Token With SecureConversation
            (STS+SC)</a></span></dt><dt><span class="section"><a href="#gfzhh">12.9.10. Example: Kerberos Token (Kerb)</a></span></dt></dl></dd></dl></div><div class="section" title="12.1.&nbsp;Configuring Security Using NetBeans IDE"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahicj"></a>12.1.&nbsp;Configuring Security Using NetBeans IDE</h2></div></div></div><p>This section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#gfrdt" title="To Secure the Service">To Secure the Service</a></p></li><li class="listitem"><p><a class="xref" href="#gfrds" title="To Secure the Client">To Secure the Client</a></p></li></ul></div><div class="task" title="To Secure the Service"><a name="gfrdt"></a><p class="title"><b>To Secure the Service</b></p><div class="tasksummary">
                <p>To use the IDE to configure security for a web service
                and/or a web service operation, perform the following
                steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Create or open your web
                    service.</strong></span></p><p>If you need an example of how to create a web
                    service, refer to <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a>.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>When creating an application using the wizards
                        in NetBeans IDE and running on GlassFish, the Java EE
                        Version defaults to Java EE 5. This results in an
                        application compliant with JSR-109, Implementing
                        Enterprise Web Services, which can be read at <a class="link" href="http://jcp.org/en/jsr/detail?id=109" target="_top">http://jcp.org/en/jsr/detail?id=109</a>.
                        If you select a value other than the default, for
                        example, J2EE 1.4, the application that is created is
                        not JSR-109 compliant, which means that the
                        application is not JAX-WS, but is JAX-RPC.</p></div></li><li class="step" title="Step 2"><p><span class="bold"><strong>In the
                    <span class="guilabel">Projects</span> window, expand the
                    <span class="guilabel">Web Services</span> node.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Right-click the node for the
                    web service you want to secure.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select <span class="guimenuitem">Edit Web
                    Service Attributes</span>.</strong></span></p><p>When the <span class="guilabel">Web Service Attributes
                    Editor</span> is opened, the <span class="guilabel">Quality of
                    Service</span> options appear (see <a class="xref" href="#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a>).</p><div class="figure"><a name="gfrct"></a><p class="title"><b>Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/tango_ws_edit_collapsed.png" height="360" alt="Web Service Attributes Editor Page"></td></tr></table></div></div></div><br class="figure-break"></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select <span class="guilabel">Secure
                    Service</span>.</strong></span></p><p>This option enables WSIT security for all of the
                    operations of a web service.</p><p>For information on how to secure selected
                    operations, refer to <a class="xref" href="#ahidy" title="12.7.&nbsp;Securing Operations and Messages">Securing Operations and Messages</a>.</p></li><li class="step" title="Step 6"><p><span class="bold"><strong>Choose a <span class="guilabel">Security
                    Mechanism</span> from the list.</strong></span></p><p>Most of the mechanisms are fully functional without
                    further configuration, however, if you'd like to customize
                    the mechanism, click <span class="guilabel">Configure</span> to
                    specify the configuration for that mechanism.</p><p>Options in the <span class="guilabel">Configure</span> dialog
                    are discussed in <a class="xref" href="#ahifj" title="13.3.&nbsp;Security Mechanism Configuration Options">Security Mechanism Configuration Options</a>.</p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Select <span class="guilabel">Use
                    Development Defaults</span>.</strong></span></p><p>Select this option to import certificates into the
                    GlassFish keystore and truststore so that they can be used
                    immediately for development. The WSIT message security
                    mechanisms require the use of v3 certificates. The default
                    GlassFish keystore and truststore do not contain v3
                    certificates at this time. In order to use message
                    security mechanisms with GlassFish, it is necessary to
                    obtain keystore and truststore files that contain v3
                    certificates and import the appropriate certificates into
                    the default GlassFish stores.</p><p>In addition to importing certificates, when this
                    option is selected a default user is created in the
                    <code class="code">file</code> realm with username
                    <code class="code">wsitUser</code>.</p><p>In a production environment, you should provide your
                    own certificates and user settings, however, in a
                    development environment you may find these defaults
                    useful.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Specify Keystore, Truststore,
                    STS, SSL, and/or user information as required for the
                    selected security mechanism. </strong></span></p><p>Refer to the entry for the selected security
                    mechanism in <a class="xref" href="#ahico" title="Table&nbsp;12.1.&nbsp;Summary of Service-Side Configuration Requirements">Summary of Service-Side Configuration
                Requirements</a> . This table summarizes the
                    information that needs to be set up for each of the
                    security mechanisms.</p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Click
                    <span class="guibutton">OK</span> to save your
                    changes.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> Run the web application by
                    right-clicking the project node and selecting
                    <span class="guimenuitem">Run</span>. </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Verify the URL of the WSDL
                    file before proceeding with the creation of the web
                    service client. </strong></span></p><p>The client will be created from this WSDL file, and
                    will get the service's security policies through the web
                    service reference URL when the client is built or
                    refreshed.</p></li></ol></div></div><div class="task" title="To Secure the Client"><a name="gfrds"></a><p class="title"><b>To Secure the Client</b></p><div class="tasksummary">
                <p>All of the steps in <a class="xref" href="#gfrdt" title="To Secure the Service">To Secure the Service</a> need to be completed before you
                create your web service client. The service's security
                policies are defined in its WSDL. You specify this WSDL file
                when you create the client application so that the client is
                configured to work with the service's security mechanism
                through the web service reference URL when the client is built
                or refreshed.</p>

                <p>To use the IDE to configure security for a web service
                client, perform the following steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Create a client for your web
                    service.</strong></span></p><p>If you need an example of how to do this, see <a class="xref" href="#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> .</p><p>If you are creating a client for a mechanism that
                    will use SSL, specify the secure port for running the
                    client when completing the New Web Service Client step. To
                    do this, type <code class="code">https://</code>
                    <span class="emphasis"><em>fully_qualified_hostname</em></span>
                    <code class="code">:8181/</code> <span class="emphasis"><em>rest_of_url</em></span> in
                    the WSDL URL field of the New Web Service Client wizard.
                    For the example, this is the way to specify the secure URL
                    for <code class="code">CalculatorWSService</code> web service:</p><pre class="programlisting">https://<span class="emphasis"><em>fully_qualified_hostname</em></span>:8181/CalculatorApplication/CalculatorWSService?wsdl</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you prefer to use <code class="code">localhost</code> in
                        place of the fully-qualified hostname when specifying
                        the URL for the service WSDL, you must follow the
                        workaround described in <a class="xref" href="#ahicy" title="12.3.5.1.&nbsp;Transport Security (SSL) Workaround">Transport Security (SSL) Workaround</a>.</p></div></li><li class="step" title="Step 2"><p><span class="bold"><strong>In the Projects window, expand
                    the client node.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Expand the Web Service
                    References node.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Right-click the node for the
                    web service reference you want to secure.
                    </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Edit Web Service
                    Attributes.</strong></span></p><p>When the Web Service References Attributes Editor is
                    opened, select the Quality of Service tab to display the
                    security options (see <a class="xref" href="#gfrda" title="Figure&nbsp;12.2.&nbsp;Web Service References Attributes Editor Page for Web Service Clients">Web Service References Attributes Editor Page
                        for Web Service Clients</a> ).</p><div class="figure"><a name="gfrda"></a><p class="title"><b>Figure&nbsp;12.2.&nbsp;Web Service References Attributes Editor Page
                        for Web Service Clients</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/web_svc_ref_wsit.png" height="360" alt="Web Service References Attributes Editor Page for Web Service Clients"></td></tr></table></div></div></div><br class="figure-break"></li><li class="step" title="Step 6"><p><span class="bold"><strong>Select Use Development
                    Defaults.</strong></span></p><p>Refer to <a class="xref" href="#ahicq" title="Table&nbsp;12.2.&nbsp;Summary of Client-Side Configuration Requirements">Summary of Client-Side Configuration
                Requirements</a> for a summary of what options
                    are required on the client side. The configuration
                    requirements for the client are dependent upon which
                    security mechanism is specified on the server side.</p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click OK to save your
                    changes.</strong></span></p><p>The security configuration information is saved in
                    two files under Source Packages/META-INF. For more
                    information on the format and runtime usage of these
                    files, see <a class="xref" href="#ahifi" title="13.2.2.&nbsp;Client-Side WSIT Configuration Files">Client-Side WSIT Configuration Files</a> .</p></li></ol></div></div></div><div class="section" title="12.2.&nbsp;Summary of Configuration Requirements"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahicm"></a>12.2.&nbsp;Summary of Configuration Requirements</h2></div></div></div><p>The following sections summarize the options that need to be
        configured for each of the security mechanisms on both the service and
        client side. The configuration requirements for the client are
        dependent upon which security mechanism is specified on the server
        side.</p><p>This section covers the following topics:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahicn" title="12.2.1.&nbsp;Summary of Service-Side Configuration Requirements">Summary of Service-Side Configuration Requirements</a></p></li><li class="listitem"><p><a class="xref" href="#ahicp" title="12.2.2.&nbsp;Summary of Client-Side Configuration Requirements">Summary of Client-Side Configuration Requirements</a></p></li></ul></div><div class="section" title="12.2.1.&nbsp;Summary of Service-Side Configuration Requirements"><div class="titlepage"><div><div><h3 class="title"><a name="ahicn"></a>12.2.1.&nbsp;Summary of Service-Side Configuration Requirements</h3></div></div></div><p><a class="xref" href="#ahico" title="Table&nbsp;12.1.&nbsp;Summary of Service-Side Configuration Requirements">Summary of Service-Side Configuration
                Requirements</a> summarizes
            the options that need to be configured for each security
            mechanism. Each of the columns is briefly discussed after the
            table.</p><div class="table"><a name="ahico"></a><p class="title"><b>Table&nbsp;12.1.&nbsp;Summary of Service-Side Configuration
                Requirements</b></p><div class="table-contents"><table summary="Summary of Service-Side Configuration&#xA;                Requirements" border="1"><colgroup><col><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th><p>Mechanism</p></th><th align="center"><p>Keystore</p></th><th align="center"><p>Truststore</p></th><th align="center"><p>STS</p></th><th align="center"><p>SSL</p></th><th align="center"><p>User in GlassFish</p></th><th align="center"><p>Kerberos</p></th></tr></thead><tbody><tr><td><p>Username Authentication with Symmetric
                            Key</p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td></tr><tr><td><p>Username Authentication with Password
                            Derived Keys</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td></tr><tr><td><p>Mutual Certificates</p></td><td align="center"><p> X </p></td><td align="center"><p> X (no alias) </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>Symmetric Binding with Kerberos
                            Tokens</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td></tr><tr><td><p>Transport Security</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td></tr><tr><td><p>Message Authentication over SSL -
                            Username Token</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td></tr><tr><td><p>Message Authentication over SSL - X.509
                            Token</p></td><td align="center">&nbsp;</td><td align="center"><p> X (no alias) </p></td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>SAML Authorization over
                            SSL</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>Endorsing Certificate</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>SAML Sender Vouches with
                            Certificate</p></td><td align="center"><p> X </p></td><td align="center"><p> X (no alias) </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>SAML Holder of Key</p></td><td align="center"><p> X </p></td><td align="center"><p> X (no alias) </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>STS Issued Token</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>STS Issued Token with Service
                            Cert.</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>STS Issued Endorsing
                            Token</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr></tbody></table></div></div><br class="table-break"><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Keystore</em></span>: If this column has an
                    X, select Use Development Defaults, or click the Keystore
                    button and configure the keystore to specify the alias
                    identifying the service certificate and private key. For
                    the GlassFish keystores, the file is
                    <code class="code">keystore.jks</code> and the alias is
                    <code class="code">xws-security-server</code>, assuming that you've
                    updated the GlassFish default certificate stores.</p></li><li class="listitem"><p><span class="emphasis"><em>Truststore</em></span> : If this column has
                    an X, select Use Development Defaults, or click the
                    Truststore button and configure the truststore to specify
                    the alias that contains the certificate and trusted roots
                    of the client. For the GlassFish keystores, the file is
                    <code class="code">cacerts.jks</code> and the alias is
                    <code class="code">xws-security-client</code> , assuming that you've
                    updated the GlassFish default certificate stores.</p></li><li class="listitem"><p><span class="emphasis"><em>STS</em></span> : If this column has an X,
                    you must have a Security Token Service that can be
                    referenced by the service. An example of an STS can be
                    found in the section <a class="xref" href="#gfrlq" title="To Create and Secure the STS (STS)">To Create and Secure the STS (STS)</a> . The STS is secured using a
                    separate (non-STS) security mechanism. The security
                    configuration for the client-side of this application is
                    dependent upon the security mechanism selected for the
                    STS, and not on the security mechanism selected for the
                    application.</p></li><li class="listitem"><p><span class="emphasis"><em>SSL</em></span> : To use a mechanism that
                    uses secure transport (SSL), you must configure the
                    <span class="emphasis"><em>system</em></span> to point to the client and
                    server keystore and truststore files. Steps for doing this
                    are described in <a class="xref" href="#ahidi" title="12.4.1.&nbsp;Configuring SSL For Your Applications">Configuring SSL For Your Applications</a> .</p></li><li class="listitem"><p><span class="emphasis"><em>User in Glassfish</em></span> : To use a
                    mechanism that requires a user database for
                    authentication, you can add a user to the file realm of
                    GlassFish. Select Use Development Defaults, or follow the
                    instructions for doing this at <a class="xref" href="#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a> .</p></li><li class="listitem"><p><span class="emphasis"><em>Kerberos</em></span> : This option is only
                    valid for 'Symmetri Binding with Kerberos Tokens' Profile.
                    Click the Kerbeos button to specify the login module to be
                    used for this service. Login Modules can be specified in
                    $GLASSFISH_HOME/domains/domain1/config/login.conf for
                    Glassfish. An example showing use of Kerberos Tokens can
                    be found at <a class="xref" href="#gfzhh" title="12.9.10.&nbsp;Example: Kerberos Token (Kerb)">Example: Kerberos Token (Kerb)</a>.</p></li></ul></div></div><div class="section" title="12.2.2.&nbsp;Summary of Client-Side Configuration Requirements"><div class="titlepage"><div><div><h3 class="title"><a name="ahicp"></a>12.2.2.&nbsp;Summary of Client-Side Configuration Requirements</h3></div></div></div><p><a class="xref" href="#ahicq" title="Table&nbsp;12.2.&nbsp;Summary of Client-Side Configuration Requirements">Summary of Client-Side Configuration
                Requirements</a> summarizes
            the options that need to be configured for each of the security
            mechanisms on the client-side. Each of the columns is briefly
            discussed after the table.</p><div class="table"><a name="ahicq"></a><p class="title"><b>Table&nbsp;12.2.&nbsp;Summary of Client-Side Configuration
                Requirements</b></p><div class="table-contents"><table summary="Summary of Client-Side Configuration&#xA;                Requirements" border="1"><colgroup><col><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th><p>Mechanism</p></th><th align="center"><p>Keystore</p></th><th align="center"><p>Truststore</p></th><th align="center"><p>Default User</p></th><th align="center"><p>SAML Callback Handler</p></th><th align="center"><p>STS</p></th><th align="center"><p>SSL</p></th><th align="center"><p>User in GlassFish</p></th><th align="center"><p>Kerberos</p></th></tr></thead><tbody><tr><td><p>Username Authentication with Symmetric
                            Key</p></td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td></tr><tr><td><p>Username Authentication with Password
                            Derived Keys</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td></tr><tr><td><p>Mutual Certificates</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>Symmetric Binding with Kerberos
                            Tokens</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td></tr><tr><td><p>Transport Security</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td></tr><tr><td><p>Message Authentication over SSL -
                            Username Token</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td></tr><tr><td><p>Message Authentication over SSL - X.509
                            Token</p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>SAML Authorization over
                            SSL</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>Endorsing Certificate</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>SAML Sender Vouches with
                            Certificate</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>SAML Holder of Key</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>STS Issued Token</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>STS Issued Token with Service
                            Certificate</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>STS Issued Endorsing
                            Token</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr></tbody></table></div></div><br class="table-break"><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Keystore</em></span>: If this column has an
                    X, select Use Development Defaults, or click Keystore to
                    configure the keystore to point to the alias for the
                    client certificate. For the GlassFish keystores, the
                    keystore file is <code class="code">keystore.jks</code> and the alias
                    is <code class="code">xws-security-client</code>, assuming that you've
                    updated the GlassFish default certificate stores.</p></li><li class="listitem"><p><span class="emphasis"><em>Truststore</em></span>: If this column has
                    an X, select Use Development Defaults, or click Truststore
                    to configure the truststore that contains the certificate
                    and trusted roots of the server. For the GlassFish
                    keystores, the file is <code class="code">cacerts.jks</code> and the
                    alias is <code class="code">xws-security-server</code> , assuming that
                    you've updated the GlassFish default certificate stores as
                    described in <a class="xref" href="#gfrgz" title="To Manually Update GlassFish Certificates">To Manually Update GlassFish Certificates</a>.</p><p>When using an STS mechanism, the client specifies
                    the truststore and certificate alias for the STS, not the
                    service. For the GlassFish stores, the file is
                    <code class="code">cacerts.jks</code> and the alias is
                    <code class="code">wssip</code>.</p></li><li class="listitem"><p><span class="emphasis"><em>Default User</em></span>: When this column
                    has an X, you must configure either a default username and
                    password, a UsernameCallbackHandler, or leave these
                    options blank and specify a user at runtime. More
                    information on these options can be found at <a class="xref" href="#ahicr" title="12.2.2.1.&nbsp;Configuring Username Authentication on the Client">Configuring Username Authentication on the
                Client</a>.</p></li><li class="listitem"><p><span class="emphasis"><em>SAML Callback Handler</em></span> : When
                    this column has an X, you must specify a SAML Callback
                    Handler. Examples of SAML Callback Handlers are described
                    in <a class="xref" href="#ahict" title="12.2.2.2.&nbsp;Example SAML Callback Handlers">Example SAML Callback Handlers</a>.</p></li><li class="listitem"><p><span class="emphasis"><em>STS</em></span> : If this column has an X,
                    you must have a Security Token Service that can be
                    referenced by the service. An example of an STS can be
                    found in the section<a class="xref" href="#gfrlq" title="To Create and Secure the STS (STS)">To Create and Secure the STS (STS)</a>. The STS is secured using a
                    separate (non-STS) security mechanism. The security
                    configuration for the client-side of this application is
                    dependent upon the security mechanism selected for the
                    STS, and not on the security mechanism selected for the
                    application. Note that on the service side, it is
                    optionally to set Issuer for the STS to be used. You only
                    need to configure the STS information on the client side
                    if Issuer if not available in the service wsdl. If both
                    configured, the service side Issuer takes high
                    priority.</p></li><li class="listitem"><p><span class="emphasis"><em>SSL</em></span> : To use a mechanism that
                    uses secure transport (SSL), you must configure the system
                    to point to the client and server keystore and truststore
                    files. Steps for doing this are described in <a class="xref" href="#ahidi" title="12.4.1.&nbsp;Configuring SSL For Your Applications">Configuring SSL For Your Applications</a>.</p></li><li class="listitem"><p><span class="emphasis"><em>User in Glassfish</em></span>: To use a
                    mechanism that requires a user database for
                    authentication, select Use Development Defaults, or add a
                    user to the <code class="code">file</code> realm of GlassFish.
                    Instructions for doing this can be found at <a class="xref" href="#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a>.</p></li><li class="listitem"><p><span class="emphasis"><em>Kerberos</em></span>: This option is only
                    valid for 'Symmetric Binding with Kerberos Tokens'
                    profile. Click Kerberos button to configure the Login
                    Module and Service Principal to be used by client, and if
                    credential delegation should be set. An example showing
                    use of Kerberos Tokens can be found at <a class="xref" href="#gfzhh" title="12.9.10.&nbsp;Example: Kerberos Token (Kerb)">Example: Kerberos Token (Kerb)</a>.</p></li></ul></div><div class="section" title="12.2.2.1.&nbsp;Configuring Username Authentication on the Client"><div class="titlepage"><div><div><h4 class="title"><a name="ahicr"></a>12.2.2.1.&nbsp;Configuring Username Authentication on the
                Client</h4></div></div></div><p>On the client side, a user name and password must be
                configured for some of the security mechanisms. For this
                purpose, you can use the default Username and Password
                Callback Handlers (when deploying to GlassFish), specify a
                SAML Callback Handler, specify a default user name and
                password for development purposes, create and specify your own
                Callback Handlers if the container you are using does not
                provide defaults, or specify the username and password
                dynamically at runtime. When using any of these options, you
                must create an authorized user on GlassFish using the Admin
                Console, as described in <a class="xref" href="#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a>.</p><div class="task" title="To Configure Username Authentication on the Client"><a name="gfrev"></a><p class="title"><b>To Configure Username Authentication on the
                    Client</b></p><div class="tasksummary">
                        <p>Once you've created an authorized user and
                        determined how your application needs to specify the
                        user, configure the Username Authentication options as
                        follows.</p>
                    </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>In the Projects window,
                            expand the node for the web service client.
                            </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Expand the Web Service
                            References node.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Right-click the node for
                            the web service reference for which you want to
                            configure security options. </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select Edit Web Service
                            Attributes.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select the Quality of
                            Service tab to display the WSIT Security options.
                            </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong>Expand the Security
                            section to specify the user name and password
                            information as required by the service. The dialog
                            appears as shown in <a class="xref" href="#ahics" title="Figure&nbsp;12.3.&nbsp;Quality of Service - Client - Security">Quality of Service - Client -
                                    Security</a>. </strong></span> </p><div class="figure"><a name="ahics"></a><p class="title"><b>Figure&nbsp;12.3.&nbsp;Quality of Service - Client -
                                    Security</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/web_svc_ref_wsit.png" height="360" alt="Quality of Service - Client - Security"></td></tr></table></div></div></div><p><br class="figure-break"></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>The following options
                            are available.</strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Currently the GlassFish
                                    <code class="code">CallbackHandler</code> cannot handle the
                                    following: SAML Callbacks and Require ThumbPrint
                                    Reference assertions under an X.509 Token. This may
                                    be addressed in a future milestone.</p></div><ul class="stepalternatives">
                                <li class="step" title="Step 7.1"><p><span class="emphasis"><em>Use Development
                                    Defaults</em></span>:</p><p>Select this option to import certificates into
                                    the GlassFish keystore and truststore so that they
                                    can be used immediately for development. The WSIT
                                    message security mechanisms require the use of v3
                                    certificates. The default GlassFish keystore and
                                    truststore do not contain v3 certificates at this
                                    time. In order to use message security mechanisms
                                    with GlassFish, it is necessary to obtain keystore
                                    and truststore files that contain v3 certificates
                                    and import the appropriate certificates into the
                                    default GlassFish stores.</p><p>In addition to importing certificates, when
                                    this option is selected a default user is created in
                                    the <code class="code">file</code> realm with username
                                    <code class="code">wsitUser</code>.</p><p>In a production environment, you should
                                    provide your own certificates and user settings,
                                    however, in a development environment you may find
                                    these defaults useful.</p></li>

                                <li class="step" title="Step 7.2"><p><span class="emphasis"><em>Authentication
                                    Credentials</em></span>: Select Static or Dynamic.
                                    Select Static to supply a static username and
                                    password, or select Dynamic and specify the Username
                                    and Password CallbackHandlers. Select Static if you
                                    want to fill in the exact user credentials that the
                                    client is providing, and which cannot be changed
                                    after deployment. Static is useful to developing and
                                    testing applications prior to deployment. Select
                                    Dynamic to use CallbackHandlers to provide a dynamic
                                    way to provide credentials. Dynamic is useful if the
                                    credentials need to be obtained from some third
                                    party, for example, or if the developer doesn't want
                                    to store the user name and password in a
                                    configuration file because it might introduce a
                                    security risk.</p></li>

                                <li class="step" title="Step 7.3"><p><span class="emphasis"><em>Default Username</em></span>,
                                    <span class="emphasis"><em>Default Password</em></span> : These
                                    options are available when Static is selected as the
                                    Authentication Credential. Type the name of an
                                    authorized user and the password for this user. This
                                    option is best used only in the development
                                    environment. When the Default Username and Default
                                    Password are specified, the username and password
                                    are stored in the <code class="code">wsit-client.xml</code> file
                                    in clear text, which presents a security risk. Do
                                    not use this option for production.</p></li>

                                <li class="step" title="Step 7.4"><p><span class="emphasis"><em>Default Username Callback
                                    Handler</em></span>, <span class="emphasis"><em>Default Password
                                    Callback Handler</em></span> : These options are
                                    available when the Authentication Credential is
                                    Dynamic. If you create JSR-109-compliant web
                                    services and web service clients that run under an
                                    Application Server container (JSR-109 deployment),
                                    the container handles the callbacks and you do not
                                    need to configure Callback Handlers of your own. If
                                    you are using another container, select the Browse
                                    button to select the class implementing the
                                    <code class="code">javax.security.auth.callback.CallbackHandler</code>
                                    interface.</p></li>

                                <li class="step" title="Step 7.5"><p><span class="emphasis"><em>SAML Callback Handler</em></span> :
                                    To use a SAML Callback Handler, you need to create
                                    one, as there is no default. References to example
                                    SAML Callback Handlers are provided in <a class="xref" href="#ahict" title="12.2.2.2.&nbsp;Example SAML Callback Handlers">Example SAML Callback Handlers</a>. An
                                    example that uses a SAML Callback Handler can be
                                    found in <a class="xref" href="#ahies" title="12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)">Example: SAML Authorization over SSL (SA)</a>.</p></li>

                                <li class="step" title="Step 7.6"><p><span class="emphasis"><em>Timestamp Timeout</em></span>: This
                                    property specifies the duration(in seconds) for
                                    which timestamp should be considered valid. The
                                    default is 5 mins(300 seconds).</p></li>
                            </ul></li></ol></div></div></div><div class="section" title="12.2.2.2.&nbsp;Example SAML Callback Handlers"><div class="titlepage"><div><div><h4 class="title"><a name="ahict"></a>12.2.2.2.&nbsp;Example SAML Callback Handlers</h4></div></div></div><p>Creating a SAML Callback Handler is beyond the scope of
                this document. However, the following web pages may be helpful
                for this purpose:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>A client-side configuration, which includes a
                        SAML Callback Handler, can be viewed at the following
                        URL:</p><p><a class="link" href="http://java.net/projects/wsit/sources/svn/content/trunk/wsit/tests/e2e/testcases/xwss/s11/resources/wsit-client.xml" target="_top">http://java.net/projects/wsit/sources/svn/content/trunk/wsit/tests/e2e/testcases/xwss/s11/resources/wsit-client.xml</a></p></li><li class="listitem"><p>An example of a SAML Callback Handler can be
                        viewed and/or downloaded from the following
                        URL:</p><p><a class="link" href="http://xwss.java.net/servlets/ProjectDocumentList?folderID=6645&amp;expandFolder=6645&amp;folderID=6645" target="_top">http://xwss.java.net/servlets/ProjectDocumentList?folderID=6645&amp;expandFolder=6645&amp;folderID=6645</a></p></li><li class="listitem"><p>An example application in this tutorial that
                        uses a SAML Callback Handler can be found in <a class="xref" href="#ahies" title="12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)">Example: SAML Authorization over SSL (SA)</a> .</p></li></ul></div><p>When writing SAML Callback Handlers for different
                security mechanisms, set the subject confirmation method to SV
                (Sender Vouches) or HOK (Holder of Key) and the appropriate
                SAML Assertion version depending on the SAML version and SAML
                Token Profile selected when setting the security mechanism for
                the service. When the subject confirmation method is HOK, a
                keystore and truststore file must be configured in the
                SAMLCallbackHandler. When the method is SV, you can either
                comment out the keystore and truststore information, or leave
                it, as it will not be used.</p><p>For example, the following code snippet for one of the
                SAMLCallbackHandlers listed above demonstrates how to set the
                subject confirmation method and sets the SAMLAssertion version
                to 1.0, profile 1.0.</p><div class="example"><a name="d0e6724"></a><p class="title"><b>Example&nbsp;12.1.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">if (callbacks[i] instanceof SAMLCallback) {
    try {

        SAMLCallback samlCallback = (SAMLCallback) callbacks[i];

        /*
         Set confirmation Method to SV [SenderVouches] or
         HOK[Holder of Key]
        */
        samlCallback.setConfirmationMethod(samlCallback
                .SV_ASSERTION_TYPE);

        if (samlCallback.getConfirmationMethod().equals
                (samlCallback.SV_ASSERTION_TYPE)) {
            
            samlCallback.setAssertionElement
                    (createSVSAMLAssertion());

            svAssertion_saml10 = samlCallback.getAssertionElement();
            /*
            samlCallback.setAssertionElement
                (createSVSAMLAssertion20());
            svAssertion_saml20 =
                 samlCallback.getAssertionElement();
            */
        } else if (samlCallback.getConfirmationMethod().equals
                (samlCallback.HOK_ASSERTION_TYPE)) {
            
            samlCallback.setAssertionElement
                    (createHOKSAMLAssertion());
            hokAssertion_saml10 = samlCallback
                    .getAssertionElement();
            /*
            samlCallback.setAssertionElement
                (createHOKSAMLAssertion20());
            hokAssertion_saml20 =
                 samlCallback.getAssertionElement();
            */
        }
    } catch (Exception e) {
        e.printStackTrace();
    }
} else {
    throw unsupportedCallback;
}</pre></div></div><br class="example-break"></div></div></div><div class="section" title="12.3.&nbsp;Security Mechanisms"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahicu"></a>12.3.&nbsp;Security Mechanisms</h2></div></div></div><p>This section describes security mechanisms you can implement
        with WSIT. This section provides an overview of the following
        mechanisms:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahicv" title="12.3.1.&nbsp;Username Authentication with Symmetric Key">Username Authentication with Symmetric Key</a></p></li><li class="listitem"><p><a class="xref" href="#ahicv1" title="12.3.2.&nbsp;Username Authentication with Password Derived Keys">Username Authentication with Password Derived Keys</a></p></li><li class="listitem"><p><a class="xref" href="#ahicw" title="12.3.3.&nbsp;Mutual Certificates Security">Mutual Certificates Security</a></p></li><li class="listitem"><p><a class="xref" href="#SymmBindingKerberos" title="12.3.4.&nbsp;Symmetric Binding with Kerberos Tokens">Symmetric Binding with Kerberos Tokens</a></p></li><li class="listitem"><p><a class="xref" href="#ahicx" title="12.3.5.&nbsp;Transport Security (SSL)">Transport Security (SSL)</a></p></li><li class="listitem"><p><a class="xref" href="#ahicz" title="12.3.6.&nbsp;Message Authentication over SSL">Message Authentication over SSL</a></p></li><li class="listitem"><p><a class="xref" href="#ahida" title="12.3.7.&nbsp;SAML Authorization over SSL">SAML Authorization over SSL</a></p></li><li class="listitem"><p><a class="xref" href="#ahidb" title="12.3.8.&nbsp;Endorsing Certificate">Endorsing Certificate</a></p></li><li class="listitem"><p><a class="xref" href="#ahidc" title="12.3.9.&nbsp;SAML Sender Vouches with Certificates">SAML Sender Vouches with Certificates</a></p></li><li class="listitem"><p><a class="xref" href="#ahidd" title="12.3.10.&nbsp;SAML Holder of Key">SAML Holder of Key</a></p></li><li class="listitem"><p><a class="xref" href="#ahide" title="12.3.11.&nbsp;STS Issued Token">STS Issued Token</a></p></li><li class="listitem"><p><a class="xref" href="#ahidf" title="12.3.12.&nbsp;STS Issued Token with Service Certificate">STS Issued Token with Service Certificate</a></p></li><li class="listitem"><p><a class="xref" href="#ahidg" title="12.3.13.&nbsp;STS Issued Endorsing Token">STS Issued Endorsing Token</a></p></li></ul></div><p>A table that summarizes the configuration options on the server
        side is available in <a class="xref" href="#ahicn" title="12.2.1.&nbsp;Summary of Service-Side Configuration Requirements">Summary of Service-Side Configuration Requirements</a>.</p><p>Some common communication issues that need to be addressed using
        security mechanisms are discussed in <a class="xref" href="#ahiff" title="13.1.&nbsp;Using Security Mechanisms">Using Security Mechanisms</a>.</p><div class="section" title="12.3.1.&nbsp;Username Authentication with Symmetric Key"><div class="titlepage"><div><div><h3 class="title"><a name="ahicv"></a>12.3.1.&nbsp;Username Authentication with Symmetric Key</h3></div></div></div><p>The Username Authentication with Symmetric Key mechanism
            protects your application for integrity and confidentiality.
            Symmetric key cryptography relies on a single, shared secret key
            that is used to both sign and encrypt a message. Symmetric keys
            are usually faster than public key cryptography.</p><p>For this mechanism, the client does not possess any
            certificate/key of his own, but instead sends its
            username/password for authentication. The client shares a secret
            key with the server. The shared, symmetric key is generated at
            runtime and encrypted using the service's certificate. The client
            must specify the alias in the truststore by identifying the
            server's certificate alias.</p><p>See Also: <a class="xref" href="#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a>.</p></div><div class="section" title="12.3.2.&nbsp;Username Authentication with Password Derived Keys"><div class="titlepage"><div><div><h3 class="title"><a name="ahicv1"></a>12.3.2.&nbsp;Username Authentication with Password Derived Keys</h3></div></div></div><p>This feature is same as "Username Authentication with
            Symmetric Key", except that the protection token is Username
            Token.This feature relies on a single, shared secret key that is
            derived using password, salt(a 16 byte random array),iterations(an
            int value).This key will be used for signing and encrypting a
            message.</p><p>For this mechanism, the client does not need to have any
            certificate/key of his own.A 160 bit secret key will be generated
            using password,salt and iterations. This secret key will be used
            for signature/encryption. In the request the username,salt and
            iterations will be send to the server.The server generates the
            same key using the password(which it already has),salt and
            iterations. Using this key the server is able to decrypt the
            message and verify the signature.The default value for iterations
            is 1000.Current Netbeans versions doesn't show this feature in the
            security features list.So for a detailed explanation about this
            feature and to know how to configure this , please visit the blog:
            <a class="link" href="http://blogs.sun.com/SureshMandalapu/entry/passwordderivedkeys_support_in_metro" target="_top">
            http://blogs.sun.com/SureshMandalapu/entry/passwordderivedkeys_support_in_metro
            </a></p></div><div class="section" title="12.3.3.&nbsp;Mutual Certificates Security"><div class="titlepage"><div><div><h3 class="title"><a name="ahicw"></a>12.3.3.&nbsp;Mutual Certificates Security</h3></div></div></div><p>The Mutual Certificates Security mechanism adds security
            through authentication and message protection that ensures
            integrity and confidentiality. When using mutual certificates, a
            keystore and truststore file must be configured for both the
            client and server sides of the application.</p><p>See Also: <a class="xref" href="#ahiem" title="12.9.3.&nbsp;Example: Mutual Certificates Security (MCS)">Example: Mutual Certificates Security (MCS)</a>.</p></div><div class="section" title="12.3.4.&nbsp;Symmetric Binding with Kerberos Tokens"><div class="titlepage"><div><div><h3 class="title"><a name="SymmBindingKerberos"></a>12.3.4.&nbsp;Symmetric Binding with Kerberos Tokens</h3></div></div></div><p>Symmetric Binding with Kerberos Tokens does client
            authentication using Kerberos Tokens and integrity and
            confidentiality protection using symmetric keys generated with
            Kerberos V5 Protocol. This profile assumes that Kerberos
            authentication is supported by the underlying platform and a KDC
            is configured. When using Kerberos Tokens Profile, a Login Module
            must be configured for the service, and a Login Module and Service
            Principal must be specified for the client.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Kerberos is supported in Metro since 1.1 release.
                Netbeans support is available for Kerberos from Metro 1.3
                and Netbeans 6.5 release. Kerberos is NOT supported on AIX 
                systems.</p></div><p>See Also: <a class="xref" href="#gfzhh" title="12.9.10.&nbsp;Example: Kerberos Token (Kerb)">Example: Kerberos Token (Kerb)</a>.</p></div><div class="section" title="12.3.5.&nbsp;Transport Security (SSL)"><div class="titlepage"><div><div><h3 class="title"><a name="ahicx"></a>12.3.5.&nbsp;Transport Security (SSL)</h3></div></div></div><p>The Transport Security mechanism protects your application
            during transport using SSL for authentication and confidentiality.
            Transport-layer security is provided by the transport mechanisms
            used to transmit information over the wire between clients and
            providers, thus transport-layer security relies on secure HTTP
            transport (HTTPS) using Secure Sockets Layer (SSL). Transport
            security is a point-to-point security mechanism that can be used
            for authentication, message integrity, and confidentiality. When
            running over an SSL-protected session, the server and client can
            authenticate one another and negotiate an encryption algorithm and
            cryptographic keys before the application protocol transmits or
            receives its first byte of data. Security is "live" from the time
            it leaves the consumer until it arrives at the provider, or vice
            versa. The problem is that it is not protected once it gets to its
            destination. For protection of data after it reaches its
            destination, use one of the security mechanisms that uses SSL and
            also secures data at the message level.</p><p>Digital certificates are necessary when running secure HTTP
            transport (HTTPS) using Secure Sockets Layer (SSL). The HTTPS
            service of most web servers will not run unless a digital
            certificate has been installed. Digital certificates have already
            been created for GlassFish, and the default certificates are
            sufficient for running this mechanism, and are required when using
            Atomic Transactions (see <a class="xref" href="#using_at" title="Chapter&nbsp;18.&nbsp;Using Atomic Transactions"><i>Using Atomic Transactions</i></a> ). However, the message security
            mechanisms require a newer version of certificates than is
            available with GlassFish. You can download valid keystore and
            truststore files for the client and server as described in <a class="xref" href="#gfrgz" title="To Manually Update GlassFish Certificates">To Manually Update GlassFish Certificates</a>.</p><p>To use this mechanism, follow the steps in <a class="xref" href="#ahidi" title="12.4.1.&nbsp;Configuring SSL For Your Applications">Configuring SSL For Your Applications</a>.</p><p>See Also: <a class="xref" href="#ahiep" title="12.9.4.&nbsp;Example: Transport Security (SSL)">Example: Transport Security (SSL)</a>.</p><div class="section" title="12.3.5.1.&nbsp;Transport Security (SSL) Workaround"><div class="titlepage"><div><div><h4 class="title"><a name="ahicy"></a>12.3.5.1.&nbsp;Transport Security (SSL) Workaround</h4></div></div></div><p>This note applies to cases where <code class="code">https</code> is
                the transport protocol used between a WSIT client and a secure
                web service using transport binding, and you are referencing
                <code class="code">localhost</code> when creating the client.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you use the fully-qualified hostname (FQHN) in
                    the URL for the service WSDL when you are adding the web
                    service client to the client application, this workaround
                    is not required. It is only required when you specify
                    <code class="code">localhost</code> in the URL for the service
                    WSDL.</p></div><p>During <span class="emphasis"><em>development</em></span> (not production)
                it is sometimes convenient to use certificates whose CN
                (Common Name) does <span class="emphasis"><em>not</em></span> match the host
                name in the URL.</p><p>A developer would want to use a CN which is different
                from the host name in the URL in WSIT when using
                <code class="code">https</code> addresses in Dispatch clients and during
                <code class="code">wsimport</code> . The below mentioned workaround is only
                for the Dispatch clients, which are also used in WS-Trust to
                communicate with STS. This has to be done even if the client's
                main service is not on https, but only the STS is on
                https.</p><p>Java by default verifies that the certificate CN (Common
                Name) is the same as host name in the URL. If the CN in the
                certificate is not the same as the host name, your web service
                client fails with the following exception:</p><div class="example"><a name="d0e6875"></a><p class="title"><b>Example&nbsp;12.2.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">javax.xml.ws.WebServiceException: java.io.IOException:
HTTPS hostname wrong: should be &lt;hostname as in the certificate&gt;</pre></div></div><br class="example-break"><p>The recommended way to overcome this issue is to
                generate the server certificate with the Common Name (CN)
                matching the host name.</p><p>To work around this only during development, in your
                client code, you can set the default host name verifier to a
                custom host name verifier which does a custom check. An
                example is given below. It is sometimes necessary to include
                this in the static block of your main Java class as shown
                below to set this verifier before any connections are made to
                the server.</p><div class="example"><a name="d0e6882"></a><p class="title"><b>Example&nbsp;12.3.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">static {
    //WORKAROUND. TO BE REMOVED.
    javax.net.ssl.HttpsURLConnection.setDefaultHostnameVerifier(
            new javax.net.ssl.HostnameVerifier(){
                public boolean verify(String hostname,
                                      javax.net.ssl.SSLSession sslSession) {
                    if (hostname.equals("mytargethostname")) {
                        return true;
                    }
                    return false;
                }
            });
}             </pre></div></div><br class="example-break"><p>Please remember to remove this code once you install
                valid certificates on the server.</p></div></div><div class="section" title="12.3.6.&nbsp;Message Authentication over SSL"><div class="titlepage"><div><div><h3 class="title"><a name="ahicz"></a>12.3.6.&nbsp;Message Authentication over SSL</h3></div></div></div><p>The Message Authentication over SSL mechanism attaches a
            cryptographically secured identity or authentication token with
            the message and use SSL for confidentiality protection.</p><p>By default, a Username Supporting Token will be used for
            message authentication. To use an X.509 Supporting Token instead,
            click the Configure button and select X509. Under this scenario,
            you will need to configure your system for using SSL as described
            in <a class="xref" href="#ahidi" title="12.4.1.&nbsp;Configuring SSL For Your Applications">Configuring SSL For Your Applications</a>.</p></div><div class="section" title="12.3.7.&nbsp;SAML Authorization over SSL"><div class="titlepage"><div><div><h3 class="title"><a name="ahida"></a>12.3.7.&nbsp;SAML Authorization over SSL</h3></div></div></div><p>The SAML Authorization over SSL mechanism attaches an
            authorization token with the message and uses SSL for
            confidentiality protection. In this mechanism, the SAML token is
            expected to carry some authorization information about an end
            user. The sender of the token is actually vouching for the
            credentials in the SAML token.</p><p>To use this mechanism, configure SSL on the server, as
            described in <a class="xref" href="#ahidi" title="12.4.1.&nbsp;Configuring SSL For Your Applications">Configuring SSL For Your Applications</a>,
            and, on the clients side, configure a SAMLCallbackHandler as
            described in <a class="xref" href="#ahict" title="12.2.2.2.&nbsp;Example SAML Callback Handlers">Example SAML Callback Handlers</a>.</p><p>See Also: <a class="xref" href="#ahies" title="12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)">Example: SAML Authorization over SSL (SA)</a>.</p></div><div class="section" title="12.3.8.&nbsp;Endorsing Certificate"><div class="titlepage"><div><div><h3 class="title"><a name="ahidb"></a>12.3.8.&nbsp;Endorsing Certificate</h3></div></div></div><p>This mechanism uses secure messages using symmetric key for
            integrity and confidentiality protection, and uses an endorsing
            client certificate to augment the claims provided by the token
            associated with the message signature. For this mechanism, the
            client knows the service's certificate, and requests need to be
            endorsed/authorized by a special identity. For example, all
            requests to a vendor must be endorsed by a purchase manager, so
            the certificate of the purchase manager should be used to endorse
            (or counter sign) the original request.</p></div><div class="section" title="12.3.9.&nbsp;SAML Sender Vouches with Certificates"><div class="titlepage"><div><div><h3 class="title"><a name="ahidc"></a>12.3.9.&nbsp;SAML Sender Vouches with Certificates</h3></div></div></div><p>This mechanism protects messages with mutual certificates
            for integrity and confidentiality and with a Sender Vouches SAML
            token for authorization. The Sender Vouches method establishes the
            correspondence between a SOAP message and the SAML assertions
            added to the SOAP message. The attesting entity provides the
            confirmation evidence that will be used to establish the
            correspondence between the subject of the SAML subject statements
            (in SAML assertions) and SOAP message content. The attesting
            entity, presumed to be different from the subject, vouches for the
            verification of the subject. The receiver has an existing trust
            relationship with the attesting entity. The attesting entity
            protects the assertions (containing the subject statements) in
            combination with the message content against modification by
            another party. For more information about the Sender Vouches
            method, read the SAML Token Profile document at <a class="link" href="http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.0.pdf" target="_top">http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.0.pdf</a>
            .</p><p>For this mechanism, the SAML token is included as part of
            the message signature as an authorization token and is sent only
            to the recipient. The message payload needs to be signed and
            encrypted. The requestor is vouching for the credentials (present
            in the SAML assertion) of the entity on behalf of which the
            requestor is acting.</p><p>The initiator token, which is an X.509 token, is used for
            signature. The recipient token, which is also an X.509 token, is
            used for encryption. For the server, this is reversed, the
            recipient token is the signature token and the initiator token is
            the encryption token. A SAML token is used for
            authorization.</p><p>See Also: <a class="xref" href="#ahiev" title="12.9.6.&nbsp;Example: SAML Sender Vouches with Certificates (SV)">Example: SAML Sender Vouches with Certificates (SV)</a>.</p></div><div class="section" title="12.3.10.&nbsp;SAML Holder of Key"><div class="titlepage"><div><div><h3 class="title"><a name="ahidd"></a>12.3.10.&nbsp;SAML Holder of Key</h3></div></div></div><p>This mechanism protects messages with a signed SAML
            assertion (issued by a trusted authority) carrying client public
            key and authorization information with integrity and
            confidentiality protection using mutual certificates. The
            Holder-of-Key (HOK) method establishes the correspondence between
            a SOAP message and the SAML assertions added to the SOAP message.
            The attesting entity includes a signature that can be verified
            with the key information in the confirmation method of the subject
            statements of the SAML assertion referenced for key info for the
            signature. For more information about the Holder of Key method,
            read the SAML Token Profile document at <a class="link" href="http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.0.pdf" target="_top">http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.0.pdf</a>
            .</p><p>Under this scenario, the service does not trust the client
            directly, but requires the client to send a SAML assertion issued
            by a particular SAML authority. The client knows the recipient's
            public key, but does not share a direct trust relationship with
            the recipient. The recipient has a trust relationship with the
            authority that issues the SAML token. The request is signed with
            the client's private key and encrypted with the server
            certificate. The response is signed using the server's private key
            and encrypted using the key provided within the HOK SAML
            assertion.</p></div><div class="section" title="12.3.11.&nbsp;STS Issued Token"><div class="titlepage"><div><div><h3 class="title"><a name="ahide"></a>12.3.11.&nbsp;STS Issued Token</h3></div></div></div><p>This security mechanism protects messages using a token
            issued by a trusted Secure Token Service (STS) for message
            integrity and confidentiality protection.</p><p>An STS is a service that implements the protocol defined in
            the WS-Trust specification (you can find a link to this
            specification at <a class="link" href="http://wsit.java.net/" target="_top">http://wsit.java.net/</a> ).
            This protocol defines message formats and message exchange
            patterns for issuing, renewing, canceling, and validating security
            tokens.</p><p>Service providers and consumers are in potentially different
            managed environments but use a single STS to establish a chain of
            trust. The service does not trust the client directly, but instead
            trusts tokens issued by a designated STS. In other words, the STS
            is taking on the role of a second service with which the client
            has to securely authenticate. The issued tokens contain a key,
            which is encrypted for the server and which is used for deriving
            new keys for signing and encrypting.</p><p>To use this mechanism for the web service, you simply select
            this option as your security mechanism. However, you must have a
            Security Token Service that can be referenced by the service. An
            example of an STS can be found in the section <a class="xref" href="#gfrlq" title="To Create and Secure the STS (STS)">To Create and Secure the STS (STS)</a> . In this section, you
            select a security mechanism for the STS. The security
            configuration for the client-side of this application is dependent
            upon the security mechanism selected for the STS, and not on the
            security mechanism selected for the application. The client
            truststore must contain the certificate of the STS, which has the
            alias of <code class="code">wssip</code> if you are using the updated GlassFish
            certificates.</p><p>See Also: <a class="xref" href="#ahiey" title="12.9.7.&nbsp;Example: STS Issued Token (STS)">Example: STS Issued Token (STS)</a>.</p></div><div class="section" title="12.3.12.&nbsp;STS Issued Token with Service Certificate"><div class="titlepage"><div><div><h3 class="title"><a name="ahidf"></a>12.3.12.&nbsp;STS Issued Token with Service Certificate</h3></div></div></div><p>This security mechanism is similar to the one discussed in
            <a class="xref" href="#ahide" title="12.3.11.&nbsp;STS Issued Token">STS Issued Token</a> , with the
            difference being that in addition to the service requiring the
            client to authenticate using a SAML token issued by a designated
            STS, confidentiality protection is achieved using a service
            certificate. A service certificate is Unhandled tag caution used
            by a client to authenticate the service and provide message
            protection. For GlassFish, a default certificate of
            <code class="code">s1as</code> is installed.</p><p>To use this mechanism for the web service, you simply select
            this option as your security mechanism. However, you must have a
            Security Token Service that can be referenced by the service. An
            example of an STS can be found in the section <a class="xref" href="#gfrlq" title="To Create and Secure the STS (STS)">To Create and Secure the STS (STS)</a> . In this section, you
            select a security mechanism for the STS. The security
            configuration for the client-side of this application is dependent
            upon the security mechanism selected for the STS, and not on the
            security mechanism selected for the application. The client
            truststore must contain the certificate of the STS, which has the
            alias of <code class="code">wssip</code> if you are using the updated GlassFish
            certificates.</p></div><div class="section" title="12.3.13.&nbsp;STS Issued Endorsing Token"><div class="titlepage"><div><div><h3 class="title"><a name="ahidg"></a>12.3.13.&nbsp;STS Issued Endorsing Token</h3></div></div></div><p>This security mechanism is similar to the one discussed in
            <a class="xref" href="#ahide" title="12.3.11.&nbsp;STS Issued Token">STS Issued Token</a> , with the
            difference being that the client authenticates using a SAML token
            that is issued by a designated STS. An endorsing token is used to
            sign the message signature.</p><p>In this mechanism, message integrity and confidentiality are
            protected using ephemeral keys encrypted for the service.
            Ephemeral keys use an algorithm where the exchange key value is
            purged from the cryptographic service provider (CSP) when the key
            handle is destroyed. The service requires messages to be endorsed
            by a SAML token issued by a designated STS.</p><p>Service providers and consumers are in potentially different
            managed environments. For this mechanism, the service requires
            that secure communications be endorsed by a trusted STS. The
            service does not trust the client directly, but instead trusts
            tokens issued by a designated STS. In other words, the STS is
            taking on the role of a second service with which the client has
            to securely authenticate.</p><p>For this mechanism, authentication of the client is achieved
            in this way:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The client authenticates with the STS and obtains
                    the necessary token with credentials.</p></li><li class="listitem"><p>The client's request is signed and encrypted using
                    ephemeral key K.</p></li><li class="listitem"><p>The server's response is signed and encrypted using
                    the same K.</p></li><li class="listitem"><p>The primary signature of the request is endorsed
                    using the issued token.</p></li></ul></div><p>To use this mechanism for the web service, you simply select
            this option as your security mechanism. However, you must have a
            Security Token Service that can be referenced by the service. An
            example of an STS can be found in the section <a class="xref" href="#gfrlq" title="To Create and Secure the STS (STS)">To Create and Secure the STS (STS)</a> . In this section, you
            select a security mechanism for the STS. The security
            configuration for the client-side of this application is dependent
            upon the security mechanism selected for the STS, and not on the
            security mechanism selected for the application. The client
            truststore must contain the certificate of the STS, which has the
            alias of <code class="code">wssip</code> if you are using the updated GlassFish
            certificates.</p></div></div><div class="section" title="12.4.&nbsp;Configuring SSL and Authorized Users"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahidh"></a>12.4.&nbsp;Configuring SSL and Authorized Users</h2></div></div></div><p>This section discusses configuring security for your web service
        and web service client using the WSIT security mechanisms. Some of
        these mechanisms require some configuration outside of NetBeans IDE.
        Depending upon which security mechanism you plan to use, some of the
        following tasks will need to be completed:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>If you are using the GlassFish container and
                <span class="emphasis"><em>message</em></span> security, you must update the
                GlassFish keystore and truststore by importing v3
                certificates. The procedure for updating the certificates is
                described in <a class="xref" href="#gfrgz" title="To Manually Update GlassFish Certificates">To Manually Update GlassFish Certificates</a>.</p></li><li class="listitem"><p>If you are using a security mechanism that requires a
                user to enter a user name and password, create authorized
                users for your container. Steps for creating an authorized
                user for the GlassFish container are described in <a class="xref" href="#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a>.</p></li><li class="listitem"><p>To use a mechanism that uses secure transport (SSL), you
                must configure the <span class="emphasis"><em>system</em></span> to point to the
                client and server keystore and truststore files. Steps for
                doing this are described in <a class="xref" href="#ahidi" title="12.4.1.&nbsp;Configuring SSL For Your Applications">Configuring SSL For Your Applications</a>.</p></li></ul></div><p>This section covers the following topics:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahidi" title="12.4.1.&nbsp;Configuring SSL For Your Applications">Configuring SSL For Your Applications</a></p></li><li class="listitem"><p><a class="xref" href="#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a></p></li></ul></div><div class="section" title="12.4.1.&nbsp;Configuring SSL For Your Applications"><div class="titlepage"><div><div><h3 class="title"><a name="ahidi"></a>12.4.1.&nbsp;Configuring SSL For Your Applications</h3></div></div></div><p>This section describes adding the steps to configure your
            application for SSL. These steps will need to be accomplished for
            any application that uses one of the mechanisms:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahicx" title="12.3.5.&nbsp;Transport Security (SSL)">Transport Security (SSL)</a>
                    (see <a class="xref" href="#ahiep" title="12.9.4.&nbsp;Example: Transport Security (SSL)">Example: Transport Security (SSL)</a>
                    )</p></li><li class="listitem"><p><a class="xref" href="#ahicz" title="12.3.6.&nbsp;Message Authentication over SSL">Message Authentication over SSL</a></p></li><li class="listitem"><p><a class="xref" href="#ahida" title="12.3.7.&nbsp;SAML Authorization over SSL">SAML Authorization over SSL</a>
                    (see <a class="xref" href="#ahies" title="12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)">Example: SAML Authorization over SSL (SA)</a>
                    )</p></li></ul></div><div class="task" title="To Configure SSL for Your Application"><a name="gfrgq"></a><p class="title"><b>To Configure SSL for Your Application</b></p><div class="tasksummary">
                    <p>The following steps are generic to any application,
                    but have example configurations that will work with the
                    tutorial examples, in particular, <a class="xref" href="#ahies" title="12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)">Example: SAML Authorization over SSL (SA)</a> and <a class="xref" href="#ahiep" title="12.9.4.&nbsp;Example: Transport Security (SSL)">Example: Transport Security (SSL)</a>.</p>

                    <p>To configure SSL for your application, follow these
                    steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Select one of the
                        mechanisms that require SSL.</strong></span></p><p>These include <a class="xref" href="#ahicx" title="12.3.5.&nbsp;Transport Security (SSL)">Transport Security (SSL)</a>, <a class="xref" href="#ahicz" title="12.3.6.&nbsp;Message Authentication over SSL">Message Authentication over SSL</a>, and<a class="xref" href="#ahida" title="12.3.7.&nbsp;SAML Authorization over SSL">SAML Authorization over SSL</a>.</p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Server
                        Configuration</strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 2.1"><p>GlassFish is already configured for SSL. No
                                further SSL configuration is necessary if you are
                                using Transport Security. However, if you are using
                                one of the Message Security mechanisms with SSL, you
                                must update the GlassFish certificates as described
                                in <a class="xref" href="#gfrgz" title="To Manually Update GlassFish Certificates">To Manually Update GlassFish Certificates</a>.</p></li>

                            <li class="step" title="Step 2.2"><p>Configure a user on GlassFish as described in
                                <a class="xref" href="#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a>.</p></li>
                        </ul></li><li class="step" title="Step 3"><p><span class="bold"><strong>Client
                        Configuration</strong></span></p><p>For configuring your system for SSL in order to
                        work through the examples in this tutorial, the same
                        keystore and truststore files are used for both the
                        client and the service. This makes it unnecessary to
                        set system properties to point to the client stores,
                        as both GlassFish and NetBeans IDE are aware of these
                        certificates and point to them by default.</p><p>In general, for the client side of SSL you will
                        not be using the same certificates for the client and
                        the service. In that case, you need to define the
                        client certificate stores by setting the system
                        properties <code class="code">-Djavax.net.ssl.trustStore</code> ,
                        <code class="code">-Djavax.net.ssl.keyStore</code> ,
                        <code class="code">-Djavax.net.ssl.trustStorePassword</code> , and
                        <code class="code">-Djavax.net.ssl.keyStorePassword</code> in the
                        application client container.</p><p>You can specify the environment variables for
                        keystore and truststore by setting the environment
                        variable <code class="code">VMARGS</code> through the shell
                        environment or inside an Ant script, or by passing
                        them in when you start NetBeans IDE from the command
                        line. For example, in the latter case, you would
                        specify the property settings as follows:</p><pre class="programlisting"><span class="bold"><strong><span class="emphasis"><em>netbeans-install</em></span>/bin/netbeans.exe
-J-Djavax.net.ssl.trustStore=<span class="emphasis"><em>as-install</em></span>/domains/domain1/config/cacerts.jks
-J-Djavax.net.ssl.keyStore=<span class="emphasis"><em>as-install</em></span>/domains/domain1/config/keystore.jks
-J-Djavax.net.ssl.trustStorePassword=changeit
-J-Djavax.net.ssl.keyStorePassword=changeit</strong></span></pre><p>Use the hard-coded path to the keystore and
                        truststore files, not variables.</p><p>For the SSL mechanism, the browser will prompt
                        you to accept the server alias
                        <code class="code">s1as</code>.</p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Service
                        Configuration</strong></span></p><p>To require the service to use the HTTPS
                        protocol, you must select a security mechanism that
                        uses SSL (as described in a previous step), and you
                        have to specify the security requirements in the
                        service's application deployment descriptor. This file
                        is <code class="code">ejb-jar.xml</code> for a web service that is
                        implemented as an EJB endpoint, and
                        <code class="code">web.xml</code> for a web service implemented as
                        a servlet. To specify the security information, follow
                        these steps:</p><ol type="a" class="substeps"><li class="step" title="Step 4.a"><p><span class="bold"><strong>From your web service
                                application, expand Web Pages |
                                WEB-INF.</strong></span></p></li><li class="step" title="Step 4.b"><p><span class="bold"><strong> Double-click
                                <code class="code">web.xml</code> (or <code class="code">ejb-jar.xml</code> )
                                to open it in the editor. </strong></span></p></li><li class="step" title="Step 4.c"><p><span class="bold"><strong>Select the Security
                                tab.</strong></span></p></li><li class="step" title="Step 4.d"><p><span class="bold"><strong> On the Security
                                Constraints line, expand the node for SSL transport
                                for CalculatorWSService. This will display when a
                                security mechanism that requires SSL is selected.
                                This constraint will be sufficient for the example
                                applications. This sections walks you through making
                                some changes in the event that you would like to
                                customize the security constraint for your
                                application. </strong></span></p></li><li class="step" title="Step 4.e"><p><span class="bold"><strong>Under Web Resource
                                Collection, click Edit.</strong></span></p></li><li class="step" title="Step 4.f"><p><span class="bold"><strong> Change the URL Pattern
                                to be protected (for example, <code class="code">/*</code> ).
                                Select which HTTP Methods to protect, for example,
                                POST. Click OK to close this dialog.
                                </strong></span></p></li><li class="step" title="Step 4.g"><p><span class="bold"><strong> Unselect Enable
                                Authentication Constraint. Ensure that the Enable
                                User Data Constraint box is checked. Verify that
                                CONFIDENTIAL is selected for the Transport Guarantee
                                to specify that the application uses SSL because the
                                application requires that data be transmitted so as
                                to prevent other entities from observing the
                                contents of the transmission. </strong></span></p><p>The IDE appears as shown in <a class="xref" href="#gfrgi" title="Figure&nbsp;12.4.&nbsp;Deployment Descriptor Page">Deployment Descriptor Page</a>.</p><div class="figure"><a name="gfrgi"></a><p class="title"><b>Figure&nbsp;12.4.&nbsp;Deployment Descriptor Page</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/security-web-xml.png" height="360" alt="Deployment Descriptor Page"></td></tr></table></div></div></div><br class="figure-break"></li><li class="step" title="Step 4.h"><p><span class="bold"><strong> Click the XML tab to
                                display the additions to <code class="code">web.xml</code> . The
                                security constraint looks like this:
                                </strong></span></p><div class="example"><a name="d0e7234"></a><p class="title"><b>Example&nbsp;12.4.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;security-constraint&gt;
    &lt;display-name&gt;Constraint1&lt;/display-name&gt;
    &lt;web-resource-collection&gt;
        &lt;web-resource-name&gt;CalcWebResource&lt;/web-resource-name&gt;
        &lt;description/&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
        &lt;http-method&gt;POST&lt;/http-method&gt;
    &lt;/web-resource-collection&gt;
    &lt;user-data-constraint&gt;
        &lt;description/&gt;
        &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;
&lt;/security-constraint&gt;</pre></div></div><br class="example-break"></li><li class="step" title="Step 4.i"><p><span class="bold"><strong> When you run this
                                project (right-click, select Run), the browser will
                                ask you to accept the server certificate of
                                <code class="code">s1as</code> . Accept this certificate. The
                                WSDL appears in the browser. </strong></span></p></li></ol></li><li class="step" title="Step 5"><p><span class="bold"><strong>Creating a
                        Client</strong></span></p><p>When creating your client application, use the
                        fully-qualified hostname to specify the secure WSDL
                        location (use <code class="code">https://</code>
                        <span class="emphasis"><em>fully_qualified_hostname</em></span>
                        <code class="code">:8181/CalculatorApplication/CalculatorWSService?wsdl</code>
                        , for example, in place of
                        <code class="code">http://localhost:8080/CalculatorApplication/CalculatorWSService?wsdl</code>
                        ).</p><p>In some cases, you might get an error dialog
                        telling you that the URL <code class="code">https://</code>
                        <span class="emphasis"><em>fully_qualified_hostname</em></span>
                        <code class="code">:8181/CalculatorApplication/CalculatorWSService?wsdl</code>
                        couldn't be downloaded. However, this is the correct
                        URL, and it does load when you run the service. So,
                        when this error occurs, repeat the steps that create
                        the Web Service Client using the secure WSDL. The
                        second time, the web service reference is created and
                        you can continue creating the client.</p></li></ol></div></div></div><div class="section" title="12.4.2.&nbsp;Adding Users to GlassFish"><div class="titlepage"><div><div><h3 class="title"><a name="ahidj"></a>12.4.2.&nbsp;Adding Users to GlassFish</h3></div></div></div><p>This section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#gfxzy" title="To Add a User to GlassFish for Development">To Add a User to GlassFish for Development</a></p></li><li class="listitem"><p><a class="xref" href="#gfrib" title="To Add Users to GlassFish Using the Admin Console">To Add Users to GlassFish Using the Admin
                Console</a></p></li><li class="listitem"><p><a class="xref" href="#gfrgr" title="To Add Users to GlassFish From the Command Line">To Add Users to GlassFish From the Command Line</a></p></li></ul></div><div class="task" title="To Add a User to GlassFish for Development"><a name="gfxzy"></a><p class="title"><b>To Add a User to GlassFish for Development</b></p><div class="tasksummary">
                    <p>To create a user in the GlassFish file realm to be
                    used for testing and development purposes, follow these
                    steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> In NetBeans IDE,
                        right-click the web service, select Edit Web Service
                        Attributes. </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Select Use Development
                        Defaults.</strong></span></p><p>In addition to setting up keystore and
                        truststore files, this option creates a default user
                        on GlassFish. The user has the name
                        <code class="code">wsitUser</code> and the password of
                        <code class="code">changeit</code> .</p></li></ol></div></div><div class="task" title="To Add Users to GlassFish Using the Admin Console"><a name="gfrib"></a><p class="title"><b>To Add Users to GlassFish Using the Admin
                Console</b></p><div class="tasksummary">
                    <p>To add users to GlassFish using the Admin Console,
                    follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Start GlassFish if you
                        haven't already done so.</strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong> Start the Admin Console
                        if you haven't already done so. </strong></span></p><p>You can start the Admin Console by starting a
                        web browser and specifying the URL
                        <code class="code">http://localhost:4848/asadmin</code> . If you
                        changed the default Admin port during installation,
                        type the correct port number in place of 4848.</p></li><li class="step" title="Step 3"><p><span class="bold"><strong> To log in to the Admin
                        Console, type the user name and password of a user in
                        the <code class="code">admin-realm</code> who belongs to the
                        <code class="code">asadmin</code> group. </strong></span></p><p>The name ( <code class="code">admin</code> ) and password (
                        <code class="code">adminadmin</code> ) entered during installation
                        will work, as will any users added to this realm and
                        group subsequent to installation.</p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Expand the Configuration
                        node in the Admin Console tree.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Expand the Security node
                        in the Admin Console tree.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Expand the Realms node,
                        then select the <code class="code">file</code> realm.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click the Manage Users
                        button.</strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong>Click New to add a new
                        user to the realm.</strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong> Type the correct
                        information into the User ID, Password, and Group(s)
                        fields. </strong></span></p><p>The example applications reference a user with
                        the following attributes:</p><ul class="stepalternatives">
                            <li class="step" title="Step 9.1"><p>User ID = <code class="code">wsitUser</code></p></li>

                            <li class="step" title="Step 9.2"><p>Group List = <code class="code">wsit</code></p></li>

                            <li class="step" title="Step 9.3"><p>New Password = <code class="code">changeit</code></p></li>

                            <li class="step" title="Step 9.4"><p>Confirm New Password =
                                <code class="code">changeit</code></p></li>
                        </ul></li><li class="step" title="Step 10"><p><span class="bold"><strong> Click OK to add this user
                        to the list of users in the realm. </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong>Click Logout when you have
                        completed this task.</strong></span></p></li></ol></div></div><div class="task" title="To Add Users to GlassFish From the Command Line"><a name="gfrgr"></a><p class="title"><b>To Add Users to GlassFish From the Command Line</b></p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Make sure GlassFish is
                        running, then type the following command: </strong></span>
                        </p><pre class="programlisting"><span class="bold"><strong><span class="emphasis"><em>as-install</em></span>/bin/asadmin create-file-user --groups wsit wsitUser</strong></span></pre></li><li class="step" title="Step 2"><p><span class="bold"><strong> When you are prompted for
                        the password, type <code class="code">changeit</code> .
                        </strong></span></p></li></ol></div></div></div></div><div class="section" title="12.5.&nbsp;Configuring Keystores and Truststores"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahidm"></a>12.5.&nbsp;Configuring Keystores and Truststores</h2></div></div></div><p>This section describes configuring keystores and truststores.
        Security mechanisms that use certificates require keystore and
        truststore files for deployment.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>For GlassFish, default keystore and truststore files
                come bundled. However, WSIT security mechanisms for
                <span class="emphasis"><em>message</em></span> security require X.509 version 3
                certificates. GlassFish contains version 1 certificates.
                Therefore, to enable the WSIT applications to run on
                GlassFish, you will need to follow the instructions in <a class="xref" href="#gfrgz" title="To Manually Update GlassFish Certificates">To Manually Update GlassFish Certificates</a> .</p></li><li class="listitem"><p>For Tomcat, keystore and truststore files do not come
                bundled with this container, so they must be provided. You can
                download valid keystore and truststore files for the client
                and server from <a class="link" href="http://xwss.java.net/" target="_top">http://xwss.java.net/</a>
                .</p></li></ul></div><p>This section covers the following topics:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#gfxyu" title="To Automatically Update GlassFish Certificates">To Automatically Update GlassFish Certificates</a></p></li><li class="listitem"><p><a class="xref" href="#gfrgz" title="To Manually Update GlassFish Certificates">To Manually Update GlassFish Certificates</a></p></li><li class="listitem"><p><a class="xref" href="#ahido" title="12.5.1.&nbsp;Specifying Aliases with the Updated Stores">Specifying Aliases with the Updated Stores</a></p></li><li class="listitem"><p><a class="xref" href="#ahidr" title="12.5.2.&nbsp;Configuring the Keystore and Truststore">Configuring the Keystore and Truststore</a></p></li><li class="listitem"><p><a class="xref" href="#ahidx" title="12.5.3.&nbsp;Configuring Validators">Configuring Validators</a></p></li></ul></div><div class="task" title="To Automatically Update GlassFish Certificates"><a name="gfxyu"></a><p class="title"><b>To Automatically Update GlassFish Certificates</b></p><div class="tasksummary">
                <p>You can have NetBeans automatically update the GlassFish
                certificates to the version needed to work with message
                security. To do this, follow these steps:</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> In NetBeans IDE, right-click
                    the web service, select Edit Web Service Attributes.
                    </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Secure
                    Service.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Select Use Development
                    Defaults.</strong></span></p><p>This option imports certificates into the GlassFish
                    keystore and truststore so that they can be used
                    immediately for development.</p><p>In a production environment, you should provide your
                    own certificates and user settings, however, in a
                    development environment you may find these defaults
                    useful.</p></li></ol></div></div><div class="task" title="To Manually Update GlassFish Certificates"><a name="gfrgz"></a><p class="title"><b>To Manually Update GlassFish Certificates</b></p><div class="tasksummary">
                <p>The WSIT message security mechanisms require the use of
                v3 certificates. The default GlassFish keystore and truststore
                Unhandled tag varname do not contain v3 certificates at this
                time (but should before FCS). (GlassFish instances installed
                using JDK 1.6 do have a v3 certificate but the certificate
                lacks a particular extension required for supporting some
                secure WSIT mechanisms.) In order to use message security
                mechanisms with GlassFish, it is necessary to download
                keystore and truststore files that contain v3 certificates and
                import the appropriate certificates into the default GlassFish
                stores.</p>

                <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The XWSS keystores are <span class="emphasis"><em>sample</em></span>
                    keystores containing sample v3 certificates. These sample
                    keystores can be used for development and testing of
                    security with WSIT technology. Once an application is in
                    production, you should definitely use your own v3
                    certificates issued by a trusted authority. In order to
                    use WSIT security on GlassFish, you will have to import
                    your trusted stores into GlassFish's keystore and specify
                    those certificates from NetBeans IDE.</p></div>

                <p>To manually update the GlassFish certificates, follow
                these steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Download the zip file that
                    contains the certificates and the Ant scripts (
                    <code class="code">copyv3.zip</code> ) by going to this URL:
                    </strong></span></p><p><a class="link" href="https://xwss.java.net/servlets/ProjectDocumentList?folderID=6645&amp;expandFolder=6645&amp;folderID=6645" target="_top">https://xwss.java.net/servlets/ProjectDocumentList?folderID=6645&amp;expandFolder=6645&amp;folderID=6645</a></p></li><li class="step" title="Step 2"><p><span class="bold"><strong> Unzip this file and change
                    into its directory, <code class="code">copyv3</code> .
                    </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Set the variable to the
                    location where GlassFish is installed, as described in the
                    <code class="code">README.txt</code> file in this directory.
                    </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> From the <code class="code">copyv3</code>
                    directory, execute the Ant command that will copy the
                    keystore and truststore files to the appropriate location,
                    and import the appropriate certificates into the GlassFish
                    keystore and truststore. </strong></span></p><p>This Ant command is as follows:</p><pre class="programlisting"><span class="bold"><strong><span class="emphasis"><em>as-install</em></span>/lib/ant/bin/ant</strong></span></pre><p>The command window will echo back the certificates
                    that are being added to the keystore and truststore files,
                    and should look something like this:</p><pre class="programlisting">[echo] WARNING: currently we add non-CA certs to GF truststore, this
will not be required in later releases when WSIT starts supporting CertStore(s)
[java] Added Key Entry  :xws-security-server
[java] Added Key Entry  :xws-security-client
[java] Added Trusted Entry  :xwss-certificate-authority
[java] Added Key Entry  :wssip
[java] Added Trusted Entry  :xws-security-client
[java] Added Trusted Entry  :xws-security-server
[java] Added Trusted Entry  :wssip
[echo] Adding JVM Option for https outbound alias, this will take at least
One Minute.
...</pre></li><li class="step" title="Step 5"><p><span class="bold"><strong> To verify that the updates
                    were successful, follow these steps: </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 5.a"><p><span class="bold"><strong> Change to the directory
                            containing the GlassFish keystore and truststore
                            files, <code class="code"> as-install /domains/domain1/config
                            </code> . </strong></span></p></li><li class="step" title="Step 5.b"><p><span class="bold"><strong> Verify that the v3
                            certificate has been imported into the GlassFish
                            truststore. To do this, run the following
                            <code class="code">keytool</code> command (all on one line):
                            </strong></span></p><pre class="programlisting"><span class="bold"><strong><span class="emphasis"><em>java-home</em></span>/bin/keytool -list -keystore cacerts.jks -alias wssip -storepass changeit</strong></span></pre><p>If the certificates are
                            <span class="emphasis"><em>successfully</em></span> updated, your
                            response will look something like this:</p><pre class="programlisting">wssip, Aug 20, 2007, trustedCertEntry,
Certificate fingerprint (MD5): 1A:0E:E9:69:7D:D0:80:AD:5C:85:47:91:EB:0D:11:B1</pre><p>If the certificates were
                            <span class="emphasis"><em>not</em></span> successfully update, your
                            response will look something like this:</p><pre class="programlisting">keytool error: java.lang.Exception: Alias &lt;wssip&gt; does not exist</pre></li><li class="step" title="Step 5.c"><p><span class="bold"><strong> Verify that the v3
                            certificate has been imported into the GlassFish
                            keystore. To do this, run the following
                            <code class="code">keytool</code> commands: </strong></span></p><pre class="programlisting"><span class="bold"><strong><span class="emphasis"><em>java-home</em></span>/bin/keytool -list -keystore keystore.jks
-alias xws-security-server -storepass changeit
<span class="emphasis"><em>java-home</em></span>/bin/keytool -list -keystore keystore.jks
-alias xws-security-client -storepass changeit</strong></span></pre><p>If the certificates were
                            <span class="emphasis"><em>successfully</em></span> updated, your
                            response should look something like this:</p><pre class="programlisting">xws-security-server, Aug 20, 2007, PrivateKeyEntry,
Certificate fingerprint (MD5): E4:E3:A9:02:3C:B0:36:0C:C1:48:6E:0E:3E:5C:5E:84</pre><p>If your certificates were
                            <span class="emphasis"><em>not</em></span> successfully updated, your
                            response will look more like this:</p><pre class="programlisting">keytool error: java.lang.Exception: Alias &lt;xws-security-server&gt; does not exist</pre></li></ol></li></ol></div></div><div class="section" title="12.5.1.&nbsp;Specifying Aliases with the Updated Stores"><div class="titlepage"><div><div><h3 class="title"><a name="ahido"></a>12.5.1.&nbsp;Specifying Aliases with the Updated Stores</h3></div></div></div><p>The configuration of the aliases for all containers (Tomcat,
            GlassFish) and for all applications (JSR-109-compliant and
            non-JSR-109-compliant), except for applications that use a
            Security Token Service (STS) mechanism, is as shown in <a class="xref" href="#ahidp" title="Table&nbsp;12.3.&nbsp;Keystore and Truststore Aliases">Keystore and Truststore Aliases</a> .</p><div class="table"><a name="ahidp"></a><p class="title"><b>Table&nbsp;12.3.&nbsp;Keystore and Truststore Aliases</b></p><div class="table-contents"><table summary="Keystore and Truststore Aliases" border="1"><colgroup><col><col><col></colgroup><thead><tr><th><p></p></th><th><p>Keystore Alias</p></th><th><p>Truststore Alias</p></th></tr></thead><tbody><tr><td><p>Client-Side
                            Configuration</p></td><td><p>xws-security-client</p></td><td><p>xws-security-server</p></td></tr><tr><td><p>Server-Side
                            Configuration</p></td><td><p>xws-security-server</p></td><td><p>xws-security-client</p></td></tr></tbody></table></div></div><br class="table-break"><p>The configuration of the aliases for applications that use a
            Security Token Service (STS) mechanism is as shown in <a class="xref" href="#ahidq" title="Table&nbsp;12.4.&nbsp;Keystore and Truststore Aliases for STS">Keystore and Truststore Aliases for STS</a> .</p><div class="table"><a name="ahidq"></a><p class="title"><b>Table&nbsp;12.4.&nbsp;Keystore and Truststore Aliases for STS</b></p><div class="table-contents"><table summary="Keystore and Truststore Aliases for STS" border="1"><colgroup><col><col><col></colgroup><thead><tr><th><p></p></th><th><p>Keystore Alias</p></th><th><p>Truststore Alias</p></th></tr></thead><tbody><tr><td><p>Client-Side
                            Configuration</p></td><td><p>xws-security-client</p></td><td><p>xws-security-server</p></td></tr><tr><td><p>STS Configuration</p></td><td><p>xws-security-client</p></td><td><p>wssip</p></td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" title="12.5.2.&nbsp;Configuring the Keystore and Truststore"><div class="titlepage"><div><div><h3 class="title"><a name="ahidr"></a>12.5.2.&nbsp;Configuring the Keystore and Truststore</h3></div></div></div><p>NetBeans IDE already knows the location of the default
            keystore file and its password, but you need to specify which
            alias is to be used. The following sections discuss configuring
            the keystore on the service and on the client.</p><div class="task" title="To Configure the Keystore on a Service Automatically"><a name="gfxzl"></a><p class="title"><b>To Configure the Keystore on a Service
                Automatically</b></p><div class="tasksummary">
                    <p>To have NetBeans IDE configure the keystore to its
                    default values, follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> In NetBeans IDE,
                        right-click the web service, select Edit Web Service
                        Attributes. </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Select Use Development
                        Defaults.</strong></span></p><p>This option imports certificates into the
                        GlassFish keystore and truststore so that they can be
                        used immediately for development. This option also
                        inserts the location and alias of the keystore and
                        truststore files into the configuration file.</p><p>In a production environment, you should provide
                        your own certificates and user settings, however, in a
                        development environment you may find these defaults
                        useful.</p></li></ol></div></div><div class="task" title="To Configure the Keystore on a Service Manually"><a name="gfril"></a><p class="title"><b>To Configure the Keystore on a Service Manually</b></p><div class="tasksummary">
                    <p>A keystore is a database of private keys and their
                    associated X.509 certificate chains authenticating the
                    corresponding public keys. A key is a piece of information
                    that controls the operation of a cryptographic algorithm.
                    For example, in encryption, a key specifies the particular
                    transformation of plaintext into ciphertext, or vice versa
                    during decryption. Keys are used in digital signatures for
                    authentication.</p>

                    <p>To configure a keystore on a service, perform the
                    following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Check the table in <a class="xref" href="#ahicn" title="12.2.1.&nbsp;Summary of Service-Side Configuration Requirements">Summary of Service-Side Configuration Requirements</a> to see if
                        a keystore needs to be configured for the selected
                        security mechanism. If so, continue.
                        </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong> Right-click the web
                        service and select Edit Web Service Attributes.
                        </strong></span></p><p>The Web Service Attributes editor is
                        displayed.</p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Enable Secure Service,
                        then select a security mechanism.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Check the table in <a class="xref" href="#ahicn" title="12.2.1.&nbsp;Summary of Service-Side Configuration Requirements">Summary of Service-Side Configuration Requirements</a> to see
                        what keystore configuration, if any, is required for
                        that mechanism. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Unselect Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Click the Keystore
                        button. The dialog shown in <a class="xref" href="#ahidt" title="Figure&nbsp;12.5.&nbsp;Keystore Configuration Dialog">Keystore Configuration Dialog</a> displays. </strong></span>
                        </p><div class="figure"><a name="ahidt"></a><p class="title"><b>Figure&nbsp;12.5.&nbsp;Keystore Configuration Dialog</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/security-keystore-configuration.png" height="360" alt="Keystore Configuration Dialog"></td></tr></table></div></div></div><p><br class="figure-break"></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Depending on what is
                        required for the selected mechanism, you may specify
                        the following information in the Keystore
                        Configuration dialog: </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 7.1"><p><span class="emphasis"><em>Keystore Password</em></span> :
                                Specifies the password for the keystore file. If you
                                are running under GlassFish, GlassFish's password is
                                already entered. If you have changed the keystore's
                                password from the default, you must specify the
                                correct value in this field.</p></li>

                            <li class="step" title="Step 7.2"><p><span class="emphasis"><em>Load Aliases</em></span> : Click the
                                Load Aliases button to populate the Alias field with
                                the aliases contained in the keystore file. The
                                Location and Store Password fields must be specified
                                correctly for this option to work.</p></li>

                            <li class="step" title="Step 7.3"><p><span class="emphasis"><em>Alias</em></span> : Specifies the
                                alias of the certificate in the specified keystore
                                to be used for authentication. Refer to the table in
                                <a class="xref" href="#ahido" title="12.5.1.&nbsp;Specifying Aliases with the Updated Stores">Specifying Aliases with the Updated Stores</a> to
                                determine which alias to choose for the selected
                                security mechanism.</p></li>

                            <li class="step" title="Step 7.4"><p><span class="emphasis"><em>Key Password</em></span> : Specifies
                                the password of the key within the keystore. For
                                this sample, leave this blank. For this field, the
                                default assumes the key password is the same as the
                                store password, so you only need to specify this
                                field when the key password is different.</p></li>
                        </ul><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The Key Password field enables you to specify
                            a password for the keystore used by the application.
                            When specified, this password is stored in a WSIT
                            configuration file in clear text, which is a
                            security risk. Setting the keystore password in the
                            development environment is fine, however, when you
                            go into production, remember to use the container's
                            Callback Handler to obtain the keys from the
                            keystore. This eliminates the need for the keystore
                            passwords to be supplied by the users. You can also
                            specify the passwords for keystores and truststores
                            by specifying a Callback Handler class that
                            implements the
                            <code class="code">javax.security.auth.callback.CallbackHandler</code>
                            interface in the Key Password or Store Password
                            fields.</p></div><p>When creating JSR-109-compliant application,
                        GlassFish will only use the default CallbackHandlers
                        and Validators, and you cannot override the location
                        of the keystore and truststore files. Any attempt to
                        override the default location will be ignored. You do,
                        however, need to specify the keystore and truststore
                        locations in these dialogs in order to specify the
                        alias.</p><p>When creating non-JSR-109-compliant application,
                        you can specify the passwords for keystores and
                        truststores by specifying a
                        <code class="code">CallbackHandler</code> class that implements the
                        <code class="code">javax.security.auth.callback.CallbackHandler</code>
                        interface in the Key Password or Store Password
                        fields.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong>Click OK to close the
                        dialog.</strong></span></p></li></ol></div></div><div class="task" title="To Configure the Truststore on a Service Automatically"><a name="gfxyn"></a><p class="title"><b>To Configure the Truststore on a Service
                Automatically</b></p><div class="tasksummary">
                    <p>To have NetBeans IDE configure the truststore to its
                    default values, follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> In NetBeans IDE,
                        right-click the web service, select Edit Web Service
                        Attributes. </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Select Use Development
                        Defaults.</strong></span></p><p>This option imports certificates into the
                        GlassFish keystore and truststore so that they can be
                        used immediately for development. This option also
                        inserts the location and alias of the keystore and
                        truststore files into the configuration file, when
                        required for a selected security mechanism.</p><p>In a production environment, you should provide
                        your own certificates and user settings, however, in a
                        development environment you may find these defaults
                        useful.</p></li></ol></div></div><div class="task" title="To Configure the Truststore on a Service Manually"><a name="gfrgu"></a><p class="title"><b>To Configure the Truststore on a Service
                Manually</b></p><div class="tasksummary">
                    <p>A truststore is a database of trusted entities and
                    their associated X.509 certificate chains authenticating
                    the corresponding public keys.</p>

                    <p>The truststore contains the Certificate Authority
                    (CA) certificates and the certificates of the other party
                    to which this entity intends to send encrypted
                    (confidential) data. This file must contain the public key
                    certificates of the CA and the client's public key
                    certificate. Any kind of encryption without
                    WS-SecureConversation will generally require that a
                    truststore be configured on the client side. Any kind of
                    signature without WS-SecureConversation will generally
                    require a truststore on the server side.</p>

                    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>For this release, place the trusted certificates
                        of other parties in GlassFish's truststore,
                        <code class="code">cacerts.jks</code> . This is not normally a
                        recommended practice because any certificate you add
                        to the <code class="code">cacerts.jks</code> file effectively means
                        it can be a trusted root for any and all certificate
                        chains, which can be a security problem. In future
                        releases, trusted certificates from other parties will
                        be placed in a certstore, and only trusted roots will
                        be placed inside <code class="code">cacerts.jks</code> .</p></div>

                    <p>To set the truststore configuration options on a
                    service, perform the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Check the table in <a class="xref" href="#ahicn" title="12.2.1.&nbsp;Summary of Service-Side Configuration Requirements">Summary of Service-Side Configuration Requirements</a> to see if
                        a truststore is required for the selected security
                        mechanism. If so, continue. </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong> Right-click the web
                        service and select Edit Web Service Attributes.
                        </strong></span></p><p>The Web Service Attributes editor is
                        displayed.</p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Enable Secure
                        Service.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Unselect Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Click the Truststore
                        button.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> On the Truststore
                        Configuration page, specify the following options:
                        </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 6.1"><p><span class="emphasis"><em>Location</em></span> : By default,
                                the location and name of the truststore that stores
                                the public key certificates of the CA and the
                                client's public key certificate is already entered.
                                The GlassFish truststore file is <code class="code">as-install
                                /domains/domain1/config/cacerts.jks</code>.</p></li>

                            <li class="step" title="Step 6.2"><p><span class="emphasis"><em>Store Password</em></span> :
                                Specifies the password for the truststore. If you
                                are using GlassFish, the value of
                                <code class="code">changeit</code> is already entered. If you
                                have changed the value of the truststore password,
                                you must type the new value in this field.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The Store Password field enables you to
                                    specify a password for the truststore used by the
                                    application. When specified, this password is stored
                                    in a WSIT configuration file in clear text, which is
                                    a security risk. Setting the truststore password in
                                    the development environment is fine, however, when
                                    you go into production, remember to use the
                                    container's Callback Handler to obtain the keys from
                                    the truststore. This eliminates the need for the
                                    truststore passwords to be supplied by the users.
                                    You can also specify the passwords for keystores and
                                    truststores by specifying a CallbackHandler class
                                    that implements the
                                    <code class="code">javax.security.auth.callback.CallbackHandler</code>
                                    interface in the Key Password or Store Password
                                    fields.</p><p>When creating JSR-109-compliant application,
                                    GlassFish will only use the default CallbackHandlers
                                    and Validators, and you cannot override the location
                                    of the keystore and truststore files. Any attempt to
                                    override the default location will be ignored. You
                                    do, however, need to specify the keystore and
                                    truststore locations in these dialogs in order to
                                    specify the alias.</p></div></li>

                            <li class="step" title="Step 6.3"><p><span class="emphasis"><em>Load Aliases</em></span> : Click the
                                Load Aliases button to populate the Alias field with
                                the aliases contained in the truststore file. The
                                Location and Store Password fields must be specified
                                correctly for this option to work.</p></li>

                            <li class="step" title="Step 6.4"><p><span class="emphasis"><em>Alias</em></span> : Unhandled tag tip
                                Specifies the peer alias of the certificate in the
                                truststore that is to be used when the client needs
                                to send encrypted data. Refer to the table in <a class="xref" href="#ahido" title="12.5.1.&nbsp;Specifying Aliases with the Updated Stores">Specifying Aliases with the Updated Stores</a> to
                                determine which alias is appropriate for the
                                selected security mechanism. A truststore contains
                                trusted other-party certificates and certificates of
                                Certificate Authorities (CA). A peer alias is the
                                alias of the other party (peer) that the sending
                                party needs to use to encrypt the request.</p></li>
                        </ul></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click OK to close the
                        dialog.</strong></span></p></li></ol></div></div><div class="task" title="To Configure the Keystore and Truststore on a Client"><a name="gfrgh"></a><p class="title"><b>To Configure the Keystore and Truststore on a
                Client</b></p><div class="tasksummary">
                    <p>On the client side, a keystore and truststore file
                    must be configured for some of the security mechanisms.
                    Refer to the table in <a class="xref" href="#ahicp" title="12.2.2.&nbsp;Summary of Client-Side Configuration Requirements">Summary of Client-Side Configuration Requirements</a> for information on which
                    mechanisms require the configuration of keystores and
                    truststores.</p>

                    <p>If the mechanism configured for the service requires
                    the configuration of keystores and truststores, follow
                    these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Check the table in <a class="xref" href="#ahicp" title="12.2.2.&nbsp;Summary of Client-Side Configuration Requirements">Summary of Client-Side Configuration Requirements</a> to see if
                        a keystore needs to be configured for the client for
                        the selected security mechanism. If so, continue.
                        </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong> In the Projects window,
                        expand the node for the web service client.
                        </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Expand the Web Service
                        References node.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Right-click the node for
                        the web service reference for which you want to
                        configure security options. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Edit Web Service
                        Attributes.</strong></span></p><p>When the Web Service References Attributes
                        Editor is opened, select the Quality of Service tab to
                        display the WSIT Security options.</p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Click Keystore or
                        Truststore to specify the keystore or truststore
                        information if required by the service.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Depending on what is
                        required for the selected mechanism, you may specify
                        the following information: </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 7.1"><p><span class="emphasis"><em>Keystore Location</em></span> : The
                                directory and file name containing the certificate
                                key to be used to authenticate the client. By
                                default, the location is already set to the default
                                GlassFish keystore, <code class="code"> as-install
                                /domains/domain1/config/keystore.jks </code>
                                .</p></li>

                            <li class="step" title="Step 7.2"><p><span class="emphasis"><em>Keystore Password</em></span> : The
                                password for the keystore used by the client. By
                                default, the password for the GlassFish keystore is
                                already entered. This password is
                                <code class="code">changeit</code> .</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>When specified, this password is stored in a
                                    WSIT configuration file in clear text. Setting the
                                    keystore password in the development environment is
                                    fine, however, when you go into production, remember
                                    to use the container's default
                                    <code class="code">CallbackHandler</code> to obtain the keys from
                                    the keystore. This eliminates the need for the
                                    keystore passwords to be supplied by the users. You
                                    can also specify the passwords for keystores and
                                    truststores by specifying a
                                    <code class="code">CallbackHandler</code> class that implements
                                    the
                                    <code class="code">javax.security.auth.callback.CallbackHandler</code>
                                    interface in the Keystore Password, Truststore
                                    Password, or Key Password fields.</p></div></li>

                            <li class="step" title="Step 7.3"><p><span class="emphasis"><em>Load Aliases</em></span> : Click this
                                button to populate the Alias list with all of the
                                certificates available in the selected keystore.
                                This option will only work if the keystore location
                                and password are correct.</p></li>

                            <li class="step" title="Step 7.4"><p><span class="emphasis"><em>Keystore Alias</em></span> : Select
                                the alias in the keystore. Refer to the table in
                                <a class="xref" href="#ahido" title="12.5.1.&nbsp;Specifying Aliases with the Updated Stores">Specifying Aliases with the Updated Stores</a> to
                                determine which alias is appropriate for the
                                selected security mechanism.</p></li>

                            <li class="step" title="Step 7.5"><p><span class="emphasis"><em>Key Password</em></span> : If the
                                client key has been password-protected, type the
                                password for this key. The GlassFish certificate key
                                password is <code class="code">changeit</code> .</p></li>

                            <li class="step" title="Step 7.6"><p><span class="emphasis"><em>Truststore Location</em></span> : The
                                directory and file name of the client truststore
                                containing the certificate of the server. By
                                default, this field points to the default GlassFish
                                truststore, <code class="code"> as-install
                                /domains/domain1/config/cacerts.jks</code>.</p></li>

                            <li class="step" title="Step 7.7"><p><span class="emphasis"><em>Truststore Password</em></span> : The
                                password for the truststore used by the client. By
                                default, the password for the GlassFish truststore
                                is already specified. The password is
                                <code class="code">changeit</code> .</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>When specified, this password is stored in a
                                    WSIT configuration file in clear text. Setting the
                                    truststore password in the development environment
                                    is fine; however, when you go into production,
                                    remember to use the container's default
                                    <code class="code">CallbackHandler</code> to obtain the keys from
                                    the keystore. This eliminates the need for the
                                    keystore passwords to be supplied by the users. You
                                    can also specify the passwords for keystores and
                                    truststores by specifying a
                                    <code class="code">CallbackHandler</code> class that implements
                                    the
                                    <code class="code">javax.security.auth.callback.CallbackHandler</code>
                                    interface in the Keystore Password, Truststore
                                    Password, or Key Password fields.</p></div></li>

                            <li class="step" title="Step 7.8"><p><span class="emphasis"><em>Load Aliases</em></span> : Click this
                                button to populate the Alias list with all of the
                                certificates available in the selected keystore.
                                This option will only work if the truststore
                                location and password are correct.</p></li>

                            <li class="step" title="Step 7.9"><p><span class="emphasis"><em>Truststore Alias</em></span> : Select
                                the alias of the server certificate and private key
                                in the client truststore. Refer to the table in
                                <a class="xref" href="#ahido" title="12.5.1.&nbsp;Specifying Aliases with the Updated Stores">Specifying Aliases with the Updated Stores</a> to
                                determine which alias is appropriate for the
                                selected security mechanism.</p></li>
                        </ul></li><li class="step" title="Step 8"><p><span class="bold"><strong>Click OK to close the
                        dialog.</strong></span></p></li></ol></div></div></div><div class="section" title="12.5.3.&nbsp;Configuring Validators"><div class="titlepage"><div><div><h3 class="title"><a name="ahidx"></a>12.5.3.&nbsp;Configuring Validators</h3></div></div></div><p>A validator is an optional set of classes used to check the
            validity of a token, a certificate, a timestamp, or a username and
            password. The Validators button will be enabled when all of the
            following are true:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Security is enabled for the service.</p></li><li class="listitem"><p>Target server for the service is not
                    GlassFish.</p></li><li class="listitem"><p>Development defaults are disabled.</p></li><li class="listitem"><p>Security profile for the service is not one of the
                    three STS based profiles.</p></li></ul></div><p>Applications that run under a GlassFish 9.1 or higher
            container do not need to configure Callback Handlers and
            Validators when using the IDE with WSIT enabled. This is because
            the container handles the callbacks and validation. You only need
            to make sure that the certificates are available at locations that
            GlassFish requires and/or create authorized users using the Admin
            Console (described in <a class="xref" href="#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a> .</p><p>Validators are always optional because there are defaults in
            the runtime (regardless of the container and regardless of whether
            the application is a JSR-109 or a non-JSR-109 deployment.) For
            non-JSR-109 deployment, you only need to specify a validator when
            you want to override the default validators. For JSR-109
            deployments, there is no point in specifying an overriding
            validator, as these will be overridden back to the defaults by
            GlassFish, thus the Validators button is not available when the
            selected web service is a JSR-109-compliant application.</p><div class="task" title="To Set Validator Configuration Options"><a name="gfrhe"></a><p class="title"><b>To Set Validator Configuration Options</b></p><div class="tasksummary">
                    <p>To set the validator configuration options for a
                    non-JSR-109-compliant application (such as a J2SE client),
                    perform the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Right-click the web
                        service and select Edit Web Service Attributes.
                        </strong></span></p><p>The Web Service Attributes editor is
                        displayed.</p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Enable Secure
                        Service.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Unselect Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Click the Validator
                        button.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> On the Validator
                        Configuration page, specify the following options,
                        when necessary: </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 5.1"><p><span class="emphasis"><em> Username Validator </em></span> :
                                Specifies the validator class to be used to validate
                                username and password on the server side. This
                                option is only used by a web service.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>When using the default Username Validator,
                                    make sure that the username and password of the
                                    client are registered with GlassFish (using Admin
                                    Console, described in <a class="xref" href="#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a> ) if using GlassFish, or
                                    is included in the <code class="code">tomcat-users.xml</code>
                                    file if using Tomcat.</p></div></li>

                            <li class="step" title="Step 5.2"><p><span class="emphasis"><em>Timestamp Validator</em></span> :
                                Specifies the validator class to be used to check
                                the token timestamp to determine whether the token
                                has expired or is still valid.</p></li>

                            <li class="step" title="Step 5.3"><p><span class="emphasis"><em> Certificate Validator </em></span> :
                                Specifies the validator class to be used to validate
                                the certificate supplied by the client or the web
                                service.</p></li>

                            <li class="step" title="Step 5.4"><p><span class="emphasis"><em> SAML Validator: </em></span>
                                Specifies the validator class to be used to validate
                                SAML token supplied by the client or the web
                                service.</p></li>
                        </ul></li><li class="step" title="Step 6"><p><span class="bold"><strong>Click OK to close the
                        dialog.</strong></span></p></li></ol></div></div></div></div><div class="section" title="12.6.&nbsp;Configuring Kerberos for Glassfish and Tomcat"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ConfiguringKerberos"></a>12.6.&nbsp;Configuring Kerberos for Glassfish and Tomcat</h2></div></div></div><p>This section explains how to setup Glassfish or Tomcat to use
        Kerberos Authentication. It assumes that the underlying infrastructure
        has Kerberos Authentication available. If you need information on how
        to setup Kerberos in Solaris or Ubuntu Linux environments, refer to
        the following links: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="link" href="http://blogs.sun.com/tdh/entry/installing_a_kerberos_kdc_and" target="_top">Solaris
                    10: Installing a Kerberos KDC</a></p></li><li class="listitem"><p><a class="link" href="http://www.alittletooquiet.net/text/kerberos-on-ubuntu/" target="_top">Ubuntu
                    Linux: Kerberos On Ubuntu</a></p></li></ul></div><p>Note that in a Windows environment you can set up a Kerberos KDC
        only on Window Server editions 2000, 2003 and 2008. The KDC is bundled
        in these editions with its own Kerberos implementation as part of
        Active Directory. You can not install MIT Kerberos KDC on Windows. A
        Windows XP/Vista system can act as a client of the Windows Server
        editions KDC. Alternatively, you can install a client module of MIT
        Kerberos for Windows -- see <a class="link" href="http://web.mit.edu/Kerberos/kfw-3.2/kfw-3.2.2.html" target="_top">Kerberos
        for Windows Release 3.2.2</a>.You can then use the client module to
        authenticate against a KDC that was set up on a UNIX system.</p><div class="section" title="12.6.1.&nbsp;For Glassfish"><div class="titlepage"><div><div><h3 class="title"><a name="KerberosForGlassfish"></a>12.6.1.&nbsp;For Glassfish</h3></div></div></div><p>Specify the JAAS login modules to be used for Kerberos in
            the $GLASSFISH_HOME/domains/domain1/config/login.conf file, as
            follows: </p><pre class="programlisting">KerberosClient {
    com.sun.security.auth.module.Krb5LoginModule required
    useTicketCache=true;
}

KerberosServer {
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true keyTab="/etc/krb5.keytab"
    doNotPrompt=true storeKey=true
    principal="websvc/service@INDIA.SUN.LOCAL";
}</pre><p>You can give any names to the login modules, that is,
            instead of KerberosClient and KerberosServer. You need to refer to
            these names in the &lt;sc:KerberosConfig&gt; assertion in the WSDL
            file and in the wsit-client.xml file.</p><p>Also edit the principal in
            <span class="emphasis"><em>KerberosServer</em></span> to the
            <span class="emphasis"><em>service_principal</em></span> that you created, and
            specify the correct location of <span class="emphasis"><em>krb5.keytab</em></span>
            file.</p></div><div class="section" title="12.6.2.&nbsp;For Tomcat"><div class="titlepage"><div><div><h3 class="title"><a name="KerberosForTomcat"></a>12.6.2.&nbsp;For Tomcat</h3></div></div></div><p>Glassfish picks the login modules from
            $GLASSFISH_HOME/domains/domain1/config/login.conf. In Tomcat we
            need to specify the file explicitly using
            java.security.auth.login.config system property. Here are the
            steps:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Create a file jaas.conf , and place it in
                    $CATALINA_HOME/conf. Here's what jaas.conf looks like:
                    </p><pre class="programlisting">KerberosClient {
    com.sun.security.auth.module.Krb5LoginModule required
    useTicketCache=true;
};
KerberosServer {
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true keyTab="/etc/krb5.keytab"
    doNotPrompt=true storeKey=true
    principal="websvc/service@INDIA.SUN.COM";
};</pre></li><li class="listitem"><p>Add following line to the catalina.sh script (or
                    specify the mentioned JAVA_OPTS property):
                    </p><pre class="programlisting">JAVA_OPTS="$JAVA_OPTS "-Djava.security.auth.login.config=$CATALINA_HOME/conf/jaas.conf</pre></li><li class="listitem"><p>Specify the following system property in your client
                    code: </p><pre class="programlisting">-Djava.security.policy=${tomcat.home}/conf/catalina.policy
-Djava.security.auth.login.config=${tomcat.home}/conf/jaas.conf</pre></li></ul></div></div></div><div class="section" title="12.7.&nbsp;Securing Operations and Messages"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahidy"></a>12.7.&nbsp;Securing Operations and Messages</h2></div></div></div><p>This section explains how to specify security mechanisms at the
        operation level and at the message level.</p><p>You can specify security mechanisms at the following
        levels:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Operation</em></span></p><p>At times, you may need to configure different operations
                with different supporting tokens. You may wish to configure
                security at the operation level, for example, in the situation
                where only one operation requires a UsernameToken to be passed
                and the rest of the operations do not require this, or in the
                situation where only one operation needs to be endorsed by a
                special token and the others do not.</p></li><li class="listitem"><p><span class="emphasis"><em> Input Message and Output Message
                </em></span></p><p>Security mechanisms at this level are used to specify
                what is being protected and the level of protection
                required.</p><p>In this section, you can specify parts of a message that
                require integrity protection (digital signature) and/or
                confidentiality (encryption). When you do this, the specified
                part of the message, outside of security headers, requires
                signature and/or encryption. For example, a message producer
                might submit an order that contains an <code class="code">orderID</code>
                header. The producer signs and/or encrypts the
                <code class="code">orderID</code> header (the SOAP message header) and the
                body of the request (the SOAP message body). Parts that can be
                signed and/or encrypted include the body, the header, the
                local name of the SOAP header, and the namespace of the SOAP
                header.</p><p>You can also specify arbitrary elements in the message
                that require integrity protection and/or confidentiality.
                Because of the mutability of some SOAP headers, a message
                producer may decide not to sign and/or encrypt the SOAP
                message header or body as a whole, but instead sign and/or
                encrypt elements within the header and body. Elements that can
                be signed and/or encrypted include an XPath expression or a
                URI which indicates the version of XPath to use.</p></li></ul></div><p>This section covers the following topics:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#gfrhv" title="To Specify Security at the Operation, Input Message, or Output Message Level">To Specify Security at the Operation, Input Message, or
            Output Message Level</a></p></li><li class="listitem"><p><a class="xref" href="#ahiea" title="12.7.1.&nbsp;Supporting Token Options">Supporting Token Options</a></p></li></ul></div><div class="task" title="To Specify Security at the Operation, Input Message, or Output Message Level"><a name="gfrhv"></a><p class="title"><b>To Specify Security at the Operation, Input Message, or
            Output Message Level</b></p><div class="tasksummary">
                <p>To specify security mechanisms at the level of the
                operation, input message, or output message, perform the
                following steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Right-click the web service
                    and select Web Service Attributes.</strong></span></p><p>The Web Service Attributes editor is
                    displayed.</p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Secure
                    Service.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Select a security
                    mechanism.</strong></span></p><p>The following mechanisms do not support Input
                    message level protection:</p><ul class="stepalternatives">
                        <li class="step" title="Step 3.1"><p><a class="xref" href="#ahicv" title="12.3.1.&nbsp;Username Authentication with Symmetric Key">Username Authentication with Symmetric Key</a></p></li>

                        <li class="step" title="Step 3.2"><p><a class="xref" href="#ahicv1" title="12.3.2.&nbsp;Username Authentication with Password Derived Keys">Username Authentication with Password Derived Keys</a></p></li>

                        <li class="step" title="Step 3.3"><p><a class="xref" href="#ahicx" title="12.3.5.&nbsp;Transport Security (SSL)">Transport Security (SSL)</a></p></li>

                        <li class="step" title="Step 3.4"><p><a class="xref" href="#ahicz" title="12.3.6.&nbsp;Message Authentication over SSL">Message Authentication over SSL</a></p></li>

                        <li class="step" title="Step 3.5"><p><a class="xref" href="#ahida" title="12.3.7.&nbsp;SAML Authorization over SSL">SAML Authorization over SSL</a></p></li>

                        <li class="step" title="Step 3.6"><p><a class="xref" href="#ahidc" title="12.3.9.&nbsp;SAML Sender Vouches with Certificates">SAML Sender Vouches with Certificates</a></p></li>
                    </ul></li><li class="step" title="Step 4"><p><span class="bold"><strong> Expand the
                    <span class="emphasis"><em>operation</em></span> Operation node (for
                    example, the <code class="code">add Operation</code> node.) It should
                    look like <a class="xref" href="#gfrgy" title="Figure&nbsp;12.6.&nbsp;Web Service Attributes Editor Page: Operation Level">Web Service Attributes Editor Page: Operation
                            Level</a>. </strong></span> </p><div class="figure"><a name="gfrgy"></a><p class="title"><b>Figure&nbsp;12.6.&nbsp;Web Service Attributes Editor Page: Operation
                            Level</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/security-operation-level.png" height="360" alt="Web Service Attributes Editor Page: Operation Level"></td></tr></table></div></div></div><p><br class="figure-break"></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> Expand the
                    <span class="emphasis"><em>operation</em></span> section. </strong></span></p><p>The section will be grayed out if Secure Service is
                    not selected.</p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select an option from the
                    Transactions list to specify a level at which transactions
                    will be secured. </strong></span></p><p>For this release, transactions will only use SSL for
                    security. Transactions are discussed in <a class="xref" href="#using_at" title="Chapter&nbsp;18.&nbsp;Using Atomic Transactions"><i>Using Atomic Transactions</i></a>.</p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Expand the Input Message
                    section.</strong></span></p><p>This section will be grayed out if Secure Service is
                    not selected.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong>Specify the following options,
                    as appropriate:</strong></span></p><ul class="stepalternatives">
                        <li class="step" title="Step 8.1"><p><span class="emphasis"><em>Authentication Token</em></span> :
                            Specifies which supporting token will be used to
                            sign and/or encrypt the specified message parts.
                            Options include Username, X509, SAML, Issued, or
                            None. For further description of these options, read
                            <a class="xref" href="#ahiea" title="12.7.1.&nbsp;Supporting Token Options">Supporting Token Options</a>.</p></li>

                        <li class="step" title="Step 8.2"><p><span class="emphasis"><em>Signed</em></span> : Specifies that
                            the authentication token must be a signed,
                            supporting token. A signed, supporting token is
                            signed by the primary signature token and is part of
                            primary signature.</p></li>

                        <li class="step" title="Step 8.3"><p><span class="emphasis"><em>Endorsing</em></span> : Specifies
                            that the authentication token must be endorsed. With
                            an endorsing supporting token, the key represented
                            by the token is used to endorse/sign the primary
                            message signature.</p></li>

                        <li class="step" title="Step 8.4"><p><span class="emphasis"><em>Encrypted</em></span>: Specifies that
                            the authentication token must be an encrypted
                            supporting token.</p></li>
                    </ul><p>One can select any (or none) combination of the
                    three options above. If both Signed and Endorsing are
                    selected, the authentication token must be a signed,
                    endorsing, supporting token. In this situation, the token
                    is signed by the primary signature. The key represented by
                    the token is used to endorse/sign the primary message
                    signature. If Encrypted is selected as well, the
                    supporting token is also encrypted in the request
                    message.</p></li><li class="step" title="Step 9"><p><span class="bold"><strong> For the Input Message and/or
                    Output Message, click the Message Parts button to specify
                    which parts of the message need to be encrypted, signed,
                    and/or required. </strong></span></p><p>See the following section for more information on
                    the options in the Message Parts dialog.</p><p>The Message Parts dialog appears. It should look
                    like <a class="xref" href="#gfrhz" title="Figure&nbsp;12.7.&nbsp;Web Service Attributes Editor Page: Message Parts">Web Service Attributes Editor Page: Message
                        Parts</a>.</p><div class="figure"><a name="gfrhz"></a><p class="title"><b>Figure&nbsp;12.7.&nbsp;Web Service Attributes Editor Page: Message
                        Parts</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/security-message-parts.png" height="360" alt="Web Service Attributes Editor Page: Message Parts"></td></tr></table></div></div></div><br class="figure-break"></li><li class="step" title="Step 10"><p><span class="bold"><strong> Click in a checkbox to the
                    right of the message part or element that you would like
                    to sign, encrypt or require. </strong></span></p><ul class="stepalternatives">
                        <li class="step" title="Step 10.1"><p>Select Sign to specify the parts or elements
                            of a message that require integrity protection
                            (digital signature).</p></li>

                        <li class="step" title="Step 10.2"><p>Select Encrypt to specify the parts or
                            elements of a message that require confidentiality
                            (encryption).</p></li>

                        <li class="step" title="Step 10.3"><p>Select Require to specify the set of parts
                            and/or elements that a message must contain.</p></li>
                    </ul></li><li class="step" title="Step 11"><p><span class="bold"><strong>Click Add Body to add a row
                    for the message body.</strong></span></p><p>This will only be necessary if the row has been
                    removed.</p></li><li class="step" title="Step 12"><p><span class="bold"><strong> Click Add Header to add a row
                    for either a specific SOAP header part or for all SOAP
                    header parts. </strong></span></p><p>This will only be necessary if the SOAP header row
                    in question has been deleted. The header parts that are
                    available to sign and/or encrypt before clicking the Add
                    Header button include To (Addressing), From (Addressing),
                    FaultTo (Addressing), ReplyTo (Addressing), MessageID
                    (Addressing), RelatesTo (Addressing), and Action
                    (Addressing). After clicking Add Header, and then clicking
                    All Headers, you may also specify AckRequested (RM),
                    SequenceAcknowledgement (RM), and Sequence (RM).</p></li><li class="step" title="Step 13"><p><span class="bold"><strong> Click Add Attachments to add
                    a row the SOAP attachments. </strong></span></p><p>This is useful if the web service has MIME
                    attachments which should be protected. All the attachments
                    in the message are secured on selecting this option. This
                    option is only available for the specification version of
                    Security Policy, supported in Netbeans IDE from 6.5
                    version.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Attachments Protection is not supported in .NET
                        3.0 and 3.5. So it is best to avoid this feature for
                        interop with .NET.</p></div></li><li class="step" title="Step 14"><p><span class="bold"><strong> There are no XPath elements
                    displayed by default. Click Add XPath to add rows that
                    enable you to specify signature and/or encryption for an
                    XPath expression or a URI which indicates the version of
                    XPath to use. </strong></span></p><p>By default, the Required field is selected. This is
                    an editable field. Double-click the XPath row to specify
                    the XPath expression or URI. Only one XPath element is
                    allowed.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>There is a limitation when specifying XPath
                        elements. To use XPath elements, switch off Optimize
                        Security manually by adding the
                        <code class="code">disableStreamingSecurity</code> policy
                        assertion. For information on how to do this, refer to
                        <a class="link" href="https://blogs.oracle.com/ashutosh/entry/custom_security_policy_assertions_in" target="_top">http://blogs.sun.com/venu/</a>
                        for more information on
                        <code class="code">disableStreamingSecurity</code>.</p></div></li><li class="step" title="Step 15"><p><span class="bold"><strong> To remove an element, select
                    it in the Message Part section, and then click Remove to
                    remove it from message security. </strong></span></p></li><li class="step" title="Step 16"><p><span class="bold"><strong>Click OK to save these
                    settings.</strong></span></p></li></ol></div></div><div class="section" title="12.7.1.&nbsp;Supporting Token Options"><div class="titlepage"><div><div><h3 class="title"><a name="ahiea"></a>12.7.1.&nbsp;Supporting Token Options</h3></div></div></div><p>You can use one of the following options for supporting
            tokens:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Username Token</em></span>: A username
                    token is used to identify the requestor by their username,
                    and optionally using a password (or shared secret, or
                    password equivalent) to authenticate that identity. When
                    using a username token, the user must be configured on
                    GlassFish. For information on configuring users on
                    GlassFish, read <a class="xref" href="#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a>.</p></li><li class="listitem"><p><span class="emphasis"><em>X.509 Certificate</em></span>: An X.509
                    certificate specifies a binding between a public key and a
                    set of attributes that includes (at least) a subject name,
                    issuer name, serial number, and validity interval. An
                    X.509 certificate may be used to validate a public key
                    that may be used to authenticate a SOAP message or to
                    identify the public key with a SOAP message that has been
                    encrypted. When this option is selected, you must specify
                    a truststore. For information on specifying a truststore,
                    read <a class="xref" href="#gfrgu" title="To Configure the Truststore on a Service Manually">To Configure the Truststore on a Service
                Manually</a>.</p></li><li class="listitem"><p><span class="emphasis"><em>Issued Token</em></span> : An issued token
                    is a token issued by a trusted Secure Token Service (STS).
                    The service does not trust the client directly, but
                    instead trusts tokens issued by a designated STS. In other
                    words, the STS is taking on the role of a second service
                    with which the client has to securely authenticate. The
                    issued tokens contain a key, which is encrypted for the
                    server and which is used for deriving new keys for signing
                    and encrypting.</p></li><li class="listitem"><p><span class="emphasis"><em>SAML Token</em></span> : A SAML Token uses
                    Security Assertion Markup Language (SAML) assertions as
                    security tokens.</p></li></ul></div></div></div><div class="section" title="12.8.&nbsp;Configuring A Secure Token Service (STS)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahieb"></a>12.8.&nbsp;Configuring A Secure Token Service (STS)</h2></div></div></div><p>A Secure Token Service (STS) is a Web service that issues
        security tokens. That is, it makes assertions based on evidence that
        it trusts, to whoever trusts it (or to specific recipients). To
        communicate trust, a service requires proof, such as a signature, to
        prove knowledge of a security token or set of security tokens. A
        service itself can generate tokens or it can rely on a separate STS to
        issue a security token with its own trust statement (note that for
        some security token formats this can just be a re-issuance or
        co-signature). This forms the basis of trust brokering.</p><p>The issued token security model includes a target service, a
        client, and a trusted third party called a Security Token Service
        (STS). Policy flows from service to client, and from STS to client.
        Policy may be embedded inside an issued token assertion, or acquired
        out-of-hand. There must be an explicit trust relationship between the
        service and the STS and the client and the STS. There does not need to
        be a trust relationship between the client and service.</p><p>When the web service being referenced by the client uses any of
        the STS security mechanisms (refer to tables in <a class="xref" href="#ahicn" title="12.2.1.&nbsp;Summary of Service-Side Configuration Requirements">Summary of Service-Side Configuration Requirements</a> and <a class="xref" href="#ahicp" title="12.2.2.&nbsp;Summary of Client-Side Configuration Requirements">Summary of Client-Side Configuration Requirements</a> ), an STS must be specified. You can
        specify the STS in the following ways.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>On the service side, specify the endpoint of the Issuer
                element and/or specify the Issuer Metadata Exchange (Mex)
                address of the STS.</p><p>If you need to create a third-party STS, follow the
                steps in <a class="xref" href="#gfrig" title="To Create a Third-Party STS">To Create a Third-Party STS</a>
                .</p><p>For more information on managing the STS, see <a class="xref" href="#sts-managing-multiple-services" title="Managing multiple services with Metro based STS">Managing multiple services with Metro based STS</a> .</p><p>If you already have an STS that you want to use, follow
                the steps in <a class="xref" href="#gfrgl" title="To Specify an STS on the Service Side">To Specify an STS on the Service Side</a>
                .</p><p>An example that creates and uses an STS can be found at
                <a class="xref" href="#ahiey" title="12.9.7.&nbsp;Example: STS Issued Token (STS)">Example: STS Issued Token (STS)</a> .</p><p>An example that shows how to achieve the trust brokering
                between different domains using an STS can be found at <a class="xref" href="#ahiex" title="12.9.8.&nbsp;Example: Broker Trust STS (BT)">Example: Broker Trust STS (BT)</a> .</p><p>An example that shows how to use SecureConversation with
                an STS can be found at <a class="xref" href="#ahiez" title="12.9.9.&nbsp;Example: STS Issued Token With SecureConversation (STS+SC)">Example: STS Issued Token With SecureConversation
            (STS+SC)</a> .</p></li><li class="listitem"><p>On the client side, specify the information for a
                preconfigured STS. This is mainly used for a local STS that is
                in the same domain as the client. Configuring the STS for the
                client is described in <a class="xref" href="#gghnt" title="To Specify an STS on the Client Side">To Specify an STS on the Client Side</a> .</p></li></ul></div><p>This section covers the following topics:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#gfrig" title="To Create a Third-Party STS">To Create a Third-Party STS</a></p></li><li class="listitem"><p><a class="xref" href="#gfrgl" title="To Specify an STS on the Service Side">To Specify an STS on the Service Side</a></p></li><li class="listitem"><p><a class="xref" href="#gghnt" title="To Specify an STS on the Client Side">To Specify an STS on the Client Side</a></p></li></ul></div><div class="task" title="To Create a Third-Party STS"><a name="gfrig"></a><p class="title"><b>To Create a Third-Party STS</b></p><div class="tasksummary">
                <p>Use the STS wizard to create an STS. When using the STS
                wizard, provide the name of the STS implementation class. This
                class must extend
                <code class="code">com.sun.xml.ws.security.trust.sts.BaseSTSImpl</code> .
                After completing the steps of the wizard, your application
                will contain a new service that is an STS and includes a
                provider implementation class, STS WSDL, and a WSIT
                configuration file with a predefined set of policies.</p>

                <p>To use the STS wizard to create an STS, follow these
                steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create a new project for the
                    STS by selecting File | New Project. </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Java Web, then Web
                    Application, then Next.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Type a Project Name, then
                    Next, then the desired Server. Click
                    Finish.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Right-click the STS Project,
                    and select New, then select Other. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Web Services from the
                    Categories list.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select Secure Token Service
                    (STS) from the File Type(s) list. </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click Next.</strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong>Type a name for the Web
                    Service Class Name.</strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Type or select a name for the
                    Package list.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong>Click
                    Finish.</strong></span></p><p>The IDE takes a while to create the STS. When
                    created, it appears under the project's Web Services node
                    as <span class="emphasis"><em>your_STS</em></span> <code class="code">Service</code> ,
                    and the Java file appears in the right pane.</p></li><li class="step" title="Step 11"><p><span class="bold"><strong> The STS wizard creates an
                    implementation of the provider class. </strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong> Back in the Projects window,
                    expand the STS project folder, expand the Web Services
                    node, right-click on the web service, and select Edit Web
                    Service Attributes to configure the STS.
                    </strong></span></p></li><li class="step" title="Step 13"><p><span class="bold"><strong> Select the "Version
                    Compatibility" to ".NET 3.5 / Metro 1.3" ( e.g. see <a class="xref" href="#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a> ) . It will
                    use WS-SX version of all WS-* specifications.
                    </strong></span></p></li><li class="step" title="Step 14"><p><span class="bold"><strong>Make sure Secure Service is
                    selected.</strong></span></p></li><li class="step" title="Step 15"><p><span class="bold"><strong> Select a Security Mechanism
                    that is NOT one of the STS mechanisms. The example
                    application uses Username Authentication with Symmetric
                    Key. </strong></span></p></li><li class="step" title="Step 16"><p><span class="bold"><strong> Select the Configure button.
                    For the Algorithm Suite option, specify a value that
                    matches the value of the web service. Set the Key Size to
                    128 if you have not configured Unlimited Strength
                    Encryption. Select OK to close the configuration dialog.
                    </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Some of the algorithm suite settings require
                            that Unlimited Strength Encryption be configured in
                            the Java Runtime Environment (JRE), particularly the
                            algorithm suites that use 256 bit encryption.
                            Download the Java Cryptography Extension (JCE)
                            Unlimited Strength Jurisdiction Policy Files.
                            Installation instructions are provided in the JCE
                            zip file. You can download JCE from this URL: <a class="link" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_top">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a></p></div></li><li class="step" title="Step 17"><p>
                        <span class="bold"><strong>Make sure Act as Secure Token
                        Service (STS) is selected.</strong></span>
                    </p><p>The default values will create a valid STS.</p><p>Optionally, you can change the following
                    configuration options by clicking the Configure
                    button:</p><ul class="stepalternatives">
                        <li class="step" title="Step 17.1"><p><span class="emphasis"><em>Issuer</em></span> : Specify an
                            identifier for the issuer for the issued token. This
                            value can be any string that uniquely identifies the
                            STS, for example, <code class="code">MySTS</code> .</p></li>

                        <li class="step" title="Step 17.2"><p><span class="emphasis"><em>Contract Implementation
                            Class</em></span> : Specify the actual implementation
                            class for the <code class="code">WSTrustContract</code> interface
                            that will handle token issuance, validation, and the
                            like. Default value is
                            <code class="code">com.sun.xml.ws.security.trust.impl.WSTRustContractImpl</code>
                            for issuing SAML assertions, or click Browse to
                            browse to another contract implementation
                            class.</p></li>

                        <li class="step" title="Step 17.3"><p><span class="emphasis"><em>Life Time of Issued
                            Tokens</em></span> : The life span of the token
                            issued by the STS. Default value is 36,000
                            ms.</p></li>

                        <li class="step" title="Step 17.4"><p><span class="emphasis"><em>Encrypt Issued Key</em></span> :
                            Select this option if the issued key should be
                            encrypted using the service certificate. Default is
                            true.</p></li>

                        <li class="step" title="Step 17.5"><p><span class="emphasis"><em>Encrypt Issued Token</em></span> :
                            Select this option if the issued token should be
                            encrypted using the service certificate. Default is
                            false.</p></li>
                    </ul><p>Optionally, to add one or more Service Providers
                    that have a trust relationship with the STS, click the Add
                    button, and specify the following configuration
                    options:</p><ul class="stepalternatives">
                        <li class="step" title="Step 17.1"><p><span class="emphasis"><em>Provider Endpoint URI</em></span> :
                            The endpoint URI of the service provider.</p></li>

                        <li class="step" title="Step 17.2"><p><span class="emphasis"><em>Certificate Alias</em></span> : The
                            alias of the certificate of the service provider in
                            the keystore.</p></li>

                        <li class="step" title="Step 17.3"><p><span class="emphasis"><em>Token Type</em></span> : The type of
                            token the service provider requires, for example,
                            <code class="code">urn:oasis:names:tc:SAML1.0:assertion</code>
                            .</p></li>

                        <li class="step" title="Step 17.4"><p><span class="emphasis"><em>Key Type</em></span> : The type of
                            key the service provider requires. The choices are
                            public key or symmetric key. Symmetric key
                            cryptography relies on a shared secret and is
                            usually faster than public key cryptography. Public
                            key cryptography relies on a key that is made public
                            to all and is primarily used for encryption but can
                            be used for verifying signatures.</p></li>
                    </ul></li><li class="step" title="Step 18"><p><span class="bold"><strong> Click OK to close the Select
                    STS Service Provider dialog, if open. </strong></span></p></li><li class="step" title="Step 19"><p><span class="bold"><strong>Click OK to close the STS
                    Configuration dialog, if open.</strong></span></p></li><li class="step" title="Step 20"><p><span class="bold"><strong>Click the Keystore button to
                    configure the keystore.</strong></span></p><p>If you are using the GlassFish stores, click the
                    Load Aliases button and select <code class="code">wssip</code> .
                    Otherwise, browse to the location of your keystore and
                    enter the relevant information.</p><p>Click OK to close the dialog.</p></li><li class="step" title="Step 21"><p><span class="bold"><strong> Right-click the STS Project
                    and select Properties. Select the Run category, and type
                    the following in the Relative URL field: <code class="code">/</code>
                    <span class="emphasis"><em>your_STS</em></span> <code class="code">Service?wsdl</code> .
                    </strong></span></p></li><li class="step" title="Step 22"><p><span class="bold"><strong> Run the Project (right-click
                    the Project and select Run). The STS WSDL displays in a
                    browser window. </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you are receiving compilation errors during
                            the build, you may need to update your JRE's JAX-WS
                            version to the latest release version. See <a class="link" href="http://metro.java.net/guide/Using_JAX_WS_2_x___Metro_1_x_2_0_with_Java_SE_6.html#Endorsed_directory" target="_top">here</a>
                            for more details.</p></div></li></ol></div></div><p>Check <a class="xref" href="#custom-sts" title="13.4.&nbsp;Building custom STS">Building custom STS</a> to
        build a custom STS to control the user attributes to be included in
        the SAML assertion.</p><div class="task" title="Managing multiple services with Metro based STS"><a name="sts-managing-multiple-services"></a><p class="title"><b>Managing multiple services with Metro based STS</b></p><div class="tasksummary">
                <p>Metro based STS can be used to secure multiple services.
                One need to register a service provider to an STS before the
                issued tokens of the STS can be used for that service.</p>

                <p>Each resgisted service comes up as a ServiceProvide in
                the STSConfiguration: </p><div class="example"><a name="d0e8913"></a><p class="title"><b>Example&nbsp;12.5.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;tc:STSConfiguration
        xmlns:tc="http://schemas.sun.com/ws/2006/05/trust/server"
        encryptIssuedKey="true" encryptIssuedToken="false"&gt;
   &lt;tc:LifeTime&gt;36000&lt;/tc:LifeTime&gt;
   &lt;tc:Contract&gt;com.sun.xml.ws.security.trust.impl.WSTrustContractImpl
   &lt;/tc:Contract&gt;
   &lt;tc:Issuer&gt;SunSTS&lt;/tc:Issuer&gt;
   &lt;tc:ServiceProviders&gt;
      &lt;tc:ServiceProvider endPoint="http://localhost:8080/jaxws-s5/simple"&gt;
         &lt;tc:CertAlias&gt;bob&lt;/tc:CertAlias&gt;
         &lt;tc:TokenType&gt;
            http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1
            #SAMLV1.1
         &lt;/tc:TokenType&gt;
      &lt;/tc:ServiceProvider&gt;
      &lt;!-- more service providers --&gt;
   &lt;/tc:ServiceProviders&gt;
&lt;/tc:STSConfiguration&gt;</pre></div></div><p><br class="example-break"></p>

                <p>At the minimum, you need to specify the endpoint as well
                as the cert alias for each service provider. At run time, the
                actual service is identified for each request RST from a
                client to the STS. The RST contains an AppliesTo element
                pointing to the endpoint of the targeted service. On the STS
                side, the certificate of the service is used to encrypt the
                issued tokens and proof keys for the service.</p>

                <p>With Netbeans, one can add Service Providers to an STS
                through the configuration panel for STS:</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Click Configure button besides Act as Secure Token
                    Service (STS).</p></li><li class="step" title="Step 2"><p>In the STS Configuration panel, click Add</p></li><li class="step" title="Step 3"><p>In the Select Service Provider panel, add
                    information of the service provider. Note that you must
                    import the certificate of the service provider to the
                    TrustStore of the STS.</p></li></ol></div></div><p>We provide a default Service Provider with endpoint="default".
        This default setting, working with any service providers, is for
        testing purpose only. In a product, you must remove it and add all the
        service providers to be secured by the STS. You may also implement
        STSConfigurationProvider with your own STSConfiguration and
        TrustSPMetada to configure STS and register service providers to a
        deployed STS at run time.</p><div class="task" title="To Specify an STS on the Service Side"><a name="gfrgl"></a><p class="title"><b>To Specify an STS on the Service Side</b></p><div class="tasksummary">
                <p>This section discusses how to specify a Security Token
                Service that can be referenced by the service. On the service
                side, you select a security mechanism that includes STS in its
                title.</p>

                <p>The STS itself is secured using a separate (non-STS)
                security mechanism. The security configuration of the
                client-side of this application is dependent upon the security
                mechanism selected for the STS, and not on the security
                mechanism selected for the application.</p>

                <p>To specify an STS for the web service, follow these
                steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Right-click the node for the
                    web service you want to secure.</strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Edit Web Service
                    Attributes.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Select the "Version
                    Compatibility" to ".NET 3.5 / Metro 1.3" ( e.g. see <a class="xref" href="#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a> ) . It will
                    use WS-SX version of all WS-* specifications.
                    </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select Secure
                    Service.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> Select a Security Mechanism
                    that specifies STS from the list. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong>Click Configure to specify the
                    STS information.</strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Type the Issuer Address and/or
                    Issuer Metadata Address.</strong></span></p><p>When the Issuer Address and the Metadata values are
                    the same, you only need to type the Issuer Address. For
                    the example application, the Issuer Address would be
                    <code class="code">http://localhost:8080/MySTSProject/MySTSService</code>
                    .</p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Set the Algorithm Suite value
                    so that the algorithm suite value of the service matches
                    the algorithm suite value of the STS. Select 128 if you
                    have not installed Unlimited Strength Encryption.
                    </strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Click OK to close the
                    dialog.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong>Click OK.</strong></span></p><p>A new file is added to the project. To view the WSIT
                    configuration file, expand Web Pages | WEB-INF, then
                    double-click the file <code class="code"> wsit- package-name .
                    service-name .xml </code> and select the Source
                    page.</p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Right-click the project node
                    and select Run to compile the application and deploy it
                    onto GlassFish. A browser will open and display the WSDL
                    file for the application. </strong></span></p></li></ol></div></div><div class="task" title="To Specify an STS on the Client Side"><a name="gghnt"></a><p class="title"><b>To Specify an STS on the Client Side</b></p><div class="tasksummary">
                <p>Once you've determined whether it is required to
                configure an STS on the client side (see <a class="xref" href="#ahicp" title="12.2.2.&nbsp;Summary of Client-Side Configuration Requirements">Summary of Client-Side Configuration Requirements</a>), configure the client Secure
                Token Service options. To configure the client-side with STS,
                you need to configure the clients for the service and STS
                follow these steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> In the Projects window,
                    expand the node for the web services client.
                    </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Expand the Web Service
                    References node.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Right-click the node for the
                    web service reference for which you want to configure
                    security options. </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select Edit Web Service
                    Attributes.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> When the Web Service
                    References Attributes Editor is opened, select the Quality
                    of Service tab. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Provide the service's
                    certificate by pointing to an alias in the client
                    truststore. For development purposes, click the Truststore
                    button,, click the Load Aliases button for the truststore
                    and select <code class="code">xws-security-server</code> from the Alias
                    list. </strong></span></p><ul class="stepalternatives">
                        <li class="step" title="Step 6.1"><p><span class="bold"><strong> In some instances,
                            NetBeans will not detect that this client is a
                            JSR-196 client, and thus will require that the
                            truststore entries be manually configured. To do
                            this, follow the steps in this section.
                            </strong></span></p></li>

                        <li class="step" title="Step 6.2"><p><span class="bold"><strong>Expand the client
                            project node, then expand Source
                            Packages/META-INF.</strong></span></p></li>

                        <li class="step" title="Step 6.3"><p><span class="bold"><strong> Double-click
                            <span class="emphasis"><em>&lt;service-project&gt;</em></span> ..xml
                            to open it in the Source window. Click the Source
                            tab to view the code. Find the
                            <code class="code">sc:TrustStore</code> elements. If these
                            elements contain parameters for
                            <code class="code">location</code> and <code class="code">storepass</code> ,
                            then just continue to the next section. If not, add
                            these attributes to this file. The following code
                            shows an example of how these elements could be
                            specified. </strong></span></p><div class="example"><a name="d0e9081"></a><p class="title"><b>Example&nbsp;12.6.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sc:TrustStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
   storepass="changeit" peeralias="xws-security-server"/&gt;</pre></div></div><br class="example-break"></li>
                    </ul></li><li class="step" title="Step 7"><p><span class="bold"><strong> Expand the Security Token
                    Service node to provide details for the STS to be used.
                    When the Endpoint and the Metadata values are the same,
                    you only need to enter the Endpoint value. For the example
                    application you would enter the following value in the
                    Endpoint field:
                    <code class="code">http://localhost:8080/MySTSProject/MySTSService</code>
                    . For WS Trust Version field, select 1.3 if STS endpoint
                    uses ".NET 3.5 / Metro 1.3" version compatibility.
                    Otherwise use the default WS Trust Version.
                    </strong></span></p><p>The Endpoint field is a mandatory field. Depending
                    on how you plan to configure the STS, you can provide
                    either Metadata information or information regarding the
                    WSDL Location, Service Name, Port Name and Namespace. The
                    examples following this section describe a few potential
                    STS configurations.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong>Click OK to close this
                    dialog.</strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong> The service requires a token
                    to be issued from the STS, which, for the example, is
                    <code class="code">http://localhost:8080/MySTSProject/MySTSService</code>
                    , with WSDL file
                    <code class="code">http://localhost:8080/MySTSProject/MySTSService?wsdl</code>
                    . To do this, follow these steps: </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 9.a"><p><span class="bold"><strong> Right-click the web
                            service client project node and select New | Web
                            Service Client. </strong></span></p><p>The New Web Service Client window
                            appears.</p></li><li class="step" title="Step 9.b"><p><span class="bold"><strong>Select the WSDL URL
                            option.</strong></span></p></li><li class="step" title="Step 9.c"><p><span class="bold"><strong> Cut and paste the URL
                            of the web service that you want the client to
                            consume into the WSDL URL field. For the tutorial
                            example, the URL for the <code class="code">MySTS</code> web
                            servicen is: </strong></span></p><pre class="programlisting">http://localhost:8080/MySTSProject/MySTSService?wsdl</pre></li><li class="step" title="Step 9.d"><p><span class="bold"><strong> Type the package name,
                            for example,
                            <code class="code">org.me.calculator.client.sts</code> , into the
                            Package field, then click Finish. </strong></span></p><p>The Projects window displays the new web
                            service client.</p></li></ol></li><li class="step" title="Step 10"><p><span class="bold"><strong> Drill down from the web
                    service client project node to the Web Service References
                    node. </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Right-click the node for the
                    STS service, and select Edit Web Service Attributes.
                    </strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong>Select the Quality of Service
                    tab.</strong></span></p></li><li class="step" title="Step 13"><p><span class="bold"><strong> If required, provide the
                    client's private key by pointing to an alias in the
                    keystore. For development purposes, click the Keystore
                    button, click the Load Aliases button, and select
                    <code class="code">xws-security-client</code> from the Alias list.
                    </strong></span></p></li><li class="step" title="Step 14"><p><span class="bold"><strong> Verify the STS's certificate
                    by pointing to an alias in the client truststore. For
                    development purposes, click the Truststore button,, click
                    the Load Aliases button and select <code class="code">wssip</code> from
                    the Alias list. </strong></span></p><ul class="stepalternatives">
                        <li class="step" title="Step 14.1"><p><span class="bold"><strong> In some instances,
                            NetBeans will not detect that this client is a
                            JSR-196 client, and thus will require that the
                            keystore and truststore entries be manually
                            configured. To do this, follow the steps in this
                            section. </strong></span></p></li>

                        <li class="step" title="Step 14.2"><p><span class="bold"><strong> Expand the web services
                            client project node, then Source Packages |
                            META-INF. </strong></span></p></li>

                        <li class="step" title="Step 14.3"><p><span class="bold"><strong> Double-click
                            <span class="emphasis"><em>&lt;sts-service&gt;</em></span> .xml to
                            open it in the Source window. Click the Source tab
                            to view the code. Find the <code class="code">sc:KeyStore</code>
                            and/or <code class="code">sc:TrustStore</code> elements. If these
                            elements contain parameters for
                            <code class="code">location</code> and <code class="code">storepass</code> ,
                            then just continue to the next section. If not, add
                            these attributes to this file. The following code
                            shows an example of how these elements could be
                            specified. </strong></span></p><div class="example"><a name="d0e9194"></a><p class="title"><b>Example&nbsp;12.7.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sc:TrustStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
   storepass="changeit" peeralias="wssip"/&gt;
&lt;sc:KeyStore
 wspp:visibility="private"
 location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\truststore.jks"
 storepass="changeit" alias="xws-security-client"/&gt;</pre></div></div><br class="example-break"></li>
                    </ul></li><li class="step" title="Step 15"><p><span class="bold"><strong>If required, enter the default
                    user name and password.</strong></span></p><p>If you followed the steps in <a class="xref" href="#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a> , this will be User Name
                    <code class="code">wsitUser</code> and Password <code class="code">changeit</code>
                    .</p></li><li class="step" title="Step 16"><p><span class="bold"><strong>Click OK to close this
                    dialog.</strong></span></p></li><li class="step" title="Step 17"><p><span class="bold"><strong> Compile and run this
                    application by right-clicking the web services client
                    project and selecting Run. </strong></span></p></li></ol></div></div></div><div class="section" title="12.9.&nbsp;Example Applications"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahiei"></a>12.9.&nbsp;Example Applications</h2></div></div></div><p>The following example applications demonstrate configuring web
        services and web service clients for different security mechanisms. If
        you are going to work through the examples sequentially, you must
        manually undo the changes to the service and then refresh the client
        in order for the client to receive the most recent version of the
        service's WSDL file, which contains the latest security configuration
        information.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a></p></li><li class="listitem"><p><a class="xref" href="#UsernameWithDigestPasswords" title="12.9.2.&nbsp;Example: Username with Digest Passwords">Example: Username with Digest Passwords</a></p></li><li class="listitem"><p><a class="xref" href="#ahiem" title="12.9.3.&nbsp;Example: Mutual Certificates Security (MCS)">Example: Mutual Certificates Security (MCS)</a></p></li><li class="listitem"><p><a class="xref" href="#ahiep" title="12.9.4.&nbsp;Example: Transport Security (SSL)">Example: Transport Security (SSL)</a></p></li><li class="listitem"><p><a class="xref" href="#ahies" title="12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)">Example: SAML Authorization over SSL (SA)</a></p></li><li class="listitem"><p><a class="xref" href="#ahiev" title="12.9.6.&nbsp;Example: SAML Sender Vouches with Certificates (SV)">Example: SAML Sender Vouches with Certificates (SV)</a></p></li><li class="listitem"><p><a class="xref" href="#ahiey" title="12.9.7.&nbsp;Example: STS Issued Token (STS)">Example: STS Issued Token (STS)</a></p></li><li class="listitem"><p><a class="xref" href="#ahiex" title="12.9.8.&nbsp;Example: Broker Trust STS (BT)">Example: Broker Trust STS (BT)</a></p></li><li class="listitem"><p><a class="xref" href="#ahiez" title="12.9.9.&nbsp;Example: STS Issued Token With SecureConversation (STS+SC)">Example: STS Issued Token With SecureConversation
            (STS+SC)</a></p></li><li class="listitem"><p><a class="xref" href="#gfzhh" title="12.9.10.&nbsp;Example: Kerberos Token (Kerb)">Example: Kerberos Token (Kerb)</a></p></li></ul></div><div class="section" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)"><div class="titlepage"><div><div><h3 class="title"><a name="ahiej"></a>12.9.1.&nbsp;Example: Username Authentication with Symmetric Key
            (UA)</h3></div></div></div><p>The section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#gfrhw" title="To Secure the Example Service Application (UA)">To Secure the Example Service Application (UA)</a></p></li><li class="listitem"><p><a class="xref" href="#gfrkr" title="To Secure the Example Web Service Client Application (UA)">To Secure the Example Web Service Client Application
                (UA)</a></p></li></ul></div><div class="task" title="To Secure the Example Service Application (UA)"><a name="gfrhw"></a><p class="title"><b>To Secure the Example Service Application (UA)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    security to both the web service and to the web service
                    client.</p>

                    <p>For this example, the security mechanism of <a class="xref" href="#ahicv" title="12.3.1.&nbsp;Username Authentication with Symmetric Key">Username Authentication with Symmetric Key</a> is used to
                    secure the application. To add security to the service
                    part of the example, follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> . </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet) </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, then right-click
                        the node for the web service (CalculatorWS) and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Deselect Reliable
                        Messaging if it is selected.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> In the
                        CalculatorWSPortBinding section, select Secure
                        Service. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select Username Authentication
                        with Symmetric Key. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select Use Development
                        Defaults to set up the keystore and truststore files,
                        and to create a user for this application, if needed.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Click OK to close the
                        <code class="code">CalculatorWSService</code> dialog.
                        </strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Web Pages | WEB-INF,
                        then double-click the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code> .
                        This file contains the security elements within
                        <code class="code">wsp:Policy</code> tags.</p><p>An example of this file can be viewed in the
                        tutorial by clicking this link: <a class="xref" href="#ahifh" title="13.2.1.&nbsp;Service-Side WSIT Configuration Files">Service-Side WSIT Configuration Files</a> .</p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run. A browser
                        will open and display the WSDL file for the
                        application. </strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong> Follow the steps to
                        secure the client application as described in <a class="xref" href="#gfrkr" title="To Secure the Example Web Service Client Application (UA)">To Secure the Example Web Service Client Application
                (UA)</a> .
                        </strong></span></p></li></ol></div></div><div class="task" title="To Secure the Example Web Service Client Application (UA)"><a name="gfrkr"></a><p class="title"><b>To Secure the Example Web Service Client Application
                (UA)</b></p><div class="tasksummary">
                    <p>This section demonstrates adding security to the web
                    service client that references the web service created in
                    the previous section. This web service is secured using
                    the security mechanism described in <a class="xref" href="#ahicv" title="12.3.1.&nbsp;Username Authentication with Symmetric Key">Username Authentication with Symmetric Key</a> . When this security mechanism
                    is used with a web service, the web service client must
                    provide a username and password in addition to specifying
                    the certificate of the server.</p>

                    <p>To add security to the client that references this
                    web service, complete the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the client
                        application by following the steps described in <a class="xref" href="#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> . </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Whenever you make changes on the service,
                                refresh the client so that the client will pick up
                                the change. To refresh the client, right-click the
                                node for the Web Service Reference for the client,
                                and select Refresh Client.</p></div></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand the node for the
                        web service client application,
                        CalculatorWSServletClient. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Expand the Web Service
                        References node.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Right-click on
                        CalculatorWSService, select Edit Web Service
                        Attributes. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> In the Security section
                        of the Quality of Service tab, select Use Development
                        Defaults. Click OK to close. </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>By default, the user name of
                                <span class="emphasis"><em>wsitUser</em></span> and the password of
                                <span class="emphasis"><em>changeit</em></span> will be entered in
                                this section. If the example doesn't run, make sure
                                that you have a user with this name and password set
                                up in the file realm of the Application Server or
                                GlassFish, as described in <a class="xref" href="#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a> .</p></div></li><li class="step" title="Step 6"><p><span class="bold"><strong> If you'd like to, in the
                        tree, drill down from the project to Source Packages |
                        META-INF. Double-click on
                        <code class="code">CalculatorWSService.xml</code> , and verify that
                        lines similar to the following are present:
                        </strong></span></p><div class="example"><a name="d0e9423"></a><p class="title"><b>Example&nbsp;12.8.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;wsp:All&gt;
   &lt;sc:TrustStore
         wspp:visibility="private"
         location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
         storepass="changeit" peeralias="xws-security-server"/&gt;
   &lt;sc:CallbackHandlerConfiguration wspp:visibility="private"&gt;
      &lt;sc:CallbackHandler default="wsitUser" name="usernameHandler"/&gt;
      &lt;sc:CallbackHandler default="changeit" name="passwordHandler"/&gt;
   &lt;/sc:CallbackHandlerConfiguration&gt;
&lt;/wsp:All&gt;</pre></div></div><br class="example-break"><p>By selecting Use Development Defaults when
                        securing the service, these values are automatically
                        generated for you.</p><p>An example of this file can be viewed in the
                        tutorial by clicking this link: <a class="xref" href="#ahifi" title="13.2.2.&nbsp;Client-Side WSIT Configuration Files">Client-Side WSIT Configuration Files</a> .</p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Right-click the
                        CalculatorWSServletClient node and select Run. The
                        result of the add operation will display in a browser
                        window. </strong></span></p></li></ol></div></div></div><div class="section" title="12.9.2.&nbsp;Example: Username with Digest Passwords"><div class="titlepage"><div><div><h3 class="title"><a name="UsernameWithDigestPasswords"></a>12.9.2.&nbsp;Example: Username with Digest Passwords</h3></div></div></div><p>This example is similar to <a class="xref" href="#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a> except that digest passwords (along
            with Created and Nonce) are used in
            <span class="emphasis"><em>UsernameToken</em></span>, and
            <span class="emphasis"><em>UsernameToken</em></span> is not encrypted in the
            message.</p><p>To Secure the Service Application, all the steps remain
            same, except for step 6. For step 6, do the following:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="bold"><strong> Click on Configure, select
                    Support Hash Passwords. Click OK. </strong></span></p></li><li class="listitem"><p><span class="bold"><strong> Unselect Use Development
                    Defaults, if already selected. Specify the KeyStore. Click
                    on Validators, and specify the username validator.
                    </strong></span></p><p>The Username Validator created should extend
                    <span class="emphasis"><em>PasswordValidationCallback.WsitDigestPasswordValidator</em></span>.
                    Here is a sample UsernameValidator for Digest passwords.
                    </p><div class="example"><a name="d0e9466"></a><p class="title"><b>Example&nbsp;12.9.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">import com.sun.xml.wss.impl.callback.PasswordValidationCallback;

public class SampleWsitDigestPasswordValidator extends
        PasswordValidationCallback.WsitDigestPasswordValidator {
    public  void setPassword(PasswordValidationCallback.Request request){
        //Get this password from somewhere - for example a JDBC Realm
        String passwd = "abcd!1234";
        PasswordValidationCallback.DigestPasswordRequest req =
                (PasswordValidationCallback.DigestPasswordRequest)request;
        req.setPassword(passwd);
    }
}</pre></div></div><p><br class="example-break"> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Use of Digest Passwords can be supported for
                            any realm which store plain passwords (not hashed
                            ones). Currently this is supported for JDBC realm in
                            Glassfish. Or optionally, a user can write his own
                            custom realm.</p></div></li></ol></div><p>The steps for securing the client remain same as in <a class="xref" href="#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a>.</p></div><div class="section" title="12.9.3.&nbsp;Example: Mutual Certificates Security (MCS)"><div class="titlepage"><div><div><h3 class="title"><a name="ahiem"></a>12.9.3.&nbsp;Example: Mutual Certificates Security (MCS)</h3></div></div></div><p>The section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#gfrlc" title="To Secure the Example Service Application (MCS)">To Secure the Example Service Application (MCS)</a></p></li><li class="listitem"><p><a class="xref" href="#gfrkw" title="To Secure the Example Web Service Client Application (MCS)">To Secure the Example Web Service Client Application
                (MCS)</a></p></li></ul></div><div class="task" title="To Secure the Example Service Application (MCS)"><a name="gfrlc"></a><p class="title"><b>To Secure the Example Service Application (MCS)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    security to both the web service and to the web service
                    client.</p>

                    <p>For this example, the security mechanism of <a class="xref" href="#ahicw" title="12.3.3.&nbsp;Mutual Certificates Security">Mutual Certificates Security</a> is used to
                    secure the application. To add security to the service
                    part of the example, follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> . </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet) </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, then right-click
                        the node for the web service, CalculatorWS, and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Deselect Reliable
                        Messaging if it is selected.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select Mutual Certificates
                        Security. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong>Select Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click OK to close the
                        dialog.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Web Pages | WEB-INF,
                        then double-click the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code> .
                        This file contains the security elements within
                        <code class="code">wsp:Policy</code> tags.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run.
                        </strong></span></p><p>A browser will open and display the WSDL file
                        for the application.</p></li><li class="step" title="Step 9"><p><span class="bold"><strong> Verify that the WSDL file
                        contains the <code class="code">AsymmetricBinding</code> element.
                        </strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> Follow the steps to
                        secure the client application as described in <a class="xref" href="#gfrkw" title="To Secure the Example Web Service Client Application (MCS)">To Secure the Example Web Service Client Application
                (MCS)</a> .
                        </strong></span></p></li></ol></div></div><div class="task" title="To Secure the Example Web Service Client Application (MCS)"><a name="gfrkw"></a><p class="title"><b>To Secure the Example Web Service Client Application
                (MCS)</b></p><div class="tasksummary">
                    <p>This section demonstrates adding security to the web
                    service client that references the web service created in
                    the previous section. This web service is secured using
                    the security mechanism described in <a class="xref" href="#ahicw" title="12.3.3.&nbsp;Mutual Certificates Security">Mutual Certificates Security</a> .</p>

                    <p>To add security to the client that references this
                    web service, complete the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the client
                        application following the steps described in <a class="xref" href="#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> . </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Whenever you make changes on the service,
                                refresh the client so that the client will pick up
                                the change. To refresh the client, right-click the
                                node for the Web Service Reference for the client,
                                and select Refresh Client.</p></div></li><li class="step" title="Step 2"><p><span class="bold"><strong> If you'd like, in the
                        tree, drill down from the project to Source Packages |
                        META-INF. Double-click on
                        <code class="code">CalculatorWSService.xml</code> , click the
                        Source tab, and look at the section in the section
                        <code class="code">&lt;wsp:All&gt;</code> to see the WSIT code that
                        has been added to this configuration file.
                        </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Compile and run this
                        application by right-clicking the
                        CalculatorWSServletClient node and selecting Run. The
                        result of the add operation will display in a browser
                        window. </strong></span></p></li></ol></div></div></div><div class="section" title="12.9.4.&nbsp;Example: Transport Security (SSL)"><div class="titlepage"><div><div><h3 class="title"><a name="ahiep"></a>12.9.4.&nbsp;Example: Transport Security (SSL)</h3></div></div></div><p>This section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#gfrkg" title="To Secure the Example Service Application (SSL)">To Secure the Example Service Application (SSL)</a></p></li><li class="listitem"><p><a class="xref" href="#gfrlg" title="To Secure the Example Web Service Client Application (SSL)">To Secure the Example Web Service Client Application
                (SSL)</a></p></li></ul></div><div class="task" title="To Secure the Example Service Application (SSL)"><a name="gfrkg"></a><p class="title"><b>To Secure the Example Service Application (SSL)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    transport security to both the web service and to the web
                    service client.</p>

                    <p>For this example, the security mechanism of <a class="xref" href="#ahicx" title="12.3.5.&nbsp;Transport Security (SSL)">Transport Security (SSL)</a> is used to
                    secure the application. To add security to the service
                    part of the example, follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> : </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet) </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, then right-click
                        the node for the web service, CalculatorWS, and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Deselect Reliable
                        Messaging if it is selected.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select Transport Security
                        (SSL). </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong>Select Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click OK to close the
                        dialog.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Web Pages | WEB-INF,
                        then double-click the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code> .
                        This file contains the security elements within
                        <code class="code">wsp:Policy</code> tags.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong> To require the service to
                        use the HTTPS protocol, security requirements must be
                        specified in the service's application deployment
                        descriptor, which is <code class="code">web.xml</code> for a web
                        service implemented as a servlet. Selecting Use
                        Development Defaults takes care of this task for you.
                        </strong></span></p><p>To view or change the security information,
                        follow these steps:</p><ol type="a" class="substeps"><li class="step" title="Step 8.a"><p><span class="bold"><strong>From your web service
                                application, expand Web Pages |
                                WEB-INF.</strong></span></p></li><li class="step" title="Step 8.b"><p><span class="bold"><strong> Double-click
                                <code class="code">web.xml</code> to open it in the editor.
                                </strong></span></p></li><li class="step" title="Step 8.c"><p><span class="bold"><strong>Select the Security
                                tab.</strong></span></p></li><li class="step" title="Step 8.d"><p><span class="bold"><strong> Expand the Security
                                Constraint named <code class="code"> SSL transport for
                                CalculatorWSService </code> . </strong></span></p></li><li class="step" title="Step 8.e"><p><span class="bold"><strong> A Web Resource
                                Collection named <code class="code">Secure Area</code> contains
                                the URL Pattern to be protected,
                                <code class="code">/CalculatorWSService//*</code> and the HTTP
                                Methods to be protected, , POST. </strong></span></p></li><li class="step" title="Step 8.f"><p><span class="bold"><strong>Unselect Enable
                                Authentication Constraint if it is
                                selected.</strong></span></p></li><li class="step" title="Step 8.g"><p><span class="bold"><strong> The Enable User Data
                                Constraint box is checked and CONFIDENTIAL is chosen
                                as the Transport Guarantee to specify that the
                                application uses SSL. </strong></span></p></li><li class="step" title="Step 8.h"><p><span class="bold"><strong> Click the XML tab to
                                view the resulting deployment descriptor additions.
                                </strong></span></p></li></ol></li><li class="step" title="Step 9"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run. If the
                        server presents its certificate, s1as, accept this
                        certificate. A browser will open and display the WSDL
                        file for the application. </strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> Follow the steps to
                        secure the client application as described in <a class="xref" href="#gfrlg" title="To Secure the Example Web Service Client Application (SSL)">To Secure the Example Web Service Client Application
                (SSL)</a> .
                        </strong></span></p></li></ol></div></div><div class="task" title="To Secure the Example Web Service Client Application (SSL)"><a name="gfrlg"></a><p class="title"><b>To Secure the Example Web Service Client Application
                (SSL)</b></p><div class="tasksummary">
                    <p>This section demonstrates adding security to the web
                    service client that references the web service created in
                    the previous section. This web service is secured using
                    the security mechanism described in <a class="xref" href="#ahicx" title="12.3.5.&nbsp;Transport Security (SSL)">Transport Security (SSL)</a> .</p>

                    <p>To add security to the client that references this
                    web service, complete the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the client
                        application by following the steps described in <a class="xref" href="#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> , with the exception that
                        you need to specify the secure WSDL when creating the
                        Web Service Client. </strong></span></p><p>To do this, create the client application up to
                        the step where you create the Servlet (step 5 as of
                        this writing) by following the steps described in
                        <a class="xref" href="#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> , with the following
                        exception.</p><p>In the step where you are directed to cut and
                        paste the URL of the web service that you want the
                        client to consume into the WSDL URL field, type
                        <span class="emphasis"><em>https</em></span> <code class="code">://</code>
                        <span class="emphasis"><em>fully-qualified-hostname:8181</em></span>
                        <code class="code">/CalculatorApplication/CalculatorWSService?wsdl</code>
                        (changes indicated in bold) to indicate that this
                        client should reference the web service using the
                        secure port. The first time you access this service,
                        accept the certificate (s1as) when you are prompted.
                        This is the server certificate popping up to confirm
                        its identity to the client.</p><p>In some cases, you might get an error dialog
                        telling you that the URL <code class="code">https://</code>
                        <span class="emphasis"><em>fully-qualified-hostname</em></span>
                        <code class="code">:8181/CalculatorApplication/CalculatorWSService?wsdl</code>
                        couldn't be downloaded. However, this the correct URL,
                        and it does load when you run the service. So, when
                        this error occurs, repeat the steps that create the
                        Web Service Client using the secure WSDL. The second
                        time, the web service reference is created and you can
                        continue creating the client.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you prefer to use localhost in place of the
                            fully-qualified hostname (FQHN) in this example, you
                            must follow the steps in <a class="xref" href="#ahicy" title="12.3.5.1.&nbsp;Transport Security (SSL) Workaround">Transport Security (SSL) Workaround</a> .</p></div></li><li class="step" title="Step 2"><p><span class="bold"><strong> Continue creating the
                        client following the remainder of the instructions in
                        <a class="xref" href="#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> . </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Some users are working through this document
                                and just making the recommended changes and
                                refreshing the client. For this example, you must
                                create a new client so that you can specify the
                                secure WSDL to create the correct setup for the
                                client.</p><p>Whenever you make changes on the service,
                                refresh the client so that the client will pick up
                                the change. To refresh the client, right-click the
                                node for the Web Service Reference for the client,
                                and select Refresh Client.</p></div></li><li class="step" title="Step 3"><p><span class="bold"><strong> Compile and run this
                        application by right-clicking on the
                        CalculatorWSServletClient node and selecting Run. The
                        result of the add operation will display in a browser
                        window. </strong></span></p></li></ol></div></div></div><div class="section" title="12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)"><div class="titlepage"><div><div><h3 class="title"><a name="ahies"></a>12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)</h3></div></div></div><p>This section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#gfrkp" title="To Secure the Example Service Application (SA)">To Secure the Example Service Application (SA)</a></p></li><li class="listitem"><p><a class="xref" href="#gfrkm" title="To Secure the Example Web Service Client Application (SA)">To Secure the Example Web Service Client Application
                (SA)</a></p></li></ul></div><div class="task" title="To Secure the Example Service Application (SA)"><a name="gfrkp"></a><p class="title"><b>To Secure the Example Service Application (SA)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    security to both the web service and to the web service
                    client.</p>

                    <p>For this example, the security mechanism of <a class="xref" href="#ahida" title="12.3.7.&nbsp;SAML Authorization over SSL">SAML Authorization over SSL</a> is used to
                    secure the application. The steps are similar to the ones
                    described in <a class="xref" href="#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a> , with the addition of the
                    writing of a client-side SAML callback handler to populate
                    the client's request with a SAML assertion.</p>

                    <p>To add security to the service part of the example,
                    follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> : </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet) </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, right-click the
                        node for the web service, CalculatorWS, and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Deselect the Reliable
                        Messaging option if it is selected.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select SAML Authorization over
                        SSL. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select Use Development
                        Defaults to have the <code class="code">web.xml</code> file
                        modified to include a security constraint that forces
                        the use of SSL. </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click OK to exit the
                        editor.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Web Pages | WEB-INF,
                        then double-click the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code> .
                        This file contains the security elements within
                        <code class="code">wsp:Policy</code> tags.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong> To require the service to
                        use the HTTPS protocol, security requirements must be
                        specified in the service's application deployment
                        descriptor, which is <code class="code">web.xml</code> for a web
                        service implemented as a servlet. Selecting Use
                        Development Defaults takes care of this task for you.
                        </strong></span></p><p>To view or change the security information in
                        the deployment descriptor, follow these steps:</p><ol type="a" class="substeps"><li class="step" title="Step 8.a"><p><span class="bold"><strong>From your web service
                                application, expand Web Pages |
                                WEB-INF.</strong></span></p></li><li class="step" title="Step 8.b"><p><span class="bold"><strong> Double-click
                                <code class="code">web.xml</code> to open it in the editor.
                                </strong></span></p></li><li class="step" title="Step 8.c"><p><span class="bold"><strong>Select the Security
                                tab.</strong></span></p></li><li class="step" title="Step 8.d"><p><span class="bold"><strong> Expand the Security
                                Constraint named <code class="code"> SSL transport for
                                CalculatorWSService </code> . </strong></span></p></li><li class="step" title="Step 8.e"><p><span class="bold"><strong> A Web Resource
                                Collection named <code class="code">Secure Area</code> contains
                                the URL Pattern to be protected,
                                <code class="code">/CalculatorWSService//*</code> and the HTTP
                                Methods to be protected, , POST. </strong></span></p></li><li class="step" title="Step 8.f"><p><span class="bold"><strong>Unselect Enable
                                Authentication Constraint if it is
                                selected.</strong></span></p></li><li class="step" title="Step 8.g"><p><span class="bold"><strong> The Enable User Data
                                Constraint box is checked and CONFIDENTIAL is chosen
                                as the Transport Guarantee to specify that the
                                application uses SSL. </strong></span></p></li><li class="step" title="Step 8.h"><p><span class="bold"><strong> Click the XML tab to
                                view the resulting deployment descriptor additions.
                                </strong></span></p></li></ol></li><li class="step" title="Step 9"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run. Accept the
                        <code class="code">s1as</code> certificate if you are prompted to.
                        A browser will open and display the WSDL file for the
                        application. </strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> Follow the steps to
                        secure the client application as described in <a class="xref" href="#gfrkm" title="To Secure the Example Web Service Client Application (SA)">To Secure the Example Web Service Client Application
                (SA)</a> .
                        </strong></span></p></li></ol></div></div><div class="task" title="To Secure the Example Web Service Client Application (SA)"><a name="gfrkm"></a><p class="title"><b>To Secure the Example Web Service Client Application
                (SA)</b></p><div class="tasksummary">
                    <p>This section demonstrates adding security to the web
                    service client that references the web service created in
                    the previous section. This web service is secured using
                    the security mechanism described in <a class="xref" href="#ahida" title="12.3.7.&nbsp;SAML Authorization over SSL">SAML Authorization over SSL</a> .</p>

                    <p>To add security to the client that references this
                    web service, complete the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> This example uses a
                        non-JSR-109-compliant client for variety. To do this,
                        create the client application up to the step where you
                        create the Servlet (step 5 as of this writing) by
                        following the steps described in <a class="xref" href="#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> , with the following
                        exceptions: </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> In the step where you
                                are directed to cut and paste the URL of the web
                                service that you want the client to consume into the
                                WSDL URL field, type <code class="code">https://</code>
                                <span class="emphasis"><em>fully-qualified-hostname</em></span>
                                <code class="code">:8181/CalculatorApplication/CalculatorWSService?wsdl</code>
                                , to indicate that this client should reference the
                                web service using the secure port.
                                </strong></span></p><p>The first time you access this service, accept
                                the certificate ( <code class="code">s1as</code> ) when you are
                                prompted. This is the server certificate popping up
                                to confirm its identity to the client.</p><p>In some cases, you might get an error dialog
                                telling you that the URL <code class="code">https://</code>
                                <span class="emphasis"><em>fully-qualified-hostname</em></span>
                                <code class="code">:8181/CalculatorApplication/CalculatorWSService?wsdl</code>
                                couldn't be downloaded. However, this the correct
                                URL, and it does load when you run the service. So,
                                when this error occurs, repeat the steps that create
                                the Web Service Client using the secure WSDL. The
                                second time, the web service reference is created
                                and you can continue creating the client.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you prefer to use <code class="code">localhost</code> in
                                    place of the fully-qualified hostname (FQHN) in this
                                    example, follow the steps in <a class="xref" href="#ahicy" title="12.3.5.1.&nbsp;Transport Security (SSL) Workaround">Transport Security (SSL) Workaround</a> .</p></div></li><li class="step" title="Step 1.b"><p><span class="bold"><strong> Name the application
                                CalculatorClient (since it's not a servlet.).
                                </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Instead of creating a
                        client servlet as is described in <a class="xref" href="#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> , just add the web service
                        operation to the generated <code class="code">index.jsp</code> file
                        to create a non-JSR-109 client. To do this, perform
                        these steps: </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 2.a"><p><span class="bold"><strong> If the
                                <code class="code">index.jsp</code> file is not open in the right
                                pane, expand Web Pages, then double-click
                                <code class="code">index.jsp</code> to open it.
                                </strong></span></p></li><li class="step" title="Step 2.b"><p><span class="bold"><strong> Drill down through the
                                Web Service References node until you get to the
                                <code class="code">add</code> operation. </strong></span></p></li><li class="step" title="Step 2.c"><p><span class="bold"><strong> Drag the
                                <code class="code">add</code> operation to the line immediately
                                following the following line: </strong></span></p><div class="example"><a name="d0e10111"></a><p class="title"><b>Example&nbsp;12.10.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;body&gt;</pre></div></div><br class="example-break"></li><li class="step" title="Step 2.d"><p><span class="bold"><strong> Edit the values for
                                <code class="code">i</code> and <code class="code">j</code> if you'd like.
                                </strong></span></p></li></ol></li><li class="step" title="Step 3"><p><span class="bold"><strong> Write a
                        <code class="code">SAMLCallback</code> handler for the client side
                        to populate a SAML assertion into the client's request
                        to the service. </strong></span></p><p>To create the <code class="code">SAMLCallbackHandler</code> ,
                        follow these steps:</p><ol type="a" class="substeps"><li class="step" title="Step 3.a"><p><span class="bold"><strong>Right-click the
                                CalculatorClient node.</strong></span></p></li><li class="step" title="Step 3.b"><p><span class="bold"><strong>Select New | Java
                                Package.</strong></span></p></li><li class="step" title="Step 3.c"><p><span class="bold"><strong> For Package Name, type
                                <code class="code">xwss.saml</code> and click Finish.
                                </strong></span></p></li><li class="step" title="Step 3.d"><p><span class="bold"><strong>Drill down from
                                CalculatorClient | Source Packages |
                                xwss.saml.</strong></span></p></li><li class="step" title="Step 3.e"><p><span class="bold"><strong>Right-click xwss.saml
                                and select New | Other.</strong></span></p></li><li class="step" title="Step 3.f"><p><span class="bold"><strong>From the Categories
                                list, select Java.</strong></span></p></li><li class="step" title="Step 3.g"><p><span class="bold"><strong> From the File Types
                                list, select Empty Java File and click Next.
                                </strong></span></p></li><li class="step" title="Step 3.h"><p><span class="bold"><strong> For Class Name, type
                                <code class="code">SamlCallbackHandler</code> and click Finish.
                                </strong></span></p><p>The empty file appears in the IDE.</p></li><li class="step" title="Step 3.i"><p><span class="bold"><strong> Download the example
                                file <code class="code">SamlCallbackHandler.java</code> from the
                                following URL: </strong></span></p><p><a class="link" href="http://xwss.java.net/servlets/ProjectDocumentList?folderID=6645&amp;expandFolder=6645&amp;folderID=6645" target="_top">http://xwss.java.net/servlets/ProjectDocumentList?folderID=6645&amp;expandFolder=6645&amp;folderID=6645</a></p></li><li class="step" title="Step 3.j"><p><span class="bold"><strong>Open the file in a text
                                editor.</strong></span></p></li><li class="step" title="Step 3.k"><p><span class="bold"><strong> Modify the
                                <code class="code">home</code> variable to provide the hard-coded
                                path to your GlassFish installation.
                                </strong></span></p><p>For example, modify the line:</p><div class="example"><a name="d0e10200"></a><p class="title"><b>Example&nbsp;12.11.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">String home = System.getProperty("WSIT_HOME");</pre></div></div><br class="example-break"><p>to</p><div class="example"><a name="d0e10205"></a><p class="title"><b>Example&nbsp;12.12.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">String home = "/home/glassfish";</pre></div></div><br class="example-break"></li><li class="step" title="Step 3.l"><p><span class="bold"><strong> Copy the contents of
                                this file into the
                                <code class="code">SamlCallbackHandler.java</code> window that is
                                displaying in the IDE. </strong></span></p></li></ol></li><li class="step" title="Step 4"><p><span class="bold"><strong>Drill down from
                        CalculatorClient | Web Service
                        References.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> Right-click
                        CalculatorWSService and select Edit Web Service
                        Attributes. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select the Quality of
                        Service tab of the CalculatorWSService dialog.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Unselect Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Enter the name of the
                        SAML Callback Handler written earlier in this section,
                        <code class="code">xwss.saml.SamlCallbackHandler</code> , into the
                        SAML Callback Handler field. </strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Click OK to close this
                        dialog.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> To view the WSIT
                        Configuration options, in the tree, drill down from
                        the project to Source Packages | META-INF.
                        Double-click <code class="code">CalculatorWSService.xml</code> ,
                        click the Source tab, and look for the lines where
                        <code class="code">xwss.saml.SamlCallbackHandler</code> is
                        specified as the SAML Callback Handler class for the
                        client. </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Compile and run this
                        application by right-clicking the CalculatorClient
                        node and selecting Run. The result of the
                        <code class="code">add</code> operation will display in a browser
                        window. </strong></span></p></li></ol></div></div></div><div class="section" title="12.9.6.&nbsp;Example: SAML Sender Vouches with Certificates (SV)"><div class="titlepage"><div><div><h3 class="title"><a name="ahiev"></a>12.9.6.&nbsp;Example: SAML Sender Vouches with Certificates (SV)</h3></div></div></div><p>This section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#gfrki" title="To Secure the Example Service Application (SV)">To Secure the Example Service Application (SV)</a></p></li><li class="listitem"><p><a class="xref" href="#gfrjq" title="To Secure the Example Web Service Client Application (SV)">To Secure the Example Web Service Client Application
                (SV)</a></p></li></ul></div><div class="task" title="To Secure the Example Service Application (SV)"><a name="gfrki"></a><p class="title"><b>To Secure the Example Service Application (SV)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    security to both the web service and to the web service
                    client.</p>

                    <p>For this example, the security mechanism of <a class="xref" href="#ahidc" title="12.3.9.&nbsp;SAML Sender Vouches with Certificates">SAML Sender Vouches with Certificates</a> is used to
                    secure the application. The steps are similar to the ones
                    described in <a class="xref" href="#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a> , with the addition of the
                    writing of a client-side SAML callback handler to populate
                    the client's request with a SAML assertion.</p>

                    <p>To add security to the service part of the example,
                    follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> : </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet) </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, then right-click
                        the node for the web service, CalculatorWS, and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Deselect the Reliable
                        Messaging option if it is selected.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select SAML Sender Vouches
                        with Certificates. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select Use Development
                        Defaults. This step properly configures the keystore,
                        truststore, and default user for this security
                        mechanism. </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click
                        OK.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Web Pages | WEB-INF,
                        then double-click the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code> .
                        This file contains the security elements within
                        <code class="code">wsp:Policy</code> tags.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run. Accept the
                        <code class="code">s1as</code> certificate if you are prompted to.
                        </strong></span></p><p>A browser will open and display the WSDL file
                        for the application.</p></li><li class="step" title="Step 9"><p><span class="bold"><strong> Follow the steps to
                        secure the client application as described in <a class="xref" href="#gfrjq" title="To Secure the Example Web Service Client Application (SV)">To Secure the Example Web Service Client Application
                (SV)</a> .
                        </strong></span></p></li></ol></div></div><div class="task" title="To Secure the Example Web Service Client Application (SV)"><a name="gfrjq"></a><p class="title"><b>To Secure the Example Web Service Client Application
                (SV)</b></p><div class="tasksummary">
                    <p>This section demonstrates adding security to the web
                    service client that references the web service created in
                    the previous section. This web service is secured using
                    the security mechanism described in <a class="xref" href="#ahidc" title="12.3.9.&nbsp;SAML Sender Vouches with Certificates">SAML Sender Vouches with Certificates</a> .</p>

                    <p>To add security to the client that references this
                    web service, complete the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> This example uses a
                        non-JSR-109-compliant client. To do this, create the
                        client application up to the step where you create the
                        Servlet (step 5 as of this writing) by following the
                        steps described in <a class="xref" href="#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> , with one exception: name
                        the application CalculatorClient (since it's not a
                        servlet.). </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong> Instead of creating a
                        client servlet as is described in <a class="xref" href="#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> , just add the web service
                        operation to the generated <code class="code">index.jsp</code> file
                        to create a non-JSR-109 client. To do this, follow
                        these steps: </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 2.a"><p><span class="bold"><strong> If the
                                <code class="code">index.jsp</code> file is not open in the right
                                pane, double-click it to open it. </strong></span></p></li><li class="step" title="Step 2.b"><p><span class="bold"><strong> Drill down through the
                                Web Service References node until you get to the
                                <code class="code">add</code> operation. </strong></span></p></li><li class="step" title="Step 2.c"><p><span class="bold"><strong> Drag the
                                <code class="code">add</code> operation to the line immediately
                                following the following line: </strong></span></p><div class="example"><a name="d0e10421"></a><p class="title"><b>Example&nbsp;12.13.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;body&gt;</pre></div></div><br class="example-break"></li><li class="step" title="Step 2.d"><p><span class="bold"><strong> Edit the values for
                                <code class="code">i</code> and <code class="code">j</code> if you'd like.
                                </strong></span></p></li></ol></li><li class="step" title="Step 3"><p><span class="bold"><strong> Write a
                        <code class="code">SAMLCallback</code> handler for the client side
                        to populate a SAML assertion into the client's request
                        to the service. </strong></span></p><p>To create the <code class="code">SAMLCallbackHandler</code> ,
                        follow these steps:</p><ol type="a" class="substeps"><li class="step" title="Step 3.a"><p><span class="bold"><strong>Right-click the
                                CalculatorClient node.</strong></span></p></li><li class="step" title="Step 3.b"><p><span class="bold"><strong>Select New | Java
                                Package.</strong></span></p></li><li class="step" title="Step 3.c"><p><span class="bold"><strong> For Package Name, type
                                <code class="code">xwss.saml</code> and click Finish.
                                </strong></span></p></li><li class="step" title="Step 3.d"><p><span class="bold"><strong>Drill down from
                                CalculatorClient | Source Packages |
                                xwss.saml.</strong></span></p></li><li class="step" title="Step 3.e"><p><span class="bold"><strong>Right-click xwss.saml
                                and select New | Other.</strong></span></p></li><li class="step" title="Step 3.f"><p><span class="bold"><strong>From the Categories
                                list, select Java.</strong></span></p></li><li class="step" title="Step 3.g"><p><span class="bold"><strong> From the File Types
                                list, select Empty Java File and click Next.
                                </strong></span></p></li><li class="step" title="Step 3.h"><p><span class="bold"><strong> For Class Name, type
                                <code class="code">SamlCallbackHandler</code> and click Finish.
                                </strong></span></p><p>The empty file appears in the IDE.</p></li><li class="step" title="Step 3.i"><p><span class="bold"><strong> Download the example
                                file <code class="code">SamlCallbackHandler.java</code> from the
                                following URL: </strong></span></p><p><a class="link" href="http://xwss.java.net/servlets/ProjectDocumentList?folderID=6645&amp;expandFolder=6645&amp;folderID=6645" target="_top">http://xwss.java.net/servlets/ProjectDocumentList?folderID=6645&amp;expandFolder=6645&amp;folderID=6645</a></p></li><li class="step" title="Step 3.j"><p><span class="bold"><strong>Open the file in a text
                                editor.</strong></span></p></li><li class="step" title="Step 3.k"><p><span class="bold"><strong> Modify the
                                <code class="code">home</code> variable to provide the hard-coded
                                path to your GlassFish installation.
                                </strong></span></p><p>For example, modify the line:</p><div class="example"><a name="d0e10510"></a><p class="title"><b>Example&nbsp;12.14.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">String home = System.getProperty("WSIT_HOME");</pre></div></div><br class="example-break"><p>to</p><div class="example"><a name="d0e10515"></a><p class="title"><b>Example&nbsp;12.15.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">String home = "/home/glassfish";</pre></div></div><br class="example-break"></li><li class="step" title="Step 3.l"><p><span class="bold"><strong> Copy the contents of
                                this file into the
                                <code class="code">SamlCallbackHandler.java</code> window that is
                                displaying in the IDE. </strong></span></p></li></ol></li><li class="step" title="Step 4"><p><span class="bold"><strong>Drill down from
                        CalculatorClient | Web Service
                        References.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> Right-click on
                        CalculatorWSService and select Edit Web Service
                        Attributes. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select the Quality of
                        Service tab of the CalculatorWSService dialog.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> In the SAML Callback
                        Handler field, type the name of the class written in
                        step 3 above,
                        <code class="code">xwss.saml.SamlCallbackHandler</code> .
                        </strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Configure the keys: Click
                        on the keystore button, select the alias
                        "xws-security-client", enter the password "changeit",
                        in the password field. Submit this dialog; Click on
                        the truststore button, select the alias
                        "xws-security-server". Submit the dialog.
                        </strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Click OK to close this
                        dialog.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> In the tree, drill down
                        from the project to Source Packages | META-INF.
                        Double-click CalculatorWSService.xml, click the Source
                        tab, and look for that lines where
                        <code class="code">xwss.saml.SamlCallbackHandler</code> is
                        specified as the SAML Callback Handler class for the
                        client. In some instances, NetBeans will not correctly
                        specify the keystore and truststore information for
                        non-JSR-196 clients, and thus will require that the
                        keystore and truststore entries be manually
                        configured. To do this, follow the example in this
                        section. </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 10.1"><p><span class="bold"><strong> Find the
                                <code class="code">sc:KeyStore</code> and
                                <code class="code">sc:TrustStore</code> elements. If these
                                elements contain parameters for
                                <code class="code">location</code> and <code class="code">storepass</code> in
                                CalculatorWSService.xml, then just continue to the
                                next step. If not, replace the existing keystore and
                                truststore attributes to include these parameters.
                                The following code shows an example of how these
                                elements should be specified. </strong></span></p><div class="example"><a name="d0e10577"></a><p class="title"><b>Example&nbsp;12.16.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sc:TrustStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
   storepass="changeit" peeralias="xws-security-server"/&gt;
&lt;sc:KeyStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\keystore.jks"
   storepass="changeit" alias="xws-security-client"/&gt;</pre></div></div><br class="example-break"></li>
                        </ul></li><li class="step" title="Step 11"><p><span class="bold"><strong> Compile and run this
                        application by right-clicking the CalculatorClient
                        node and selecting Run. The result of the add
                        operation will display in a browser window.
                        </strong></span></p></li></ol></div></div></div><div class="section" title="12.9.7.&nbsp;Example: STS Issued Token (STS)"><div class="titlepage"><div><div><h3 class="title"><a name="ahiey"></a>12.9.7.&nbsp;Example: STS Issued Token (STS)</h3></div></div></div><p>This section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#gfrlq" title="To Create and Secure the STS (STS)">To Create and Secure the STS (STS)</a></p></li><li class="listitem"><p><a class="xref" href="#gfrmw" title="To Secure the Example Service Application (STS)">To Secure the Example Service Application (STS)</a></p></li><li class="listitem"><p><a class="xref" href="#gfrls" title="To Secure the Example Web Service Client Application (STS)">To Secure the Example Web Service Client Application
                (STS)</a></p></li></ul></div><p>Another STS example application can be found at the
            following URL: <a class="link" href="http://java.net/projects/wsit/sources/svn/show/trunk/wsit/samples/ws-trust" target="_top">http://java.net/projects/wsit/sources/svn/show/trunk/wsit/samples/ws-trust</a>
            .</p><div class="task" title="To Create and Secure the STS (STS)"><a name="gfrlq"></a><p class="title"><b>To Create and Secure the STS (STS)</b></p><div class="tasksummary">
                    <p>To create and secure a Security Token Service for
                    this example, follow these steps. </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>For development with NetBeans 6.8, there are
                            some temporary setup changes that will need to be
                            done--see <a class="link" href="http://old.nabble.com/Create-STS-with-Netbeans-6.8-and-Glassfish-V3-td27597150r0.html" target="_top">here</a>
                            for more details.</p></div>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create a new project for
                        the STS by selecting File | New Project.
                        </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Java Web, then Web
                        Application, then Next.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Type
                        <code class="code">MySTSProject</code> for the Project Name, then
                        Next, then the desired Server. Click
                        Finish.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Right-click the
                        <code class="code">MySTSProject</code> node, select New, then
                        select Other. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Web Services from
                        the Categories list.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select Secure Token
                        Service (STS) from the File Type(s) list, then click
                        Next. </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Type the name
                        <code class="code">MySTS</code> for the Web Service Class Name.
                        </strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Enter or select
                        <code class="code">org.me.my.sts</code> in the Package field, then
                        click Finish. If prompted to reload the
                        <code class="code">catalog.xml</code> file, click No.
                        </strong></span></p><p>The IDE takes a while to create the STS. When
                        created, it appears under the project's Web Services
                        node as <code class="code">MySTSService</code> .</p></li><li class="step" title="Step 9"><p><span class="bold"><strong> The STS wizard creates an
                        implementation of the provider class. To view it,
                        expand Source Packages, then org.me.my.sts.
                        Double-click <code class="code">MySTS.java</code> to open it in the
                        right pane. </strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> In the Projects window,
                        expand the MySTSProject node, then expand the Web
                        Services node. Right-click the
                        MySTSService[IMySTSService_Port] node and select Edit
                        Web Service Attributes to configure the STS.
                        </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Select the "Version
                        Compatibility" to ".NET 3.5 / Metro 1.3" ( e.g. see
                        <a class="xref" href="#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a> ) .
                        It will use WS-SX version of all WS-* specifications.
                        </strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong>Select Secure Service if
                        it's not already selected.</strong></span></p></li><li class="step" title="Step 13"><p><span class="bold"><strong> Verify that the Security
                        Mechanism of Username Authentication with Symmetric
                        Key is selected. </strong></span></p></li><li class="step" title="Step 14"><p><span class="bold"><strong> Select the Configure
                        button. For Algorithm Suite, verify that Basic128 bit
                        is selected (so that it matches the value selected for
                        the service.) Select OK to close the configuration
                        dialog. </strong></span></p></li><li class="step" title="Step 15"><p><span class="bold"><strong> If not already selected,
                        select Act as Secure Token Service (STS). </strong></span>
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you'd like to use an STS other than the
                                default, click the STS Configure button, and click
                                the Add button to add a different service provider.
                                Click OK to close the STS Configuration
                                dialog.</p></div></li><li class="step" title="Step 16"><p><span class="bold"><strong> Click Configure. In the
                        Issuer field, enter MySTS. Click OK to close.
                        </strong></span></p></li><li class="step" title="Step 17"><p><span class="bold"><strong> Click the Keystore button
                        to provide your keystore with the alias identifying
                        the service certificate and private key. To do this,
                        click the Load Aliases button, select
                        <code class="code">wssip</code> , then click OK to close the
                        dialog. </strong></span></p></li><li class="step" title="Step 18"><p><span class="bold"><strong>Click
                        OK.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Configuration Files |
                        xml-resources | web-services | MySTS | wsdl, then
                        double-click the file <code class="code">MySTSService.wsdl</code> .
                        This file contains the
                        <code class="code">tc:STSConfiguration</code> element within the
                        <code class="code">wsp:Policy</code> elements..</p></li><li class="step" title="Step 19"><p><span class="bold"><strong> Right-click the
                        MySTSProject tab, select Properties. Select the Run
                        category, and type the following in the Relative URL
                        field: <code class="code">/MySTSService?wsdl</code> .
                        </strong></span></p></li><li class="step" title="Step 20"><p><span class="bold"><strong>Run the Project
                        (right-click the project and select
                        Run).</strong></span></p><p>The STS WSDL appears in the browser.</p></li></ol></div></div><p>Check <a class="xref" href="#custom-sts" title="13.4.&nbsp;Building custom STS">Building custom STS</a>
            to build a custom STS to control the user attributes to be
            included in the SAML assertion.</p><div class="task" title="To Secure the Example Service Application (STS)"><a name="gfrmw"></a><p class="title"><b>To Secure the Example Service Application (STS)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    security to both the web service and to the web service
                    client.</p>

                    <p>For this example, the security mechanism of <a class="xref" href="#ahide" title="12.3.11.&nbsp;STS Issued Token">STS Issued Token</a> is used to
                    secure the application. The steps are similar to the ones
                    described in <a class="xref" href="#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a> , with the addition of
                    creating and securing an STS.</p>

                    <p>To add security to the service part of the example,
                    follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> . </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet). </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, then right-click
                        the node for the web service, CalculatorWS, and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Select the "Version
                        Compatibility" to ".NET 3.5 / Metro 1.3" ( e.g. see
                        <a class="xref" href="#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a> ) .
                        It will use WS-SX version of all WS-* specifications.
                        </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Deselect the Reliable
                        Messaging option if it is selected.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select STS Issued Token.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Click Configure. For
                        Issuer Address and Issuer Metadata Address, enter
                        <code class="code">http://localhost:8080/MySTSProject/MySTSService</code>
                        . For Issuer Metadata, enter
                        <code class="code">http://localhost:8080/MySTSProject/MySTSService/mex</code>
                        </strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> For Algorithm Suite,
                        select Basic 128 bit. For Key Size, select 128 (the
                        algorithm suite value of the service must match the
                        algorithm suite value of the STS). Select OK to close
                        the configuration dialog. </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you have configured Unlimited Strength
                                Encryption as described in <a class="xref" href="#gfrig" title="To Create a Third-Party STS">To Create a Third-Party STS</a> , you can leave the key
                                size at 256. Otherwise, you must set it to
                                128.</p></div></li><li class="step" title="Step 9"><p><span class="bold"><strong>Select Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong>Click
                        OK.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Web Pages | WEB-INF,
                        then double-click the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code>
                        and select the Source page. This file contains the
                        security elements within <code class="code">wsp:Policy</code>
                        tags.</p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run. This step
                        compiles the application and deploys it onto
                        GlassFish. A browser will open and display the WSDL
                        file for the application. </strong></span></p></li></ol></div></div><div class="task" title="To Secure the Example Web Service Client Application (STS)"><a name="gfrls"></a><p class="title"><b>To Secure the Example Web Service Client Application
                (STS)</b></p><div class="tasksummary">
                    <p>This section demonstrates adding security to the
                    CalculatorApplication's web service client. The service
                    was secured using the security mechanism described in
                    <a class="xref" href="#ahide" title="12.3.11.&nbsp;STS Issued Token">STS Issued Token</a> .</p>

                    <p>To add security to the web service client, complete
                    the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the client
                        application by following the steps described in <a class="xref" href="#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> . </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Whenever you make changes on the service,
                                refresh the client so that the client will pick up
                                the change. To refresh the client, right-click the
                                node for the Web Service Reference for the client,
                                and select Refresh Client.</p></div></li><li class="step" title="Step 2"><p><span class="bold"><strong> Drill down from
                        CalculatorWSServletClient | Web Service References.
                        </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Right-click
                        CalculatorWSService and select Edit Web Service
                        Attributes, then select the Quality of Service tab.
                        </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Provide the client's
                        private key by pointing to an alias in the keystore.
                        To do this, click the Keystore button, click the Load
                        Aliases button, and select
                        <code class="code">xws-security-client</code> from the Alias list.
                        </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> Provide the service's
                        certificate by pointing to an alias in the client
                        truststore. To do this, click the Truststore button,,
                        click the Load Aliases button for the truststore and
                        select <code class="code">xws-security-server</code> from the Alias
                        list. </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 5.1"><p><span class="bold"><strong> In some instances,
                                NetBeans will not detect that this client is a
                                JSR-196 client, and thus will require that the
                                keystore and truststore entries be manually
                                configured. To do this, follow the steps in this
                                section. </strong></span></p></li>

                            <li class="step" title="Step 5.2"><p><span class="bold"><strong>Expand
                                CalculatorWSServletClient | Source Packages |
                                META-INF.</strong></span></p></li>

                            <li class="step" title="Step 5.3"><p><span class="bold"><strong> Double-click
                                CalculatorWSService.xml to open it in the Source
                                window. Click the Source tab to view the code. Find
                                the <code class="code">sc:KeyStore</code> and
                                <code class="code">sc:TrustStore</code> elements. If these
                                elements contain parameters for
                                <code class="code">location</code> and <code class="code">storepass</code> ,
                                then just continue to the next section. If not, add
                                these attributes to this file. The following code
                                shows an example of how these elements should be
                                specified. </strong></span></p><div class="example"><a name="d0e10944"></a><p class="title"><b>Example&nbsp;12.17.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sc:TrustStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
   storepass="changeit" peeralias="xws-security-server"/&gt;
&lt;sc:KeyStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\keystore.jks"
   storepass="changeit" alias="xws-security-client"/&gt;</pre></div></div><br class="example-break"></li>
                        </ul></li><li class="step" title="Step 6"><p><span class="bold"><strong> Expand the Security Token
                        Service node to provide details for the STS to be
                        used. When the Endpoint and the Metadata values are
                        the same, you only need to enter the Endpoint value.
                        For the Endpoint field, enter the following value:
                        http://localhost:8080/MySTSProject/MySTSService. For
                        WS Trust Version field, select 1.3 if STS endpoint
                        uses ".NET 3.5 / Metro 1.3" version compatibility.
                        Otherwise use the default WS Trust Version.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click OK to close this
                        dialog.</strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> The service requires a
                        token to be issued from the STS at
                        <code class="code">http://localhost:8080/MySTSProject/MySTSService</code>
                        , with WSDL file
                        <code class="code">http://localhost:8080/MySTSProject/MySTSService?wsdl</code>
                        . To do this, follow these steps: </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 8.a"><p><span class="bold"><strong> Right-click the
                                CalculatorWSServletClient node and select New | Web
                                Service Client. </strong></span></p><p>The New Web Service Client window
                                appears.</p></li><li class="step" title="Step 8.b"><p><span class="bold"><strong>Select the WSDL URL
                                option.</strong></span></p></li><li class="step" title="Step 8.c"><p><span class="bold"><strong> Cut and paste the URL
                                of the web service that you want the client to
                                consume into the WSDL URL field. For this example,
                                here is the URL for the <code class="code">MySTS</code> web
                                service: </strong></span></p><pre class="programlisting">http://localhost:8080/MySTSProject/MySTSService?wsdl</pre></li><li class="step" title="Step 8.d"><p><span class="bold"><strong> Type
                                <code class="code">org.me.calculator.client.sts</code> in the
                                Package field, then click Finish. </strong></span></p><p>The Projects window displays the new web
                                service client.</p></li></ol></li><li class="step" title="Step 9"><p><span class="bold"><strong> Drill down from
                        CalculatorWSServletClient | Web Service References.
                        </strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong>Right-click MySTSService
                        and select Edit Web Service
                        Attributes.</strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Select the Quality of
                        Service tab of the MySTSService dialog.
                        </strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong> Provide the client's
                        private key by pointing to an alias in the keystore.
                        To do this, click the Keystore button, click the Load
                        Aliases button, and select
                        <code class="code">xws-security-client</code> from the Alias list.
                        If the Keystore button is not selectable, follow the
                        instructions in the next step for adding the keystore
                        entry manually. </strong></span></p></li><li class="step" title="Step 13"><p><span class="bold"><strong> Verify the STS's
                        certificate by pointing to an alias in the client
                        truststore. To do this, click the Truststore button,,
                        click the Load Aliases button and select
                        <code class="code">wssip</code> from the Alias list.
                        </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 13.1"><p><span class="bold"><strong> In some instances,
                                NetBeans will not detect that this client is a
                                JSR-196 client, and thus will require that the
                                keystore and truststore entries be manually
                                configured. To do this, follow the steps in this
                                section. </strong></span></p></li>

                            <li class="step" title="Step 13.2"><p><span class="bold"><strong>Expand
                                CalculatorWSServletClient | Source Packages |
                                META-INF.</strong></span></p></li>

                            <li class="step" title="Step 13.3"><p><span class="bold"><strong> Double-click
                                MySTSService.xml to open it in the Source window.
                                Click the Source tab to view the code. Find the
                                <code class="code">sc:KeyStore</code> and
                                <code class="code">sc:TrustStore</code> elements. If these
                                elements contain parameters for
                                <code class="code">location</code> and <code class="code">storepass</code> ,
                                then just continue to the next section. If not, add
                                these attributes to this file. The following code
                                shows an example of how these elements should be
                                specified. </strong></span></p><div class="example"><a name="d0e11049"></a><p class="title"><b>Example&nbsp;12.18.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sc:TrustStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
   storepass="changeit" peeralias="wssip"/&gt;
&lt;sc:KeyStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\keystore.jks"
   storepass="changeit" alias="xws-security-client"/&gt;</pre></div></div><br class="example-break"></li>
                        </ul></li><li class="step" title="Step 14"><p><span class="bold"><strong>Enter the default user
                        name and password.</strong></span></p><p>If you followed the steps in <a class="xref" href="#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a> , this
                        will be User Name <code class="code">wsitUser</code> and Password
                        <code class="code">changeit</code> .</p></li><li class="step" title="Step 15"><p><span class="bold"><strong>Click OK to close this
                        dialog.</strong></span></p></li><li class="step" title="Step 16"><p><span class="bold"><strong> Compile and run this
                        application by right-clicking the
                        CalculatorWSServletClient project and selecting Run.
                        The result of the add operation will display in a
                        browser window. </strong></span></p></li></ol></div></div></div><div class="section" title="12.9.8.&nbsp;Example: Broker Trust STS (BT)"><div class="titlepage"><div><div><h3 class="title"><a name="ahiex"></a>12.9.8.&nbsp;Example: Broker Trust STS (BT)</h3></div></div></div><p>Broker Trust STS example illustrates the interaction between
            client and server of different domains through STS's of
            corresponding domains. In this kind of scenarios, STS of different
            domains must have a trust relationship between them. Lets take
            client/STS2 are in domain A, and server/STS1 are in domain B.
            Here, STS1 is the remote STS on the server domain(B) and STS2 is
            the local STS on the client domain(B). There is a trust
            relationship between STS1 and STS2. Here are steps which client
            has to follow to comminicate with server. </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong> Client wants to
                        communicate with Server. </strong></span></p></li><li class="listitem"><p><span class="bold"><strong> Server asks Client to get
                        a token from STS1 to comminicate with it.
                        </strong></span></p></li><li class="listitem"><p><span class="bold"><strong> Now Client would like to
                        communicate with remote STS (i.e. STS1).
                        </strong></span></p></li><li class="listitem"><p><span class="bold"><strong> STS1 asks Client to get a
                        token from Client's local STS (i.e. STS2) to
                        comminicate with it. </strong></span></p></li><li class="listitem"><p><span class="bold"><strong> Now Client sends a
                        request to local STS (i.e. STS2) asking for a token to
                        communicate with STS1. </strong></span></p></li><li class="listitem"><p><span class="bold"><strong> STS2 issues a token to
                        Client, which Client uses to comminicate with STS1.
                        </strong></span></p></li><li class="listitem"><p><span class="bold"><strong> STS1 issues a token to
                        Client, which Client uses to comminicate with Server.
                        </strong></span></p></li><li class="listitem"><p><span class="bold"><strong> Now Client comminicates
                        with server using a token issued by STS1, which Server
                        understands. </strong></span></p></li></ul></div><p>This section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#gfrla" title="To Create and Secure the First STS (BT)">To Create and Secure the First STS (BT)</a></p></li><li class="listitem"><p><a class="xref" href="#gfrlb" title="To Create and Secure the Second STS (BT)">To Create and Secure the Second STS (BT)</a></p></li><li class="listitem"><p><a class="xref" href="#gfrmp" title="To Secure the Example Service Application (BT)">To Secure the Example Service Application (BT)</a></p></li><li class="listitem"><p><a class="xref" href="#gfrlr" title="To Secure the Example Web Service Client Application (BT)">To Secure the Example Web Service Client Application
                (BT)</a></p></li></ul></div><div class="task" title="To Create and Secure the First STS (BT)"><a name="gfrla"></a><p class="title"><b>To Create and Secure the First STS (BT)</b></p><div class="tasksummary">
                    <p>To create and secure a Security Token Service(i.e.
                    Remote STS) for this example, follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create a new project for
                        the STS by selecting File | New Project.
                        </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Web, then Web
                        Application, then Next.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Type <code class="code">
                        MySTS1Project</code> for the Project Name, then click
                        Finish. </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Right-click the <code class="code">
                        MySTS1Project</code> node, select New, then select
                        Other. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Web Services from
                        the Categories list.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select Secure Token
                        Service (STS) from the File Type(s) list, then click
                        Next. </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Type the name
                        <code class="code">MySTS1</code> for the Web Service Class Name.
                        </strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Enter or select
                        <code class="code">org.me.my.sts1</code> in the Package field, then
                        click Finish. If prompted to reload the
                        <code class="code">catalog.xml</code> file, click No.
                        </strong></span></p><p>The IDE takes a while to create the first STS.
                        When created, it appears under the project's Web
                        Services node as <code class="code">MySTS1Service</code> .</p></li><li class="step" title="Step 9"><p><span class="bold"><strong> The STS wizard creates an
                        implementation of the provider class. To view it,
                        expand Source Packages, then org.me.my.sts1.
                        Double-click <code class="code">MySTS1.java</code> to open it in
                        the right pane. </strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> In the Projects window,
                        expand the MySTS1Service node, then expand the Web
                        Services node. Right-click the
                        MySTS1Service[IMySTS1Service_Port] node and select
                        Edit Web Service Attributes to configure the STS.
                        </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Select the "Version
                        Compatibility" to ".NET 3.5 / Metro 1.3" ( e.g. see
                        <a class="xref" href="#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a> ) .
                        It will use WS-SX version of all WS-* specifications.
                        </strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong>Select Secure Service if
                        it's not already selected.</strong></span></p></li><li class="step" title="Step 13"><p><span class="bold"><strong> Verify that the Security
                        Mechanism of "STS Issued Token" is selected.
                        </strong></span></p></li><li class="step" title="Step 14"><p><span class="bold"><strong> Select the Configure
                        button. For Algorithm Suite, verify that Basic128 bit
                        is selected (so that it matches the value selected for
                        the service.) Select OK to close the configuration
                        dialog. </strong></span></p></li><li class="step" title="Step 15"><p><span class="bold"><strong> If not already selected,
                        select Act as Secure Token Service (STS). </strong></span>
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you'd like to use an STS other than the
                                default, click the STS Configure button, and click
                                the Add button to add a different service provider.
                                Click OK to close the STS Configuration
                                dialog.</p></div></li><li class="step" title="Step 16"><p><span class="bold"><strong> Click Configure. In the
                        Issuer field, enter MySTS1. Click OK to close.
                        </strong></span></p></li><li class="step" title="Step 17"><p><span class="bold"><strong> Click the Keystore button
                        to provide your keystore with the alias identifying
                        the service certificate and private key. To do this,
                        click the Load Aliases button, select
                        <code class="code">wssip</code> , then click OK to close the
                        dialog. </strong></span></p></li><li class="step" title="Step 18"><p><span class="bold"><strong>Click
                        OK.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Configuration Files |
                        xml-resources | web-services | MySTS1 | wsdl, then
                        double-click the file <code class="code">MySTS1Service.wsdl</code>
                        . This file contains the
                        <code class="code">tc:STSConfiguration</code> element within the
                        <code class="code">wsp:Policy</code> elements..</p></li><li class="step" title="Step 19"><p><span class="bold"><strong> Right-click the
                        MySTS1Project tab, select Properties. Select the Run
                        category, and type the following in the Relative URL
                        field: <code class="code">/MySTS1Service?wsdl</code> .
                        </strong></span></p></li><li class="step" title="Step 20"><p><span class="bold"><strong>Run the Project
                        (right-click the project and select
                        Run).</strong></span></p><p>The STS WSDL appears in the browser.</p></li></ol></div></div><div class="task" title="To Create and Secure the Second STS (BT)"><a name="gfrlb"></a><p class="title"><b>To Create and Secure the Second STS (BT)</b></p><div class="tasksummary">
                    <p>To create and secure a Security Token Service(i.e.
                    local STS) for this example, follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create a new project for
                        the 2nd STS by selecting File | New Project.
                        </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Web, then Web
                        Application, then Next.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Type <code class="code">
                        MySTS2Project</code> for the Project Name, then click
                        Finish. </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Right-click the <code class="code">
                        MySTS2Project</code> node, select New, then select
                        Other. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Web Services from
                        the Categories list.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select Secure Token
                        Service (STS) from the File Type(s) list, then click
                        Next. </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Type the name
                        <code class="code">MySTS2</code> for the Web Service Class Name.
                        </strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Enter or select
                        <code class="code">org.me.my.sts2</code> in the Package field, then
                        click Finish. If prompted to reload the
                        <code class="code">catalog.xml</code> file, click No.
                        </strong></span></p><p>The IDE takes a while to create the first STS.
                        When created, it appears under the project's Web
                        Services node as <code class="code">MySTS2Service</code> .</p></li><li class="step" title="Step 9"><p><span class="bold"><strong> The STS wizard creates an
                        implementation of the provider class. To view it,
                        expand Source Packages, then org.me.my.sts2.
                        Double-click <code class="code">MySTS2.java</code> to open it in
                        the right pane. </strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> In the Projects window,
                        expand the MySTS2Service node, then expand the Web
                        Services node. Right-click the
                        MySTS2Service[IMySTS2Service_Port] node and select
                        Edit Web Service Attributes to configure the STS.
                        </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Select the "Version
                        Compatibility" to ".NET 3.5 / Metro 1.3" ( e.g. see
                        <a class="xref" href="#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a> ) .
                        It will use WS-SX version of all WS-* specifications.
                        </strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong>Select Secure Service if
                        it's not already selected.</strong></span></p></li><li class="step" title="Step 13"><p><span class="bold"><strong> Verify that the Security
                        Mechanism of Username Authentication with Symmetric
                        Key is selected. </strong></span></p></li><li class="step" title="Step 14"><p><span class="bold"><strong> Select the Configure
                        button. For Algorithm Suite, verify that Basic128 bit
                        is selected (so that it matches the value selected for
                        the service.) Select OK to close the configuration
                        dialog. </strong></span></p></li><li class="step" title="Step 15"><p><span class="bold"><strong> If not already selected,
                        select Act as Secure Token Service (STS). </strong></span>
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you'd like to use an STS other than the
                                default, click the STS Configure button, and click
                                the Add button to add a different service provider.
                                Click OK to close the STS Configuration
                                dialog.</p></div></li><li class="step" title="Step 16"><p><span class="bold"><strong> Click Configure. In the
                        Issuer field, enter MySTS2. Click OK to close.
                        </strong></span></p></li><li class="step" title="Step 17"><p><span class="bold"><strong> Click the Keystore button
                        to provide your keystore with the alias identifying
                        the service certificate and private key. To do this,
                        click the Load Aliases button, select
                        <code class="code">wssip</code> , then click OK to close the
                        dialog. </strong></span></p></li><li class="step" title="Step 18"><p><span class="bold"><strong>Click
                        OK.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Configuration Files |
                        xml-resources | web-services | MySTS2 | wsdl, then
                        double-click the file <code class="code">MySTS2Service.wsdl</code>
                        . This file contains the
                        <code class="code">tc:STSConfiguration</code> element within the
                        <code class="code">wsp:Policy</code> elements..</p></li><li class="step" title="Step 19"><p><span class="bold"><strong> Right-click the
                        MySTS2Project tab, select Properties. Select the Run
                        category, and type the following in the Relative URL
                        field: <code class="code">/MySTS2Service?wsdl</code> .
                        </strong></span></p></li><li class="step" title="Step 20"><p><span class="bold"><strong>Run the Project
                        (right-click the project and select
                        Run).</strong></span></p><p>The STS WSDL appears in the browser.</p></li></ol></div></div><div class="task" title="To Secure the Example Service Application (BT)"><a name="gfrmp"></a><p class="title"><b>To Secure the Example Service Application (BT)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    security to both the web service and to the web service
                    client.</p>

                    <p>For this example, the security mechanism of <a class="xref" href="#ahide" title="12.3.11.&nbsp;STS Issued Token">STS Issued Token</a> is used to
                    secure the application. The steps are similar to the ones
                    described in <a class="xref" href="#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a>, with the addition of creating
                    and securing an STS.</p>

                    <p>To add security to the service part of the example,
                    follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> . </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet). </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, then right-click
                        the node for the web service, CalculatorWS, and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Select the "Version
                        Compatibility" to ".NET 3.5 / Metro 1.3" ( e.g. see
                        <a class="xref" href="#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a> ) .
                        It will use WS-SX version of all WS-* specifications.
                        </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Deselect the Reliable
                        Messaging option if it is selected.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select STS Issued Token.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Click Configure. For
                        Issuer Address and Issuer Metadata Address, enter
                        <code class="code">http://localhost:8080/MySTS1Project/MySTS1Service</code>
                        . For Issuer Metadata, enter
                        <code class="code">http://localhost:8080/MySTS1Project/MySTS1Service/mex</code>
                        </strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> For Algorithm Suite,
                        select Basic 128 bit. For Key Size, select 128 (the
                        algorithm suite value of the service must match the
                        algorithm suite value of the STS). Select OK to close
                        the configuration dialog. </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you have configured Unlimited Strength
                                Encryption as described in <a class="xref" href="#gfrig" title="To Create a Third-Party STS">To Create a Third-Party STS</a> , you can leave the key
                                size at 256. Otherwise, you must set it to
                                128.</p></div></li><li class="step" title="Step 9"><p><span class="bold"><strong>Select Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong>Click
                        OK.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Web Pages | WEB-INF,
                        then double-click the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code>
                        and select the Source page. This file contains the
                        security elements within <code class="code">wsp:Policy</code>
                        tags.</p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Properties.
                        Select the Run category, and type the following in the
                        Relative URL field:
                        <code class="code">/CalculatorWSService?wsdl</code> .
                        </strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run. This step
                        compiles the application and deploys it onto
                        GlassFish. A browser will open and display the WSDL
                        file for the application. </strong></span></p></li></ol></div></div><div class="task" title="To Secure the Example Web Service Client Application (BT)"><a name="gfrlr"></a><p class="title"><b>To Secure the Example Web Service Client Application
                (BT)</b></p><div class="tasksummary">
                    <p>This section demonstrates adding security to the
                    CalculatorApplication's web service client. The service
                    was secured using the security mechanism described in
                    <a class="xref" href="#ahide" title="12.3.11.&nbsp;STS Issued Token">STS Issued Token</a> .</p>

                    <p>To add security to the web service client, complete
                    the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the client
                        application by following the steps described in <a class="xref" href="#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> . </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Whenever you make changes on the service,
                                refresh the client so that the client will pick up
                                the change. To refresh the client, right-click the
                                node for the Web Service Reference for the client,
                                and select Refresh Client.</p></div></li><li class="step" title="Step 2"><p><span class="bold"><strong> Drill down from
                        CalculatorWSServletClient | Web Service References.
                        </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Right-click
                        CalculatorWSService and select Edit Web Service
                        Attributes, then select the Quality of Service tab.
                        </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Provide the client's
                        private key by pointing to an alias in the keystore.
                        To do this, click the Keystore button, click the Load
                        Aliases button, and select
                        <code class="code">xws-security-client</code> from the Alias list.
                        </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> Provide the service's
                        certificate by pointing to an alias in the client
                        truststore. To do this, click the Truststore button,,
                        click the Load Aliases button for the truststore and
                        select <code class="code">xws-security-server</code> from the Alias
                        list. </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 5.1"><p><span class="bold"><strong> In some instances,
                                NetBeans will not detect that this client is a
                                JSR-196 client, and thus will require that the
                                keystore and truststore entries be manually
                                configured. To do this, follow the steps in this
                                section. </strong></span></p></li>

                            <li class="step" title="Step 5.2"><p><span class="bold"><strong>Expand
                                CalculatorWSServletClient | Source Packages |
                                META-INF.</strong></span></p></li>

                            <li class="step" title="Step 5.3"><p><span class="bold"><strong> Double-click
                                CalculatorWSService.xml to open it in the Source
                                window. Click the Source tab to view the code. Find
                                the <code class="code">sc:KeyStore</code> and
                                <code class="code">sc:TrustStore</code> elements. If these
                                elements contain parameters for
                                <code class="code">location</code> and <code class="code">storepass</code> ,
                                then just continue to the next section. If not, add
                                these attributes to this file. The following code
                                shows an example of how these elements should be
                                specified. </strong></span></p><div class="example"><a name="d0e11605"></a><p class="title"><b>Example&nbsp;12.19.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sc:TrustStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
   storepass="changeit" peeralias="xws-security-server"/&gt;
&lt;sc:KeyStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\keystore.jks"
   storepass="changeit" alias="xws-security-client"/&gt;</pre></div></div><br class="example-break"></li>
                        </ul></li><li class="step" title="Step 6"><p><span class="bold"><strong>Click OK to close this
                        dialog.</strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> The service requires a
                        token to be issued from the first STS (i.e Remote STS)
                        at
                        <code class="code">http://localhost:8080/MySTS1Project/MySTS1Service</code>
                        , with WSDL file
                        <code class="code">http://localhost:8080/MySTS1Project/MySTS1Service?wsdl</code>.
                        To do this, follow these steps: </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 7.a"><p><span class="bold"><strong> Right-click the
                                CalculatorWSServletClient node and select New | Web
                                Service Client. </strong></span></p><p>The New Web Service Client window
                                appears.</p></li><li class="step" title="Step 7.b"><p><span class="bold"><strong>Select the WSDL URL
                                option.</strong></span></p></li><li class="step" title="Step 7.c"><p><span class="bold"><strong> Cut and paste the URL
                                of the web service that you want the client to
                                consume into the WSDL URL field. For this example,
                                here is the URL for the <code class="code">MySTS1</code> web
                                service: </strong></span></p><pre class="programlisting">http://localhost:8080/MySTS1Project/MySTS1Service?wsdl</pre></li><li class="step" title="Step 7.d"><p><span class="bold"><strong> Type
                                <code class="code">org.me.calculator.client.sts1</code> in the
                                Package field, then click Finish. </strong></span></p><p>The Projects window displays the new web
                                service client.</p></li></ol></li><li class="step" title="Step 8"><p><span class="bold"><strong> Drill down from
                        CalculatorWSServletClient | Web Service References.
                        </strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Right-click MySTS1Service
                        and select Edit Web Service
                        Attributes.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> Select the Quality of
                        Service tab of the MySTS1Service dialog.
                        </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Provide the client's
                        private key by pointing to an alias in the keystore.
                        To do this, click the Keystore button, click the Load
                        Aliases button, and select
                        <code class="code">xws-security-client</code> from the Alias list.
                        If the Keystore button is not selectable, follow the
                        instructions in the next step for adding the keystore
                        entry manually. </strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong> Verify the STS's
                        certificate by pointing to an alias in the client
                        truststore. To do this, click the Truststore button,,
                        click the Load Aliases button and select
                        <code class="code">wssip</code> from the Alias list.
                        </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 12.1"><p><span class="bold"><strong> In some instances,
                                NetBeans will not detect that this client is a
                                JSR-196 client, and thus will require that the
                                keystore and truststore entries be manually
                                configured. To do this, follow the steps in this
                                section. </strong></span></p></li>

                            <li class="step" title="Step 12.2"><p><span class="bold"><strong>Expand
                                CalculatorWSServletClient | Source Packages |
                                META-INF.</strong></span></p></li>

                            <li class="step" title="Step 12.3"><p><span class="bold"><strong> Double-click
                                MySTSService.xml to open it in the Source window.
                                Click the Source tab to view the code. Find the
                                <code class="code">sc:KeyStore</code> and
                                <code class="code">sc:TrustStore</code> elements. If these
                                elements contain parameters for
                                <code class="code">location</code> and <code class="code">storepass</code> ,
                                then just continue to the next section. If not, add
                                these attributes to this file. The following code
                                shows an example of how these elements should be
                                specified. </strong></span></p><div class="example"><a name="d0e11706"></a><p class="title"><b>Example&nbsp;12.20.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sc:TrustStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
   storepass="changeit" peeralias="wssip"/&gt;
&lt;sc:KeyStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\keystore.jks"
   storepass="changeit" alias="xws-security-client"/&gt;</pre></div></div><br class="example-break"></li>
                        </ul></li><li class="step" title="Step 13"><p><span class="bold"><strong> Expand the Security Token
                        Service node to provide details for the second
                        STS(i.e. local STS) to be used. When the Endpoint and
                        the Metadata values are the same, you only need to
                        enter the Endpoint value. For the Endpoint field,
                        enter the following value:
                        http://localhost:8080/MySTS2Project/MySTS2Service. For
                        WS Trust Version field, select 1.3 if STS endpoint
                        uses ".NET 3.5 / Metro 1.3" version compatibility.
                        Otherwise use the default WS Trust Version.
                        </strong></span></p></li><li class="step" title="Step 14"><p><span class="bold"><strong>Click OK to close this
                        dialog.</strong></span></p></li><li class="step" title="Step 15"><p><span class="bold"><strong> The First STS(i.e. Remote
                        STS) requires a token to be issued from the second
                        STS(i.e. local STS) at
                        <code class="code">http://localhost:8080/MySTS2Project/MySTS2Service</code>
                        , with WSDL file
                        <code class="code">http://localhost:8080/MySTS2Project/MySTS2Service?wsdl</code>
                        . To do this, follow these steps: </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 15.a"><p><span class="bold"><strong> Right-click the
                                CalculatorWSServletClient node and select New | Web
                                Service Client. </strong></span></p><p>The New Web Service Client window
                                appears.</p></li><li class="step" title="Step 15.b"><p><span class="bold"><strong>Select the WSDL URL
                                option.</strong></span></p></li><li class="step" title="Step 15.c"><p><span class="bold"><strong> Cut and paste the URL
                                of the web service that you want the client to
                                consume into the WSDL URL field. For this example,
                                here is the URL for the <code class="code">MySTS2</code> web
                                service: </strong></span></p><pre class="programlisting">http://localhost:8080/MySTS2Project/MySTS2Service?wsdl</pre></li><li class="step" title="Step 15.d"><p><span class="bold"><strong> Type
                                <code class="code">org.me.calculator.client.sts2</code> in the
                                Package field, then click Finish. </strong></span></p><p>The Projects window displays the new web
                                service client.</p></li></ol></li><li class="step" title="Step 16"><p><span class="bold"><strong> Drill down from
                        CalculatorWSServletClient | Web Service References.
                        </strong></span></p></li><li class="step" title="Step 17"><p><span class="bold"><strong>Right-click MySTS2Service
                        and select Edit Web Service
                        Attributes.</strong></span></p></li><li class="step" title="Step 18"><p><span class="bold"><strong> Select the Quality of
                        Service tab of the MySTS2Service dialog.
                        </strong></span></p></li><li class="step" title="Step 19"><p><span class="bold"><strong> Provide the client's
                        private key by pointing to an alias in the keystore.
                        To do this, click the Keystore button, click the Load
                        Aliases button, and select
                        <code class="code">xws-security-client</code> from the Alias list.
                        If the Keystore button is not selectable, follow the
                        instructions in the next step for adding the keystore
                        entry manually. </strong></span></p></li><li class="step" title="Step 20"><p><span class="bold"><strong> Verify the STS's
                        certificate by pointing to an alias in the client
                        truststore. To do this, click the Truststore button,,
                        click the Load Aliases button and select
                        <code class="code">wssip</code> from the Alias list.
                        </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 20.1"><p><span class="bold"><strong> In some instances,
                                NetBeans will not detect that this client is a
                                JSR-196 client, and thus will require that the
                                keystore and truststore entries be manually
                                configured. To do this, follow the steps in this
                                section. </strong></span></p></li>

                            <li class="step" title="Step 20.2"><p><span class="bold"><strong>Expand
                                CalculatorWSServletClient | Source Packages |
                                META-INF.</strong></span></p></li>

                            <li class="step" title="Step 20.3"><p><span class="bold"><strong> Double-click
                                MySTS2Service.xml to open it in the Source window.
                                Click the Source tab to view the code. Find the
                                <code class="code">sc:KeyStore</code> and
                                <code class="code">sc:TrustStore</code> elements. If these
                                elements contain parameters for
                                <code class="code">location</code> and <code class="code">storepass</code> ,
                                then just continue to the next section. If not, add
                                these attributes to this file. The following code
                                shows an example of how these elements should be
                                specified. </strong></span></p><div class="example"><a name="d0e11811"></a><p class="title"><b>Example&nbsp;12.21.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sc:TrustStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
   storepass="changeit" peeralias="wssip"/&gt;
&lt;sc:KeyStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\keystore.jks"
   storepass="changeit" alias="xws-security-client"/&gt;</pre></div></div><br class="example-break"></li>
                        </ul></li><li class="step" title="Step 21"><p><span class="bold"><strong>Enter the default user
                        name and password.</strong></span></p><p>If you followed the steps in <a class="xref" href="#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a> , this
                        will be User Name <code class="code">wsitUser</code> and Password
                        <code class="code">changeit</code> .</p></li><li class="step" title="Step 22"><p><span class="bold"><strong>Click OK to close this
                        dialog.</strong></span></p></li><li class="step" title="Step 23"><p><span class="bold"><strong> Compile and run this
                        application by right-clicking the
                        CalculatorWSServletClient project and selecting Run.
                        The result of the add operation will display in a
                        browser window. </strong></span></p></li></ol></div></div></div><div class="section" title="12.9.9.&nbsp;Example: STS Issued Token With SecureConversation (STS+SC)"><div class="titlepage"><div><div><h3 class="title"><a name="ahiez"></a>12.9.9.&nbsp;Example: STS Issued Token With SecureConversation
            (STS+SC)</h3></div></div></div><p>This example illustrates, how SecureConversation Token is
            used to interact with STS. To have a basic idea of
            SecureConversation, find this article : <span class="bold"><strong>
            <a class="link" href="http://blogs.sun.com/enterprisetechtips/entry/secure_conversations_for_web_services" target="_top">Secure
            Conversations for Web Services With Metro</a>
            </strong></span></p><p>This section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#gfrle" title="To Create and Secure the STS with SecureConversationToken (STS+SC)">To Create and Secure the STS with
                SecureConversationToken (STS+SC)</a></p></li><li class="listitem"><p><a class="xref" href="#gfrlf" title="To Secure the Example Service Application (STS+SC)">To Secure the Example Service Application
                (STS+SC)</a></p></li><li class="listitem"><p><a class="xref" href="#gfrmg" title="To Secure the Example Web Service Client Application (STS+SC)">To Secure the Example Web Service Client Application
                (STS+SC)</a></p></li></ul></div><p title="To Create and Secure the STS with SecureConversationToken (STS+SC)"><a name="gfrle"></a><b>To Create and Secure the STS with
                SecureConversationToken (STS+SC).&nbsp;</b></p><p>Same as provided in <a class="xref" href="#gfrlq" title="To Create and Secure the STS (STS)">To Create and Secure the STS (STS)</a></p><div class="task" title="To Secure the Example Service Application (STS+SC)"><a name="gfrlf"></a><p class="title"><b>To Secure the Example Service Application
                (STS+SC)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    security to both the web service and to the web service
                    client.</p>

                    <p>For this example, the security mechanism of <a class="xref" href="#ahide" title="12.3.11.&nbsp;STS Issued Token">STS Issued Token</a> is used to
                    secure the application. The steps are similar to the ones
                    described in <a class="xref" href="#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a> , with the addition of
                    creating and securing an STS.</p>

                    <p>To add security to the service part of the example,
                    follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> . </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet). </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, then right-click
                        the node for the web service, CalculatorWS, and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Select the "Version
                        Compatibility" to ".NET 3.5 / Metro 1.3" ( e.g. see
                        <a class="xref" href="#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a> ) .
                        It will use WS-SX version of all WS-* specifications.
                        </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Deselect the Reliable
                        Messaging option if it is selected.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select STS Issued Token.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Click Configure. For
                        Issuer Address and Issuer Metadata Address, enter
                        <code class="code">http://localhost:8080/MySTSProject/MySTSService</code>
                        . For Issuer Metadata, enter
                        <code class="code">http://localhost:8080/MySTSProject/MySTSService/mex</code>
                        </strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Select the Configure
                        button and do the following :</strong></span></p><p><span class="bold"><strong> For Algorithm Suite,
                        verify that Basic128 bit is selected (so that it
                        matches the value selected for the
                        service.)</strong></span></p><p><span class="bold"><strong> Check the Establish
                        Secure Session (Secure Conversation) check box to
                        enable the secure conversaion
                        feature</strong></span></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you have configured Unlimited Strength
                            Encryption as described in <a class="xref" href="#gfrig" title="To Create a Third-Party STS">To Create a Third-Party STS</a> , you can leave the key
                            size at 256. Otherwise, you must set it to
                            128.</p></div><p><span class="bold"><strong> Select OK to close the
                        configuration dialog. </strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Select Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong>Click
                        OK.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Web Pages | WEB-INF,
                        then double-click the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code>
                        and select the Source page. This file contains the
                        security elements within <code class="code">wsp:Policy</code>
                        tags.</p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run. This step
                        compiles the application and deploys it onto
                        GlassFish. A browser will open and display the WSDL
                        file for the application. </strong></span></p></li></ol></div></div><p title="To Secure the Example Web Service Client Application (STS+SC)"><a name="gfrmg"></a><b>To Secure the Example Web Service Client Application
                (STS+SC).&nbsp;</b></p><p>Same as provided in <a class="xref" href="#gfrls" title="To Secure the Example Web Service Client Application (STS)">To Secure the Example Web Service Client Application
                (STS)</a></p></div><div class="section" title="12.9.10.&nbsp;Example: Kerberos Token (Kerb)"><div class="titlepage"><div><div><h3 class="title"><a name="gfzhh"></a>12.9.10.&nbsp;Example: Kerberos Token (Kerb)</h3></div></div></div><p>This section contains the steps for running a Kerberos Token
            Profile-based WS Security scenario. Kerberos support was added to
            Metro in 1.1 release. The Netbeans support for configuring a
            Kerberos Token based secure web service is available from Metro
            1.3 and Netbeans 6.5.</p><p>For an article discussing using Kerberos with WSIT, go to
            <a class="link" href="http://blogs.sun.com/enterprisetechtips/entry/building_kerberos_based_secure_services" target="_top">Building
            Kerberos-Based Secure Services Using Metro</a>. This article
            has a sample application, but does not use Netbeans IDE.</p><p>The section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#gfzgj" title="To Set Up Your System for Kerberos Profile">To Set Up Your System for Kerberos Profile</a></p></li><li class="listitem"><p><a class="xref" href="#gfzgt" title="To Secure the Example Service Application (Kerb)">To Secure the Example Service Application
                (Kerb)</a></p></li><li class="listitem"><p><a class="xref" href="#gfzhj" title="To Secure the Example Web Service Client Application (Kerb)">To Secure the Example Web Service Client Application
                (Kerb)</a></p></li></ul></div><p title="To Set Up Your System for Kerberos Profile"><a name="gfzgj"></a><b>To Set Up Your System for Kerberos Profile.&nbsp;</b></p><p>If your system is not already set up to use Kerberos, refer
            to the steps mentioned in <a class="xref" href="#ConfiguringKerberos" title="12.6.&nbsp;Configuring Kerberos for Glassfish and Tomcat">Configuring Kerberos for Glassfish and Tomcat</a>.</p><div class="task" title="To Secure the Example Service Application (Kerb)"><a name="gfzgt"></a><p class="title"><b>To Secure the Example Service Application
                (Kerb)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    security to both the web service and to the web service
                    client.</p>

                    <p>For this example, a Kerberos token is used to secure
                    the application. To add security to the service part of
                    the example, follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a>. </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet) </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, then right-click
                        the node for the web service (CalculatorWS) and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Deselect Reliable
                        Messaging if it is selected.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> In the
                        CalculatorWSPortBinding section, select Secure
                        Service. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select Symmetric Binding with
                        Kerberos Tokens. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select Kerberos button,
                        and specify the Login Module to be used for the
                        service. For details on Login Module to specify refer
                        <a class="xref" href="#ConfiguringKerberos" title="12.6.&nbsp;Configuring Kerberos for Glassfish and Tomcat">Configuring Kerberos for Glassfish and Tomcat</a>. </strong></span> </p><div class="figure"><a name="kerberosServerConfig"></a><p class="title"><b>Figure&nbsp;12.8.&nbsp;Kerberos Configuration Attributes -
                                Service</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/kerberos_server_config.png" height="360" alt="Kerberos Configuration Attributes - Service"></td></tr></table></div></div></div><p><br class="figure-break"></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Click OK to close the
                        <code class="code">CalculatorWSService</code> dialog.
                        </strong></span></p><p>Expand Web Pages | WEB-INF, then double-click
                        the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code>
                        to open it in the edit window.The Binding level policy
                        looks like: (This section of code has been formatted
                        to fit the page)</p><div class="example"><a name="d0e12106"></a><p class="title"><b>Example&nbsp;12.22.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;wsp:Policy wsu:Id="IFinancialService_policy"&gt;
   &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
         &lt;wsaws:UsingAddressing
                 xmlns:wsaws="http://www.w3.org/2006/05/addressing/wsdl"/&gt;
         &lt;sp:SymmetricBinding&gt;
            &lt;wsp:Policy&gt;
               &lt;sp:ProtectionToken&gt;
                  &lt;wsp:Policy&gt;
                     &lt;sp:KerberosToken
                             sp:IncludeToken="http://docs.oasis-open.org/
                        ws-sx/ws-securitypolicy/200702/IncludeToken/Once"&gt;
                        &lt;wsp:Policy&gt;
                           &lt;sp:WssGssKerberosV5ApReqToken11/&gt;
                        &lt;/wsp:Policy&gt;
                     &lt;/sp:KerberosToken&gt;
                  &lt;/wsp:Policy&gt;
               &lt;/sp:ProtectionToken&gt;
               &lt;sp:Layout&gt;
                  &lt;wsp:Policy&gt;
                     &lt;sp:Strict/&gt;
                  &lt;/wsp:Policy&gt;
               &lt;/sp:Layout&gt;
               &lt;sp:IncludeTimestamp/&gt;
               &lt;sp:OnlySignEntireHeadersAndBody/&gt;
               &lt;sp:AlgorithmSuite&gt;
                  &lt;wsp:Policy&gt;
                     &lt;sp:Basic128/&gt;
                  &lt;/wsp:Policy&gt;
               &lt;/sp:AlgorithmSuite&gt;
            &lt;/wsp:Policy&gt;
         &lt;/sp:SymmetricBinding&gt;
         &lt;sp:Wss11&gt;
            &lt;wsp:Policy&gt;
               &lt;sp:MustSupportRefKeyIdentifier/&gt;
               &lt;sp:MustSupportRefIssuerSerial/&gt;
               &lt;sp:MustSupportRefThumbprint/&gt;
               &lt;sp:MustSupportRefEncryptedKey/&gt;
            &lt;/wsp:Policy&gt;
         &lt;/sp:Wss11&gt;
         &lt;sc:KerberosConfig xmlns:
                            sc="http://schemas.sun.com/2006/03/wss/server"
                            loginModule="KerberosServer"/&gt;
      &lt;/wsp:All&gt;
   &lt;/wsp:ExactlyOne&gt;
&lt;/wsp:Policy&gt;</pre></div></div><br class="example-break"></li><li class="step" title="Step 8"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run. A browser
                        will open and display the WSDL file for the
                        application. </strong></span></p><p>If the application doesn't build, expand
                        CalculatorApplication | Web Pages | WEB-INF, and
                        double-click <code class="code">web.xml</code> to open it in the
                        right pane. Select the Security tab, and remove any
                        existing security constraints. Then run the project
                        again.</p></li><li class="step" title="Step 9"><p><span class="bold"><strong> Follow the steps to
                        secure the client application as described in <a class="xref" href="#gfzhj" title="To Secure the Example Web Service Client Application (Kerb)">To Secure the Example Web Service Client Application
                (Kerb)</a>.
                        </strong></span></p></li></ol></div></div><div class="task" title="To Secure the Example Web Service Client Application (Kerb)"><a name="gfzhj"></a><p class="title"><b>To Secure the Example Web Service Client Application
                (Kerb)</b></p><div class="tasksummary">
                    <p>This section demonstrates adding security to the web
                    service client that references the web service created in
                    the previous section. . This section also assumes that
                    Kerberos environment has already been setup on the system.
                    Refer to <a class="xref" href="#ConfiguringKerberos" title="12.6.&nbsp;Configuring Kerberos for Glassfish and Tomcat">Configuring Kerberos for Glassfish and Tomcat</a> for more details.</p>

                    <p>To add security to the client that references this
                    web service, complete the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the client
                        application by following the steps described in <a class="xref" href="#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a>. </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Whenever you make changes on the service,
                                refresh the client so that the client will pick up
                                the change. To refresh the client, right-click the
                                node for the Web Service Reference for the client,
                                and select Refresh Client.</p></div></li><li class="step" title="Step 2"><p><span class="bold"><strong>Expand the node for the
                        web service client application,
                        CalculatorWSServletClient. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Expand the Web Service
                        References node. </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Right-click on
                        CalculatorWSService, select Edit Web Service
                        Attributes. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Expand the Web Service
                        References node. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> In the Security section
                        of the Quality of Service tab, select Kerberos.
                        Specify Login Module, Service Principal and check the
                        box if credentials should be delegated.
                        </strong></span></p><p>Specify the Login Module to the one you created
                        in <span class="emphasis"><em>login.conf</em></span> file for the client
                        in the section <a class="xref" href="#ConfiguringKerberos" title="12.6.&nbsp;Configuring Kerberos for Glassfish and Tomcat">Configuring Kerberos for Glassfish and Tomcat</a>, and the service principal
                        for which the ticket needs to be obtained.</p><p>Kerberos support in Metro security supports
                        credential delegation from client to service, such
                        that the server can initiate other security contexts
                        on behalf of the client. This feature is useful for
                        single sign-on in a multi-tier environment. Select the
                        checkbox for credential delegation.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>At the service, we can obtain the delegated
                            credentials from the <a class="link" href="http://download.oracle.com/javase/6/docs/api/javax/security/auth/Subject.html" target="_top">Subject</a>
                            of the authenticated user. The PrivateCredential set
                            of the will have the delegated client credentials
                            (as <a class="link" href="http://download.oracle.com/javase/6/docs/api/org/ietf/jgss/GSSCredential.html" target="_top">GSSCredential</a>).
                            We can pass this GSSCredential to <a class="link" href="http://download.oracle.com/javase/6/docs/api/org/ietf/jgss/GSSManager.html" target="_top">GSSManager</a>.createContext()
                            pretending to be the client.</p><p>Also, the PublicCredential set of the
                            authenticated Subject will always have <a class="link" href="http://download.oracle.com/javase/6/docs/api/javax/security/auth/kerberos/KerberosPrincipal.html" target="_top">KerberosPrincipal</a>
                            corresponding to the client.</p></div><div class="figure"><a name="kerberosClientConfig"></a><p class="title"><b>Figure&nbsp;12.9.&nbsp;Kerberos Configuration Attributes -
                            Client</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/kerberos_client_config.png" height="360" alt="Kerberos Configuration Attributes - Client"></td></tr></table></div></div></div><br class="figure-break"></li><li class="step" title="Step 7"><p><span class="bold"><strong> Right-click the
                        CalculatorWSServletClient node and select Run. The
                        result of the add operation will display in a browser
                        window. </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If your client is a Java SE client, you need
                                to set the following system properties while running
                                your client code: </p><div class="example"><a name="d0e12215"></a><p class="title"><b>Example&nbsp;12.23.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">-Djava.security.policy=${glassfish.home}/domains/domain1/config/server.policy

-Djava.security.auth.login.config=${glassfish.home}/domains/domain1/config/login.conf</pre></div></div><p><br class="example-break"> If it is WebApp deployed on
                                glassfish, nothing else needs to be done.</p></div></li></ol></div></div></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;13.&nbsp;WSIT Security Features: Advanced: Topics"><div class="titlepage"><div><div><h2 class="title"><a name="ahife"></a>Chapter&nbsp;13.&nbsp;WSIT Security Features: Advanced: Topics</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#ahiff">13.1. Using Security Mechanisms</a></span></dt><dt><span class="section"><a href="#ahifg">13.2. Understanding WSIT Configuration Files</a></span></dt><dd><dl><dt><span class="section"><a href="#ahifh">13.2.1. Service-Side WSIT Configuration Files</a></span></dt><dt><span class="section"><a href="#ahifi">13.2.2. Client-Side WSIT Configuration Files</a></span></dt></dl></dd><dt><span class="section"><a href="#ahifj">13.3. Security Mechanism Configuration Options</a></span></dt><dt><span class="section"><a href="#custom-sts">13.4. Building custom STS</a></span></dt><dd><dl><dt><span class="section"><a href="#sts-claims">13.4.1. Handling Claims with Metro STS</a></span></dt></dl></dd><dt><span class="section"><a href="#sts-client-run-time-config">13.5. Handling Token and Key Requirements at Run Time</a></span></dt><dt><span class="section"><a href="#advanced-sts-usage">13.6. Advanced Usages of STS in Security</a></span></dt><dd><dl><dt><span class="section"><a href="#sts-sso">13.6.1. Token Caching and Sharing</a></span></dt><dt><span class="section"><a href="#sts-delegation">13.6.2. ActAs and Identity Delegation</a></span></dt></dl></dd></dl></div><div class="section" title="13.1.&nbsp;Using Security Mechanisms"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahiff"></a>13.1.&nbsp;Using Security Mechanisms</h2></div></div></div><p>The security mechanism that you need to select reflects the
        commonly available infrastructure between your organization and
        another organization with which you will be communicating. The
        following list provides some common communication issues that need to
        be addressed using security mechanisms:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Asymmetric binding is used for message protection. This
                binding has two binding specific token properties: the
                initiator token and the recipient token. If the message
                pattern requires multiple messages, this binding defines that
                the initiator token is used for the message signature from
                initiator to the recipient, and for encryption from recipient
                to initiator. The recipient token is used for encryption from
                initiator to recipient, and for the message signature from
                recipient to initiator.</p></li><li class="listitem"><p>Some organizations have a Kerberos infrastructure, while
                other organizations have a PKI infrastructure (asymmetric
                binding). WS-Trust allows two communicating parties having
                different security infrastructure to communicate securely with
                one another. In this scenario, the client authenticates with a
                third party (STS) using its infrastructure. The STS returns a
                (digitally-signed) SAML token containing authorization and
                authentication information regarding the client, along with a
                key. The client then simply relays the token to the server and
                uses the STS-supplied key to ensure integrity and
                confidentiality of the messages sent to the server.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Kerberos is supported in Metro since 1.1 release.
                    Netbeans support is available for Kerberos from Metro 1.3
                    and Netbeans 6.5 release. Kerberos is NOT supported on AIX 
                    systems.</p></div></li><li class="listitem"><p>Symmetric binding is used for message protection. This
                binding has two binding specific token properties: encryption
                token and signature token. If the message pattern requires
                multiple messages, this binding defines that the encryption
                token used from initiator to recipient is also used from
                recipient to initiator. Similarly, the signature token used
                from initiator to recipient is also used from recipient to
                initiator.</p><p>In some cases, the client does not have its own
                certificates. In this case, the client can choose a security
                mechanism that makes use of symmetric binding and could use a
                Username token as a signed supporting token for authentication
                with the server. The symmetric binding in this case serves the
                purpose of integrity and confidentiality protection.</p></li><li class="listitem"><p>In the absence of a notion of secure session, the client
                would have to reauthenticate with the server upon every
                request. In this situation, if the client is sending a
                Username token, the client will be asked for its username and
                password on each request, or, if the client is sending a
                certificate, the validity of the certificate has to be
                established with every request. This is expensive! Enable
                Secure Conversation to remove the requirement for
                re-authentication.</p></li><li class="listitem"><p>The use of the same session key (Secure Conversation)
                for repeated message exchanges is sometimes considered a risk.
                To reduce that risk, enable Require Derived Keys.</p></li><li class="listitem"><p>RSA Signatures (signatures with public-private keys) is
                more expensive than Symmetric Key signatures. Use the Secure
                Conversation option to enable Symmetric Key signatures.</p></li><li class="listitem"><p>Enabling WSS 1.1 enables an encrypted key generated by
                the client to be reused by the server in the response to the
                client. This saves the time otherwise required to create a
                Symmetric Key, encrypt it with the client public key (which is
                also an expensive RSA operation), and transmit the encrypted
                key in the message (it occupies markup and requires Base64
                operations).</p></li></ul></div></div><div class="section" title="13.2.&nbsp;Understanding WSIT Configuration Files"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahifg"></a>13.2.&nbsp;Understanding WSIT Configuration Files</h2></div></div></div><p>When a web service or a web service client are configured for
        WSIT features, this information is saved in WSIT Configuration files.
        The following sections discuss the WSIT configuration files for the
        service and for the client:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahifh" title="13.2.1.&nbsp;Service-Side WSIT Configuration Files">Service-Side WSIT Configuration Files</a></p></li><li class="listitem"><p><a class="xref" href="#ahifi" title="13.2.2.&nbsp;Client-Side WSIT Configuration Files">Client-Side WSIT Configuration Files</a></p></li></ul></div><div class="section" title="13.2.1.&nbsp;Service-Side WSIT Configuration Files"><div class="titlepage"><div><div><h3 class="title"><a name="ahifh"></a>13.2.1.&nbsp;Service-Side WSIT Configuration Files</h3></div></div></div><p>WSIT features are configured on a web service in the
            following way:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Right-click the web service in NetBeans IDE.</p></li><li class="listitem"><p>Select Edit Web Service Attributes.</p></li><li class="listitem"><p>Select and/or configure the appropriate WSIT
                    features on the Quality Of Service Configuration tab for
                    the web service. Many of the WSIT features are discussed
                    in <a class="xref" href="#ahici" title="Chapter&nbsp;12.&nbsp;Using WSIT Security"><i>Using WSIT Security</i></a>.</p></li><li class="listitem"><p>Select OK to close the dialog.</p></li><li class="listitem"><p>Run the web application by right-clicking the
                    project node and selecting Run Project.</p></li></ol></div><p>The service-side WSIT Configuration file that is used when
            the web service is deployed can be viewed by expanding the Web
            Pages | WEB-INF elements of the application in the tree, and then
            double-clicking the <code class="code">wsit-package.service.xml</code> file to
            open it in the editor.</p><p>For the example application <a class="xref" href="#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a>, the WSIT configuration file for the
            service is named
            <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code>, and looks
            like this:</p><div class="example"><a name="d0e12303"></a><p class="title"><b>Example&nbsp;13.1.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions
        xmlns="http://schemas.xmlsoap.org/wsdl/"
        xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
        name="CalculatorWSService"
        targetNamespace="http://calculator.me.org/"
        xmlns:tns="http://calculator.me.org/"
        xmlns:wsp="http://schemas.xmlsoap.org/ws/2004/09/policy"
        xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/
                oasis-200401-wss-wssecurity-utility-1.0.xsd"
        xmlns:wsaws="http://www.w3.org/2005/08/addressing"
        xmlns:sp="http://schemas.xmlsoap.org/ws/2005/07/securitypolicy"
        xmlns:sc="http://schemas.sun.com/2006/03/wss/server"
        xmlns:wspp="http://java.sun.com/xml/ns/wsit/policy"&gt;
   &lt;message name="add"/&gt;
   &lt;message name="addResponse"/&gt;
   &lt;portType name="CalculatorWS"&gt;
      &lt;operation name="add"&gt;
         &lt;input message="tns:add"/&gt;
         &lt;output message="tns:addResponse"/&gt;
      &lt;/operation&gt;
   &lt;/portType&gt;
   &lt;binding name="CalculatorWSPortBinding" type="tns:CalculatorWS"&gt;
      &lt;wsp:PolicyReference URI="#CalculatorWSPortBindingPolicy"/&gt;
      &lt;operation name="add"&gt;
         &lt;input&gt;
            &lt;wsp:PolicyReference
                    URI="#CalculatorWSPortBinding_add_Input_Policy"/&gt;
         &lt;/input&gt;
         &lt;output&gt;
            &lt;wsp:PolicyReference
                    URI="#CalculatorWSPortBinding_add_Output_Policy"/&gt;
         &lt;/output&gt;
      &lt;/operation&gt;
   &lt;/binding&gt;
   &lt;service name="CalculatorWSService"&gt;
      &lt;port name="CalculatorWSPort" binding="tns:CalculatorWSPortBinding"/&gt;
   &lt;/service&gt;
   &lt;wsp:Policy wsu:Id="CalculatorWSPortBindingPolicy"&gt;
      &lt;wsp:ExactlyOne&gt;
         &lt;wsp:All&gt;
            &lt;wsaws:UsingAddressing
                    xmlns:wsaws="http://www.w3.org/2006/05/addressing/wsdl"/&gt;
            &lt;sp:SymmetricBinding&gt;
               &lt;wsp:Policy&gt;
                  &lt;sp:ProtectionToken&gt;
                     &lt;wsp:Policy&gt;
                        &lt;sp:X509Token sp:IncludeToken=
                           "http://schemas.xmlsoap.org/ws/2005/07/
                           securitypolicy/IncludeToken/Never"&gt;
                           &lt;wsp:Policy&gt;
                              &lt;sp:WssX509V3Token10/&gt;
                           &lt;/wsp:Policy&gt;
                        &lt;/sp:X509Token&gt;
                     &lt;/wsp:Policy&gt;
                  &lt;/sp:ProtectionToken&gt;
                  &lt;sp:Layout&gt;
                     &lt;wsp:Policy&gt;
                        &lt;sp:Strict/&gt;
                     &lt;/wsp:Policy&gt;
                  &lt;/sp:Layout&gt;
                  &lt;sp:IncludeTimestamp/&gt;
                  &lt;sp:OnlySignEntireHeadersAndBody/&gt;
                  &lt;sp:AlgorithmSuite&gt;
                     &lt;wsp:Policy&gt;
                        &lt;sp:Basic128/&gt;
                     &lt;/wsp:Policy&gt;
                  &lt;/sp:AlgorithmSuite&gt;
               &lt;/wsp:Policy&gt;
            &lt;/sp:SymmetricBinding&gt;
            &lt;sp:Wss11&gt;
               &lt;wsp:Policy&gt;
                  &lt;sp:MustSupportRefKeyIdentifier/&gt;
                  &lt;sp:MustSupportRefIssuerSerial/&gt;
                  &lt;sp:MustSupportRefThumbprint/&gt;
                  &lt;sp:MustSupportRefEncryptedKey/&gt;
               &lt;/wsp:Policy&gt;
            &lt;/sp:Wss11&gt;
            &lt;sp:SignedSupportingTokens&gt;
               &lt;wsp:Policy&gt;
                  &lt;sp:UsernameToken
                          sp:IncludeToken="http://schemas.xmlsoap.org/
                                           ws/2005/07/securitypolicy/
                                           IncludeToken/AlwaysToRecipient"&gt;
                     &lt;wsp:Policy&gt;
                        &lt;sp:WssUsernameToken10/&gt;
                     &lt;/wsp:Policy&gt;
                  &lt;/sp:UsernameToken&gt;
               &lt;/wsp:Policy&gt;
            &lt;/sp:SignedSupportingTokens&gt;
            &lt;sc:KeyStore wspp:visibility="private"
                         alias="xws-security-server"/&gt;
         &lt;/wsp:All&gt;
      &lt;/wsp:ExactlyOne&gt;
   &lt;/wsp:Policy&gt;
   &lt;wsp:Policy wsu:Id="CalculatorWSPortBinding_add_Input_Policy"&gt;
      &lt;wsp:ExactlyOne&gt;
         &lt;wsp:All&gt;
            &lt;sp:EncryptedParts&gt;
               &lt;sp:Body/&gt;
            &lt;/sp:EncryptedParts&gt;
            &lt;sp:SignedParts&gt;
               &lt;sp:Body/&gt;
               &lt;sp:Header Name="To"
                          Namespace="http://www.w3.org/2005/08/addressing"/&gt;
               &lt;sp:Header Name="From"
                          Namespace="http://www.w3.org/2005/08/addressing"/&gt;
               &lt;sp:Header Name="FaultTo"
                          Namespace="http://www.w3.org/2005/08/addressing"/&gt;
               &lt;sp:Header Name="ReplyTo"
                          Namespace="http://www.w3.org/2005/08/addressing"/&gt;
               &lt;sp:Header
                       Name="MessageID" Namespace=
                       "http://www.w3.org/2005/08/addressing"/&gt;
               &lt;sp:Header
                       Name="RelatesTo" Namespace=
                       "http://www.w3.org/2005/08/addressing"/&gt;
               &lt;sp:Header Name="Action"
                          Namespace="http://www.w3.org/2005/08/addressing"/&gt;
               &lt;sp:Header Name="AckRequested"
                          Namespace="http://schemas.xmlsoap.org/ws/2005/02/rm"/&gt;
               &lt;sp:Header Name="SequenceAcknowledgement"
                          Namespace="http://schemas.xmlsoap.org/ws/2005/02/rm"/&gt;
               &lt;sp:Header Name="Sequence"
                          Namespace="http://schemas.xmlsoap.org/ws/2005/02/rm"/&gt;
            &lt;/sp:SignedParts&gt;
         &lt;/wsp:All&gt;
      &lt;/wsp:ExactlyOne&gt;
   &lt;/wsp:Policy&gt;
   &lt;wsp:Policy wsu:Id="CalculatorWSPortBinding_add_Output_Policy"&gt;
      &lt;wsp:ExactlyOne&gt;
         &lt;wsp:All&gt;
            &lt;sp:EncryptedParts&gt;
               &lt;sp:Body/&gt;
            &lt;/sp:EncryptedParts&gt;
            &lt;sp:SignedParts&gt;
               &lt;sp:Body/&gt;
               &lt;sp:Header Name="To"
                          Namespace="http://www.w3.org/2005/08/addressing"/&gt;
               &lt;sp:Header Name="From"
                          Namespace="http://www.w3.org/2005/08/addressing"/&gt;
               &lt;sp:Header Name="FaultTo"
                          Namespace="http://www.w3.org/2005/08/addressing"/&gt;
               &lt;sp:Header Name="ReplyTo"
                          Namespace="http://www.w3.org/2005/08/addressing"/&gt;
               &lt;sp:Header Name="MessageID"
                          Namespace="http://www.w3.org/2005/08/addressing"/&gt;
               &lt;sp:Header Name="RelatesTo"
                          Namespace="http://www.w3.org/2005/08/addressing"/&gt;
               &lt;sp:Header Name="Action"
                          Namespace="http://www.w3.org/2005/08/addressing"/&gt;
               &lt;sp:Header Name="AckRequested"
                          Namespace="http://schemas.xmlsoap.org/ws/2005/02/rm"/&gt;
               &lt;sp:Header Name="SequenceAcknowledgement"
                          Namespace="http://schemas.xmlsoap.org/ws/2005/02/rm"/&gt;
               &lt;sp:Header Name="Sequence"
                          Namespace="http://schemas.xmlsoap.org/ws/2005/02/rm"/&gt;
            &lt;/sp:SignedParts&gt;
         &lt;/wsp:All&gt;
      &lt;/wsp:ExactlyOne&gt;
   &lt;/wsp:Policy&gt;
&lt;/definitions&gt;</pre></div></div><br class="example-break"></div><div class="section" title="13.2.2.&nbsp;Client-Side WSIT Configuration Files"><div class="titlepage"><div><div><h3 class="title"><a name="ahifi"></a>13.2.2.&nbsp;Client-Side WSIT Configuration Files</h3></div></div></div><p>WSIT features are configured on the client in the following
            way:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Expand the Web Service Reference node for the web
                    service client in NetBeans IDE.</p></li><li class="listitem"><p>Select Edit Web Service Attributes.</p></li><li class="listitem"><p>Select and/or configure the appropriate WSIT
                    features on the Quality Of Service tab for the web service
                    client. Many of the WSIT features are discussed in <a class="xref" href="#ahici" title="Chapter&nbsp;12.&nbsp;Using WSIT Security"><i>Using WSIT Security</i></a>.</p></li><li class="listitem"><p>Select OK to close the dialog.</p></li><li class="listitem"><p>Run the web service client by right-clicking the
                    project node and selecting Run Project.</p></li></ol></div><p>The WSIT Configuration information can be viewed by
            expanding Source Packages | META-INF in NetBeans IDE for the
            client project. This directory contains two files:
            <code class="code">serviceService.xml</code> and
            <code class="code">wsit-client.xml</code>.</p><p>The <code class="code">serviceService.xml</code> file is an XML file that
            must conform to the WSDL specification. The WSIT configuration is
            written to this file. For the example application <a class="xref" href="#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a>, the WSIT
            configuration file for the client is named
            <code class="code">CalculatorWSService.xml</code>, and looks like this:</p><div class="example"><a name="d0e12348"></a><p class="title"><b>Example&nbsp;13.2.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- Published by JAX-WS RI at http://jax-ws.java.net. RI's version
                is JAX-WS RI 2.1.2_01-hudson-189-. --&gt;&lt;!-- Generated by JAX-WS
                RI at http://jax-ws.java.net. RI's version is JAX-WS RI
                2.1.2_01-hudson-189-. --&gt;
&lt;definitions
        xmlns:wsu=
             "http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-
             utility-1.0.xsd"
        xmlns:wsp="http://schemas.xmlsoap.org/ws/2004/09/policy"
        xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
        xmlns:tns="http://calculator.me.org/"
        mlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns="http://schemas.xmlsoap.org/wsdl/"
        targetNamespace="http://calculator.me.org/"
        name="CalculatorWSService"
        xmlns:sc="http://schemas.sun.com/2006/03/wss/client"
        xmlns:wspp="http://java.sun.com/xml/ns/wsit/policy"
        xmlns:tc="http://schemas.sun.com/ws/2006/05/trust/client"&gt;
   
   &lt;wsp:UsingPolicy&gt;&lt;/wsp:UsingPolicy&gt;
   &lt;types&gt;
      &lt;xsd:schema&gt;
         &lt;xsd:import namespace="http://calculator.me.org/"
                     schemaLocation="http://localhost:8080/CalculatorApplication/
                CalculatorWSService?xsd=1"&gt;
         &lt;/xsd:import&gt;
      &lt;/xsd:schema&gt;
   &lt;/types&gt;
   &lt;message name="add"&gt;
      &lt;part name="parameters" element="tns:add"&gt;&lt;/part&gt;
   &lt;/message&gt;
   &lt;message name="addResponse"&gt;
      &lt;part name="parameters" element="tns:addResponse"&gt;&lt;/part&gt;
   &lt;/message&gt;
   &lt;portType name="CalculatorWS"&gt;
      &lt;operation name="add"&gt;
         &lt;input message="tns:add"&gt;&lt;/input&gt;
         &lt;output message="tns:addResponse"&gt;&lt;/output&gt;
      &lt;/operation&gt;
   &lt;/portType&gt;
   &lt;binding name="CalculatorWSPortBinding" type="tns:CalculatorWS"&gt;
      &lt;wsp:PolicyReference URI="#CalculatorWSPortBindingPolicy"/&gt;
      &lt;soap:binding transport="http://schemas.xmlsoap.org/
                soap/http" style="document"&gt;&lt;/soap:binding&gt;
      &lt;operation name="add"&gt;
         &lt;soap:operation soapAction=""&gt;&lt;/soap:operation&gt;
         &lt;input&gt;
            &lt;soap:body use="literal"&gt;&lt;/soap:body&gt;
         &lt;/input&gt;
         &lt;output&gt;
            &lt;soap:body use="literal"&gt;&lt;/soap:body&gt;
         &lt;/output&gt;
      &lt;/operation&gt;
   &lt;/binding&gt;
   &lt;service name="CalculatorWSService"&gt;
      &lt;port name="CalculatorWSPort" binding="tns:CalculatorWSPortBinding"&gt;
         &lt;soap:address location="http://localhost:8080/
                CalculatorApplication/CalculatorWSService"&gt;
         &lt;/soap:address&gt;
      &lt;/port&gt;
   &lt;/service&gt;
   &lt;wsp:Policy wsu:Id="CalculatorWSPortBindingPolicy"&gt;
      &lt;wsp:ExactlyOne&gt;
         &lt;wsp:All&gt;
            &lt;sc:KeyStore
                  wspp:visibility="private"
                  location="c:\Sun\glassfish\domains\domain1\config\keystore.jks"
                  storepass="changeit" alias="xws-security-client"/&gt;
            &lt;sc:TrustStore
                    wspp:visibility="private"
                    location="c:\Sun\glassfish\domains\domain1\config\cacerts.jks"
                    storepass="changeit"
                    peeralias="xws-security-server"/&gt;
            &lt;tc:PreconfiguredSTS wspp:visibility="private"/&gt;
            &lt;sc:CallbackHandlerConfiguration wspp:visibility="private"&gt;
               &lt;sc:CallbackHandler default="wsitUser"
                                   name="usernameHandler"/&gt;
               &lt;sc:CallbackHandler default="changeit"
                                   name="passwordHandler"/&gt;
            &lt;/sc:CallbackHandlerConfiguration&gt;
         &lt;/wsp:All&gt;
      &lt;/wsp:ExactlyOne&gt;
   &lt;/wsp:Policy&gt;
&lt;/definitions&gt;</pre></div></div><br class="example-break"><p>The <code class="code">wsit-client.xml</code> file imports the
            <code class="code">serviceService.xml</code> file. For the example shown about,
            the <code class="code">wsit-client.xml</code> file looks like this:</p><div class="example"><a name="d0e12363"></a><p class="title"><b>Example&nbsp;13.3.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions
        xmlns="http://schemas.xmlsoap.org/wsdl/"
        xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
        name="mainclientconfig"&gt;
    &lt;import location="CalculatorWSService.xml"
            namespace="http://calculator.me.org/"/&gt;
&lt;/definitions&gt;</pre></div></div><br class="example-break"><p>When running the client, these two files will need to be in
            the classpath, either at the classpath root (i.e., build/classes)
            or in a META-INF directory under the classpath root.</p></div></div><div class="section" title="13.3.&nbsp;Security Mechanism Configuration Options"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahifj"></a>13.3.&nbsp;Security Mechanism Configuration Options</h2></div></div></div><p>The following fields shown in <a class="xref" href="#ahifk" title="Table&nbsp;13.1.&nbsp;Security Mechanism Configuration Options">Security Mechanism Configuration Options</a> are used to configure different security
        policies. Not every option is available for every mechanism, but many
        of the policies include the same configuration options, so they are
        grouped here for the purposes of defining them in one central
        location.</p><div class="table"><a name="ahifk"></a><p class="title"><b>Table&nbsp;13.1.&nbsp;Security Mechanism Configuration Options</b></p><div class="table-contents"><table summary="Security Mechanism Configuration Options" border="1"><colgroup><col><col></colgroup><thead><tr><th><p>Option</p></th><th><p>Description</p></th></tr></thead><tbody><tr><td><p>Algorithm Suite</p></td><td><p>This attribute specifies the algorithm
                        suite required for performing cryptographic operations
                        with symmetric or asymmetric key-based security
                        tokens. An algorithm suite specifies actual algorithms
                        and allowed key lengths. A mechanism alternative will
                        define what algorithms are used and how they are used.
                        The value of this attribute is typically referenced by
                        a security binding and is used to specify the
                        algorithms used for all cryptographic operations
                        performed under the security binding. The default
                        value is Basic 128 bit.</p> <p>Some of the
                        algorithm suite settings require that Unlimited
                        StrengthEncryption be configured in the Java Runtime
                        Environment (JRE), particularly the algorithm suites
                        that use 256 bit encryption. Instructions for
                        downloading and configuring unlimited strength
                        encryption can be found at the following URLS:</p>
                        <p>
                                 

                                <a class="link" href="http://www.oracle.com/technetwork/java/javase/tech/index-jsp-136007.html" target="_top">http://www.oracle.com/technetwork/java/javase/tech/index-jsp-136007.html</a>

                                 
                            </p> <p>
                                 

                                <a class="link" href="http://java.sun.com/javase/downloads/index_jdk5.jsp#docs" target="_top">http://java.sun.com/javase/downloads/index_jdk5.jsp#docs</a>

                                 
                            </p> <p>Read the OASIS specification
                        WS-Security Policy section on Security Binding
                        Properties for more description of the components for
                        each of these algorithm suites. A link to this
                        document can be found at <a class="link" href="http://wsit.java.net/" target="_top">http://wsit.java.net/</a>.</p></td></tr><tr><td><p>Encrypt Before Signing</p></td><td><p>If selected, specifies that the order of
                        message protection is to encrypt the SOAP content,
                        then sign the entire SOAP body. Encryption key and
                        signing key must be derived from the same source
                        key.</p> <p>If not selected, the default
                        behavior is Sign Before Encrypt.</p></td></tr><tr><td><p>Encrypt Signature</p></td><td><p>Specifies whether the signature must be
                        encrypted. If selected, the primary signature must be
                        encrypted and any signature confirmation elements must
                        also be encrypted. If not selected (the default), the
                        primary signature must not be encrypted and any
                        signature confirmation elements must not be
                        encrypted.</p></td></tr><tr><td><p>Enable EPR Identity</p></td><td><p>This feature enables the service to
                        produce its public key in the wsdl.Clients who wants
                        to consume the service can use this public key to
                        encrypt messages and hence they do not need to specify
                        the peerAlias in their configuration, but still
                        TrustStore configuration is needed to validate the
                        certificate. Current Netbeans versions do not support
                        the UI to configure this.So for a detailed description
                        about this feature and to know how to configure this ,
                        please visit the blog: <a class="link" href="http://blogs.sun.com/SureshMandalapu/entry/support_of_endpoint_references_with" target="_top">
                        http://blogs.sun.com/SureshMandalapu/entry/support_of_endpoint_references_with
                        </a> </p></td></tr><tr><td><p>Securing only some of the WS
                        operations</p></td><td><p>With latest metro we can secure only
                        required operations in a service unlike in the older
                        version where we have to secure either all or no
                        operations.This means the security is at binding level
                        , but not at operation level.But with latest metro ,
                        the security policies can be specified for individual
                        operations,thus we can secure only required operations
                        in a service</p> <p>For a detailed description
                        and how to configure this , please go through the
                        blog: <a class="link" href="http://blogs.sun.com/SureshMandalapu/entry/support_of_binding_assertions_at" target="_top">
                        http://blogs.sun.com/SureshMandalapu/entry/support_of_binding_assertions_at
                        </a> </p></td></tr><tr><td><p>Establish Secure Session (Secure
                        Conversation)</p></td><td><p>Secure Conversation enables a consumer
                        and provider to establish a shared security context
                        when a multiple-message-exchange sequence is first
                        initiated. Subsequent messages use (possibly derived)
                        session keys that increase the overall security while
                        reducing the security processing overhead for each
                        message.</p> <p>In the absence of a notion of
                        secure session, the client would have to
                        reauthenticate with the server upon every request. In
                        this situation, if the client is sending a Username
                        token, it has to authenticate on every request, or, if
                        the client is sending a certificate, the validity of
                        the certificate has to be established on every
                        request. This is expensive. Enable Secure Conversation
                        to get over this requirement for
                        re-authentication.</p> <p>When this option and
                        Require Derived Keys are both enabled, a derived key
                        will be used. If not, the original session key will be
                        used.</p> <p>Note on Secure Conversation with
                        Reliable Message Delivery: Reliable Messaging can be
                        used independently of the security mechanisms;
                        however, when Reliable Messaging (RM) is used with a
                        security mechanism, it requires the use of Secure
                        Conversation, which will be automatically configured
                        for a security mechanism when Reliable Messaging is
                        selected before the security mechanism is selected. If
                        Secure Conversation is selected for a security
                        mechanism and the Reliable Messaging option was not
                        selected before the security mechanism was specified,
                        Reliable Messaging will need to be manually selected
                        in order for Secure Conversation to work. Reliable
                        messaging, as well as the Advanced configuration
                        options and Deliver Messages in Exact Order feature,
                        is discussed in <a class="xref" href="#using_rm" title="Chapter&nbsp;10.&nbsp;Using Reliable Messaging"><i>Using Reliable Messaging</i></a>.</p></td></tr><tr><td><p>Issuer Address</p></td><td><p>This optional element specifies the
                        address of the issuer (STS) that will accept the
                        security token that is presented in the message. This
                        element's type is an endpoint reference. An STS
                        contains a set of interfaces to be used for the
                        issuance, exchange, and validation of security tokens.
                        An example that creates and uses an STS can be found
                        at <a class="xref" href="#ahiey" title="12.9.7.&nbsp;Example: STS Issued Token (STS)">Example: STS Issued Token (STS)</a>.</p> <p>For example,
                        a Metro STS Issuer Address might be:</p>
                        <div class="informalexample"><pre class="programlisting">http://localhost:8080/jaxws-sts/sts</pre></div> <p>An examle WCF STS Issuer
                        Address might be:</p> <div class="informalexample"><pre class="programlisting">http://131.107.72.15/ \
Security_Federation_SecurityTokenService_Indigo/ \
Symmetric.svc/ \
Scenario_5_IssuedTokenForCertificate_MutualCertificate11</pre></div></td></tr><tr><td><p>Issuer Metadata Address</p></td><td><p>Specifies the address (URLs) from which
                        to retrieve the issuer metadata. For example, a Metro
                        STS Issuer Metadata Address might be:</p>
                        <div class="informalexample"><pre class="programlisting">http://localhost:8080/jaxws-sts/sts</pre></div> <p>For a WCF STS the Issuer
                        Metadata Address might be:</p> <div class="informalexample"><pre class="programlisting">http://131.107.72.15/ \
Security_Federation_SecurityTokenService_Indigo/ \
Symmetric.svc</pre></div> <p>For more information,
                        read <a class="xref" href="#ahieb" title="12.8.&nbsp;Configuring A Secure Token Service (STS)">Configuring A Secure Token Service (STS)</a>.</p></td></tr><tr><td><p>Key Type</p></td><td><p>Applicable for Issued Token mechanisms
                        only. The type of key the service provider desires.
                        The choices are public key or symmetric key. Symmetric
                        key cryptography relies on a shared secret and is
                        usually faster than public key cryptography. Public
                        key cryptography relies on a key that is made public
                        to all and is primarily used for encryption but can be
                        used for verifying signatures.</p></td></tr><tr><td><p>Key Size</p></td><td><p>Applicable for Issued Token mechanisms
                        only. The size of the symmetric key requested,
                        specified in number of bits. This is a request, and,
                        as such, the requested security token is not obligated
                        to use the requested key size, nor is the STS
                        obligated to issue a token with the same key size.
                        That said, the recipient should try to use a key at
                        least as strong as the specified value if possible.
                        The information is provided as an indication of the
                        desired strength of the security. Valid choices
                        include 128, 192, and 256.</p></td></tr><tr><td><p>Require Client Certificate</p></td><td><p>Select this option to require that a
                        client certificate be provided to the server for
                        verification.</p> <p>If you are using a security
                        mechanism with SSL, a client certificate will be
                        required by the server both during its initial
                        handshake and again during
                        verification.</p></td></tr><tr><td><p>Require Derived Keys</p> <p>Require
                        Derived Keys for:</p> <p>Issued Token, Secure
                        Session, X509 Token</p></td><td><p>A derived key is a cryptographic key
                        created from a password or other user data. Derived
                        keys allow applications to create session keys as
                        needed, eliminating the need to store a particular
                        key. The use of the same session key (for example,
                        when using Secure Conversation) for repeated message
                        exchanges is sometimes considered a risk. To reduce
                        that risk, enable Require Derived Keys.</p></td></tr><tr><td><p>Require Signature
                        Confirmation</p></td><td><p>When the WSS Version is 1.1, select this
                        option to reduce the risk of attacks because signature
                        confirmation indicates that the responder has
                        processed the signature in the request. For more
                        information, read section 8.5, Signature Confirmation,
                        of the Web Services Security: SOAP Message Security
                        1.1 specification at <a class="link" href="http://www.oasis-open.org/committees/download.php/16790/wss-v1.1-spec-os-SOAPMessageSecurity.pdf" target="_top">http://www.oasis-open.org/committees/download.php/16790/wss-v1.1-spec-os-SOAPMessageSecurity.pdf</a>.</p></td></tr><tr><td><p>SAML Version</p></td><td><p>Specifies which version of the SAML token
                        should be used. The SAML Version is something the
                        <code class="code">CallbackHandler</code> has to verify, not the
                        security runtime. SAML tokens are defined in WSS: SAML
                        Token Profile documents, available from <a class="link" href="http://www.oasis-open.org/specs/index.php" target="_top">http://www.oasis-open.org/specs/index.php</a>.</p>
                        <p>For an example that uses SAML Callbacks, refer
                        to <a class="xref" href="#ahies" title="12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)">Example: SAML Authorization over SSL (SA)</a>.</p></td></tr><tr><td><p>Security Header Layout</p></td><td><p>Specifies which layout rules to apply
                        when adding items to the security header. The options
                        are: </p> <div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Strict</em></span>: Items are added
                                    to the security header following the general
                                    principle of "declare before using".</p></li><li class="listitem"><p><span class="emphasis"><em>Lax</em></span>: Items are added to
                                    the security header in any order that conforms to
                                    WSS: SOAP Message Security. However, WSIT follows
                                    Strict even when Lax is selected.</p></li><li class="listitem"><p><span class="emphasis"><em>Lax (Timestamp First or
                                    Last)</em></span>: The same as for Lax, except that
                                    the first or last item in the security header must
                                    be a <code class="code">wsse:Timestamp</code>.</p></li></ul></div> <p>Examples of the layout rules
                        are described in the OASIS WS-SecurityPolicy
                        specification, a link to which can be found at <a class="link" href="http://wsit.java.net/" target="_top">http://wsit.java.net/</a>.</p></td></tr><tr><td><p>Supporting Token</p></td><td><p>Specifies the type of supporting token to
                        be used. Supporting Tokens are included in the
                        security header and may sign and/or encrypt additional
                        message parts. Valid options for supporting tokens
                        include X.509 tokens, Username tokens, SAML tokens, or
                        an Issued Token from an STS.</p> <p>For more
                        information on these options, read <a class="xref" href="#ahiea" title="12.7.1.&nbsp;Supporting Token Options">Supporting Token Options</a>.</p></td></tr><tr><td><p>Token Type</p></td><td><p>The type of SAML token the service
                        provider requires, for example,
                        <code class="code">urn:oasis:names:tc:SAML1.0:assertion</code>.Choices
                        are 1.0, 1.1, or 2.0.</p></td></tr><tr><td><p>WSS Version</p></td><td><p>Specifies which version of the Web
                        Services Security specification should be followed,
                        1.0 or 1.1. These specifications can be viewed from
                        <a class="link" href="http://www.oasis-open.org/specs/index.php" target="_top">http://www.oasis-open.org/specs/index.php</a>.</p>
                        <p>Enabling WSS 1.1 enables an encrypted key
                        generated by the client to be reused by the Server in
                        the response to the client. This saves the time
                        otherwise required to create a Symmetric Key during
                        the course of response, encrypt it with the client
                        public key (which is also an expensive RSA operation),
                        and transmit the encrypted key in the message (it
                        occupies markup and requires Base64 operations).
                        Enabling WSS 1.1 also enables encrypted
                        headers.</p></td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" title="13.4.&nbsp;Building custom STS"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="custom-sts"></a>13.4.&nbsp;Building custom STS</h2></div></div></div><p>It is described in section 11.8 (<a class="xref" href="#gfrig" title="To Create a Third-Party STS">To Create a Third-Party STS</a>) how to build a WS-Trust Security Token
        Service (STS). Thus created STS can be configured to authenticate the
        client with username/passwords, X.509 certificates, etc. and to issue
        either SAML 1.0 or SAML 2.0 assertions. By default the issued SAML
        tokens will contain an SAML AttributeStatement with the user
        authenticated identity to the STS and a dummy attribute.</p><p>In practice, users may have different identities when using
        different web services. For authorization or privacy purposes,
        different user identity and/or user attributes (e.g. role or
        authorization code) are required to be included in the issued SAML
        assertion for a service.</p><p>WSIT provides an interface
        com.sun.xml.ws.api.security.trust.STSAttributeProvider for use in
        plugging user identity/attribute mappings into an STS. The
        implementation class of the STSAttributeProvider is exposed to the
        system with the standard ServiceFinder mechanism, i.e. using a file
        META-INF/services/com.sun.xml.ws.api.security.trust.STSAttributeProvider
        in the classpath. The file contains the names of STSAttributeProvider
        implementation classes, one per line. The mapped user
        identity/attributes will be picked up when creating SAML
        assertions.</p><p>Here are the steps for creating a custom STSAttributeProvider
        and plugging it into an STS created from NetBeans:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Use NetBeans to <a class="xref" href="#gfrig" title="To Create a Third-Party STS">To Create a Third-Party STS</a>.</p></li><li class="listitem"><p>Create an MySTSAttributeProvider implementation class in
                the same package as the STS implementation class which extends
                the BaseSTSImpl.</p></li><li class="listitem"><p>Create a directory META-INF/services in the src/java
                directory.</p></li><li class="listitem"><p>Create a file with name
                com.sun.xml.ws.api.security.trust.STSAttributeProvider with
                content the path to the class MySTSAttributeProvider (e.g.
                org.me.sts.MySTSAttributeProvider). Then place this file in
                the src/java/META-INF/services directory.</p></li><li class="listitem"><p>Run the NetBeans STS project. Your STS will now use your
                custom attribute provider in creating the SAML
                assertions.</p></li></ol></div><p>As a reference, <a class="link" href="http://java.net/projects/wsit/sources/svn/content/trunk/wsit/samples/ws-trust/basic/src/common/MySTSAttributeProvider.java?rev=6860" target="_top">
        here</a> is a sample STSAttributeProvider.</p><div class="section" title="13.4.1.&nbsp;Handling Claims with Metro STS"><div class="titlepage"><div><div><h3 class="title"><a name="sts-claims"></a>13.4.1.&nbsp;Handling Claims with Metro STS</h3></div></div></div><p>In WS-SecurityPolicy, an IssuedToken policy assertion may
            carry an optional wst:Claims element, to specify the actual claims
            required to access the service. Here is an example of IssuedToken
            policy assertions with Claims:</p><div class="example"><a name="d0e12696"></a><p class="title"><b>Example&nbsp;13.4.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sp:IssuedToken sp:IncludeToken="..."&gt;
   &lt;Issuer xmlns="..."&gt;
      &lt;Address xmlns="http://www.w3.org/2005/08/addressing"&gt;...&lt;/Address&gt;
   &lt;/Issuer&gt;
   &lt;sp:RequestSecurityTokenTemplate
           xmlns:t="http://schemas.xmlsoap.org/ws/2005/02/trust"&gt;
      &lt;t:TokenType&gt;urn:oasis:names:tc:SAML:2.0:assertion&lt;/t:TokenType&gt;
      &lt;t:KeyType&gt;http://schemas.xmlsoap.org/ws/2005/02/trust/SymmetricKey
      &lt;/t:KeyType&gt;
      &lt;t:KeySize&gt;256&lt;/t:KeySize&gt;
      &lt;t:Claims Dialect="http://schemas.xmlsoap.org/ws/2005/05/identity"
                xmlns:ic="http://schemas.xmlsoap.org/ws/2005/05/identity"&gt;
         &lt;ic:ClaimType
                 Uri="http://.../ws/2005/05/identity/claims/givenname"/&gt;
         &lt;ic:ClaimType Uri="http://.../ws/2005/05/identity/claims/surname"
                       Optional="true"/&gt;
      &lt;/wst:Claims&gt;
   &lt;/sp:RequestSecurityTokenTemplate&gt;
&lt;/sp:IssuedToken&gt;</pre></div></div><br class="example-break"><p>With Oasis standard versions of WS-SecurityPolicy 1.2 and
            WS-Trust 1.3, syntax is different for Claims, where it is defined
            as a top level sub-element of IssuedToken, in stead of a
            sub-element of RequestSecurityTokenTemplate:</p><div class="example"><a name="d0e12701"></a><p class="title"><b>Example&nbsp;13.5.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sp:IssuedToken sp:IncludeToken="..."&gt;
   &lt;Issuer xmlns="..."&gt;
      &lt;Address xmlns="http://www.w3.org/2005/08/addressing"&gt;...&lt;/Address&gt;
   &lt;/Issuer&gt;
   &lt;t:Claims Dialect="http://schemas.xmlsoap.org/ws/2005/05/identity"
             xmlns:ic="http://schemas.xmlsoap.org/ws/2005/05/identity"&gt;
      &lt;ic:ClaimType Uri="http://.../ws/2005/05/identity/claims/givenname"/&gt;
      &lt;ic:ClaimType Uri="http://.../ws/2005/05/identity/claims/surname"
                    Optional="true"/&gt;
   &lt;/wst:Claims&gt;
   &lt;sp:RequestSecurityTokenTemplate
           xmlns:t="http://schemas.xmlsoap.org/ws/2005/02/trust"&gt;
      &lt;t:TokenType&gt;urn:oasis:names:tc:SAML:2.0:assertion&lt;/t:TokenType&gt;
      &lt;t:KeyType&gt;http://schemas.xmlsoap.org/ws/2005/02/trust/SymmetricKey
      &lt;/t:KeyType&gt;
      &lt;t:KeySize&gt;256&lt;/t:KeySize&gt;
   &lt;/sp:RequestSecurityTokenTemplate&gt;
&lt;/sp:IssuedToken&gt;</pre></div></div><br class="example-break"><p>On the client side, the Claims, together with all the
            elements in the RequestSecurityTokenTemplate, is copied into the
            request message RST to the STS.</p><p>With Metro based STS, the Claims will then be available in
            the STSAttributeProvider, for use to build the user attributes to
            be included in the issued SAML assertion.</p><p>In your implementation of the method,
            getClaimedAttributes(Subject subject, String appliesTo, String
            tokenType, Claims claims), one may parse the Claims to obtain the
            ClaimTypes with the following codes:</p><div class="example"><a name="d0e12710"></a><p class="title"><b>Example&nbsp;13.6.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">String dialect = claims.getDialect();
List&lt;Object&gt; claimTypes = claims.getAny();
for (Object claimType : claimsTypes){
    Element ctElement = (Element) claimType;
    // parsing ctElement according to the dialect to get claim types
    ...
}</pre></div></div><br class="example-break"><p>Once you parse the Claims, you may create the attributes
            accordingly. The attributes returned from the STSAttributeProvider
            is available in the STSTokenProvider through: </p><div class="example"><a name="d0e12715"></a><p class="title"><b>Example&nbsp;13.7.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">(Map&lt;QName, List&lt;String&gt;&gt;) ctx.getOtherProperties().get(IssuedTokenContext.CLAIMED_ATTRUBUTES);</pre></div></div><p><br class="example-break"> for you to build into your issued SAML
            assertions.</p><p>See also <a class="xref" href="#sts-client-run-time-config" title="13.5.&nbsp;Handling Token and Key Requirements at Run Time">Handling Token and Key Requirements at Run Time</a> for how to inject Claims on the client
            side at run time.</p></div></div><div class="section" title="13.5.&nbsp;Handling Token and Key Requirements at Run Time"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="sts-client-run-time-config"></a>13.5.&nbsp;Handling Token and Key Requirements at Run Time</h2></div></div></div><p>In the general model for using STS issued tokens to securing Web
        services, a service side IssuedToken policy assertion is used to
        specify the STS information (STS endpoint, STS MEX endpoint, etc) and
        the token requirements (token type, key type, claims, etc).
        Alternatively, a client side PreConfiguredSTS assertion can be used to
        specify the local STS. Only one STS can be specified in
        PreconfiguredSTS. In this way, the process to go to STS to obtain the
        issued toke and subsequently use it with the messages to the service
        was handled by Metro transparently to the users.</p><p>Now with Metro 2.0, one may also inject STS information and
        issued token requirements programmatically at run time on the client
        side. This This gives the users more control of the its identity and
        security information to be used to access a service, hence open up for
        building more interesting and important applications with
        Metro.</p><p>General steps for managing run time configuration: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Use existing STSIssuedTokenConfiguration for
                    run-time configuration, e.g. </p><div class="example"><a name="d0e12736"></a><p class="title"><b>Example&nbsp;13.8.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">DefaultSTSIssuedTokenConfiguration config = new DefaultSTSIssuedTokenConfiguration();
Claims claims = ...
config.setClaims(claims);</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>Use Web Service Feature to inject
                    STSIssuedTokenConfiguration into the system: </p><div class="example"><a name="d0e12742"></a><p class="title"><b>Example&nbsp;13.9.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">STSIssuedTokenFeature feature = new STSIssuedTokenFeature(config);</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>STSIssuedTokenFeature is used when creating port
                    from the Service: </p><div class="example"><a name="d0e12748"></a><p class="title"><b>Example&nbsp;13.10.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">CalculatorWS port = service.getCalculatorWSPort(new WebServiceFeature[]{feature});</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>The entries in IssuedToken policy assertion in
                    services WSDL is available through </p><div class="example"><a name="d0e12754"></a><p class="title"><b>Example&nbsp;13.11.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">configure.getOtherOptions().get(STSIssuedTokenConfiguration.ISSUED_TOKEN);</pre></div></div><p><br class="example-break"> This allows the users to select STS at run
                    time according to the service requirements.</p></li></ol></div><p>While it is more or less straight forward with TokenType,
        KeyType, etc., it requires extra effort for managing Claims
        requirement at run time:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Claims are defined as an extensible element in the
                    WS-SecurityPolicy spec: </p><div class="example"><a name="d0e12765"></a><p class="title"><b>Example&nbsp;13.12.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;wst:Claims Dialect="http://schemas.xmlsoap.org/ws/2005/05/identity"
            xmlns:wst="http://docs.oasis-open.org/ws-sx/ws-trust/200512"&gt;
&lt;/wst:Claims&gt;</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>It is up to the applications and profiles of
                    WS-Trust to define the content of the Claims. So you need
                    to implement com.sun.xml.ws.api.security.trust.Claims to
                    manage claims in your environment. Here is a <a class="link" href="http://java.net/projects/wsit/sources/svn/content/trunk/wsit/samples/ws-trust/runtime/src/common/MyClaims.java?rev=6860" target="_top">sample</a>
                    for managing claim types of the following form: </p><div class="example"><a name="d0e12774"></a><p class="title"><b>Example&nbsp;13.13.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;wst:Claims Dialect="http://schemas.xmlsoap.org/ws/2005/05/identity"
            xmlns:wst="http://docs.oasis-open.org/ws-sx/ws-trust/200512"
            xmlns:ic="http://schemas.xmlsoap.org/ws/2005/05/identity"&gt;
   &lt;ic:ClaimType
      Uri="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/locality"/&gt;
   &lt;ic:ClaimType
      Uri="http://schemas.xmlsoap.org/ws/2005/05/identity/claims/role"/&gt;
&lt;/wst:Claims&gt;</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>Make run time requirement for claim types on the
                    client side: </p><div class="example"><a name="d0e12780"></a><p class="title"><b>Example&nbsp;13.14.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">DefaultSTSIssuedTokenConfiguration config = new 
        DefaultSTSIssuedTokenConfiguration();
STSIssuedTokenFeature feature = new STSIssuedTokenFeature(config);
org.me.calculator.client.CalculatorWS port = service
        .getCalculatorWSPort(new WebServiceFeature[]{feature});

int i = Integer.parseInt(request.getParameter("value1"));
int j = Integer.parseInt(request.getParameter("value2"));

config.setTokenType("urn:oasis:names:tc:SAML:1.0:assertion");
MyClaims claims = new MyClaims();
claims.addClaimType(MyClaims.ROLE);
config.setClaims(claims);
int result = port.add(i, j)</pre></div></div><p><br class="example-break"></p></li></ol></div><p>In general, you may need to supply your own
        STSIssuedTokenConfiguration in following cases: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The client has to go through multiple STS in a trust
                    chain across security domains to access the
                    service.</p></li><li class="listitem"><p>The client needs to select the STS and/or to provide
                    token and key parameters to the STS at run time, according
                    to which service it tries to access and the requirement
                    from the service.</p></li></ol></div><p>To create a custom configuration class which extends
        STSIssuedTokenConfiguration: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>You may get the targeted service endpoint at run
                    time through </p><div class="example"><a name="d0e12798"></a><p class="title"><b>Example&nbsp;13.15.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">getOtherOptions().get(STSIssuedTokenCOnfiguration.APPLIES_TO);</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>Similarly, you may get an instance of
                    STSIssuedTokenConfiguration, which captures entries from
                    the IssuedToken policy assertion for the targeted service,
                    through </p><div class="example"><a name="d0e12804"></a><p class="title"><b>Example&nbsp;13.16.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">getOtherOptions().get(STSIssuedTokenCOnfiguration.ISSUED_TOKEN);</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>The entries in the IssuedToken policy and in the
                    client side PreConfiguredSTS take high priorities which
                    cannot be override at run time.</p></li><li class="listitem"><p>Different run time entries should be supplied for
                    different services.</p></li></ol></div></div><div class="section" title="13.6.&nbsp;Advanced Usages of STS in Security"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="advanced-sts-usage"></a>13.6.&nbsp;Advanced Usages of STS in Security</h2></div></div></div><p>The following sections discuss some features for advanced usages
        of STS in securing Web services with:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#sts-sso" title="13.6.1.&nbsp;Token Caching and Sharing">Token Caching and Sharing</a></p></li><li class="listitem"><p><a class="xref" href="#sts-delegation" title="13.6.2.&nbsp;ActAs and Identity Delegation">ActAs and Identity Delegation</a></p></li></ul></div><div class="section" title="13.6.1.&nbsp;Token Caching and Sharing"><div class="titlepage"><div><div><h3 class="title"><a name="sts-sso"></a>13.6.1.&nbsp;Token Caching and Sharing</h3></div></div></div><p>Here is a description of how this is supported in Metro:
            </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The services to be accessed with the same token
                        must share the same certificate.</p></li><li class="listitem"><p>Only issued tokens from the same STS are
                        shared.</p></li><li class="listitem"><p>Caching and sharing issued tokens can be enabled
                        for each service instance by configuration</p></li></ol></div><p> To enable this for a service proxy, you need to
            add attribute shareToken="true" in the wsit-client.xml or the file
            referenced by it for the proxy: </p><div class="example"><a name="d0e12841"></a><p class="title"><b>Example&nbsp;13.17.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;t:PreConfiguredSTS
     xmlns:t="http://schemas.sun.com/ws/2006/05/trust/client"
     shareToken="true"&gt;
&lt;/t:PreConfiguredSTS&gt;</pre></div></div><p><br class="example-break"></p><p>To illustrate the usage, you may find a stand alone sample
            <a class="link" href="http://java.net/projects/wsit/sources/svn/show/trunk/wsit/samples/ws-trust/share?rev=6860" target="_top">here</a>.
            This sample contains 4 parts for client, STS, Service, and
            Service1. Each service is configured to use the STS issued token
            to access. On the client side, the client instances for Service
            and Service1 are configured to be in the circle to share the
            issued tokens from the STS. The client calls Service first, then
            Service1. You will see that the client goes to the STS to get the
            token to access Service, and then to call Service1 without going
            to the STS but use the token obtained in calling Service.</p><p>Here is a description on how to managing the lifetime and
            renewing of the issued tokens: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The client can request for the life time of an
                        issued token through configuration with a subelement
                        LifeTime of PreConfiguredSTS: </p><div class="example"><a name="d0e12855"></a><p class="title"><b>Example&nbsp;13.18.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;t:PreConfiguredSTS
      xmlns:t="http://schemas.sun.com/ws/2006/05/trust/client"
      shareToken="true"&gt;

    &lt;t:LifeTime&gt;3600&lt;/LifeTime&gt;
&lt;/t:PreConfiguredSTS&gt;</pre></div></div><p><br class="example-break"> or programmatically with
                        STSIssuedTokenConfiguration: </p><div class="example"><a name="d0e12859"></a><p class="title"><b>Example&nbsp;13.19.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">config.getOtherOptions().put(STSIssuedTokenConfiguration.LIFE_TIME, Integer.valueOf(3600));</pre></div></div><p><br class="example-break"> The value is used to construct the
                        Lifetime element in the RST to the STS: </p><div class="example"><a name="d0e12863"></a><p class="title"><b>Example&nbsp;13.20.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;trust:Lifetime&gt;
    &lt;wsu:Created xmlns:wsu="..."&gt;2007-10-31T18:39:23.548Z&lt;/wsu:Created&gt;
    &lt;wsu:Expires xmlns:wsu="..."&gt;2007-11-01T02:39:23.548Z&lt;/wsu:Expires&gt;
&lt;/trust:Lifetime&gt;</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>By default, an exception is thrown if the token
                        cached to be used on the client side is
                        expired.</p></li><li class="listitem"><p>One can enable to automatically request for a
                        new token for an expired token by configuration with
                        attribute renewExpiredToken in PreConfiguredSTS:
                        </p><div class="example"><a name="d0e12872"></a><p class="title"><b>Example&nbsp;13.21.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;t:PreConfiguredSTS
      xmlns:t="http://schemas.sun.com/ws/2006/05/trust/client"
      shareToken="true"
      renewExpiredToken="true"&gt;

    &lt;t:LifeTime&gt;3600&lt;/LifeTime&gt;
&lt;/t:PreConfiguredSTS&gt;</pre></div></div><p><br class="example-break"> or programmatically with
                        STSIssuedTokenConfiguration: </p><div class="example"><a name="d0e12876"></a><p class="title"><b>Example&nbsp;13.22.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">config.getOtherOptions()
        .put(STSIssuedTokenConfiguration.RENEW_EXPIRED_TOKEN, "true");</pre></div></div><p><br class="example-break"></p></li></ol></div></div><div class="section" title="13.6.2.&nbsp;ActAs and Identity Delegation"><div class="titlepage"><div><div><h3 class="title"><a name="sts-delegation"></a>13.6.2.&nbsp;ActAs and Identity Delegation</h3></div></div></div><p>We provide support for ActAs introduced in WS-Truts 1.4 in
            Metro 2.0</p><div class="figure"><a name="sts_actas_page"></a><p class="title"><b>Figure&nbsp;13.1.&nbsp;ActAs and Identity Delegation</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/trust_act_as.png" height="360" alt="ActAs and Identity Delegation"></td></tr></table></div></div></div><br class="figure-break"><p>This feature is better illustrated by the sample <a class="link" href="http://java.net/projects/wsit/sources/svn/show/trunk/wsit/samples/ws-trust/delegate?rev=6860" target="_top">here</a></p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The Client send a request to the STS. The request
                    message carries the username/password of the user and is
                    secured with the STS certificate.</p></li><li class="listitem"><p>The STS issues an SAML assertion containing the
                    username (e.g. Alice) as subject id and role attribute
                    (see src\common\SampleSTSAttributeProvider). Then it send
                    a response message with the issued token to the
                    Client.</p></li><li class="listitem"><p>The client send a request to the Service. The
                    message carries the SAML assertion from the previous step
                    for authentication and secured with the Service
                    certificate.</p></li><li class="listitem"><p>The Service send a request to the STS. The message
                    contains the username/password (bob/bob) of the Service,
                    the SAML assertion received from the user in the previous
                    step in an ActAs element in the body (RST), and is secure
                    with the STS certificate (see src\fs\
                    simple\server\FSImpl.java. The ActAs token is injected
                    into the request using the STSIssuedTokenFeture). It means
                    to ask for an issued token with it the Service can access
                    the Service 1, acting as the user.</p></li><li class="listitem"><p>The STS issues an (act as) SAML assertion which
                    contains the Service id (bob) in the Subject, and
                    attribute ActAs with the user name (e.g. Alice), and role
                    attribute for the user (see
                    src\common\SampleSTSAttributeProvider). It then send a
                    response message with the issued token to the
                    Service.</p></li><li class="listitem"><p>The Service sand a request to the Service 1. The
                    message carries the act as SAML from the previous step and
                    is secured with the Service 1 certificate. The Service 1
                    check the act as SAML assertion (see
                    src\common\SampleSamlValidator.java) and understands it is
                    the Service who made the request act as the user.</p></li><li class="listitem"><p>The Service 1 send a response to the Service.</p></li><li class="listitem"><p>The Service sends a response to the Client.</p></li></ol></div><p>Common issues and solutions:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>When a custom SAML assertion validator is used, the
                    SAML assertion is not available in the Subject.</p><p>In this case, you need to use the extended version
                    com.sun.xml.wss.impl.callback.SamlValidator and to add
                    explicitly the DOM based saml assertion to the public
                    credentials of the Subject in your implementation of the
                    method </p><div class="example"><a name="d0e12930"></a><p class="title"><b>Example&nbsp;13.23.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">validate(XMLStreamReader assertion, Map runtimeProps,
         Subject clientSubject)
and
validate(Element assertion, Map runtimeProps, Subject clientSubject)</pre></div></div><p><br class="example-break"> in the interface.</p></li><li class="listitem"><p>ActAs is not called in your custom
                    STSAttributeProvider:</p><p>You need to use the WSTrustContractImpl for your STS
                    as specified in the STSConfiguration in the sts wsdl:
                    </p><div class="example"><a name="d0e12939"></a><p class="title"><b>Example&nbsp;13.24.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;tc:STSConfiguration
        xmlns:tc="http://schemas.sun.com/ws/2006/05/trust/server"
        sencryptIssuedKey="true" encryptIssuedToken="false"&gt;
   &lt;tc:LifeTime&gt;36000&lt;/tc:LifeTime&gt;
   &lt;tc:Contract&gt;com.sun.xml.ws.security.trust.impl.WSTrustContractImpl
   &lt;/tc:Contract&gt;
   ...
&lt;/tc:STSConfiguration&gt;</pre></div></div><p><br class="example-break"> If you use Netbenas to create STS,
                    IssueSAMLTokenContractImpl is set by default. You need to
                    change it to WSTrustContractImpl for "ActAs"
                    support.</p></li></ol></div></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;14.&nbsp;WSIT Example Using a Web Container Without NetBeans IDE"><div class="titlepage"><div><div><h2 class="title"><a name="ahifl"></a>Chapter&nbsp;14.&nbsp;WSIT Example Using a Web Container Without NetBeans IDE</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#ahifm">14.1. Environment Configuration Settings</a></span></dt><dd><dl><dt><span class="section"><a href="#ahifn">14.1.1. Setting the Web Container Listener Port</a></span></dt><dt><span class="section"><a href="#ahifo">14.1.2. Setting the Web Container Home Directory</a></span></dt></dl></dd><dt><span class="section"><a href="#ahifp">14.2. WSIT Configuration and WS-Policy Assertions</a></span></dt><dt><span class="section"><a href="#ahifq">14.3. Creating a Web Service without NetBeans</a></span></dt><dd><dl><dt><span class="section"><a href="#ahifr">14.3.1. Creating a Web Service From Java</a></span></dt><dt><span class="section"><a href="#ahifu">14.3.2. Creating a Web Service From WSDL</a></span></dt></dl></dd><dt><span class="section"><a href="#ahifx">14.4. Building and Deploying the Web Service</a></span></dt><dd><dl><dt><span class="section"><a href="#ahify">14.4.1. Building and Deploying a Web Service Created From
            Java</a></span></dt><dt><span class="section"><a href="#ahifz">14.4.2. Building and Deploying a Web Service Created From
            WSDL</a></span></dt><dt><span class="section"><a href="#ahiga">14.4.3. Deploying the Web Service to a Web Container</a></span></dt><dt><span class="section"><a href="#ahigd">14.4.4. Verifying Deployment</a></span></dt></dl></dd><dt><span class="section"><a href="#ahige">14.5. Creating a Web Service Client</a></span></dt><dd><dl><dt><span class="section"><a href="#ahigf">14.5.1. Creating a Client from Java</a></span></dt><dt><span class="section"><a href="#ahigi">14.5.2. Creating a Client from WSDL</a></span></dt></dl></dd><dt><span class="section"><a href="#ahigl">14.6. Building and Deploying a Client</a></span></dt><dt><span class="section"><a href="#ahigm">14.7. Running a Web Service Client</a></span></dt><dt><span class="section"><a href="#ahign">14.8. Undeploying a Web Service</a></span></dt></dl></div><div class="section" title="14.1.&nbsp;Environment Configuration Settings"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahifm"></a>14.1.&nbsp;Environment Configuration Settings</h2></div></div></div><p>Before you can build and run the samples in this tutorial, you
        need to complete the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahifn" title="14.1.1.&nbsp;Setting the Web Container Listener Port">Setting the Web Container Listener Port</a></p></li><li class="listitem"><p><a class="xref" href="#ahifo" title="14.1.2.&nbsp;Setting the Web Container Home Directory">Setting the Web Container Home Directory</a></p></li></ul></div><div class="section" title="14.1.1.&nbsp;Setting the Web Container Listener Port"><div class="titlepage"><div><div><h3 class="title"><a name="ahifn"></a>14.1.1.&nbsp;Setting the Web Container Listener Port</h3></div></div></div><p>The Java code and configuration files for the examples used
            in this tutorial assume that the web container is listening on IP
            port 8080. Port 8080 is the default listener port for both
            GlassFish (domain1) and Tomcat. If you have changed the port, you
            must update the port number in the following files before building
            and running the examples:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">wsit-enabled-fromjava/etc/wsit-fromjava.server.AddNumbersImpl.xml</code></p></li><li class="listitem"><p><code class="code">wsit-enabled-fromjava/etc/custom-schema.xml</code></p></li><li class="listitem"><p><code class="code">wsit-enabled-fromjava/etc/custom-client.xml</code></p></li><li class="listitem"><p><code class="code">wsit-enabled-fromjava/etc/build.properties</code></p></li><li class="listitem"><p><code class="code">wsit-enabled-fromwsdl/etc/custom-client.xml</code></p></li><li class="listitem"><p><code class="code">wsit-enabled-fromwsdl/etc/build.properties</code></p></li></ul></div></div><div class="section" title="14.1.2.&nbsp;Setting the Web Container Home Directory"><div class="titlepage"><div><div><h3 class="title"><a name="ahifo"></a>14.1.2.&nbsp;Setting the Web Container Home Directory</h3></div></div></div><p>Before you build and deploy the web service and its client,
            set one of the following environment variables:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>If you are using GlassFish, set the
                    <code class="code">AS_HOME</code> environment variable to the top-level
                    directory of GlassFish.</p></li><li class="listitem"><p>If you are using Tomcat, set the
                    <code class="code">CATALINA_HOME</code> environment variable to the
                    top-level directory of Tomcat.</p></li></ul></div></div></div><div class="section" title="14.2.&nbsp;WSIT Configuration and WS-Policy Assertions"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahifp"></a>14.2.&nbsp;WSIT Configuration and WS-Policy Assertions</h2></div></div></div><p>WSIT features are enabled and configured using a mechanism
        defined by the Web Services Policy Framework (WS-Policy)
        specification. A web service expresses its requirements and
        capabilities through policies embedded in the service's WSDL
        description. A web service consumer, or client, verifies that it can
        handle the expressed requirements and, optionally, uses server
        capabilities advertised in policies.</p><p>Each individual WSIT technology, such as Reliable Messaging,
        Addressing, or Secure Conversation, provides a set of policy
        assertions it can process. Those assertions provide the necessary
        configuration details to the WSIT runtime to enable proper operation
        of the WSIT features used by a given web service. The assertions may
        specify particular configuration settings or rely on default settings
        that are predetermined by the specific technology. For instance, in
        the snippet shown below, the <code class="code">wsrm:InactivityTimeout</code>
        setting is optional and could be omitted. The following snippet shows
        WS-Policy assertions for WS-Addressing and WS-Reliable
        Messaging:</p><div class="example"><a name="d0e13017"></a><p class="title"><b>Example&nbsp;14.1.&nbsp;Sample WS-Policy expression</b></p><div class="example-contents"><pre class="programlisting">&lt;wsp:Policy wsu:Id="AddNumbers_policy"&gt;
    &lt;wsp:ExactlyOne&gt;
        &lt;wsp:All&gt;
            &lt;wsaw:UsingAddressing/&gt;
            &lt;wsrm:RMAssertion&gt;
                &lt;wsrm:InactivityTimeout Milliseconds="600000"/&gt;
            &lt;/wsrm:RMAssertion&gt;
        &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
&lt;/wsp:Policy&gt;</pre></div></div><br class="example-break"><p>This snippet is valid in either a WSIT configuration file
        (<code class="code">wsit-package.service.xml</code>) or in a Web Services
        Description Language (WSDL) file. Java-first web services use the WSIT
        configuration file, while WSDL-first web services rely exclusively on
        the policy elements in the WSDL file. This particular snippet is from
        the WSIT configuration file in the example,
        <code class="code">wsit-enabled-fromjava/etc/wsit-fromjava.server.AddNumbersImpl.xml</code>.</p></div><div class="section" title="14.3.&nbsp;Creating a Web Service without NetBeans"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahifq"></a>14.3.&nbsp;Creating a Web Service without NetBeans</h2></div></div></div><p>You can create a web service starting from Java code or starting
        from a WSDL file. The following sections describe each
        approach:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahifr" title="14.3.1.&nbsp;Creating a Web Service From Java">Creating a Web Service From Java</a></p></li><li class="listitem"><p><a class="xref" href="#ahifu" title="14.3.2.&nbsp;Creating a Web Service From WSDL">Creating a Web Service From WSDL</a></p></li></ul></div><div class="section" title="14.3.1.&nbsp;Creating a Web Service From Java"><div class="titlepage"><div><div><h3 class="title"><a name="ahifr"></a>14.3.1.&nbsp;Creating a Web Service From Java</h3></div></div></div><p>One way to create a web service application is to start by
            coding the endpoint in Java. If you are developing your Java web
            service from scratch or have an existing Java class you wish to
            expose as a web service, this is the most direct approach.</p><p>The Java API for XML Web Services (JAX-WS) 2.0
            Specification, JSR-224, relies heavily on the use of annotations
            as specified in A Metadata Facility for the Java Programming
            Language (JSR-175) and Web Services Metadata for the Java Platform
            (JSR-181), as well as additional annotations defined by the JAX-WS
            2.0 specification.</p><p>The web service is written as a normal Java class. Then the
            class and its exposed methods are annotated with the web service
            annotations <code class="code">@WebService</code> and <code class="code">@WebMethod</code>.
            The following code snippet shows an example:</p><div class="example"><a name="d0e13057"></a><p class="title"><b>Example&nbsp;14.2.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">@WebService
public class AddNumbersImpl {
    @WebMethod(action="addNumbers")
    public int addNumbers(int number1, int number2)
            throws AddNumbersException {
        if (number1 &lt; 0 || number2 &lt; 0) {
            throw new AddNumbersException(
                    "Negative number can't be added!",
                    "Numbers: " + number1 + ", " + number2);
        }
        return number1 + number2;
    }
}</pre></div></div><br class="example-break"><p>When developing a web service from scratch or based on an
            existing Java class, WSIT features are enabled using a
            configuration file. That file,
            <code class="code">wsit-package.service.xml</code>, is written in WSDL format.
            An example configuration file can be found in the accompanying
            samples:</p><div class="example"><a name="d0e13065"></a><p class="title"><b>Example&nbsp;14.3.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">wsit-enabled-fromjava/etc/wsit-fromjava.server.AddNumbersImpl.xml</pre></div></div><br class="example-break"><p>The settings in the <code class="code">wsit-package.service.xml</code>
            file are incorporated dynamically by the WSIT runtime into the
            WSDL it generates for the web service. So when a client requests
            the web service&#8217;s WSDL, the runtime embeds any publicly visible
            policy assertions contained in the
            <code class="code">wsit-package.service.xml</code> file into the WSDL. For the
            example <code class="code">wsit-fromjava.server.AddNumbersImpl.xml</code> in
            the sample discussed in this tutorial, the Addressing and Reliable
            Messaging assertions are part of the WSDL as seen by the
            client.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The <code class="code">wsit-package.service.xml</code> file must be
                in the <code class="code">WEB-INF</code> sub-directory of the application&#8217;s
                WAR file when it is deployed to the web container. Otherwise,
                the WSIT run-time environment will not find it.</p></div><p>To create a web service from Java, create the following
            files:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>These files define the web service and the WSIT
                    configuration for the service, which are discussed in the
                    sections below.</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p><a class="xref" href="#ahifs" title="14.3.1.1.&nbsp;Web Service Implementation Java File">Web Service Implementation Java File</a></p></li><li class="listitem"><p><a class="xref" href="#ahift" title="14.3.1.2.&nbsp;wsit-package.service.xml File">wsit-package.service.xml File</a></p></li></ul></div><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p><code class="code">AddNumbersException.java</code></p></li><li class="listitem"><p><code class="code">custom-schema.xml</code></p></li><li class="listitem"><p><code class="code">sun-jaxws.xml</code></p></li><li class="listitem"><p><code class="code">web.xml</code></p></li></ul></div></li><li class="listitem"><p>These files are standard files required for JAX-WS.
                    Examples of these files are provided in the
                    <code class="code">wsit-enabled-fromjava</code> sample
                    directory.</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p><code class="code">AddNumbersException.java</code></p></li><li class="listitem"><p><code class="code">custom-schema.xml</code></p></li><li class="listitem"><p><code class="code">sun-jaxws.xml</code></p></li><li class="listitem"><p><code class="code">web.xml</code></p></li></ul></div></li><li class="listitem"><p>These files are standard in any Ant build
                    environment. Examples of these files are provided in the
                    <code class="code">wsit-enabled-fromjava</code> sample
                    directory.</p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p><code class="code">build.xml</code></p></li><li class="listitem"><p><code class="code">build.properties</code></p></li></ul></div></li></ul></div><div class="section" title="14.3.1.1.&nbsp;Web Service Implementation Java File"><div class="titlepage"><div><div><h4 class="title"><a name="ahifs"></a>14.3.1.1.&nbsp;Web Service Implementation Java File</h4></div></div></div><p>The sample files define a web service that takes two
                integers, adds them, and returns the result. If one of the
                integers is negative, an exception is thrown.</p><p>The starting point for developing a web service that
                uses the WSIT technologies is a Java class file annotated with
                the <code class="code">javax.jws.WebService</code> annotation. The
                <code class="code">@WebService</code> annotation defines the class as a web
                service endpoint.</p><p>The following file
                (<code class="code">wsit-enabled-fromjava/src/fromjava/serverAddNumbersImpl.java</code>)
                implements the web service <code class="code">interface.package
                fromjava.server;</code></p><div class="example"><a name="d0e13176"></a><p class="title"><b>Example&nbsp;14.4.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">import javax.jws.WebService;
import javax.jws.WebMethod;

@WebService
public class AddNumbersImpl {
    @WebMethod(action="addNumbers")
    public int addNumbers(int number1, int number2)
            throws AddNumbersException {
        if (number1 &lt; 0 || number2 &lt; 0) {
            throw new AddNumbersException(
                    "Negative number cannot be added!",
                    "Numbers: " + number1 + ", " + number2);
        }
        return number1 + number2;
    }
}</pre></div></div><br class="example-break"><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>To ensure interoperability with Windows
                    Communication Foundation (WCF) clients, you must specify
                    the <code class="code">action</code> element of <code class="code">@WebMethod</code>
                    in your endpoint implementation classes. WCF clients will
                    incorrectly generate an empty string for the Action header
                    if you do not specify the <code class="code">action</code>
                    element.</p></div></div><div class="section" title="14.3.1.2.&nbsp;wsit-package.service.xml File"><div class="titlepage"><div><div><h4 class="title"><a name="ahift"></a>14.3.1.2.&nbsp;wsit-package.service.xml File</h4></div></div></div><p>This file is the WSIT configuration file. It defines
                which WSIT technologies are enabled in the web service. The
                snippet shown below illustrates how to enable the WSIT
                reliable messaging technology in a
                <code class="code">wsit-package.service.xml</code> file.</p><div class="example"><a name="d0e13199"></a><p class="title"><b>Example&nbsp;14.5.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;wsp:Policy wsu:Id="AddNumbers_policy"&gt;
    &lt;wsp:ExactlyOne&gt;
        &lt;wsp:All&gt;
            &lt;wsaw:UsingAddressing/&gt;
            &lt;wsrm:RMAssertion&gt;
                &lt;wsrm:InactivityTimeout Milliseconds="600000"/&gt;
                &lt;wsrm:AcknowledgementInterval Milliseconds="200"/&gt;
            &lt;/wsrm:RMAssertion&gt;
        &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
&lt;/wsp:Policy&gt;</pre></div></div><br class="example-break"><p>For a complete example of a
                <code class="code">wsit-package.service.xml</code> file, see the
                <code class="code">wsit-enabled-fromjava</code> example. You can use the
                <code class="code">wsit-package.service.xml</code> file provided in the
                example as a reference for creating your own
                <code class="code">wsit-package.service.xml</code> file.</p></div></div><div class="section" title="14.3.2.&nbsp;Creating a Web Service From WSDL"><div class="titlepage"><div><div><h3 class="title"><a name="ahifu"></a>14.3.2.&nbsp;Creating a Web Service From WSDL</h3></div></div></div><p>Typically, you start from WSDL to build your web service if
            you want to implement a web service that is already defined either
            by a standard or an existing instance of the service. In either
            case, the WSDL already exists. The JAX-WS <code class="code">wsimport</code>
            tool processes the existing WSDL document, either from a local
            copy on disk or by retrieving it from a network address or URL.
            For an example of using a web browser to access a service&#8217;s WSDL,
            see <a class="xref" href="#ahigd" title="14.4.4.&nbsp;Verifying Deployment">Verifying Deployment</a>.</p><p>When developing a web service starting from an existing
            WSDL, the process is actually simpler than starting from Java.
            This is because the policy assertions needed to enable various
            WSIT technologies are already embedded in the WSDL file. An
            example WSDL file is included in the <code class="code">fromwsdl</code> sample
            provided with this tutorial at:</p><div class="example"><a name="d0e13231"></a><p class="title"><b>Example&nbsp;14.6.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">tut-install/wsit-enabled-fromwsdl/etc/AddNumbers.wsdl</pre></div></div><br class="example-break"><p>To create a web service from WSDL, create the following
            source files:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahifv" title="14.3.2.1.&nbsp;WSDL File">WSDL File</a></p></li><li class="listitem"><p><a class="xref" href="#ahifw" title="14.3.2.2.&nbsp;Web Service Implementation File">Web Service Implementation File</a></p></li><li class="listitem"><p><code class="code">custom-server.xml</code></p></li><li class="listitem"><p><code class="code">web.xml</code></p></li><li class="listitem"><p><code class="code">sun-jaxws.xml</code></p></li><li class="listitem"><p><code class="code">build.xml</code></p></li><li class="listitem"><p><code class="code">build.properties</code></p></li></ul></div><p>The following files are standard files required for JAX-WS.
            Examples of these files are provided in the <code class="code">fromwsdl</code>
            sample directory.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">custom-server.xml</code></p></li><li class="listitem"><p><code class="code">sun-jaxws.xml</code></p></li><li class="listitem"><p><code class="code">web.xml</code></p></li></ul></div><p>The <code class="code">build.xml</code> and <code class="code">build.properties</code>
            files are standard in any Ant build environment. Examples of these
            files are provided in the respective samples directories.</p><p>The sample files provided in this tutorial define a web
            service that takes two integers, adds them, and returns the
            result. If one of the integers is negative, an exception is
            returned.</p><div class="section" title="14.3.2.1.&nbsp;WSDL File"><div class="titlepage"><div><div><h4 class="title"><a name="ahifv"></a>14.3.2.1.&nbsp;WSDL File</h4></div></div></div><p>You can create a WSDL file by hand or retrieve it from
                an existing web service by simply pointing a web browser at
                the web service&#8217;s URL. The snippet shown below illustrates how
                to enable the WSIT Reliable Messaging technology in a WSDL
                file.</p><div class="example"><a name="d0e13296"></a><p class="title"><b>Example&nbsp;14.7.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;wsp:Policy wsu:Id="AddNumbers_policy"&gt;
    &lt;wsp:ExactlyOne&gt;
        &lt;wsp:All&gt;
            &lt;wsrm:RMAssertion&gt;
                &lt;wsrm:InactivityTimeout Milliseconds="600000"/&gt;
                &lt;wsrm:AcknowledgementInterval Milliseconds="200"/&gt;
            &lt;/wsrm:RMAssertion&gt;
        &lt;/wsp:All&gt;
    &lt;/wsp:ExactlyOne&gt;
&lt;/wsp:Policy&gt;</pre></div></div><br class="example-break"><p>For a complete example of a WSDL file, see the
                <code class="code">AddNumbers.wsdl</code> file in the <code class="code">fromwsdl</code>
                example. Another benefit of the <code class="code">AddNumbers.wsdl</code>
                file is that it shows how a WSIT-enabled WSDL is constructed.
                Therefore, you can use it as a reference when you create a
                WSDL file or modify an existing one.</p></div><div class="section" title="14.3.2.2.&nbsp;Web Service Implementation File"><div class="titlepage"><div><div><h4 class="title"><a name="ahifw"></a>14.3.2.2.&nbsp;Web Service Implementation File</h4></div></div></div><p>The following file (<code class="code">AddNumbersImpl.java</code>)
                shows how to implement a web service <code class="code">interface.package
                fromwsdl.server;</code></p><div class="example"><a name="d0e13320"></a><p class="title"><b>Example&nbsp;14.8.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">import javax.jws.WebService;
import javax.jws.WebMethod;

@WebService (endpointInterface=
        "fromwsdl.server.AddNumbersPortType")
public class AddNumbersImpl{
    @WebMethod(action="addNumbers")
    public int addNumbers (int number1, int number2)
            throws AddNumbersFault_Exception {
        if (number1 &lt; 0 || number2 &lt; 0) {
            String message = "Negative number cannot be added!";
            String detail = "Numbers: " + number1 + ", " + number2;
            AddNumbersFault fault = new AddNumbersFault ();
            fault.setMessage (message);
            fault.setFaultInfo (detail);
            throw new AddNumbersFault_Exception(message, fault);
        }
        return number1 + number2;
    }

    public void oneWayInt(int number) {
        System.out.println("Service received: " + number);
    }
}</pre></div></div><br class="example-break"></div></div></div><div class="section" title="14.4.&nbsp;Building and Deploying the Web Service"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahifx"></a>14.4.&nbsp;Building and Deploying the Web Service</h2></div></div></div><p>Once configured, you can build and deploy a WSIT-enabled web
        service in the same manner as you would build and deploy a standard
        JAX-WS web service.</p><p>The following topics describe how to perform this task:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahify" title="14.4.1.&nbsp;Building and Deploying a Web Service Created From Java">Building and Deploying a Web Service Created From
            Java</a></p></li><li class="listitem"><p><a class="xref" href="#ahifz" title="14.4.2.&nbsp;Building and Deploying a Web Service Created From WSDL">Building and Deploying a Web Service Created From
            WSDL</a></p></li><li class="listitem"><p><a class="xref" href="#ahiga" title="14.4.3.&nbsp;Deploying the Web Service to a Web Container">Deploying the Web Service to a Web Container</a></p></li><li class="listitem"><p><a class="xref" href="#ahigd" title="14.4.4.&nbsp;Verifying Deployment">Verifying Deployment</a></p></li></ul></div><div class="section" title="14.4.1.&nbsp;Building and Deploying a Web Service Created From Java"><div class="titlepage"><div><div><h3 class="title"><a name="ahify"></a>14.4.1.&nbsp;Building and Deploying a Web Service Created From
            Java</h3></div></div></div><p>To build and deploy the web service, open a terminal window,
            go to the <code class="code">tut-install/wsit-enabled-fromjava/</code>
            directory and type the following:</p><p>This command calls the <code class="code">server</code> target in
            <code class="code">build.xml</code>, which builds and packages the application
            into a WAR file, <code class="code">wsit-enabled-fromjava.war</code>, and
            places it in the <code class="code">wsit-enabled-fromjava/build/war</code>
            directory. The <code class="code">ant server</code> command also deploys the
            WAR file to the web container.</p><p>The <code class="code">ant</code> command calls multiple tools to build
            and deploy the web service. The JAX-WS annotation processing tool
            (<code class="code">apt</code>) processes the annotated source code and invokes
            the compiler itself, resulting in the class files for each of the
            Java source files. In the <code class="code">wsit-enabled-fromjava</code>
            example, the Ant target <code class="code">build-server-java</code> in
            <code class="code">build.xml</code> handles this portion of the process. Next,
            the individual class files are bundled together along with the web
            service&#8217;s supporting configuration files into the application&#8217;s
            WAR file. It is this file that is deployed to the web container by
            the deploy target.</p><p>During execution of the <code class="code">server</code> target, you will
            see a warning message. The message refers to &#8220;Annotation types
            without processors&#8221;. The warning is expected and does not indicate
            an abnormal situation. The text is included here for
            reference:</p><div class="example"><a name="d0e13390"></a><p class="title"><b>Example&nbsp;14.9.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">build-server-java:
   [apt] warning: Annotation types without processors:
        [javax.xml.bind.annotation.XmlRootElement,
        javax.xml.bind.annotation.XmlAccessorType,
        javax.xml.bind.annotation.XmlType,
         javax.xml.bind.annotation.XmlElement]
   [apt] 1 warning</pre></div></div><br class="example-break"></div><div class="section" title="14.4.2.&nbsp;Building and Deploying a Web Service Created From WSDL"><div class="titlepage"><div><div><h3 class="title"><a name="ahifz"></a>14.4.2.&nbsp;Building and Deploying a Web Service Created From
            WSDL</h3></div></div></div><p>To build and deploy the web service, open a terminal window,
            go to the <code class="code">tut-install/wsit-enabled-fromwsdl/</code>
            directory, and type the following:</p><pre class="programlisting"><span class="bold"><strong>ant server</strong></span></pre><p>This command calls <code class="code">wsimport</code>, which takes the
            WSDL description and generates a corresponding Java interface and
            other supporting classes. Then the Java compiler is called to
            compile both the user&#8217;s code and the generated code. Finally, the
            class files are bundled together into the WAR file. To see the
            details of how this is done, see the
            <code class="code">build-server-wsdl</code> and <code class="code">create-war</code> targets
            in the <code class="code">wsit-enabled-fromwsdl/build.xml</code> file.</p></div><div class="section" title="14.4.3.&nbsp;Deploying the Web Service to a Web Container"><div class="titlepage"><div><div><h3 class="title"><a name="ahiga"></a>14.4.3.&nbsp;Deploying the Web Service to a Web Container</h3></div></div></div><p>As a convenience, invoking the <code class="code">ant server</code>
            command builds the web service&#8217;s WAR file and immediately deploys
            it to the web container. However, in some situations, such as
            after undeploying a web service, it may be useful to deploy the
            web service without rebuilding it.</p><p>For both scenarios, <code class="code">wsit-enabled-fromjava</code> and
            <code class="code">fromwsdl</code>, the resulting application is deployed in
            the same manner.</p><p>The following sections describe how to deploy on the
            different web containers:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahigb" title="14.4.3.1.&nbsp;Deploying to GlassFish">Deploying to GlassFish</a></p></li><li class="listitem"><p><a class="xref" href="#ahigc" title="14.4.3.2.&nbsp;Deploying to Apache Tomcat">Deploying to Apache Tomcat</a></p></li></ul></div><div class="section" title="14.4.3.1.&nbsp;Deploying to GlassFish"><div class="titlepage"><div><div><h4 class="title"><a name="ahigb"></a>14.4.3.1.&nbsp;Deploying to GlassFish</h4></div></div></div><p>For development purposes, the easiest way to deploy is
                to use the <code class="code">autodeploy</code> facility of the GlassFish
                application server. To do so, you simply copy your
                application&#8217;s WAR file to the <code class="code">/autodeploy</code>
                directory for the domain to which you want to deploy. If you
                are using the default domain, <code class="code">domain1</code>, which is
                set up by the GlassFish installation process, the appropriate
                directory path would be
                <code class="code">as-install/domains/domain1/autodeploy</code>.</p><p>The <code class="code">build.xml</code> file which accompanies this
                example has a deploy target for GlassFish. To invoke that
                target, run the following command in the top-level directory
                of the respective examples, either
                <code class="code">wsit-enabled-fromjava</code> or
                <code class="code">wsit-enabled-fromwsdl</code>, as follows.</p><pre class="programlisting"><span class="bold"><strong>ant deploy</strong></span></pre></div><div class="section" title="14.4.3.2.&nbsp;Deploying to Apache Tomcat"><div class="titlepage"><div><div><h4 class="title"><a name="ahigc"></a>14.4.3.2.&nbsp;Deploying to Apache Tomcat</h4></div></div></div><p>Apache Tomcat also has an <code class="code">autoDeploy</code>
                feature that is enabled by Tomcat&#8217;s out-of-the-box
                configuration settings. If you are not sure whether the
                autoDeploy is enabled, check
                <code class="code">tomcat-home/conf/server.xml</code> for the value of
                <code class="code">autoDeploy</code>, where
                <span class="emphasis"><em>tomcat-home</em></span> is the directory where Tomcat
                is installed. Assuming <code class="code">autoDeploy</code> is enabled, you
                simply copy your application&#8217;s WAR file to the
                <code class="code">tomcat-home/webapps</code> directory.</p><p>The <code class="code">build.xml</code> file which accompanies this
                example has a deploy target for Tomcat. To invoke that target,
                run the following command in the top-level directory of the
                respective examples, either <code class="code">wsit-enabled-fromjava</code>
                or <code class="code">wsit-enabled-fromwsdl</code>, as follows. You need to
                use the <code class="code">-Duse.tomcat=true</code> switch to make sure
                that the application is deployed to Tomcat, and not to the
                default server, which is GlassFish.</p><pre class="programlisting"><span class="bold"><strong>ant -Duse.tomcat=true deploy</strong></span></pre></div></div><div class="section" title="14.4.4.&nbsp;Verifying Deployment"><div class="titlepage"><div><div><h3 class="title"><a name="ahigd"></a>14.4.4.&nbsp;Verifying Deployment</h3></div></div></div><p>A basic test to verify that the application has deployed
            properly is to use a web browser to retrieve the application&#8217;s
            WSDL from its hosting web container. The following URLs retrieve
            the WSDL from each of the two example services. If you are running
            your web browser and web container on different machines, you need
            to replace <code class="code">localhost</code> with the name of the machine
            hosting your web service.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Before testing, make sure your web container is
                running.</p></div><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">http://localhost:8080/wsit-enabled-fromjava/addnumbers?wsdl</code></p></li><li class="listitem"><p><code class="code">http://localhost:8080/wsit-enabled-fromwsdl/addnumbers?wsdl</code></p></li></ul></div><p>If the browser displays a page of XML tags, the web service
            has been deployed and is working. If not, check the web container
            log for any error messages related to the sample WAR you have just
            deployed. For GlassFish, the log can be found at
            <code class="code">as-install/domains/domain1/logs/server.log</code>. For
            Apache Tomcat, the appropriate log file can be found at
            <code class="code">tomcat-home/logs/catalina.out</code>.</p></div></div><div class="section" title="14.5.&nbsp;Creating a Web Service Client"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahige"></a>14.5.&nbsp;Creating a Web Service Client</h2></div></div></div><p>Unlike developing a web service provider, creating a web service
        client application always starts with an existing WSDL file. This
        process is similar to the process you use to build a service from an
        existing WSDL file. The WSDL file that the client consumes already
        contains the WS&#8211;* policy assertions (and, in some cases, any
        value-added WSIT policy assertions that augment Sun&#8217;s implementation,
        but can safely be ignored by other implementations). Most of the
        policy assertions are defined in the WS-* specifications. Sun&#8217;s
        implementation processes these standard policy assertions.</p><p>The policy assertions describe any requirements from the server
        as well as any optional features the client may use. The WSIT build
        tools and run-time environment detect the WSDL&#8217;s policy assertions and
        configure themselves appropriately, if possible. If an unsupported
        assertion is found, an error message describing the problem will be
        displayed.</p><p>Typically, you retrieve the WSDL directly from a web service
        provider using the <code class="code">wsimport</code> tool. The
        <code class="code">wsimport</code> tool then generates the corresponding Java
        source code for the interface described by the WSDL. The Java
        compiler, <code class="code">javac</code>, is then called to compile the source
        into class files. The programming code uses the generated classes to
        access the web service.</p><p>The following sections describe how to create a web service
        client:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahigf" title="14.5.1.&nbsp;Creating a Client from Java">Creating a Client from Java</a></p></li><li class="listitem"><p><a class="xref" href="#ahigi" title="14.5.2.&nbsp;Creating a Client from WSDL">Creating a Client from WSDL</a></p></li></ul></div><div class="section" title="14.5.1.&nbsp;Creating a Client from Java"><div class="titlepage"><div><div><h3 class="title"><a name="ahigf"></a>14.5.1.&nbsp;Creating a Client from Java</h3></div></div></div><p>To create a client from Java, you must create the following
            files:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahigg" title="14.5.1.1.&nbsp;Client Java File (fromjava)">Client Java File (fromjava)</a></p></li><li class="listitem"><p><a class="xref" href="#ahigh" title="14.5.1.2.&nbsp;Client Configuration File (fromjava)">Client Configuration File (fromjava)</a></p></li><li class="listitem"><p><code class="code">build.xml</code></p></li><li class="listitem"><p><code class="code">build.properties</code></p></li></ul></div><p>The <code class="code">build.xml</code> and <code class="code">build.properties</code>
            files are standard in any Ant build environment. Examples of these
            files are provided in the <code class="code">wsit-enabled-fromjava</code>
            sample directory.</p><div class="section" title="14.5.1.1.&nbsp;Client Java File (fromjava)"><div class="titlepage"><div><div><h4 class="title"><a name="ahigg"></a>14.5.1.1.&nbsp;Client Java File (fromjava)</h4></div></div></div><p>The client Java file defines the functionality of the
                web service client. The following code shows the
                <code class="code">AddNumbersClient.java</code> file that is provided in
                the sample.</p><div class="example"><a name="d0e13608"></a><p class="title"><b>Example&nbsp;14.10.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">package fromjava.client;

import com.sun.xml.ws.Closeable;
import java.rmi.RemoteException;

public class AddNumbersClient {
    public static void main (String[] args) {
        AddNumbersImpl port = null;
        try {
            port = new AddNumbersImplService().getAddNumbersImplPort();
            int number1 = 10;
            int number2 = 20;
            System.out.printf ("Invoking addNumbers(%d, %d)\n",
                    number1, number2);
            int result = port.addNumbers (number1, number2);
            System.out.printf (
                    "The result of adding %d and %d is %d.\n\n",
                     number1, number2, result);

            number1 = -10;
            System.out.printf ("Invoking addNumbers(%d, %d)\n",
                    number1, number2);
            result = port.addNumbers (number1, number2);
            System.out.printf (
                    "The result of adding %d and %d is %d.\n",
                     number1, number2, result);
        } catch (AddNumbersException_Exception ex) {
            System.out.printf (
                    "Caught AddNumbersException_Exception: %s\n",
                     ex.getFaultInfo ().getDetail ());
        } finally {
            ((Closeable)port).close();
        }
    }
}</pre></div></div><br class="example-break"><p>This file specifies two positive integers that are to be
                added by the web service, passes the integers to the web
                service and gets the results from the web service by using the
                <code class="code">port.addNumbers</code> method, and prints the results to
                the screen. It then specifies a negative number to be added,
                gets the results (which should be an exception), and prints
                the results (the exception) to the screen.</p></div><div class="section" title="14.5.1.2.&nbsp;Client Configuration File (fromjava)"><div class="titlepage"><div><div><h4 class="title"><a name="ahigh"></a>14.5.1.2.&nbsp;Client Configuration File (fromjava)</h4></div></div></div><p>The client configuration file defines the URL of the web
                service WSDL file. It is used by the web container
                <code class="code">wsimport</code> tool to access and consume the WSDL and
                to build the stubs that are used to communicate with the web
                service.</p><p>The <code class="code">custom-client.xml</code> file provided in the
                <code class="code">wsit-enabled-fromjava</code> sample is shown below. The
                <code class="code">wsdlLocation</code> and the package name xml tags are
                unique to each client and are highlighted in bold text</p><div class="example"><a name="d0e13635"></a><p class="title"><b>Example&nbsp;14.11.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;bindings
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
    wsdlLocation="http://localhost:8080/wsit-enabled-fromjava/ 
        addnumbers?wsdl"
    xmlns="http://java.sun.com/xml/ns/jaxws"&gt;
    &lt;bindings node="wsdl:definitions"&gt;
        &lt;package name="fromjava.client"/&gt;
    &lt;/bindings&gt;
&lt;/bindings&gt;</pre></div></div><br class="example-break"></div></div><div class="section" title="14.5.2.&nbsp;Creating a Client from WSDL"><div class="titlepage"><div><div><h3 class="title"><a name="ahigi"></a>14.5.2.&nbsp;Creating a Client from WSDL</h3></div></div></div><p>To create a client from WSDL, you must create the following
            files:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahigj" title="14.5.2.1.&nbsp;Client Java File (fromwsdl)">Client Java File (fromwsdl)</a></p></li><li class="listitem"><p><a class="xref" href="#ahigk" title="14.5.2.2.&nbsp;Client Configuration File (fromwsdl)">Client Configuration File (fromwsdl)</a></p></li><li class="listitem"><p><code class="code">build.xml</code></p></li><li class="listitem"><p><code class="code">build.properties</code></p></li></ul></div><p>The <code class="code">build.xml</code> and <code class="code">build.properties</code>
            files are standard in any Ant build environment. Examples of these
            files are provided in the <code class="code">fromwsdl</code> sample
            directory.</p><div class="section" title="14.5.2.1.&nbsp;Client Java File (fromwsdl)"><div class="titlepage"><div><div><h4 class="title"><a name="ahigj"></a>14.5.2.1.&nbsp;Client Java File (fromwsdl)</h4></div></div></div><p>The client Java file defines the functionality of the
                web service client. The same client Java file is used with
                both samples, <code class="code">wsit-enabled-fromjava</code> <code class="code">and
                wsit-enabled-fromwsdl</code>. For more information on this
                file, see <a class="xref" href="#ahigg" title="14.5.1.1.&nbsp;Client Java File (fromjava)">Client Java File (fromjava)</a>.</p></div><div class="section" title="14.5.2.2.&nbsp;Client Configuration File (fromwsdl)"><div class="titlepage"><div><div><h4 class="title"><a name="ahigk"></a>14.5.2.2.&nbsp;Client Configuration File (fromwsdl)</h4></div></div></div><p>This is a sample <code class="code">custom-client.xml</code> file.
                The <code class="code">wsdlLocation</code>, package name, and
                <code class="code">jaxb:package</code> name XML tags are unique to each
                client and are highlighted in bold text</p><div class="example"><a name="d0e13696"></a><p class="title"><b>Example&nbsp;14.12.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;
&lt;bindings
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns:jaxb="http://java.sun.com/xml/ns/jaxb"
    xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/"
    wsdlLocation="http://localhost:8080/wsit-enabled-fromwsdl/
            addnumbers?wsdl"
    xmlns="http://java.sun.com/xml/ns/jaxws"&gt;
    &lt;bindings node="ns1:definitions"
            xmlns:ns1="http://schemas.xmlsoap.org/wsdl/"&gt;
            &lt;package name="fromwsdl.client"/&gt;
    &lt;/bindings&gt;
    &lt;bindings node="ns1:definitions/ns1:types/xsd:schema
            [@targetNamespace=&#8217;http://duke.org&#8217;]"
            xmlns:xs="http://www.w3.org/2001/XMLSchema"
            xmlns:ns1="http://schemas.xmlsoap.org/wsdl/"&gt;
        &lt;jaxb:schemaBindings&gt;
            &lt;jaxb:package name="fromwsdl.client"/&gt;
        &lt;/jaxb:schemaBindings&gt;
    &lt;/bindings&gt;
&lt;/bindings&gt;</pre></div></div><br class="example-break"></div></div></div><div class="section" title="14.6.&nbsp;Building and Deploying a Client"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahigl"></a>14.6.&nbsp;Building and Deploying a Client</h2></div></div></div><p>To build and deploy a client for either of the examples provided
        in this tutorial, type one of the following Ant commands in the
        top-level directory of the respective example, (either
        <code class="code">wsit-enabled-fromjava</code> or
        <code class="code">wsit-enabled-fromwsdl</code>) depending on which web container
        you are using:</p><p>For GlassFish:</p><pre class="programlisting"><span class="bold"><strong>ant client</strong></span></pre><p>For Apache Tomcat:</p><pre class="programlisting"><span class="bold"><strong>ant -Duse.tomcat=true client</strong></span></pre><p>This command runs <code class="code">wsimport</code>, which retrieves the web
        service&#8217;s WSDL, and then it runs <code class="code">javac</code> to compile the
        source.</p></div><div class="section" title="14.7.&nbsp;Running a Web Service Client"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahigm"></a>14.7.&nbsp;Running a Web Service Client</h2></div></div></div><p>To run a client for either of the examples provided in this
        tutorial, type one of the following Ant commands in the top-level
        directory of the respective example, (either
        <code class="code">wsit-enabled-fromjava</code> or
        <code class="code">wsit-enabled-fromwsdl</code>) depending on which web container
        you are using:</p><p>For GlassFish:</p><pre class="programlisting"><span class="bold"><strong>ant run</strong></span></pre><p>For the Apache Tomcat:</p><pre class="programlisting"><span class="bold"><strong>ant -Duse.tomcat=true run</strong></span></pre><p>This command executes the <code class="code">run</code> target, which simply
        runs Java with the name of the client&#8217;s class, for example,
        <code class="code">fromwsdl.client.AddNumbersClient</code>.</p></div><div class="section" title="14.8.&nbsp;Undeploying a Web Service"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahign"></a>14.8.&nbsp;Undeploying a Web Service</h2></div></div></div><p>During the development process, it is often useful to undeploy a
        web service. Undeploying a web service means to disable and remove it
        from the web container. Once the web service is removed, clients are
        no longer able to use the web service. Further, the web service will
        not restart without explicit redeployment by the user.</p><p>To undeploy from GlassFish, type the following commands:</p><pre class="programlisting"><span class="bold"><strong>asadmin undeploy --user admin wsit-enabled-fromjava</strong></span></pre><pre class="programlisting"><span class="bold"><strong>asadmin undeploy --user admin wsit-enabled-fromwsdl</strong></span></pre><p>To undeploy from Apache Tomcat, type the following
        commands:</p><pre class="programlisting"><span class="bold"><strong>rm $CATALINA_HOME/webapps/wsit-enabled-fromjava.war</strong></span></pre><pre class="programlisting"><span class="bold"><strong>rm $CATALINA_HOME/webapps/wsit-enabled-fromwsdl.war</strong></span></pre></div></div><div lang="en" class="chapter" title="Chapter&nbsp;15.&nbsp;Accessing Metro Services Using WCF Clients"><div class="titlepage"><div><div><h2 class="title"><a name="accessing-metro-using-wcf-client"></a>Chapter&nbsp;15.&nbsp;Accessing Metro Services Using WCF Clients</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#ahigp">15.1. Creating a WCF Client</a></span></dt><dd><dl><dt><span class="section"><a href="#ahigq">15.1.1. Prerequisites to Creating the WCF Client</a></span></dt><dt><span class="section"><a href="#ahigr">15.1.2. Examining the Client Class</a></span></dt><dt><span class="section"><a href="#ahigs">15.1.3. Building and Running the Client</a></span></dt></dl></dd></dl></div><div class="section" title="15.1.&nbsp;Creating a WCF Client"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahigp"></a>15.1.&nbsp;Creating a WCF Client</h2></div></div></div><p>The process of creating a WCF C# client to the
        <code class="code">addnumbers</code> service is similar to that for a Java
        programming language client. To create a WCF client you will:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Use the <code class="code">svcutil.exe</code> tool to generate the C#
                proxy class and contracts for accessing the web
                service.</p></li><li class="listitem"><p>Create a client program that uses the generated files to
                make calls to the <code class="code">addnumbers</code> web service.</p></li></ol></div><p>This section covers the following topics:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahigq" title="15.1.1.&nbsp;Prerequisites to Creating the WCF Client">Prerequisites to Creating the WCF Client</a></p></li><li class="listitem"><p><a class="xref" href="#ahigr" title="15.1.2.&nbsp;Examining the Client Class">Examining the Client Class</a></p></li><li class="listitem"><p><a class="xref" href="#ahigs" title="15.1.3.&nbsp;Building and Running the Client">Building and Running the Client</a></p></li></ul></div><div class="section" title="15.1.1.&nbsp;Prerequisites to Creating the WCF Client"><div class="titlepage"><div><div><h3 class="title"><a name="ahigq"></a>15.1.1.&nbsp;Prerequisites to Creating the WCF Client</h3></div></div></div><p>You must have the following software installed to create the
            WCF client: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Microsoft Windows Software Development Kit (SDK)
                        for July Community Technology Preview</p></li><li class="listitem"><p>Microsoft .NET Framework 3.5 RTM</p></li><li class="listitem"><p>The <code class="code">csclient-enabled-fromjava.zip</code>
                        example bundle, which is availalble for <a class="link" href="http://metro.java.net/getting-started/download/csclient.zip" target="_top">download</a>.</p></li></ul></div><p> You must also deploy the
            <code class="code">addnumbers</code> service described in <a class="xref" href="#ahifl" title="Chapter&nbsp;14.&nbsp;WSIT Example Using a Web Container Without NetBeans IDE"><i>WSIT Example Using a Web Container Without NetBeans IDE</i></a>. The service is also available for
            <a class="link" href="http://metro.java.net/getting-started/download/wsit-enabled-fromjava.zip" target="_top">download</a>.</p></div><div class="section" title="15.1.2.&nbsp;Examining the Client Class"><div class="titlepage"><div><div><h3 class="title"><a name="ahigr"></a>15.1.2.&nbsp;Examining the Client Class</h3></div></div></div><p>The client class uses a generated proxy class,
            <code class="code">AddNumbersImpl</code>, to access the web service. The
            <code class="code">port</code> instance variable stores a reference to the
            proxy class.</p><div class="example"><a name="d0e13856"></a><p class="title"><b>Example&nbsp;15.1.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">port = new AddNumbersImplClient("AddNumbersImplPort");
...</pre></div></div><br class="example-break"><p>Then the web service operation <code class="code">addNumbers</code> is
            called on <code class="code">port</code>:</p><div class="example"><a name="d0e13867"></a><p class="title"><b>Example&nbsp;15.2.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">...
int result = port.addNumbers (number1, number2);
...</pre></div></div><br class="example-break"><p>The full <code class="code">Client.cs</code> class is as follows:</p><div class="example"><a name="d0e13875"></a><p class="title"><b>Example&nbsp;15.3.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">using System;

class Client {
    static void Main(String[] args) {
        AddNumbersImplClient port = null;
        try {
            port = new AddNumbersImplClient("AddNumbersImplPort");
            int number1 = 10;
            int number2 = 20;

            Console.Write("Adding {0} and {1}. ", number1, number2);
            int result = port.addNumbers (number1, number2);
            Console.WriteLine("Result is {0}.\n\n",result);

            number1 = -10;
            Console.Write("Adding {0} and {1}. ", number1, number2);
            result = port.addNumbers (number1, number2);
            Console.WriteLine("Result is {0}.\n\n",result);
            port.Close();
        } catch (System.ServiceModel.FaultException e) {
            Console.WriteLine("Exception: " + e.Message);
            if (port != null) port.Close();
        }
    }
}</pre></div></div><br class="example-break"></div><div class="section" title="15.1.3.&nbsp;Building and Running the Client"><div class="titlepage"><div><div><h3 class="title"><a name="ahigs"></a>15.1.3.&nbsp;Building and Running the Client</h3></div></div></div><p>The example bundle contains all the files you need to build
            and run a WCF client that accesses a Metro web service written in
            the Java programming language.</p><p>The <code class="code">csclient-enabled-fromjava.zip</code> bundle
            contains the following files: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">Client.cs</code>, the C# client
                        class</p></li><li class="listitem"><p><code class="code">build.bat</code>, the build batch
                        file</p></li></ul></div><p>This section covers the following topics: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahigt" title="15.1.3.1.&nbsp;Generating the Proxy Class and Configuration File">Generating the Proxy Class and Configuration
                File</a></p></li><li class="listitem"><p><a class="xref" href="#gfrfw" title="15.1.3.1.1.&nbsp;To Build the AddNumbers Client">To Build the AddNumbers Client</a></p></li><li class="listitem"><p><a class="xref" href="#gfreh" title="15.1.3.1.2.&nbsp;To Customize the build.bat File">To Customize the build.bat File</a></p></li><li class="listitem"><p><a class="xref" href="#gfreu" title="15.1.3.1.3.&nbsp;To Run the AddNumbers Client">To Run the AddNumbers Client</a></p></li></ul></div><div class="section" title="15.1.3.1.&nbsp;Generating the Proxy Class and Configuration File"><div class="titlepage"><div><div><h4 class="title"><a name="ahigt"></a>15.1.3.1.&nbsp;Generating the Proxy Class and Configuration
                File</h4></div></div></div><p>When creating a Java programming language client, you
                use the <code class="code">wsimport</code> tool to generate the proxy and
                helper classes used by the client class to access the web
                service. When creating a WCF client, the
                <code class="code">svcutil.exe</code> tool provides the same functionality
                as the <code class="code">wsimport</code> tool. <code class="code">svcutil.exe</code>
                generates the C# proxy class and contracts for accessing the
                service from a C# client program.</p><p>The example bundle contains a batch file,
                <code class="code">build.bat</code>, that calls <code class="code">svcutil.exe</code> to
                generate the proxy class. The command is:</p><pre class="programlisting"><span class="bold"><strong>svcutil /config:Client.exe.config http://localhost:8080/wsit-enabled-fromjava/addnumbers?wsdl</strong></span></pre><div class="section" title="15.1.3.1.1.&nbsp;To Build the AddNumbers Client"><div class="titlepage"><div><div><h5 class="title"><a name="gfrfw"></a>15.1.3.1.1.&nbsp;To Build the AddNumbers Client</h5></div></div></div><p>The example bundle's <code class="code">build.bat</code> file
                    first generates the proxy class and configuration file for
                    the client, then compiles the proxy class, configuration
                    file, and <code class="code">Client.cs</code> client class into the
                    <code class="code">Client.exe</code> executable file.</p><p>To run <code class="code">build.bat</code>, do the following.
                    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="bold"><strong>At a command prompt,
                                navigate to the location where you extracted the
                                example bundle.</strong></span></p></li><li class="listitem"><p><span class="bold"><strong>If necessary, customize
                                the <code class="code">build.bat</code> file as described in
                                <a class="xref" href="#gfreh" title="15.1.3.1.2.&nbsp;To Customize the build.bat File">To Customize the build.bat File</a>.</strong></span></p></li><li class="listitem"><p><span class="bold"><strong>Type the following
                                command:</strong></span> </p><pre class="programlisting"><span class="bold"><strong>build.bat</strong></span></pre></li></ol></div></div><div class="section" title="15.1.3.1.2.&nbsp;To Customize the build.bat File"><div class="titlepage"><div><div><h5 class="title"><a name="gfreh"></a>15.1.3.1.2.&nbsp;To Customize the build.bat File</h5></div></div></div><p>To customize the <code class="code">build.bat</code> file for
                    your environment, do the following: </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="bold"><strong>Open
                                <code class="code">build.bat</code> in a text
                                editor.</strong></span></p></li><li class="listitem"><p><span class="bold"><strong>On the first line, type
                                the full path to the <code class="code">svcutil.exe</code> tool.
                                By default, it is installed at <code class="code">C:\Program
                                Files\Microsoft
                                SDKs\Windows\v6.0\Bin</code>.</strong></span></p></li><li class="listitem"><p><span class="bold"><strong>On the first line,
                                change the WSDL location URL if you did not deploy
                                the <code class="code">addnumbers</code> service to the local
                                machine, or if the service was deployed to a
                                different port than the default 8080 port
                                number.</strong></span></p><p>For example, the following command (all on one
                                line) sets the host name to
                                <code class="code">testmachine.example.com</code> and the port
                                number to 8081:</p><pre class="programlisting"><span class="bold"><strong>svcutil /config:Client.exe.config http://testmachine.example.com:8081/wsit-enabled-fromjava/addnumbers?wsdl</strong></span></pre></li><li class="listitem"><p><span class="bold"><strong>On line 2, change the
                                location of the <code class="code">csc.exe</code> C# compiler and
                                the <code class="code">System.ServiceModel</code> and
                                <code class="code">System.Runtime.Serialization</code> support
                                DLLs if you installed the .NET 2.0 and 3.0
                                frameworks to non-default
                                locations.</strong></span></p></li></ol></div></div><div class="section" title="15.1.3.1.3.&nbsp;To Run the AddNumbers Client"><div class="titlepage"><div><div><h5 class="title"><a name="gfreu"></a>15.1.3.1.3.&nbsp;To Run the AddNumbers Client</h5></div></div></div><p>After the client has been built, run the client by
                    following these steps. </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="bold"><strong>At a command prompt,
                                navigate to the location where you extracted the
                                example bundle.</strong></span></p></li><li class="listitem"><p><span class="bold"><strong>Type the following
                                command:</strong></span> </p><pre class="programlisting"><span class="bold"><strong>Client.exe</strong></span></pre><p>
                                You will see the following output: </p><pre class="programlisting">Adding 10 and 20. Result is 30.
Adding -10 and 20. Exception: Negative numbers can't be added!</pre></li></ol></div></div></div></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;16.&nbsp;Data Contracts"><div class="titlepage"><div><div><h2 class="title"><a name="ahigx"></a>Chapter&nbsp;16.&nbsp;Data Contracts</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#ahigy">16.1. Web Service - Start from Java</a></span></dt><dd><dl><dt><span class="section"><a href="#ahigz">16.1.1. Data Types</a></span></dt><dt><span class="section"><a href="#ahihn">16.1.2. Fields and Properties</a></span></dt><dt><span class="section"><a href="#ahihr">16.1.3. Java Classes</a></span></dt><dt><span class="section"><a href="#ahihv">16.1.4. Open Content</a></span></dt><dt><span class="section"><a href="#ahihw">16.1.5. Enum Type</a></span></dt><dt><span class="section"><a href="#ahihx">16.1.6. Package-level Annotations</a></span></dt></dl></dd><dt><span class="section"><a href="#ahiia">16.2. Web Service - Start from WSDL</a></span></dt><dt><span class="section"><a href="#ahiic">16.3. Customizations for WCF Service WSDL</a></span></dt><dd><dl><dt><span class="section"><a href="#ahiid">16.3.1. generateElementProperty Attribute</a></span></dt></dl></dd><dt><span class="section"><a href="#ahiii">16.4. Developing a Microsoft .NET Client</a></span></dt><dt><span class="section"><a href="#ahiij">16.5. BP 1.1 Conformance</a></span></dt></dl></div><div class="section" title="16.1.&nbsp;Web Service - Start from Java"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahigy"></a>16.1.&nbsp;Web Service - Start from Java</h2></div></div></div><p>This section provides guidelines for designing an XML schema
        exported by a Java web service designed starting from Java. JAXB 2.0
        provides a rich set of annotations and types for mapping Java classes
        to different XML Schema constructs. The guidelines provide guidance on
        using JAXB 2.0 annotations and types so that developer friendly
        bindings may be generated by XML serialization mechanisms (svcutil) on
        WCF client.</p><p>Not all JAXB 2.0 annotations are included here; not all are
        relevant from an interoperability standpoint. For example, the
        annotation <code class="code">@XmlAccessorType</code> provides control over default
        serialization of fields and properties in a Java class but otherwise
        has no effect on the on-the-wire XML representation or the XML schema
        generated from a Java class. Select JAXB 2.0 annotations are therefore
        not included here in the guidance.</p><p>The guidance includes several examples, which use the following
        conventions:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The prefix <code class="code">xs:</code> is used to represent XML
                Schema namespace.</p></li><li class="listitem"><p>JAXB 2.0 annotations are defined in
                <code class="code">javax.xml.bind.annotation</code> package but, for
                brevity, the package name has been omitted.</p></li></ul></div><div class="section" title="16.1.1.&nbsp;Data Types"><div class="titlepage"><div><div><h3 class="title"><a name="ahigz"></a>16.1.1.&nbsp;Data Types</h3></div></div></div><p>This section covers the following topics:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#ahiha" title="16.1.1.1.&nbsp;Primitives and Wrappers">Primitives and Wrappers</a></p></li><li class="listitem"><p><a class="xref" href="#ahihb" title="16.1.1.2.&nbsp;BigDecimal Type">BigDecimal Type</a></p></li><li class="listitem"><p><a class="xref" href="#ahihc" title="16.1.1.3.&nbsp;java.net.URI Type">java.net.URI Type</a></p></li><li class="listitem"><p><a class="xref" href="#ahihd" title="16.1.1.4.&nbsp;Duration">Duration</a></p></li><li class="listitem"><p><a class="xref" href="#ahihe" title="16.1.1.5.&nbsp;Binary Types">Binary Types</a></p></li><li class="listitem"><p><a class="xref" href="#ahihf" title="16.1.1.6.&nbsp;XMLGregorianCalendar Type">XMLGregorianCalendar Type</a></p></li><li class="listitem"><p><a class="xref" href="#ahihg" title="16.1.1.7.&nbsp;UUID Type">UUID Type</a></p></li><li class="listitem"><p><a class="xref" href="#ahihh" title="16.1.1.8.&nbsp;Typed Variables">Typed Variables</a></p></li><li class="listitem"><p><a class="xref" href="#ahihi" title="16.1.1.9.&nbsp;Collections Types">Collections Types</a></p></li><li class="listitem"><p><a class="xref" href="#ahihm" title="16.1.1.10.&nbsp;Array Types">Array Types</a></p></li></ul></div><div class="section" title="16.1.1.1.&nbsp;Primitives and Wrappers"><div class="titlepage"><div><div><h4 class="title"><a name="ahiha"></a>16.1.1.1.&nbsp;Primitives and Wrappers</h4></div></div></div><p><span class="emphasis"><em>Guideline:</em></span> Java primitive and
                wrapper classes map to slightly different XML schema
                representations. Therefore, .NET bindings will vary
                accordingly.</p><div class="example"><a name="d0e14130"></a><p class="title"><b>Example&nbsp;16.1.&nbsp;A Java primitive type and its corresponding wrapper
                        class</b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
public class StockItem{
    public Double wholeSalePrice;
    public double retailPrice;
}

//--Schema fragment
&lt;xs:complexType name="stockItem"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="wholeSalePrice" type="xs:double" minOccurs="0"/&gt;
        &lt;xs:element name="retailPrice" type="xs:double"/&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;

//-- .NET C# auto generated code from schema
public partial class stockItem
{
    private double wholeSalePrice;
    private bool wholeSalePriceFieldSpecified;
    private double retailPrice;

    public double wholeSalePrice
    {
        get{ return this.wholeSalePrice;}
        set{this.wholeSalePrice=value}
    }

    public bool wholeSalePriceSpecified
    {
        get{ return this.wholeSalePriceFieldSpecified;}
        set{this.wholeSalePriceFieldSpecified=value}
    }

    public double retailPrice
    {
        get{ return this.retailPrice;}
        set{this.retailPrice=value}
    }
}

//-- C# code fragment
stockItem s = new stockItem();
s.wholeSalePrice = Double.parse("198.92");
s.wholeSalePriceSpecified = true;
s.retailPrice = Double.parse("300.25");</pre></div></div><br class="example-break"></div><div class="section" title="16.1.1.2.&nbsp;BigDecimal Type"><div class="titlepage"><div><div><h4 class="title"><a name="ahihb"></a>16.1.1.2.&nbsp;BigDecimal Type</h4></div></div></div><p><span class="emphasis"><em>Guideline:</em></span> Limit decimal values to
                the range and precision of .NET's
                <code class="code">System.decimal</code>.</p><p><code class="code">java.math.BigDecimal</code> maps to
                <code class="code">xs:decimal</code>. .NET maps <code class="code">xs:decimal</code> to
                <code class="code">System.decimal</code>. These two data types support
                different range and precision.
                <code class="code">java.math.BigDecimal</code> supports arbitrary
                precision. <code class="code">System.decimal</code> does not. For
                interoperability use only values within the range and
                precision of <code class="code">System.decimal</code>. (See
                <code class="code">System.decimal.Minvalue</code> and
                <code class="code">System.decimal.Maxvalue</code>.) Any values outside of
                this range require a customized .NET client.</p><div class="example"><a name="d0e14173"></a><p class="title"><b>Example&nbsp;16.2.&nbsp;<code class="code">BigDecimal</code> usage</b></p><div class="example-contents"><pre class="programlisting">//--- Java code fragment
public class RetBigDecimal {
    private BigDecimal arg0;

    public BigDecimal getArg0() { return this.arg0; }
    public void setArg0(BigDecimal arg0) { this.arg0 = arg0; }
}

//--- Schema fragment
&lt;xs:complexType name="retBigDecimal"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="arg0" type="xs:decimal" minOccurs="0"/&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;

//--- .NET auto generated code from schema
public partial class retBigDecimal{
    private decimal arg0Field;
    private bool arg0FieldSpecified;

    public decimal arg0 {
        get { return this.arg0Field;}
        set { this.arg0Field = value;}
    }

    public bool arg0Specified {
        get { return this.arg0FieldSpecified;}
        set { this.arg0FieldSpecified = value;}
    }
}

//--- C# code fragment
System.CultureInfo engCulture = new System.CultureInfo("en-US");
retBigDecimal bd = new retBigDecimal();
bd.arg0 = System.decimal.MinValue;

retBigDecimal negBd = new retBigDecimal();
negBd = System.decimal.Parse("-0.0", engCulture);</pre></div></div><br class="example-break"></div><div class="section" title="16.1.1.3.&nbsp;java.net.URI Type"><div class="titlepage"><div><div><h4 class="title"><a name="ahihc"></a>16.1.1.3.&nbsp;java.net.URI Type</h4></div></div></div><p><span class="emphasis"><em>Guideline:</em></span> Use the
                <code class="code">@XmlSchemaType</code> annotation for a strongly typed
                binding to a .NET client generated with the
                <code class="code">DataContractSerializer</code>.</p><p><code class="code">java.net.URI</code> maps to
                <code class="code">xs:string</code>. .NET maps <code class="code">xs:string</code> to
                <code class="code">System.string</code>. Annotation
                <code class="code">@XmlSchemaType</code> can be used to define a more
                strongly typed binding to a .NET client generated with the
                <code class="code">DataContractSerializer</code>.
                <code class="code">@XmlSchemaType</code> can be used to map
                <code class="code">java.net.URI</code> to <code class="code">xs:anyURI</code>. .NET's
                <code class="code">DataContractSerializer</code> and
                <code class="code">XmlSerializer</code> bind <code class="code">xs:anyURI</code>
                differently:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">DataContractSerializer</code> binds
                        <code class="code">xs:anyURI</code> to .NET type
                        <code class="code">System.Uri</code>.</p></li><li class="listitem"><p><code class="code">XmlSerializer</code> binds
                        <code class="code">xs:anyURI</code> to .NET type
                        <code class="code">System.string</code>.</p></li></ul></div><p>Thus, the above technique only works if the WSDL is
                processed using <code class="code">DataContractSerializer</code>.</p><div class="example"><a name="d0e14258"></a><p class="title"><b>Example&nbsp;16.3.&nbsp;<code class="code">@XmlSchemaType</code> and
                    <code class="code">DataContractSerializer</code></b></p><div class="example-contents"><pre class="programlisting">// Java code fragment
public class PurchaseOrder
{
    @XmlSchemaType(name="anyURI")
     public java.net.URI uri;
}

//-- Schema fragment
&lt;xs:complexType name="purchaseOrder"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="uri" type="xs:anyURI" minOccurs="0"/&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;

//--- .NET auto generated code from schema
//--- Using svcutil.exe /serializer:DataContractSerializer &lt;wsdl file&gt;
public partial class purchaseOrder : object,
        System.Runtime.Serialization.IExtensibleDataObject
{

    private System.Uri uriField;

    //-- ..... other generated code ........
    public System.Uri uri
    {
        get { return this.uriField; }
        set { this.uriField = value; }
    }
}

//--- C# code fragment
purchaseOrder tmpU = new purchaseOrder()
tmpU.uri = new System.Uri("../Hello", System.UriKind.Relative);</pre></div></div><br class="example-break"><div class="example"><a name="d0e14267"></a><p class="title"><b>Example&nbsp;16.4.&nbsp;<code class="code">@XmlSchemaType</code> and
                    <code class="code">XmlSerializer</code></b></p><div class="example-contents"><pre class="programlisting">// Java code fragment
public class PurchaseOrder
{
    @XmlSchemaType(name="anyURI")
    public java.net.URI uri;
}

//--- .NET auto generated code from schema
//--- Using svcutil.exe /serializer:XmlSerializer &lt;wsdl file&gt;
public partial class purchaseOrder
{
    private string uriField;
    public string uri
    {
        get { return this.uriField; }
        set { this.uriField = value; }
    }
}

//--- C# code fragment
purchaseOrder tmpU = new purchaseOrder()
tmpU.uri = "mailto:mailto:mduerst@ifi.unizh.ch";</pre></div></div><br class="example-break"></div><div class="section" title="16.1.1.4.&nbsp;Duration"><div class="titlepage"><div><div><h4 class="title"><a name="ahihd"></a>16.1.1.4.&nbsp;Duration</h4></div></div></div><p><span class="emphasis"><em>Guideline:</em></span> Use .NET's
                <code class="code">System.Xml.XmlConvert</code> to generate a lexical
                representation of <code class="code">xs:duration</code> when the binding is
                to a type of <code class="code">System.string</code>.</p><p><code class="code">javax.xml.datatype.Duration</code> maps to
                <code class="code">xs:duration</code>. .NET maps <code class="code">xs:duration</code>
                to a different datatype for
                <code class="code">DataContractSerializer</code> and
                <code class="code">XmlSerializer</code>.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">DataContractSerializer</code> binds
                        <code class="code">xs:duration</code> to .NET
                        <code class="code">System.TimeSpan</code>.</p></li><li class="listitem"><p><code class="code">XmlSerializer</code> binds
                        <code class="code">xs:duration</code> to .NET
                        <code class="code">System.string</code>.</p></li></ul></div><p>When <code class="code">xs:duration</code> is bound to .NET
                <code class="code">System.string</code>, the string value must be a lexical
                representation for <code class="code">xs:duration</code>. .NET provides
                utility <code class="code">System.Xml.XmlConvert</code> for this
                purpose.</p><div class="example"><a name="d0e14345"></a><p class="title"><b>Example&nbsp;16.5.&nbsp;Mapping <code class="code">xs:duration</code> using
                    <code class="code">DataContactSerializer</code></b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
public class PurchaseReport {
     public javax.xml.datatype.Duration period;
}

//-- Schema fragment
&lt;xs:complexType name="purchaseReport"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="period" type="xs:duration" minOccurs="0"/&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;

//-- .NET auto generated code from schema
//-- Using svcutil.exe /serializer:DataContractSerializer &lt;wsdl file&gt;
public partial class purchaseReport: object,
        System.Runtime.Serialization.IExtensibleDataObject
{
    private System.TimeSpan periodField;
    //-- ..... other generated code ........
    public System.TimeSpan period
    {
        get { return this.periodField; }
        set { this.periodField = value; }
    }
}

//-- C# code fragment
purchaseReport tmpR = new purchaseReport();
tmpR.period = new System.TimeSpan.MaxValue;</pre></div></div><br class="example-break"><div class="example"><a name="d0e14355"></a><p class="title"><b>Example&nbsp;16.6.&nbsp;Mapping <code class="code">xs:duration</code> using
                    <code class="code">XmlSerializer</code></b></p><div class="example-contents"><pre class="programlisting">//-- .NET auto generated code from schema
//-- Using svcutil.exe /serializer:XmlSerializer &lt;wsdl file&gt;
public partial class purchaseReport
{
    private string periodField;
    public string period
    {
        get { return this.periodField; }
        set { this.periodField = value; }
    }
}

//-- C# code fragment
purchaseReport tmpR = new purchaseReport();
tmpR.period = System.Xml.XmlConvert.ToString(new System.TimeSpan(23, 0,0));</pre></div></div><br class="example-break"></div><div class="section" title="16.1.1.5.&nbsp;Binary Types"><div class="titlepage"><div><div><h4 class="title"><a name="ahihe"></a>16.1.1.5.&nbsp;Binary Types</h4></div></div></div><p><span class="emphasis"><em>Guideline:</em></span>
                <code class="code">java.awt.Image</code>,
                <code class="code">javax.xml.transform.Source</code>, and
                <code class="code">javax.activation.DataHandler</code> map to
                <code class="code">xs:base64Binary</code>. .NET maps
                <code class="code">xs:base64Binary</code> to <code class="code">byte[]</code>.</p><p>JAXB 2.0 provides the annotation
                <code class="code">@XmlMimeType</code>, which supports specifying the
                content type, but .NET ignores this information.</p><div class="example"><a name="d0e14395"></a><p class="title"><b>Example&nbsp;16.7.&nbsp;Mapping <code class="code">java.awt.Image</code>
                    <span class="emphasis"><em>without</em></span>
                    <code class="code">@XmlMimeType</code></b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
public class Claim {
    public java.awt.Image photo;
}

//-- Schema fragment
&lt;xs:complexType name="claim"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="photo" type="xs:base64Binary" minOccurs="0"/&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;

//-- .NET auto generated code from schema
public partial class claim : object,
        System.Runtime.Serialization.IExtensibleDataObject
{
    private byte[] photoField;
    //-- ..... other generated code .......
    public byte[] photo
    {
        get { return this.photoField; }
        set { this.photoField = value; }
    }
}

//-- C# code fragment
try
{
    claim tmpC = new claim();

    System.IO.FileStream f = new System.IO.FileStream(
        "C:\\icons\\circleIcon.gif", System.IO.FileMode.Open);
    int cnt = (int)f.Length;
    tmpC.photo = new byte[cnt];
    int rCnt = f.Read(tmpC.photo, 0, cnt);

}
catch (Exception e)
{
    Console.WriteLine(e.ToString());
}</pre></div></div><br class="example-break"><div class="example"><a name="d0e14408"></a><p class="title"><b>Example&nbsp;16.8.&nbsp;Mapping <code class="code">java.awt.Image</code>
                    <span class="emphasis"><em>with</em></span>
                    <code class="code">@XmlMimeType</code></b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
public class Claim {
    @XmlMimeType("image/gif")
    public java.awt.Image photo;
}

//-- Schema fragment
&lt;xs:complexType name="claim"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="photo" ns1:expectedContentTypes="image/gif"
                    type="xs:base64Binary" minOccurs="0"
                    xmlns:ns1="http://www.w3.org/2005/05/xmlmime"/&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;

//-- Using the @XmlMimeType annotation doesn't change .NET
//--auto generated code
public partial class claim : object,
        System.Runtime.Serialization.IExtensibleDataObject
{
    private byte[] photoField;
    //-- ..... other generated code .......
    public byte[] photo
    {
        get { return this.photoField; }
        set { this.photoField = value; }
    }
}

//-- This code is unchanged by the different schema
//-- C# code fragment
try
{
    claim tmpC = new claim();

    System.IO.FileStream f = new System.IO.FileStream(
        "C:\\icons\\circleIcon.gif", System.IO.FileMode.Open);
    int cnt = (int)f.Length;
    tmpC.photo = new byte[cnt];
    int rCnt = f.Read(tmpC.photo, 0, cnt);
}
catch (Exception e)
{
    Console.WriteLine(e.ToString());
}</pre></div></div><br class="example-break"></div><div class="section" title="16.1.1.6.&nbsp;XMLGregorianCalendar Type"><div class="titlepage"><div><div><h4 class="title"><a name="ahihf"></a>16.1.1.6.&nbsp;XMLGregorianCalendar Type</h4></div></div></div><p><span class="emphasis"><em>Guideline:</em></span> Use
                <code class="code">java.xml.datatype.XMLGregorianCalendar</code> instead of
                <code class="code">java.util.Date</code> and
                <code class="code">java.util.Calendar</code>.</p><p><code class="code">XMLGregorianCalendar</code> supports the following
                XML schema calendar types: <code class="code">xs:date</code>,
                <code class="code">xs:time</code>, <code class="code">xs:dateTime</code>,
                <code class="code">xs:gYearMonth</code>, <code class="code">xs:gMonthDay</code>,
                <code class="code">xs:gYear</code>, <code class="code">xs:gMonth</code>, and
                <code class="code">xs:gDay</code>. It is statically mapped to
                <code class="code">xs:anySimpleType</code>, the common schema type from
                which all the XML schema calendar types are dervived. .NET
                maps <code class="code">xs:anySimpleType</code> to
                <code class="code">System.string</code>.</p><p><code class="code">java.util.Date</code> and
                <code class="code">java.util.Calendar</code> map to
                <code class="code">xs:dateTime</code>, but don&#8218;&Auml;&ouml;&#8730;&Ntilde;&#8730;&yen;t provide as complete
                XML support as <code class="code">XMLGregorianCalendar</code> does.</p><p><span class="emphasis"><em>Guideline:</em></span> Use the annotation
                <code class="code">@XmlSchemaType</code> for a strongly typed binding of
                <code class="code">XMLGregorianCalendar</code> to one of the XML schema
                calendar types.</p><div class="example"><a name="d0e14497"></a><p class="title"><b>Example&nbsp;16.9.&nbsp;<code class="code">XmlGregorianCalendar</code>
                    <span class="emphasis"><em>without</em></span>
                    <code class="code">@XmlSchemaType</code></b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
public class PurchaseOrder {
    public javax.xml.datatype.XMLGregorianCalendar orderDate;
}

//-- Schema fragment
&lt;xs:complexType name="purchaseOrder"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="orderDate" type="xs:anySimpleType" minOccurs="0"/&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;

//-- .NET auto generated code from schema
public partial class purchaseOrder
{
    private string orderDateField;
    public string orderDate
    {
        get { return this.orderDateField; }
        set { this.orderDateField = value; }
    }
}

//-- C# code fragment
purchaseOrder tmpP = new purchaseOrder();
tmpP.orderDate = System.Xml.XmlConvert.ToString(
   System.DateTime.Now, System.Xml.XmlDateTimeSerializerMode.RoundtripKind);</pre></div></div><br class="example-break"><div class="example"><a name="d0e14509"></a><p class="title"><b>Example&nbsp;16.10.&nbsp;<code class="code">XMLGregorianCalendar</code>
                    <span class="emphasis"><em>with</em></span>
                    <code class="code">@XmlSchemaType</code></b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
public class PurchaseOrder {
    @XmlSchemaType(name="dateTime")
    public javax.xml.datatype.XMLGregorianCalendar orderDate;
}

//-- Schema fragment
&lt;xs:complexType name="purchaseOrder"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="orderDate" type="xs:dateTime" minOccurs="0"/&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;

//-- .NET auto generated code from schema
public partial class purchaseOrder : object,
        System.Runtime.Serialization.IExtensibleDataObject
{
    private System.Runtime.Serialization.ExtensionDataObject extensionDataField;
    private System.DateTime orderDateField;

    public System.Runtime.Serialization.ExtensionDataObject ExtensionData
    {
        get { return this.extensionDataField; }
        set { this.extensionDataField = value; }
    }

    public System.DateTime orderDate
    {
        get { return this.orderDateField; }
        set { this.orderDateField = value; }
    }
}

//-- C# code fragment
purchaseOrder tmpP = new purchaseOrder();
tmpP.orderDate = System.DateTime.Now;</pre></div></div><br class="example-break"></div><div class="section" title="16.1.1.7.&nbsp;UUID Type"><div class="titlepage"><div><div><h4 class="title"><a name="ahihg"></a>16.1.1.7.&nbsp;UUID Type</h4></div></div></div><p><span class="emphasis"><em>Guideline:</em></span> Use Leach-Salz variant
                of UUID at runtime.</p><p><code class="code">java.util.UUID</code> maps to schema type
                <code class="code">xs:string</code>. .NET maps <code class="code">xs:string</code> to
                <code class="code">System.string</code>. The constructors in
                <code class="code">java.util.UUID</code> allow any variant of UUID to be
                created. Its methods are for manipulation of the Leach-Salz
                variant.</p><div class="example"><a name="d0e14544"></a><p class="title"><b>Example&nbsp;16.11.&nbsp;Mapping <code class="code">UUID</code></b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
public class ReportUid {
    public java.util.UUID uuid;
}

//-- Schema fragment
&lt;xs:complexType name="reportUid"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="uuid" type="xs:string" minOccurs="0"/&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;

//-- .NET auto generated code from schema
public partial class reportUid: object,
        System.Runtime.Serialization.IExtensibleDataObject
{
    private System.Runtime.Serialization.ExtensionDataObject extensionDataField;
    private string uuidField;

    public System.Runtime.Serialization.ExtensionDataObject ExtensionData
    {
        get { return this.extensionDataField; }
        set { this.extensionDataField = value; }
    }

    public string uuid
    {
        get { return this.uuidField; }
        set { this.uuidField = value; }
    }
}

//-- C# code fragment
reportUid tmpU = new reportUid();
System.Guid guid = new System.Guid("06b7857a-05d8-4c14-b7fa-822e2aa6053f");
tmpU.uuid = guid.ToString();</pre></div></div><br class="example-break"></div><div class="section" title="16.1.1.8.&nbsp;Typed Variables"><div class="titlepage"><div><div><h4 class="title"><a name="ahihh"></a>16.1.1.8.&nbsp;Typed Variables</h4></div></div></div><p><span class="emphasis"><em>Guideline:</em></span> A typed variable maps to
                <code class="code">xs:anyType</code>. .NET maps <code class="code">xs:anyType</code> to
                <code class="code">System.Object</code>.</p><div class="example"><a name="d0e14567"></a><p class="title"><b>Example&nbsp;16.12.&nbsp;Using a typed variable</b></p><div class="example-contents"><pre class="programlisting">// Java class
public class Shape &lt;T&gt;
{
    private T xshape;

    public Shape() {};
    public Shape(T f)
    {
        xshape = f;
    }
}

//-- Schema fragment
&lt;xs:complexType name="shape"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="xshape" type="xs:anyType" minOccurs="0"/&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;

// C# code generated by svcutil
public partial class shape
{
    private object xshapeField;

    public object xshape
    {
        get { return this.xshapeField; }
        set { this.xshapeField = value; }
    }
}</pre></div></div><br class="example-break"></div><div class="section" title="16.1.1.9.&nbsp;Collections Types"><div class="titlepage"><div><div><h4 class="title"><a name="ahihi"></a>16.1.1.9.&nbsp;Collections Types</h4></div></div></div><p>Java collections types
                (<code class="code">java.util.Collection</code> and its subtypes, array,
                List, and parameterized collection types such as
                <code class="code">List&lt;Integer&gt;</code>) can be mapped to XML schema
                in different ways and can be serialized in different ways. The
                following examples show .NET bindings.</p><div class="section" title="16.1.1.9.1.&nbsp;List of Nillable Elements"><div class="titlepage"><div><div><h5 class="title"><a name="ahihj"></a>16.1.1.9.1.&nbsp;List of Nillable Elements</h5></div></div></div><p><span class="emphasis"><em>Guideline:</em></span> By default, a
                    collection type such as <code class="code">List&lt;Integer&gt;</code>
                    maps to an XML schema construct that is a repeating
                    unbounded occurrence of an optional and nillable element.
                    .NET binds the XML schema construct to
                    <code class="code">System.Nullable&lt;int&gt;[]</code>. The element is
                    optional and nillable. However, when marshalling JAXB
                    marshaller will always marshal a null value using
                    <code class="code">xsi:nil</code>.</p><div class="example"><a name="d0e14599"></a><p class="title"><b>Example&nbsp;16.13.&nbsp;Collection to a list of nillable
                        elements</b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
@XmlRootElement(name="po")
public PurchaseOrder {
    public List&lt;Integer&gt; items;
}

//-- Schema fragment
&lt;xs:element name="po" type="purchaseOrder"&gt;
&lt;xs:complexType name="purchaseOrder"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="items" type="xs:int" nillable="true"
                    minOccurs="0" maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
...

//--- JAXB XML serialization
&lt;po&gt;
    &lt;items&gt; 1 &lt;/items&gt;
    &lt;items&gt; 2 &lt;/items&gt;
    &lt;items&gt; 3 &lt;/items&gt;
&lt;/po&gt;

&lt;po&gt;
    &lt;items&gt; 1 &lt;/items&gt;
    &lt;items xsi:nil=true/&gt;
    &lt;items&gt; 3 &lt;/items&gt;
&lt;/po&gt;

//-- .NET auto generated code from schema
partial class purchaseOrder {
        private System.Nullable&lt;int&gt;[] itemsField;

    public System.Nullable&lt;int&gt;[] items
    {
        get { return this.itemsField; }
        set { this.itemsField = value; }
    }
}</pre></div></div><br class="example-break"></div><div class="section" title="16.1.1.9.2.&nbsp;List of Optional Elements"><div class="titlepage"><div><div><h5 class="title"><a name="ahihk"></a>16.1.1.9.2.&nbsp;List of Optional Elements</h5></div></div></div><p><span class="emphasis"><em>Guideline:</em></span> This is the same as
                    above except that a collection type such as
                    <code class="code">List&lt;Integer&gt;</code> maps to a repeating
                    unbounded occurrence of an optional
                    (<code class="code">minOccurs="0"</code>) but not nillable element.
                    This in turn binds to .NET type <code class="code">int[]</code>. This
                    is more developer friendly. However, when marshalling,
                    JAXB will marshal a null value within the
                    <code class="code">List&lt;Integer&gt;</code> as a value that is absent
                    from the XML instance.</p><div class="example"><a name="d0e14623"></a><p class="title"><b>Example&nbsp;16.14.&nbsp;Collection to a list of optional
                        elements</b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
@XmlRootElement(name="po")
public PurchaseOrder {
    @XmlElement(nillable=false)
    public List&lt;Integer&gt; items;
}

//-- Schema fragment
&lt;xs:element name="po" type="purchaseOrder"&gt;
&lt;xs:complexType name="purchaseOrder"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="items" type="xs:int"
                    minOccurs="0" maxOccurs="unbounded"/&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
...

// .NET auto generated code from schema
partial class purchaseOrder {
    private int[] itemsField;

    public int[] items
    {
        get { return this.itemsField; }
        set { this.itemsField = value; }
    }
}</pre></div></div><br class="example-break"></div><div class="section" title="16.1.1.9.3.&nbsp;List of Values"><div class="titlepage"><div><div><h5 class="title"><a name="ahihl"></a>16.1.1.9.3.&nbsp;List of Values</h5></div></div></div><p><span class="emphasis"><em>Guideline:</em></span> A collection such as
                    <code class="code">List&lt;Integer&gt;</code> can be mapped to a list
                    of XML values (that is, an XML schema list simple type)
                    using annotation <code class="code">@XmlList</code>. .NET maps a list
                    simple type to a .NET <code class="code">System.string</code>.</p><div class="example"><a name="d0e14644"></a><p class="title"><b>Example&nbsp;16.15.&nbsp;Collection to a list of values using
                        <code class="code">@XmlList</code></b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
@XmlRootElement(name="po")
public PurchaseOrder {
    @XmlList public List&lt;Integer&gt; items;
}

//-- Schema fragment
&lt;xs:element name="po" type="purchaseOrder"&gt;
&lt;xs:complexType name="purchaseOrder"&gt;
    &lt;xs:element name="items" minOccurs="0"&gt;
        &lt;xs:simpleType&gt;
            &lt;xs:list itemType="xs:int"/&gt;
        &lt;/xs:simpleType&gt;
    &lt;/xs:element&gt;
&lt;/xs:complexType&gt;
...

//-- XML serialization
&lt;po&gt;
    &lt;items&gt; 1 2 3 &lt;/items&gt;
&lt;/po&gt;

// .NET auto generated code from schema
partial class purchaseOrder {
    private string itemsField;

    public string items
    {
        get { return this.itemsField; }
        set { this.itemsField = value; }
    }
}</pre></div></div><br class="example-break"></div></div><div class="section" title="16.1.1.10.&nbsp;Array Types"><div class="titlepage"><div><div><h4 class="title"><a name="ahihm"></a>16.1.1.10.&nbsp;Array Types</h4></div></div></div><div class="example"><a name="d0e14654"></a><p class="title"><b>Example&nbsp;16.16.&nbsp;Single and multidimensional arrays</b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
public class FamilyTree {
    public Person[] persons;
    public Person[][] family;
}

// .NET auto generated code from schema
public partial class familyTree
{
    private person[] persons;
    private person[][] families;

    public person[] persons
    {
        get { return this.membersField; }
        set { this.membersField = value; }
    }

    public person[][] families
    {
        get { return this.familiesField; }
        set { this.familiesField = value; }
    }
}</pre></div></div><br class="example-break"></div></div><div class="section" title="16.1.2.&nbsp;Fields and Properties"><div class="titlepage"><div><div><h3 class="title"><a name="ahihn"></a>16.1.2.&nbsp;Fields and Properties</h3></div></div></div><p>The following guidelines apply to mapping of JavaBeans
            properties and Java fields, but for brevity Java fields are
            used.</p><div class="section" title="16.1.2.1.&nbsp;@XmlElement Annotation"><div class="titlepage"><div><div><h4 class="title"><a name="ahiho"></a>16.1.2.1.&nbsp;@XmlElement Annotation</h4></div></div></div><p><span class="emphasis"><em>Guideline:</em></span> The
                <code class="code">@XmlElement</code> annotation maps a property or field
                to an XML element. This is also the default mapping in the
                absence of any other JAXB 2.0 annotations. The annotation
                parameters in <code class="code">@XmlElement</code> can be used to specify
                whether the element is optional or required, nillable or not.
                The following examples illustrate the corresponding bindings
                in the .NET client.</p><div class="example"><a name="d0e14677"></a><p class="title"><b>Example&nbsp;16.17.&nbsp;Map a field or property to a nillable
                    element</b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
public class PurchaseOrder {

    // Map a field to a nillable XML element
    @javax.xml.bind.annotation.XmlElement(nillable=true)
    public java.math.BigDecimal price;
}

//-- Schema fragment
&lt;xs:complexType name="purchaseOrder"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="price" type="xs:decimal"
                    nillable="true" minOccurs="0" /&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;

// .NET auto generated code from schema
public partial class purchaseOrder {
    private System.Nullable&lt;decimal&gt; priceField;
    private bool priceFieldSpecified;

    public decimal price
    {
        get { return this.priceField; }
        set { this.priceField = value; }
    }

    public bool priceSpecified {
    {
        get { return this.priceFieldSpecified; }
        set { this.priceFieldSpecified = value;}
    }
}</pre></div></div><br class="example-break"><div class="example"><a name="d0e14682"></a><p class="title"><b>Example&nbsp;16.18.&nbsp;Map a property or field to a nillable, required
                    element</b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
public class PurchaseOrder {

    // Map a field to a nillable XML element
    @XmlElement(nillable=true, required=true)
    public java.math.BigDecimal price;
}

//-- Schema fragment
&lt;xs:complexType name="purchaseOrder"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="price" type="xs:decimal"
                    nillable="true" minOccurs="1" /&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;

// .NET auto generated code from schema
public partial class purchaseOrder {
    private System.Nullable&lt;decimal&gt; priceField;

    public decimal price
    {
        get { return this.priceField; }
        set { this.priceField = value; }
    }
}</pre></div></div><br class="example-break"></div><div class="section" title="16.1.2.2.&nbsp;@XmlAttribute Annotation"><div class="titlepage"><div><div><h4 class="title"><a name="ahihp"></a>16.1.2.2.&nbsp;@XmlAttribute Annotation</h4></div></div></div><p><span class="emphasis"><em>Guideline:</em></span> A property or field can
                be mapped to an XML attribute using <code class="code">@XmlAttribute</code>
                annotation. .NET binds an XML attribute to a property.</p><div class="example"><a name="d0e14697"></a><p class="title"><b>Example&nbsp;16.19.&nbsp;Mapping a field or property to an XML
                    attribute</b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
public class UKAddress extends Address {
    @XmlAttribute
    public int exportCode;
}

//-- Schema fragment
&lt;! XML Schema fragment --&gt;
&lt;xs:complexType name="ukAddress"&gt;
    &lt;xs:complexContent&gt;
        &lt;xs:extension base="tns:address"&gt;
            &lt;xs:sequence/&gt;
            &lt;xs:attribute name="exportCode" type="xs:int"/&gt;
        &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
&lt;/xs:complexType&gt;

// .NET auto generated code from schema
public partial class ukAddress : address
{
    private int exportCodeField;
    public int exportCode
    {
        get { return this.exportCodeField; }
        set { this.exportCodeField = value; }
    }
}</pre></div></div><br class="example-break"></div><div class="section" title="16.1.2.3.&nbsp;@XmlElementRefs Annotation"><div class="titlepage"><div><div><h4 class="title"><a name="ahihq"></a>16.1.2.3.&nbsp;@XmlElementRefs Annotation</h4></div></div></div><p><span class="emphasis"><em>Guideline:</em></span>
                <code class="code">@XmlElementRefs</code> maps to a <code class="code">xs:choice</code>.
                This binds to a property with name <code class="code">item</code> in the C#
                class. If there is another field/property named
                <code class="code">item</code> in the Java class, there will be a name
                clash that .NET will resolve by generating name. To avoid the
                name clash, either change the name or use customization, for
                example <code class="code">@XmlElement(name="foo")</code>.</p><div class="example"><a name="d0e14724"></a><p class="title"><b>Example&nbsp;16.20.&nbsp;Mapping a field or property using
                    <code class="code">@XmlElementRefs</code></b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
public class PurchaseOrder {
    @XmlElementRefs({
        @XmlElementRef(name="plane", type=PlaneType.class),
        @XmlElementRef(name="auto", type=AutoType.class)})
    public TransportType shipBy;
}

@XmlRootElement(name="plane")
public class PlaneType extends TransportType {}

@XmlRootElement(name="auto")
public class AutoType extends TransportType { }

@XmlRootElement
public class TransportType { ... }

//-- Schema fragment
&lt;!-- XML schema generated by wsgen --&gt;
&lt;xs:complexType name="purchaseOrder"&gt;
    &lt;xs:choice&gt;
        &lt;xs:element ref="plane"/&gt;
        &lt;xs:element ref="auto"/&gt;
    &lt;/xs:choice&gt;
&lt;/xs:complexType&gt;

&lt;!-- XML global elements --&gt;
&lt;xs:element name="plane" type="autoType" /&gt;
&lt;xs:element name="auto" type="planeType" /&gt;

&lt;xs:complexType name="autoType"&gt;
    &lt;!-- content omitted - details not relevant to example --&gt;
&lt;/xs:complexType&gt;

&lt;/xs:complexType name="planeType"&gt;
    &lt;!-- content omitted - details not relevant to example --&gt;
&lt;/xs:complexType&gt;

// .NET auto generated code from schema
public partial class purchaseOrder {
    private transportType itemField;

    [System.Xml.Serialization.XmlElementAttribute("auto", typeof(autoType), Order=4)]
    [System.Xml.Serialization.XmlElementAttribute("plane", typeof(planeType), Order=4)]
    public transportType Item
    {
        get { return this.itemField; }
        set { this.itemField = value; }
    }

public partial class planeType { ... } ;
public partial class autoType { ... } ;</pre></div></div><br class="example-break"></div></div><div class="section" title="16.1.3.&nbsp;Java Classes"><div class="titlepage"><div><div><h3 class="title"><a name="ahihr"></a>16.1.3.&nbsp;Java Classes</h3></div></div></div><p>A Java class can be mapped to different XML schema type
            and/or an XML element. The following guidelines apply to the usage
            of annotations at the class level.</p><div class="section" title="16.1.3.1.&nbsp;@XmlType Annotation - Anonymous Type"><div class="titlepage"><div><div><h4 class="title"><a name="ahihs"></a>16.1.3.1.&nbsp;@XmlType Annotation - Anonymous Type</h4></div></div></div><p><span class="emphasis"><em>Guideline:</em></span> Prefer mapping class to
                named XML schema type rather than an anonymous type for a
                better .NET type binding.</p><p>The <code class="code">@XmlType</code> annotation is used to
                customize the mapping of a Java class to an anonymous type.
                .NET binds an anonymous type to a .NET class - one per
                reference to the anonymous type. Thus, each Java class mapped
                to an anonymous type can generate multiple classes on the .NET
                client.</p><div class="example"><a name="d0e14748"></a><p class="title"><b>Example&nbsp;16.21.&nbsp;Mapping a Java class to an anonymous type using
                    <code class="code">@XmlType</code></b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
public class PurchaseOrder {
    public java.util.List&lt;Item&gt; item;
}
@XmlType(name="")
public class Item {
    public String productName;
    ...
}

//-- Schema fragment
&lt;xs:complexType name="purchaseOrder"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="item"&gt;
            &lt;xs:complexType&gt;
                &lt;xs:sequence&gt;
                    &lt;xs:element name="productName" type="xs:string"/&gt;
                &lt;/xs:sequence&gt;
            &lt;/xs:complexType
&gt;        &lt;/xs:element&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;

// C# code generated by svcutil
public partial class purchaseOrder
{
    private purchaseOrderItem[] itemField;
    System.Xml.Serialization.XmlElementAttribute("item",
        Form=System.Xml.Schema.XmlSchemaForm.Unqualified, IsNullable=true, Order=0)]
    public purchaseOrderItem[] item
    {
        get {
            return this.itemField;
        }

        set {
            this.itemField = value;
        }
    }
}

// .NET auto generated code from schema
public partial class purchaseOrderItem
{
    private string productNameField;
    public string productName {
        get { return this.productNameField; }
        set { this.productNameField = value; }
    }
}</pre></div></div><br class="example-break"></div><div class="section" title="16.1.3.2.&nbsp;@XmlType Annotation - xs:all"><div class="titlepage"><div><div><h4 class="title"><a name="ahiht"></a>16.1.3.2.&nbsp;@XmlType Annotation - xs:all</h4></div></div></div><p><span class="emphasis"><em>Guideline:</em></span> Avoid using
                <code class="code">XmlType(propOrder=:{})</code>.</p><p><code class="code">@XmlType(propOrder={})</code> maps a Java class to
                an XML Schema complex type with <code class="code">xs:all</code> content
                model. Since XML Schema places severe restrictions on
                <code class="code">xs:all</code>, the use of
                <code class="code">@XmlType(propOrder={})</code> is therefore not
                recommended. So, the following example shows the mapping of a
                Java class to <code class="code">xs:all</code>, but the corresponding .NET
                code generated by <code class="code">svcutil</code> is omitted.</p><div class="example"><a name="d0e14784"></a><p class="title"><b>Example&nbsp;16.22.&nbsp;Mapping a class to <code class="code">xs:all</code> using
                    <code class="code">@XmlType</code></b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
@XmlType(propOrder={})
public class USAddress {
    public String name;
    public String street;
}

//-- Schema fragment
&lt;xs:complexType name="USAddress"&gt;
    &lt;xs:all&gt;
        &lt;xs:element name="name" type="xs:string"/&gt;
        &lt;xs:element name="street" type="xs:string"/&gt;
        ...
    &lt;/xs:all&gt;
&lt;/xs:complexType&gt;</pre></div></div><br class="example-break"></div><div class="section" title="16.1.3.3.&nbsp;@XmlType Annotation - Simple Content"><div class="titlepage"><div><div><h4 class="title"><a name="ahihu"></a>16.1.3.3.&nbsp;@XmlType Annotation - Simple Content</h4></div></div></div><p><span class="emphasis"><em>Guideline:</em></span> A class can be mapped to
                a <code class="code">complexType</code> with a <code class="code">simpleContent</code>
                using <code class="code">@XmlValue</code> annotation. .NET binds the Java
                property annotated with <code class="code">@XmlValue</code> to a property
                with name <code class="code">"value"</code>.</p><div class="example"><a name="d0e14816"></a><p class="title"><b>Example&nbsp;16.23.&nbsp;Class to <code class="code">complexType</code> with
                    <code class="code">simpleContent</code></b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
public class InternationalPrice
{
    @XmlValue
    public java.math.BigDecimal price;

    @XmlAttribute public String currency;
}

//-- Schema fragment
&lt;xs:complexType name="internationalPrice"&gt;
    &lt;xs:simpleContent&gt;
        &lt;xs:extension base="xs:decimal"&gt;
            xs:attribute name="currency" type="xs:string"/&gt;
        &lt;/xs:extension&gt;
    &lt;/xs:simpleContent&gt;
 &lt;/xs:complexType&gt;

// .NET auto generated code from schema
public partial class internationalPrice
{
    private string currencyField;
    private decimal valueField;
    public string currency
    {
        get { return this.currencyField; }
        set { this.currencyField = value;}
    }

    public decimal Value
    {
        get { return this.valueField; }
        set { this.valueField = value;}
    }
}</pre></div></div><br class="example-break"></div></div><div class="section" title="16.1.4.&nbsp;Open Content"><div class="titlepage"><div><div><h3 class="title"><a name="ahihv"></a>16.1.4.&nbsp;Open Content</h3></div></div></div><p>JAXB 2.0 supports the following annotations for defining
            open content. (Open content allows content not statically defined
            in XML schema to occur in an XML instance):</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The <code class="code">@XmlAnyElement</code> annotation maps to
                    <code class="code">xs:any</code>, which binds to the .NET type
                    <code class="code">System.Xml.XmlElement[]</code>.</p></li><li class="listitem"><p>The <code class="code">@XmlAnyAttribute</code> annotation maps to
                    <code class="code">xs:anyAttribute</code>, which binds to the .NET type
                    <code class="code">System.Xml.XmlAttribute[]</code>.</p></li></ul></div><div class="example"><a name="d0e14856"></a><p class="title"><b>Example&nbsp;16.24.&nbsp;Using <code class="code">@XmlAnyElement</code> for open
                content</b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
@XmlType(propOrder={"name", "age", "oc"})
public class OcPerson {
    @XmlElement(required=true)
    public String name;
    public int age;

    // Define open content
    @XmlAnyElement
    public List&lt;Object&gt; oc;
}

//-- Schema fragment
&lt;xs:complexType name="ocPerson"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="name" type="xs:string"/&gt;
        &lt;xs:element name="age" type="xs:int"/&gt;
        &lt;xs:any minOccurs="0" maxOccurs="unbounded"&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;

// .NET auto generated code from schema
public class ocPerson
{
    private String name;
    private int age;
    private System.Xml.XmlElement[] anyField;&lt;

    public String name { ... }
    public int age { ... }

    public System.Xml.XmlElement[] Any {
    {
        get { return this.anyField; }
        set { this.anyField = value; }
    }
}</pre></div></div><br class="example-break"><div class="example"><a name="d0e14864"></a><p class="title"><b>Example&nbsp;16.25.&nbsp;Using <code class="code">@XmlAnyAttribute</code> for open
                content</b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
@XmlType(propOrder={"name", "age"}
public class OcPerson {
    public String name;
    public int age;

    // Define open content
    @XmlAnyAttribute
    public java.util.Map oc;
}

//-- Schema fragment
&lt;xs:complexType name="ocPerson"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="name" type="xs:string"/&gt;
        &lt;xs:element name="age" type="xs:int"/&gt;
    &lt;/xs:sequence&gt;
    &lt;xs:anyAttribute/&gt;
&lt;/xs:complexType&gt;

// .NET auto generated code from schema
public class ocPerson
{
    private String name;
    private double age;
    private System.Xml.XmlAttribute[] anyAttrField;&lt;

    public String name { ... }
    public double age { ... }

    public System.Xml.XmlElement[] anyAttr {
    {
        get { return this.anyAttrField; }
        set { this.anyAttrField = value; }
    }
}</pre></div></div><br class="example-break"></div><div class="section" title="16.1.5.&nbsp;Enum Type"><div class="titlepage"><div><div><h3 class="title"><a name="ahihw"></a>16.1.5.&nbsp;Enum Type</h3></div></div></div><p><span class="emphasis"><em>Guideline:</em></span> A Java <code class="code">enum</code>
            type maps to an XML schema type constrained by enumeration facets.
            This, in turn, binds to the .NET type <code class="code">enum</code>
            type.</p><div class="example"><a name="d0e14885"></a><p class="title"><b>Example&nbsp;16.26.&nbsp;Java <code class="code">enum</code> &#8596; <code class="code">xs:simpleType</code>
                (with <code class="code">enum</code> facets) &#8596; .NET
                <code class="code">enum</code></b></p><div class="example-contents"><pre class="programlisting">//-- Java code fragment
public enum USState {MA, NH}

//-- Schema fragment
&lt;xs:simpleType name="usState"&gt;
    &lt;xs:restriction base="xs:string"&gt;
        &lt;xs:enumeration value="NH" /&gt;
        &lt;xs:enumeration value="MA" /&gt;
    &lt;/xs:restriction&gt;
&lt;/xs:simpleType&gt;

// .NET auto generated code from schema
public enum usState { NH, MA }</pre></div></div><br class="example-break"></div><div class="section" title="16.1.6.&nbsp;Package-level Annotations"><div class="titlepage"><div><div><h3 class="title"><a name="ahihx"></a>16.1.6.&nbsp;Package-level Annotations</h3></div></div></div><p>The following package-level JAXB annotations are relevant
            from an interoperability standpoint:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">@XmlSchema</code> - customizes the mapping of
                    package to XML namespace.</p></li><li class="listitem"><p><code class="code">@XmlSchemaType</code> - customizes the mapping
                    of XML schema built-in type. The
                    <code class="code">@XmlSchemaType</code> annotation can also be used at
                    the property/field level, as was seen in the example <a class="xref" href="#ahihf" title="16.1.1.6.&nbsp;XMLGregorianCalendar Type">XMLGregorianCalendar Type</a>.</p></li></ul></div><div class="section" title="16.1.6.1.&nbsp;@XmlSchema Annotation"><div class="titlepage"><div><div><h4 class="title"><a name="ahihy"></a>16.1.6.1.&nbsp;@XmlSchema Annotation</h4></div></div></div><p>A package is mapped to an XML namespace. The following
                attributes of the XML namespace can be customized using the
                <code class="code">@XmlSchema</code> annotation parameters:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">elementFormDefault</code> using
                        <code class="code">@XmlSchema.elementFormDefault()</code></p></li><li class="listitem"><p><code class="code">attributeFormDefault</code> using
                        <code class="code">@XmlSchema.attributeFormDefault()</code></p></li><li class="listitem"><p><code class="code">targetNamespace</code> using
                        <code class="code">@XmlSchema.namespace()</code></p></li><li class="listitem"><p>Associate namespace prefixes with the XML
                        namespaces using the <code class="code">@XmlSchema.ns()</code>
                        annotation</p></li></ul></div><p>These XML namespace attributes are bound to .NET
                serialization attributes (for example,
                <code class="code">XmlSerializer</code> attributes).</p></div><div class="section" title="16.1.6.2.&nbsp;Not Recommended Annotations"><div class="titlepage"><div><div><h4 class="title"><a name="ahihz"></a>16.1.6.2.&nbsp;Not Recommended Annotations</h4></div></div></div><p>Any JAXB 2.0 annotation can be used, but the following
                are not recommended:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The
                        <code class="code">javax.xml.bind.annotation.XmlElementDecl</code>
                        annotation is used to provide complete XML schema
                        support.</p></li><li class="listitem"><p>The <code class="code">@XmlID</code> and
                        <code class="code">@XmlIDREF</code> annotations are used for XML
                        object graph serialization, which is not well
                        supported.</p></li></ul></div></div></div></div><div class="section" title="16.2.&nbsp;Web Service - Start from WSDL"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahiia"></a>16.2.&nbsp;Web Service - Start from WSDL</h2></div></div></div><p>The following guidelines apply when designing a Java web service
        starting from a WSDL:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>If the WSDL was generated by
                <code class="code">DataContractSerializer</code>, enable JAXB 2.0
                customizations described in <a class="xref" href="#ahiic" title="16.3.&nbsp;Customizations for WCF Service WSDL">Customizations for WCF Service WSDL</a>. The rationale for the JAXB 2.0
                customizations is described in the same section.</p></li><li class="listitem"><p>If the WSDL is a result of contract first approach,
                verify that the WSDL can be processed by either the
                <code class="code">DataContractSerializer</code> or
                <code class="code">XmlSerializer</code> mechanisms.</p><p>The purpose of this step is to ensure that the WSDL uses
                only the set of XML schema features supported by JAXB 2.0 or
                .NET serialization mechanisms. JAXB 2.0 was designed to
                support all the XML schema features. The WCF serialization
                mechanisms, <code class="code">DataContractSerializer</code> and
                <code class="code">XmlSerializer</code>, provide different levels of
                support for XML schema features. Thus, the following step will
                ensure that the WSDL/schema file can be consumed by the WCF
                serialization mechanisms.</p><pre class="programlisting"><span class="bold"><strong>svcutil <span class="emphasis"><em>wsdl-file</em></span></strong></span></pre><p>The <code class="code">svcutil.exe</code> tool, by default, uses
                <code class="code">DataContractSerializer</code> but falls back to
                <code class="code">XmlSerializer</code> if it encounters an XML schema
                construct not supported by <code class="code">XmlFormatter</code>.</p></li></ol></div></div><div class="section" title="16.3.&nbsp;Customizations for WCF Service WSDL"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahiic"></a>16.3.&nbsp;Customizations for WCF Service WSDL</h2></div></div></div><p>When developing either a Java web service or a Java client from
        a WCF service WSDL generated using
        <code class="code">DataContractSerializer</code>, the following JAXB 2.0
        customizations are useful and/or required.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">generateElementProperty</code> attribute</p></li><li class="listitem"><p><code class="code">mapSimpleTypeDef</code> attribute</p></li></ul></div><p>The following sections explain the use and rationale of these
        customizations.</p><div class="section" title="16.3.1.&nbsp;generateElementProperty Attribute"><div class="titlepage"><div><div><h3 class="title"><a name="ahiid"></a>16.3.1.&nbsp;generateElementProperty Attribute</h3></div></div></div><p>WCF service WSDL generated from a programming language such
            as C# using <code class="code">DataContractSerializer</code> may contain XML
            Schema constructs which result in
            <code class="code">JAXBElement&lt;T&gt;</code> in generated code. A
            <code class="code">JAXBElement&lt;T&gt;</code> type can also sometimes be
            generated when a WSDL contains advanced XML schema features such
            as substitution groups or elements that are both optional and
            nillable. In all such cases, <code class="code">JAXBElement&lt;T&gt;</code>
            provides roundtripping support of values in XML instances.
            However, <code class="code">JAXBElement&lt;T&gt;</code> is not natural to a
            Java developer. So the <code class="code">generateElementProperty</code>
            customization can be used to generate an alternate developer
            friendly but lossy binding. The different bindings along with the
            trade-offs are discussed below.</p><div class="section" title="16.3.1.1.&nbsp;Default Binding"><div class="titlepage"><div><div><h4 class="title"><a name="ahiie"></a>16.3.1.1.&nbsp;Default Binding</h4></div></div></div><p>The following is the default binding of an optional
                <code class="code">(minOccurs="0")</code> and
                <code class="code">nillable(nillable="true")</code> element:</p><div class="example"><a name="d0e15089"></a><p class="title"><b>Example&nbsp;16.27.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;!-- XML schema fragment --&gt;
&lt;xs:element name="person" type="Person"/&gt;
&lt;xs:complexType name="Person"&gt;
    &lt;xs:sequence&gt;
        &lt;xs:element name="name" type="xs:string"
                    nillable="true" minOccurs="0"/&gt;
    &lt;/xs:sequence&gt;
&lt;/xs:complexType&gt;
...</pre></div></div><br class="example-break"><div class="example"><a name="d0e15092"></a><p class="title"><b>Example&nbsp;16.28.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">// Binding
public class Person {
    JAXBElement&lt;String&gt; getName() {...};
    public void setName(JAXBElement&lt;String&gt; value) {...}
}</pre></div></div><br class="example-break"><p>Since the XML element <code class="code">name</code> is both optional
                and nillable, it can be represented in an XML instance in one
                of following ways:</p><div class="example"><a name="d0e15100"></a><p class="title"><b>Example&nbsp;16.29.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;!-- Absence of element name--&gt;
&lt;person&gt;
    &lt;-- element name is absent --&gt;
&lt;/person&gt;

&lt;!-- Presence of an element name --&gt;
&lt;person&gt;
    &lt;name xsi:nil="true"/&gt;
&lt;/person&gt;</pre></div></div><br class="example-break"><p>The <code class="code">JAXBElement&lt;String&gt;</code> type
                roundtrips the XML representation of <code class="code">name</code> element
                across an unmarshal/marshal operation.</p></div><div class="section" title="16.3.1.2.&nbsp;Customized Binding"><div class="titlepage"><div><div><h4 class="title"><a name="ahiif"></a>16.3.1.2.&nbsp;Customized Binding</h4></div></div></div><p>When <code class="code">generateElementProperty</code> is false, the
                binding is changed as follows:</p><div class="example"><a name="d0e15119"></a><p class="title"><b>Example&nbsp;16.30.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">// set JAXB customization generateElementProperty="false"
public class Person {
    String getName() {...}
    public void setName(String value) {...}
}</pre></div></div><br class="example-break"><p>The above binding is more natural to Java developer than
                <code class="code">JAXBElement&lt;String&gt;</code>. However, it does not
                roundtrip the value of <code class="code">name</code>.</p><p>JAXB 2.0 allows <code class="code">generateElementProperty</code> to
                be set:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Globally in
                        <code class="code">&lt;jaxb:globalBindings&gt;</code></p></li><li class="listitem"><p>Locally in <code class="code">&lt;jaxb:property&gt;</code>
                        customization</p></li></ul></div><p>When processing a WCF service WSDL, it is recommended
                that the <code class="code">generateElementProperty</code> customization be
                set in <code class="code">&lt;jaxb:globalBindings&gt;</code>:</p><div class="example"><a name="d0e15155"></a><p class="title"><b>Example&nbsp;16.31.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;jaxb:bindings version="2.0"
               xmlns:jxb="http://java.sun.com/xml/ns/jaxb"
               xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;
    &lt;jaxb:bindings schemaLocation="schema-importedby-wcfsvcwsdl"
                   node="/xs:schema"&gt;
        &lt;jaxb:globalBindings generateElementProperty="false"/&gt;
    &lt;/jaxb:bindings&gt;
    ...</pre></div></div><br class="example-break"><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The <code class="code">generateElementProperty</code> attribute
                    was introduced in JAXB 2.1.</p></div></div><div class="section" title="16.3.1.3.&nbsp;mapSimpleTypeDef Attribute"><div class="titlepage"><div><div><h4 class="title"><a name="ahiig"></a>16.3.1.3.&nbsp;mapSimpleTypeDef Attribute</h4></div></div></div><p>XML Schema Part 2: Datatype defines facilities for
                defining datatypes for use in XML Schemas. .NET platform
                introduced the CLR types for some of the XML schema datatypes
                as described in <a class="xref" href="#ahiih" title="Table&nbsp;16.1.&nbsp;CLR to XML Schema Type Mapping">CLR to XML Schema Type Mapping</a>.</p><div class="table"><a name="ahiih"></a><p class="title"><b>Table&nbsp;16.1.&nbsp;CLR to XML Schema Type Mapping</b></p><div class="table-contents"><table summary="CLR to XML Schema Type Mapping" border="1"><colgroup><col><col></colgroup><thead><tr><th><p>CLR Type</p></th><th><p>XML Schema Type</p></th></tr></thead><tbody><tr><td><p> <code class="code">byte</code> </p></td><td><p> <code class="code">xs:unsignedByte</code>
                                </p></td></tr><tr><td><p> <code class="code">uint</code> </p></td><td><p> <code class="code">xs:unsignedInt</code>
                                </p></td></tr><tr><td><p> <code class="code">ushort</code> </p></td><td><p> <code class="code">xs:unsignedShor</code>
                                </p></td></tr><tr><td><p> <code class="code">ulong</code> </p></td><td><p> <code class="code">xs:unsignedLong</code>
                                </p></td></tr></tbody></table></div></div><br class="table-break"><p>However, there are no corresponding Java types that map
                to the XML Schema types listed in <a class="xref" href="#ahiih" title="Table&nbsp;16.1.&nbsp;CLR to XML Schema Type Mapping">CLR to XML Schema Type Mapping</a>. Furthermore, JAXB 2.0 maps these
                XML schema types to Java types that are natural to Java
                developer. However, this results in a mapping that is not
                one-to-one. For example:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">xs:int -&gt; int</code></p></li><li class="listitem"><p><code class="code">xs:unsignedShort -&gt; int</code></p></li></ul></div><p>The lack of a one-to-one mapping means that when XML
                Schema types shown in <a class="xref" href="#ahiih" title="Table&nbsp;16.1.&nbsp;CLR to XML Schema Type Mapping">CLR to XML Schema Type Mapping</a> are used in an
                <code class="code">xsi:type</code> construct, they won&#8218;&Auml;&ouml;&#8730;&Ntilde;&#8730;&yen;t be preserved
                by default across an unmarshal followed by marshal operation.
                For example:</p><div class="example"><a name="d0e15256"></a><p class="title"><b>Example&nbsp;16.32.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">// C# web method
public Object retObject(Object objvalue);
// Java web method generated from WCF service WSDL
public Object retObject(
    Object objvalue);
}</pre></div></div><br class="example-break"><p>The following illustrates why <code class="code">xsi:type</code> is
                not preserved across an unmarshal/marshal operation.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>A value of type <code class="code">uint</code> is marshalled
                        by WCF serialization mechanism as:</p><div class="example"><a name="d0e15271"></a><p class="title"><b>Example&nbsp;16.33.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;objvalue xsi:type="xs:unsignedShort"/&gt;</pre></div></div><br class="example-break"></li><li class="listitem"><p>JAXB 2.0 unmarshaller unmarshals the value as an
                        instance of <code class="code">int</code> and assigns it to
                        parameter <code class="code">objvalue</code>.</p></li><li class="listitem"><p>The <code class="code">objvalue</code> is marshalled back by
                        JAXB 2.0 marshaller with an <code class="code">xsi:type</code> of
                        <code class="code">xs:int</code>.</p><div class="example"><a name="d0e15295"></a><p class="title"><b>Example&nbsp;16.34.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;objvalue xsi:type="xs:int"/&gt;</pre></div></div><br class="example-break"></li></ul></div><p>One way to preserve and roundtrip the
                <code class="code">xsi:type</code> is to use the
                <code class="code">mapSimpleTypeDef</code> customization. The customization
                makes the mapping of XML Schema Part 2 datatypes one--to-one
                by generating additional Java classes. Thus,
                <code class="code">xs:unsignedShort</code> will be bound to its own class
                rather than <code class="code">int</code>, as shown:</p><div class="example"><a name="d0e15312"></a><p class="title"><b>Example&nbsp;16.35.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">//Java class to which xs:unsignedShort is bound
public class UnsignedShort { ... }</pre></div></div><br class="example-break"><p>The following illustrates how the <code class="code">xsi:type</code>
                is preserved across an unmarshal/marshal operation:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>A value of type <code class="code">uint</code> is marshalled
                        by WCF serialization mechanism as:</p><div class="example"><a name="d0e15327"></a><p class="title"><b>Example&nbsp;16.36.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;objvalue xsi:type="xs:unsignedShort"/&gt;</pre></div></div><br class="example-break"></li><li class="listitem"><p>JAXB 2.0 unmarshaller unmarshals the value as an
                        instance of <code class="code">UnsignedShort</code> and assigns it
                        to parameter <code class="code">objvalue</code>.</p></li><li class="listitem"><p>The <code class="code">objvalue</code> is marshalled back by
                        JAXB 2.0 marshaller with an <code class="code">xsi:type</code> of
                        <code class="code">xs:int</code>.</p><div class="example"><a name="d0e15351"></a><p class="title"><b>Example&nbsp;16.37.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;objvalue xsi:type="xs:unsignedShort"/&gt;</pre></div></div><br class="example-break"></li></ul></div><p><span class="emphasis"><em>Guideline:</em></span> Use the
                <code class="code">mapSimpleTypedef</code> customization where
                roundtripping of XML Schema types in <a class="xref" href="#ahiih" title="Table&nbsp;16.1.&nbsp;CLR to XML Schema Type Mapping">CLR to XML Schema Type Mapping</a> are used in <code class="code">xsi:type</code>.
                However, it is preferable to avoid the use of CLR types listed
                in <a class="xref" href="#ahiih" title="Table&nbsp;16.1.&nbsp;CLR to XML Schema Type Mapping">CLR to XML Schema Type Mapping</a> since
                they are specific to .NET platform.</p><p>The syntax of the <code class="code">mapSimpleTypeDef</code>
                customization is shown below.</p><div class="example"><a name="d0e15373"></a><p class="title"><b>Example&nbsp;16.38.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;jaxb:bindings version="2.0"
               xmlns:jxb="http://java.sun.com/xml/ns/jaxb"
               xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;
    &lt;jaxb:bindings schemaLocation="schema-importedby-wcfsvcwsdl"&gt;
        &lt;jaxb:globalBindings mapSimpleTypeDef="true"/&gt;
    &lt;/jaxb:bindings&gt;
    ....</pre></div></div><br class="example-break"></div></div></div><div class="section" title="16.4.&nbsp;Developing a Microsoft .NET Client"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahiii"></a>16.4.&nbsp;Developing a Microsoft .NET Client</h2></div></div></div><p>This section describes how to develop a .NET client that uses
        data binding.</p><div class="task" title="To Develop a Microsoft .NET Client"><a name="gfrep"></a><p class="title"><b>To Develop a Microsoft .NET Client</b></p><div class="tasksummary">
                <p>Perform the following steps to generate a Microsoft .NET
                client from a Java web service WSDL file.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Generate WCF web service
                    client artifacts using the <code class="code">svcutil.exe</code>
                    tool:</strong></span></p><pre class="programlisting"><span class="bold"><strong>svcutil.exe <span class="emphasis"><em>java-web-service-wsdl</em></span></strong></span></pre><p><code class="code">svcutil.exe</code> has the following options
                    for selecting a serializer:</p><ul class="stepalternatives">
                        <li class="step" title="Step 1.1"><p><code class="code">svcutil.exe /serializer:auto</code>
                            (default)</p></li>

                        <li class="step" title="Step 1.2"><p><code class="code">svcutil.exe
                            /serializer:DataContractSerializer</code></p></li>

                        <li class="step" title="Step 1.3"><p><code class="code">svcutil.exe
                            /serializer:XmlSerializer</code></p></li>
                    </ul><p>It is recommended that you use the default option,
                    <code class="code">/serializer:auto</code>. This option ensures that
                    <code class="code">svcutil.exe</code> falls back to
                    <code class="code">XmlSerializer</code> if an XML schema construct is
                    used that cannot be processed by
                    <code class="code">DataContractSerializer</code>.</p><p>For example, in the following class the field
                    <code class="code">price</code> is mapped to an XML attribute that
                    cannot be consumed by
                    <code class="code">DataContractSerializer</code>.</p><div class="example"><a name="d0e15449"></a><p class="title"><b>Example&nbsp;16.39.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">public class POType {
    @javax.xml.bind.annotation.XmlAttribute
    public java.math.BigDecimal price;
}

&lt;!-- XML schema fragment --&gt;
&lt;xs:complexType name="poType"&gt;
    &lt;xs:sequence/&gt;
    &lt;xs:attribute name="price" type="xs:decimal"/&gt;
&lt;/xs:complexType&gt;</pre></div></div><br class="example-break"></li><li class="step" title="Step 2"><p><span class="bold"><strong>Develop the .NET client using
                    the generated artifacts.</strong></span></p></li></ol></div></div></div><div class="section" title="16.5.&nbsp;BP 1.1 Conformance"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahiij"></a>16.5.&nbsp;BP 1.1 Conformance</h2></div></div></div><p>JAX-WS 2.0 enforces strict Basic Profile 1.1 compliance. In one
        situation, the .NET framework does not enforce strict BP 1.1
        semantics, and their usage can lead to interoperability
        problems.</p><p>In <code class="code">rpclit</code> mode, <a class="link" href="http://www.ws-i.org/Profiles/BasicProfile-1.1-2006-04-10.html" target="_top">BP
        1.1</a>, R2211 disallows the use of <code class="code">xsi:nil</code> in part
        accessors: An <span class="emphasis"><em>ENVELOPE</em></span> described with an
        <code class="code">rpc-literal</code> binding <span class="emphasis"><em>MUST NOT</em></span> have
        the <code class="code">xsi:nil</code> attribute with a value of <code class="code">"1"</code> or
        <code class="code">"true"</code> on the part accessors.</p><p>From a developer perspective this means that in
        <code class="code">rpclit</code> mode, JAX-WS does not allow a null to be passed in
        a web service method parameter.</p><div class="example"><a name="d0e15496"></a><p class="title"><b>Example&nbsp;16.40.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">//Java Web method
public byte[] retByteArray(byte[] inByteArray) {
    return inByteArray;
}</pre></div></div><br class="example-break"><div class="example"><a name="d0e15499"></a><p class="title"><b>Example&nbsp;16.41.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;!-- In rpclit mode, the above Java web service method will throw an exception
  if the following XML instance with xsi:nil is passed by a .NET client.--&gt;
  &lt;RetByteArray xmlns="http://tempuri.org/"&gt;
      &lt;inByteArray a:nil="true" xmlns=""
          xmlns:a="http://www.w3.org/2001/XMLSchema-instance"/&gt;
  &lt;/RetByteArray&gt;</pre></div></div><br class="example-break"></div></div><div lang="en" class="chapter" title="Chapter&nbsp;17.&nbsp;Modular Databinding"><div class="titlepage"><div><div><h2 class="title"><a name="modulardbinding"></a>Chapter&nbsp;17.&nbsp;Modular Databinding</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#md-introduction">17.1. Introduction</a></span></dt><dt><span class="section"><a href="#md-jvm">17.2. Configure databinding for JVM</a></span></dt><dt><span class="section"><a href="#md-endpoint">17.3. Configure databinding for an endpoint</a></span></dt></dl></div><div class="section" title="17.1.&nbsp;Introduction"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="md-introduction"></a>17.1.&nbsp;Introduction</h2></div></div></div><p>The JAX-WS reference implementation (RI) used to be dependent
        on the JAXB RI for databinding. JAXB and JAX-WS implementations have 
        been decoupled in Metro 2.2 release, and databinding is now modular.
        The Eclipselink JAXB implementation, plus EclipseLink extensions,
        is called MOXy. The <code class="code">org.eclipse.persistence.moxy.jar</code> file 
        is bundled with GlassFish Server, which supports the JAXB RI and MOXy 
        as databinding providers.
        For standalone distributions, databinding plugins can be found in
        <code class="code">lib/databinding</code> folder in the distribution. The MOXy
        implementation (library) is not bundled with Metro. It's expected from
        user to provide MOXy jars to classpath whenever MOXy databinding is 
        required. EclipseLink JAXB compiler is not included as well, but can be 
        used with GlassFish Server. Download the EclipseLink zip file at
        <a class="link" href="http://www.eclipse.org/eclipselink/downloads/" target="_top">http://www.eclipse.org/eclipselink/downloads/</a>
        and unzip it.
        </p></div><div class="section" title="17.2.&nbsp;Configure databinding for JVM"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="md-jvm"></a>17.2.&nbsp;Configure databinding for JVM</h2></div></div></div><p>To specify the databinding provider for the JVM, set the 
        <code class="code">com.sun.xml.ws.spi.db.BindingContextFactory</code> JVM property 
        to one of the following values:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><span class="bold"><strong><code class="code">com.sun.xml.ws.db.glassfish.JAXBRIContextFactory</code></strong></span>
                Specifies the JAXB reference implementation. This is the default.
            </li><li class="listitem"><span class="bold"><strong><code class="code">com.sun.xml.ws.db.toplink.JAXBContextFactory</code></strong></span>
                Specifies the EclipseLink MOXy JAXB binding.
            </li></ul></div><p>For example:</p><code class="code">
            asadmin create-jvm-options -Dcom.sun.xml.ws.spi.db.BindingContextFactory=com.sun.xml.ws.db.toplink.JAXBContextFactory
        </code></div><div class="section" title="17.3.&nbsp;Configure databinding for an endpoint"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="md-endpoint"></a>17.3.&nbsp;Configure databinding for an endpoint</h2></div></div></div><p>To specify the databinding provider for a web service endpoint:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
                Set the <code class="code">org.jvnet.ws.databinding.DatabindingModeFeature</code> 
                feature during <code class="code">WebServiceFeature</code> list initialization
                or using the <code class="code">add</code> method. Allowed values are as follows:

                <div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><span class="bold"><strong><code class="code">org.jvnet.ws.databinding.DatabindingModeFeature.GLASSFISH_JAXB</code></strong></span>
                        Specifies the JAXB reference implementation. This is the default.
                    </li><li class="listitem"><span class="bold"><strong><code class="code">com.sun.xml.ws.db.toplink.JAXBContextFactory.ECLIPSELINK_JAXB</code></strong></span>
                        Specifies Eclipselink MOXy JAXB binding.
                    </li></ul></div>

                For example:
                <pre class="programlisting">
import javax.xml.ws.WebServiceFeature;
import org.jvnet.ws.databinding.DatabindingModeFeature;
import com.sun.xml.ws.db.toplink.JAXBContextFactory;
...
WebServiceFeature[] features = { new DatabindingModeFeature(JAXBContextFactory.ECLIPSELINK_JAXB)};
                </pre></li><li class="listitem">
                Set the <code class="code">org.jvnet.ws.databinding.DatabindingModeFeature</code> 
                feature using the <code class="code">@DatabindingMode</code> annotation.

                For example:
                <pre class="programlisting">
import javax.jws.WebService;
import org.jvnet.ws.databinding.DatabindingMode;
import com.sun.xml.ws.db.toplink.JAXBContextFactory;
...
@WebService
@DatabindingMode(JAXBContextFactory.ECLIPSELINK_JAXB);
                </pre></li><li class="listitem">
                Set the <code class="code">databinding</code> attribute of the endpoint element 
                in the <code class="code">sun-jaxws.xml</code> file. Allowed values are 
                <code class="code">glassfish.jaxb</code> or <code class="code">eclipselink.jaxb</code>.
                For example:

                <pre class="programlisting">
&lt;endpoint
    name='hello'
    implementation='hello.HelloImpl'
    url-pattern='/hello'
    databinding='eclipselink.jaxb'/&gt;
                </pre></li></ul></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;18.&nbsp;Using Atomic Transactions"><div class="titlepage"><div><div><h2 class="title"><a name="using_at"></a>Chapter&nbsp;18.&nbsp;Using Atomic Transactions</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#using_wsat">18.1. Using Web Services Atomic Transactions</a></span></dt><dd><dl><dt><span class="section"><a href="#using_wsat-overview">18.1.1. Overview of Web Services Atomic Transactions</a></span></dt><dt><span class="section"><a href="#using_wsat-enable_endpoint">18.1.2. Enabling Web Services Atomic Transactions on Web Service
            Endpoint</a></span></dt><dt><span class="section"><a href="#using_wsat-enable_client">18.1.3. Enabling Web Services Atomic Transactions on Web Service
            Clients</a></span></dt><dt><span class="section"><a href="#using_wsat-system_level_config">18.1.4. System Level Configuration</a></span></dt><dt><span class="section"><a href="#compatibility">18.1.5. Compatibility</a></span></dt></dl></dd><dt><span class="section"><a href="#ahiim">18.2. About the basicWSTX Example</a></span></dt><dt><span class="section"><a href="#ahiip">18.3. Building, Deploying and Running the basicWSTX Example</a></span></dt></dl></div><div class="section" title="18.1.&nbsp;Using Web Services Atomic Transactions"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using_wsat"></a>18.1.&nbsp;Using Web Services Atomic Transactions</h2></div></div></div><p>This section describes how to use Web services atomic
        transactions to enable interoperability with other external
        transaction processing systems.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#using_wsat-overview" title="18.1.1.&nbsp;Overview of Web Services Atomic Transactions">Overview of Web Services Atomic Transactions</a></p></li><li class="listitem"><p><a class="xref" href="#using_wsat-enable_endpoint" title="18.1.2.&nbsp;Enabling Web Services Atomic Transactions on Web Service Endpoint">Enabling Web Services Atomic Transactions on Web Service
            Endpoint</a></p></li><li class="listitem"><p><a class="xref" href="#using_wsat-enable_client" title="18.1.3.&nbsp;Enabling Web Services Atomic Transactions on Web Service Clients">Enabling Web Services Atomic Transactions on Web Service
            Clients</a></p></li></ul></div><div class="section" title="18.1.1.&nbsp;Overview of Web Services Atomic Transactions"><div class="titlepage"><div><div><h3 class="title"><a name="using_wsat-overview"></a>18.1.1.&nbsp;Overview of Web Services Atomic Transactions</h3></div></div></div><p>Web services enable interoperability with other external
            transaction processing systems, such as WebLogic, Websphere,
            JBoss, Microsoft .NET, and so on, through the support of the
            following specifications:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Web Services Atomic Transaction
                    (WS-AtomicTransaction) Versions 1.0, 1.1 and 1.2:
                    <code class="code">http://docs.oasis-open.org/ws-tx/wstx-wsat-1.2-spec-cs-01/wstx-wsat-1.2-spec-cs-01.html</code></p></li><li class="listitem"><p>Web Services Coordination (WS-Coordination) Versions
                    1.0, 1.1 and 1.2:
                    <code class="code">http://docs.oasis-open.org/ws-tx/wstx-wscoor-1.2-spec-cs-01/wstx-wscoor-1.2-spec-cs-01.html</code></p></li></ul></div><p>These specifications define an extensible framework for
            coordinating distributed activities among a set of participants.
            The coordinator, shown in the following figure, is the central
            component, managing the transactional state (coordination context)
            and enabling Web services and clients to register as
            participants.</p><div class="figure"><a name="f0.3738067790934235"></a><p class="title"><b>Figure&nbsp;18.1.&nbsp;Web Services Atomic Transactions Framework</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/coordinator.png" height="360" alt="Web Services Atomic Transactions Framework"></td></tr></table></div></div></div><br class="figure-break"><p>The following table describes the components of Web services
            atomic transactions, shown in the previous figure.</p><div class="table"><a name="using_wsat-components_table"></a><p class="title"><b>Table&nbsp;18.1.&nbsp;Components of Web Services Atomic Transactions</b></p><div class="table-contents"><table summary="Components of Web Services Atomic Transactions" border="1"><colgroup><col><col></colgroup><thead><tr><th>
                                <p>Component</p>
                            </th><th>
                                <p>Description</p>
                            </th></tr></thead><tbody><tr><td>
                                <p>Coordinator</p>
                            </td><td>
                                <p>Manages the transactional state (coordination
                                context) and enables Web services and clients to
                                register as participants.</p>
                            </td></tr><tr><td>
                                <p>Activation Service</p>
                            </td><td>
                                <p>Enables the application to activate a
                                transaction and create a coordination context for an
                                activity. Once created, the coordination context is
                                passed with the transaction flow.</p>
                            </td></tr><tr><td>
                                <p>Registration Service</p>
                            </td><td>
                                <p>Enables an application to register as a
                                participant.</p>
                            </td></tr><tr><td>
                                <p>Application Protocol X, Y</p>
                            </td><td>
                                <p>Supported coordination protocols, such as
                                WS-AtomicTransaction.</p>
                            </td></tr></tbody></table></div></div><br class="table-break"><p>The following figure shows two server instances interacting
            within the context of a Web services atomic transaction.</p><div class="figure"><a name="f0.34418460497260706"></a><p class="title"><b>Figure&nbsp;18.2.&nbsp;Atomic Transaction - Interaction between two
                Servers</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/wsatarch.png" height="360" alt="Atomic Transaction - Interaction between two Servers"></td></tr></table></div></div></div><br class="figure-break"><p>Please note the following:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Using the local JTA transaction manager, a
                    transaction can be imported to or exported from the local
                    JTA environment as a subordinate transaction, all within
                    the context of a Web service request.</p></li><li class="listitem"><p>Creation and management of the coordination context
                    is handled by the local JTA transaction manager.</p></li><li class="listitem"><p>All transaction integrity management and recovery
                    processing is done by the local JTA transaction
                    manager.</p></li></ul></div><p>The following describes a sample end-to-end Web services
            atomic transaction interaction:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Application A begins a transaction on the current
                    thread of control using the JTA transaction manager on
                    Server A.</p></li><li class="listitem"><p>Application A calls a Web service method in
                    Application B on Server B.</p></li><li class="listitem"><p>Server A updates its transaction information and
                    creates a SOAP header that contains the coordination
                    context, and identifies the transaction and local
                    coordinator.</p></li><li class="listitem"><p>Server B receives the request for Application B,
                    detects that the header contains a transaction
                    coordination context and determines whether it has already
                    registered as a participant in this transaction. If it
                    has, that transaction is resumed and if not, a new
                    transaction is started.</p><p>Application B executes within the context of the
                    imported transaction. All transactional resources with
                    which the application interacts are enlisted with this
                    imported transaction.</p></li><li class="listitem"><p>Server B enlists itself as a participant in the
                    WS-AtomicTransaction transaction by registering with the
                    registration service indicated in the transaction
                    coordination context.</p></li><li class="listitem"><p>Server A resumes the transaction.</p></li><li class="listitem"><p>Application A resumes processing and commits the
                    transaction.</p></li></ol></div></div><div class="section" title="18.1.2.&nbsp;Enabling Web Services Atomic Transactions on Web Service Endpoint"><div class="titlepage"><div><div><h3 class="title"><a name="using_wsat-enable_endpoint"></a>18.1.2.&nbsp;Enabling Web Services Atomic Transactions on Web Service
            Endpoint</h3></div></div></div><p>To enable Web services atomic transactions on a Web service
            endpoint:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>When starting from Java (bottom-up), add the
                    <code class="code">@com.sun.xml.ws.api.tx.at.Transactional</code>
                    annotation to the Web service endpoint implementation
                    class or method.</p></li></ul></div><p>The following tables summarizes the configuration options
            that you can set when enabling Web services atomic
            transactions:</p><div class="table"><a name="using_wsat-config_table"></a><p class="title"><b>Table&nbsp;18.2.&nbsp;Web Services Atomic Transactions Configuration
                Options</b></p><div class="table-contents"><table summary="Web Services Atomic Transactions Configuration&#xA;                Options" border="1"><colgroup><col><col></colgroup><thead><tr><th>
                                <p>Attribute</p>
                            </th><th>
                                <p>Description</p>
                            </th></tr></thead><tbody><tr><td>
                                <p>
                                    <code class="code">Version</code>
                                </p>
                            </td><td>
                                <p>Version of the Web services atomic transaction
                                coordination context that is used for Web services
                                and clients. For clients, it specifies the version
                                used for outbound messages only. The value specified
                                must be consistent across the entire
                                transaction.</p>

                                <p>Valid values include <code class="code">WSAT10</code>,
                                <code class="code">WSAT11</code>, <code class="code">WSAT12</code>, and
                                <code class="code">DEFAULT</code>. The <code class="code">DEFAULT</code> value
                                for Web services is all three versions (driven by
                                the inbound request); the <code class="code">DEFAULT</code> value
                                for Web service clients is
                                <code class="code">WSAT12</code>.</p>
                            </td></tr><tr><td>
                                <p>
                                    <code class="code">Flow type</code>
                                </p>
                            </td><td>
                                <p>Whether the Web services atomic transaction
                                coordination context is passed with the transaction
                                flow. See table for valid values.</p>
                            </td></tr></tbody></table></div></div><br class="table-break"><p>The following table summarizes the valid values for flow
            type and their meaning on the Web service and client. The table
            also summarizes the valid value combinations when configuring web
            services atomic transactions for an EJB-style web service that
            uses the <code class="code">@TransactionAttribute</code> annotation.</p><div class="table"><a name="using_wsat-flow_types_table"></a><p class="title"><b>Table&nbsp;18.3.&nbsp;Flow Types Values</b></p><div class="table-contents"><table summary="Flow Types Values" border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>
                                <p>Value</p>
                            </th><th>
                                <p>Web Service Client</p>
                            </th><th>
                                <p>Web Service</p>
                            </th><th>
                                <p>Valid EJB <code class="code">@TransactionAttribute</code>
                                Values</p>
                            </th></tr></thead><tbody><tr><td>
                                <p>
                                    <code class="code">NEVER</code>
                                </p>
                            </td><td>
                                <p>JTA transaction: Do not export transaction
                                coordination context.</p>

                                <p>No JTA transaction: Do not export transaction
                                coordination context.</p>
                            </td><td>
                                <p>Transaction flow exists: Do not import
                                transaction coordination context. If the
                                CoordinationContext header contains
                                <code class="code">mustunderstand="true"</code>, a SOAP fault is
                                thrown.</p>

                                <p>No transaction flow: Do not import transaction
                                coordination context.</p>
                            </td><td>
                                <p><code class="code">NEVER</code>,
                                <code class="code">NOT_SUPPORTED</code>, <code class="code">REQUIRED</code>,
                                <code class="code">REQUIRES_NEW</code>,
                                <code class="code">SUPPORTS</code></p>
                            </td></tr><tr><td>
                                <p><code class="code">SUPPORTS</code> (Default)</p>
                            </td><td>
                                <p>JTA transaction: Export transaction
                                coordination context.</p>

                                <p>No JTA transaction: Do not export transaction
                                coordination context.</p>
                            </td><td>
                                <p>Transaction flow exists: Import transaction
                                context.</p>

                                <p>No transaction flow: Do not import transaction
                                coordination context.</p>
                            </td><td>
                                <p><code class="code">REQUIRED</code>,
                                <code class="code">SUPPORTS</code></p>
                            </td></tr><tr><td>
                                <p>
                                    <code class="code">MANDATORY</code>
                                </p>
                            </td><td>
                                <p>JTA transaction: Export transaction
                                coordination context.</p>

                                <p>No JTA transaction: An exception is
                                thrown.</p>
                            </td><td>
                                <p>Transaction flow exists: Import transaction
                                context.</p>

                                <p>No transaction flow: Service-side exception is
                                thrown.</p>
                            </td><td>
                                <p><code class="code">MANDATORY</code>, <code class="code">REQUIRED</code>,
                                <code class="code">SUPPORTS</code></p>
                            </td></tr></tbody></table></div></div><br class="table-break"><div class="section" title="18.1.2.1.&nbsp;Using the @Transactional Annotation in Your JWS File"><div class="titlepage"><div><div><h4 class="title"><a name="using_wsat-enable_endpoint_using_annotation"></a>18.1.2.1.&nbsp;Using the @Transactional Annotation in Your JWS
                File</h4></div></div></div><p>To enable Web services atomic transactions, specify the
                <code class="code">@com.sun.xml.ws.api.tx.at.Transactional</code>
                annotation on the Web service endpoint implementation class or
                method.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>If you specify the <code class="code">@Transactional</code>
                        annotation at the Web service class level, the
                        settings apply to all two-way methods defined by the
                        service endpoint interface. You can override the flow
                        type value at the method level; however, the version
                        must be consistent across the entire
                        transaction.</p></li><li class="listitem"><p>You cannot explicitly specify the
                        <code class="code">@Transactional</code> annotation on a Web method
                        that is also annotated with
                        <code class="code">@Oneway</code>.</p></li><li class="listitem"><p>Web services atomic transactions cannot be used
                        with the client-side asynchronous programming
                        model.</p></li></ul></div><p>The format for specifying the
                <code class="code">@Transactional</code> annotation is as follows:</p><div class="example"><a name="d0e16032"></a><p class="title"><b>Example&nbsp;18.1.&nbsp;@Transactional annotation format</b></p><div class="example-contents"><pre class="programlisting">@Transactional(
    version=Transactional.Version.[WSAT10|WSAT11|WSAT12|DEFAULT],
    value=Transactional.TransactionFowType.[MANDATORY|SUPPORTS|NEVER]
)</pre></div></div><br class="example-break"><p>For more information about the version and flow type
                configuration options, see Table.</p><p>The following sections provide examples of using the
                <code class="code">@Transactional</code> annotation at the Web service
                implementation class and method levels, and with the EJB
                @TransactionAttribute annotation.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>
                            <a class="xref" href="#using_wsat-enable_endpoint_using_annotation_example_class" title="18.1.2.1.1.&nbsp;Example: Using @Transactional Annotation on a Web Service Class">Example: Using @Transactional Annotation on a Web
                    Service Class</a>
                        </p></li><li class="listitem"><p>
                            <a class="xref" href="#using_wsat-enable_endpoint_using_annotation_example_method" title="18.1.2.1.2.&nbsp;Example: Using @Transactional Annotation on a Web Service Method">Example: Using @Transactional Annotation on a Web
                    Service Method</a>
                        </p></li><li class="listitem"><p>
                            <a class="xref" href="#using_wsat-enable_endpoint_using_annotation_example_both" title="18.1.2.1.3.&nbsp;Example: Using the @Transactional and the EJB @TransactionAttribute Annotations Together">Example: Using the @Transactional and the EJB
                    @TransactionAttribute Annotations Together</a>
                        </p></li></ul></div><div class="section" title="18.1.2.1.1.&nbsp;Example: Using @Transactional Annotation on a Web Service Class"><div class="titlepage"><div><div><h5 class="title"><a name="using_wsat-enable_endpoint_using_annotation_example_class"></a>18.1.2.1.1.&nbsp;Example: Using @Transactional Annotation on a Web
                    Service Class</h5></div></div></div><p>The following example shows how to add
                    <code class="code">@Transactional</code> annotation on a Web service
                    class. As shown in the example, there is an active JTA
                    transaction.</p><div class="example"><a name="d0e16068"></a><p class="title"><b>Example&nbsp;18.2.&nbsp;@Transactional Annotation on a Web Service
                        Class</b></p><div class="example-contents"><pre class="programlisting">package examples.webservices.jaxws.wsat.simple.service;
. . .
import javax.transaction.UserTransaction;
. . .
import javax.jws.WebService;
import com.sun.xml.ws.api.tx.at.Transactional;
import com.sun.xml.ws.api.tx.at.Transactional.Version;
import com.sun.xml.ws.api.tx.at.Transactional.TransactionFlowType;

/**
 * This JWS file forms the basis of a WS-Atomic Transaction Web Service 
 * with the
 * operations: createAccount, deleteAccount, transferMonet, listAccount
 *
 */
@WebService(serviceName = "WsatBankTransferService", 
        targetNamespace = "http://tempuri.org/",
        portName = "WSHttpBindingIService")
@Transactional(value = Transactional.TransactionFlowType.MANDATORY,
        version = com.sun.xml.ws.api.tx.at.Transactional.Version.WSAT10)
public class WsatBankTransferService {

    public String createAccount(String acctNo, String amount) throws java
            .lang.Exception {

        Context ctx = null;
        UserTransaction tx = null;
        try {
            ctx = new InitialContext();
            tx = (UserTransaction) ctx.lookup("java:comp/UserTransaction");
            try {
                DataSource dataSource = (DataSource) ctx.lookup
                        ("examples-demoXA-2");

                String sql = "insert into wsat_acct_remote (acctno, " +
                        "amount) values (" + acctNo +
                        ", " + amount + ")";

                int insCount = dataSource.getConnection()
                        .prepareStatement(sql).executeUpdate();

                if (insCount != 1)
                    throw new java.lang.Exception("insert fail at remote" +
                            ".");

                return ":acctno=" + acctNo + " amount=" + amount + " " +
                        "creating. ";
            } catch (SQLException e) {
                System.out.println("**** Exception caught *****");
                e.printStackTrace();

                throw new SQLException("SQL Exception during " +
                        "createAccount() at remote.");
            }
        } catch (java.lang.Exception e) {
            System.out.println("**** Exception caught *****");
            e.printStackTrace();
            throw new java.lang.Exception(e);
        }
    }

    public String deleteAccount(String acctNo) throws java.lang.Exception {
        ...
    }

    public String transferMoney(String acctNo, String amount,
                                String direction)
            throws java.lang.Exception {
        ...
    }

    public String listAccount() throws java.lang.Exception {
        ...
    }
}</pre></div></div><br class="example-break"></div><div class="section" title="18.1.2.1.2.&nbsp;Example: Using @Transactional Annotation on a Web Service Method"><div class="titlepage"><div><div><h5 class="title"><a name="using_wsat-enable_endpoint_using_annotation_example_method"></a>18.1.2.1.2.&nbsp;Example: Using @Transactional Annotation on a Web
                    Service Method</h5></div></div></div><p>The following example shows how to add
                    <code class="code">@Transactional</code> annotation on a Web service
                    implementation method.</p><div class="example"><a name="d0e16081"></a><p class="title"><b>Example&nbsp;18.3.&nbsp;@Transactional Annotation on a Web Service
                        Method</b></p><div class="example-contents"><pre class="programlisting">package examples.webservices.jaxws.wsat.simple.service;
. . .
import javax.transaction.UserTransaction;
. . .
import javax.jws.WebService;
import com.sun.xml.ws.api.tx.at.Transactional;
import com.sun.xml.ws.api.tx.at.Transactional.Version;
import com.sun.xml.ws.api.tx.at.Transactional.TransactionFlowType;

/**
 * This JWS file forms the basis of a WS-Atomic Transaction Web Service 
 * with the
 * operations: createAccount, deleteAccount, transferMonet, listAccount
 *
 */
@WebService(serviceName = "WsatBankTransferService",
        targetNamespace = "http://tempuri.org/",
        portName = "WSHttpBindingIService")
public class WsatBankTransferService {

    @Transactional(value = Transactional.TransactionFlowType.MANDATORY,
            version = com.sun.xml.ws.api.tx.at.Transactional.Version
                    .WSAT10)
    public String createAccount(String acctNo, String amount) throws java
            .lang.Exception {
        
        Context ctx = null;
        UserTransaction tx = null;
        try {
            ctx = new InitialContext();
            tx = (UserTransaction) ctx.lookup("javax.transaction" + "" +
                    ".UserTransaction");
            try {
                DataSource dataSource = (DataSource) ctx.lookup
                        ("examples-demoXA-2");

                String sql = "insert into wsat_acct_remote (acctno, " +
                        "amount) values (" + acctNo +
                        ", " + amount + ")";

                int insCount = dataSource.getConnection()
                        .prepareStatement(sql).executeUpdate();
                
                if (insCount != 1)
                    throw new java.lang.Exception("insert fail at remote" +
                            ".");
                
                return ":acctno=" + acctNo + " amount=" + amount + " " +
                        "creating. ";
            } catch (SQLException e) {
                System.out.println("**** Exception caught *****");
                e.printStackTrace();
                
                throw new SQLException("SQL Exception during " + 
                        "createAccount() at remote.");
            }
        } catch (java.lang.Exception e) {
            System.out.println("**** Exception caught *****");
            e.printStackTrace();
            throw new java.lang.Exception(e);
        }
    }

    public String deleteAccount(String acctNo) throws java.lang.Exception {
        ...
    }

    public String transferMoney(String acctNo, String amount,
                                String direction)
            throws java.lang.Exception {
        ...
    }

    public String listAccount() throws java.lang.Exception {
        ...
    }
}</pre></div></div><br class="example-break"></div><div class="section" title="18.1.2.1.3.&nbsp;Example: Using the @Transactional and the EJB @TransactionAttribute Annotations Together"><div class="titlepage"><div><div><h5 class="title"><a name="using_wsat-enable_endpoint_using_annotation_example_both"></a>18.1.2.1.3.&nbsp;Example: Using the @Transactional and the EJB
                    @TransactionAttribute Annotations Together</h5></div></div></div><p>The following example illustrates how to use the
                    <code class="code">@Transactional</code> and EJB
                    <code class="code">@TransactionAttribute</code> annotations together.
                    In this case, the flow type values must be
                    compatible.</p><div class="example"><a name="d0e16097"></a><p class="title"><b>Example&nbsp;18.4.&nbsp;@Transactional and the EJB
                        @TransactionAttribute Used Together</b></p><div class="example-contents"><pre class="programlisting">package examples.webservices.jaxws.wsat.simple.service;
. . .
import javax.transaction.UserTransaction;
. . .
import javax.jws.WebService;
import javax.ejb.TransactionAttribute;
import javax.ejb.TransactionAttributeType;
import com.sun.xml.ws.api.tx.at.Transactional;
import com.sun.xml.ws.api.tx.at.Transactional.Version;
import com.sun.xml.ws.api.tx.at.Transactional.TransactionFlowType;

/**
 * This JWS file forms the basis of a WS-Atomic Transaction Web Service 
 * with the
 * operations: createAccount, deleteAccount, transferMonet, listAccount
 *
 */
@WebService(serviceName = "WsatBankTransferService",
        targetNamespace = "http://tempuri.org/",
        portName = "WSHttpBindingIService")
@Transactional(value = Transactional.TransactionFlowType.MANDATORY,
        version = com.sun.xml.ws.api.tx.at.Transactional.Version.WSAT10)
@TransactionAttribute(TransactionAttributeType.REQUIRED)
public class WsatBankTransferService {
. . .
}</pre></div></div><br class="example-break"></div></div><div class="section" title="18.1.2.2.&nbsp;Enabling Web Services Atomic Transactions Starting From WSDL"><div class="titlepage"><div><div><h4 class="title"><a name="using_wsat-enable_endpoint_from_wsdl"></a>18.1.2.2.&nbsp;Enabling Web Services Atomic Transactions Starting From
                WSDL</h4></div></div></div><p>When enabled, Web services atomic transactions are
                advertised in the WSDL file using a policy assertion.</p><p>This table summarizes the WS-AtomicTransaction 1.2
                policy assertions that correspond to a set of common Web
                services atomic transaction flow type and EJB Transaction
                attribute combinations.</p><p>Web Services Atomic Transaction Policy Assertion Values
                (WS-AtomicTransaction 1.2)</p><div class="table"><a name="using_wsat-wsat_1-2_assertion_values"></a><p class="title"><b>Table&nbsp;18.4.&nbsp;Web Services Atomic Transaction Policy Assertion
                    Values (WS-AtomicTransaction 1.2)</b></p><div class="table-contents"><table summary="Web Services Atomic Transaction Policy Assertion&#xA;                    Values (WS-AtomicTransaction 1.2)" border="1"><colgroup><col><col><col></colgroup><thead><tr><th>
                                    <p>Atomic Transaction Flow Type</p>
                                </th><th>
                                    <p>EJB <code class="code">@TransactionAttribute</code></p>
                                </th><th>
                                    <p>WS-AtomicTransaction 1.2 Policy
                                    Assertion</p>
                                </th></tr></thead><tbody><tr><td>
                                    <p>
                                        <code class="code">MANDATORY</code>
                                    </p>
                                </td><td>
                                    <p><code class="code">MANDATORY</code>, <code class="code">REQUIRED</code>,
                                    <code class="code">SUPPORTS</code></p>
                                </td><td>
                                    <p>
                                        <code class="code">&lt;wsat:ATAssertion/&gt;</code>
                                    </p>
                                </td></tr><tr><td>
                                    <p>
                                        <code class="code">SUPPORTS</code>
                                    </p>
                                </td><td>
                                    <p><code class="code">REQUIRED</code>,
                                    <code class="code">SUPPORTS</code></p>
                                </td><td>
                                    <p>
                                        <code class="code">&lt;wsat:ATAssertion
                                        wsp:Optional="true"/&gt;</code>
                                    </p>
                                </td></tr><tr><td>
                                    <p>
                                        <code class="code">NEVER</code>
                                    </p>
                                </td><td>
                                    <p><code class="code">REQUIRED</code>,
                                    <code class="code">REQUIRES_NEW</code>, <code class="code">NEVER</code>,
                                    <code class="code">SUPPORTS</code>,
                                    <code class="code">NOT_SUPPORTED</code></p>
                                </td><td>
                                    <p>No policy advertisement</p>
                                </td></tr></tbody></table></div></div><br class="table-break"></div></div><div class="section" title="18.1.3.&nbsp;Enabling Web Services Atomic Transactions on Web Service Clients"><div class="titlepage"><div><div><h3 class="title"><a name="using_wsat-enable_client"></a>18.1.3.&nbsp;Enabling Web Services Atomic Transactions on Web Service
            Clients</h3></div></div></div><p>On a Web service client, enable Web services atomic
            transactions using one of the following methods:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Add the
                    <code class="code">@com.sun.xml.ws.api.tx.at.Transactional</code>
                    annotation on the Web service reference injection point
                    for a client.</p></li><li class="listitem"><p>Pass the
                    <code class="code">com.sun.xml.ws.api.tx.at.TransactionalFeature</code>
                    as a parameter when creating the Web service proxy or
                    dispatch.</p></li><li class="listitem"><p>At run-time, if the non-atomic transactional Web
                    service client calls an atomic transaction-enabled Web
                    service, then based on the flow type settings:
                    </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>If the flow type is set to
                                <code class="code">SUPPORTS</code> or <code class="code">NEVER</code> on the
                                service-side, then the call is included as part of
                                the transaction.</p></li><li class="listitem"><p>If the flow type is set to
                                <code class="code">MANDATORY</code>, then an exception is
                                thrown.</p></li></ul></div></li></ul></div><div class="section" title="18.1.3.1.&nbsp;Using @Transactional Annotation with the @WebServiceRef Annotation"><div class="titlepage"><div><div><h4 class="title"><a name="using_wsat-enable_client_annotation"></a>18.1.3.1.&nbsp;Using @Transactional Annotation with the @WebServiceRef
                Annotation</h4></div></div></div><p>To enable Web services atomic transactions, specify the
                <code class="code">@com.sun.xml.ws.api.tx.at.Transactional</code>
                annotation on the Web service client at the Web service
                reference (<code class="code">@WebServiceRef</code>) injection
                point.</p><p>See <a class="xref" href="#using_wsat-enable_endpoint_using_annotation" title="18.1.2.1.&nbsp;Using the @Transactional Annotation in Your JWS File">Using the @Transactional Annotation in Your JWS
                File</a> for the description of
                <code class="code">@Transactional</code> annotation format.</p><p>The following example illustrates how to annotate the
                Web service reference injection point. As shown in the
                example, the active JTA transaction becomes a part of the
                atomic transaction.</p><div class="example"><a name="d0e16279"></a><p class="title"><b>Example&nbsp;18.5.&nbsp;Using @Transactional Annotation with the
                    @WebServiceRef Annotation</b></p><div class="example-contents"><pre class="programlisting">package examples.webservices.jaxws.wsat.simple.client;
. . .
import javax.servlet.*;
import javax.servlet.http.*;
. . .
import java.net.URL;
import javax.xml.namespace.QName;

import javax.transaction.UserTransaction;
import javax.transaction.SystemException;

import javax.xml.ws.WebServiceRef;
import com.sun.xml.ws.api.tx.at.Transactional;
*/

/**
 * This example demonstrates using a WS-Atomic Transaction to create or
 * delete an account,
 * or transfer money via Web service as a single atomic transaction.
 */

public class WsatBankTransferServlet extends HttpServlet {
    ...
    String url = "http://localhost:7001";
    URL wsdlURL = new URL(url + 
            "/WsatBankTransferService/WsatBankTransferService");
    ...
    DataSource ds = null;
    UserTransaction utx = null;

    try {
        ctx = new InitialContext();
        utx = (UserTransaction) ctx.lookup("javax.transaction" +
                ".UserTransaction");
        utx.setTransactionTimeout(900);
    } catch (java.lang.Exception e) {
        e.printStackTrace();
    }

    WsatBankTransferService port = getWebService(wsdlURL);

    try {
        utx.begin();
        if (remoteAccountNo.length() &gt; 0) {
            if (action.equals("create")) {
                result = port.createAccount(remoteAccountNo, 
                        amount);
            } else if (action.equals("delete")) {
                result = port.deleteAccount(remoteAccountNo);
            } else if (action.equals("transfer")) {
                result = port.transferMoney(remoteAccountNo, 
                        amount, direction);
            }
        }
        utx.commit();
        result = "The transaction is committed " + result;
    } catch (java.lang.Exception e) {
        try {
            e.printStackTrace();
            utx.rollback();
            result = "The transaction is rolled back. " + e
                    .getMessage();
        } catch (java.lang.Exception ex) {
            e.printStackTrace();
            result = "Exception is caught. Check stack trace.";
        }
    }
    request.setAttribute("result", result);

    ...
    @Transactional(value = Transactional.TransactionFlowType.MANDATORY,
            version = Transactional.Version.WSAT10)
    @WebServiceRef()
    WsatBankTransferService_Service service;

    private WsatBankTransferService getWebService() {
        return service.getWSHttpBindingIService();
    }

    public String createAccount(String acctNo, String amount) throws 
            java.lang.Exception {
        Context ctx = null;
        UserTransaction tx = null;
        try {
            ctx = new InitialContext();
            tx = (UserTransaction) ctx.lookup("javax.transaction" +
                    ".UserTransaction");
            try {
                DataSource dataSource = (DataSource) ctx.lookup
                        ("examples-dataSource-demoXAPool");
                
                String sql = "insert into wsat_acct_local (acctno, " +
                        "amount) values (
                " + acctNo + ", " + amount + ")";
                        
                int insCount = dataSource.getConnection()
                        .prepareStatement(sql).executeUpdate();
                
                if (insCount != 1)
                    throw new java.lang.Exception("insert fail at " +
                            "local.");
                
                return ":acctno=" + acctNo + " amount=" + amount + " " +
                        "creating.. ";
            } catch (SQLException e) {
                System.out.println("**** Exception caught *****");
                e.printStackTrace();
                
                throw new SQLException("SQL Exception during " +
                        "createAccount() at local.");
            }
        } catch (java.lang.Exception e) {
            System.out.println("**** Exception caught *****");
            e.printStackTrace();
            throw new java.lang.Exception(e);
        }
    }

    public String deleteAccount(String acctNo) throws java.lang.Exception {
        ...
    }

    public String transferMoney(String acctNo, String amount,
                                String direction)
            throws java.lang.Exception {
        ...
    }

    public String listAccount() throws java.lang.Exception {
        ...
    }
}</pre></div></div><br class="example-break"></div><div class="section" title="18.1.3.2.&nbsp;Passing the TransactionalFeature to the Client"><div class="titlepage"><div><div><h4 class="title"><a name="using_wsat-enable_client_feature"></a>18.1.3.2.&nbsp;Passing the TransactionalFeature to the Client</h4></div></div></div><p>To enable Web services atomic transactions on the client
                of the Web service, you can pass the
                <code class="code">com.sun.xml.ws.api.tx.at.TransactionalFeature</code> as
                a parameter when creating the Web service proxy or dispatch,
                as illustrated in the following example.</p><div class="example"><a name="d0e16292"></a><p class="title"><b>Example&nbsp;18.6.&nbsp;Passing the TransactionalFeature to the
                    Client</b></p><div class="example-contents"><pre class="programlisting">package examples.webservices.jaxws.wsat.simple.client;
. . .
import javax.servlet.*;
import javax.servlet.http.*;
. . .
import java.net.URL;
import javax.xml.namespace.QName;

import javax.transaction.UserTransaction;
import javax.transaction.SystemException;

import com.sun.xml.ws.api.tx.at.TransactionalFeature;
import com.sun.xml.ws.api.tx.at.Transactional.Version;
import com.sun.xml.ws.api.tx.at.Transactional.TransactionFlowType;
*/

/**
 * This example demonstrates using a WS-Atomic Transaction to create 
 * or delete an account,
 * or transfer money via Web service as a single atomic transaction.
 */

public class WsatBankTransferServlet extends HttpServlet {
    ...
    String url = "http://localhost:7001";
    URL wsdlURL = new URL(url + 
            "/WsatBankTransferService/WsatBankTransferService");
    ...
    DataSource ds = null;
    UserTransaction utx = null;

    try {
        ctx = new InitialContext();
        utx = (UserTransaction) ctx.lookup("javax.transaction" +
                ".UserTransaction");
        utx.setTransactionTimeout(900);
    } catch (java.lang.Exception e) {
        e.printStackTrace();
    }

    WsatBankTransferService port = getWebService(wsdlURL);

    try {
        utx.begin();
        if (remoteAccountNo.length() &gt; 0) {
            if (action.equals("create")) {
                result = port.createAccount(remoteAccountNo, 
                        amount);
            } else if (action.equals("delete")) {
                result = port.deleteAccount(remoteAccountNo);
            } else if (action.equals("transfer")) {
                result = port.transferMoney(remoteAccountNo, 
                        amount, direction);
            }
        }
        utx.commit();
        result = "The transaction is committed " + result;
    } catch (java.lang.Exception e) {
        try {
            e.printStackTrace();
            utx.rollback();
            result = "The transaction is rolled back.    " + e
                    .getMessage();
        } catch (java.lang.Exception ex) {
            e.printStackTrace();
            result = "Exception is caught. Check stack trace.";
        }
    }
    request.setAttribute("result", result);

    ...

    // Passing the TransactionalFeature to the Client
    private WsatBankTransferService getWebService(URL wsdlURL) {
        TransactionalFeature feature = new TransactionalFeature();
        feature.setFlowType(TransactionFlowType.MANDATORY);
        feature.setVersion(Version.WSAT10);
        
        WsatBankTransferService_Service service = new 
                WsatBankTransferService_Service(wsdlURL, 
                new QName("http://tempuri.org/", 
                        "WsatBankTransferService"));
        
        return service.getWSHttpBindingIService(new javax.xml.ws.soap
                .AddressingFeature(), feature);
    }

    public String createAccount(String acctNo, String amount) throws 
            java.lang.Exception {
        Context ctx = null;
        UserTransaction tx = null;
        try {
            ctx = new InitialContext();
            tx = (UserTransaction) ctx.lookup("javax.transaction" +
                    ".UserTransaction");
            try {
                DataSource dataSource = (DataSource) ctx.lookup
                        ("examples-dataSource-demoXAPool");
                
                String sql = "insert into wsat_acct_local (acctno, " +
                        "amount) values (
                " + acctNo + ", " + amount + ")";
                        
                int insCount = dataSource.getConnection()
                        .prepareStatement(sql).executeUpdate();
                
                if (insCount != 1)
                    throw new java.lang.Exception("insert fail at " +
                            "local.");
                
                return ":acctno=" + acctNo + " amount=" + amount + " " +
                        "creating.. ";
            } catch (SQLException e) {
                System.out.println("**** Exception caught *****");
                e.printStackTrace();
                
                throw new SQLException("SQL Exception during " +
                        "createAccount() at local.");
            }
        } catch (java.lang.Exception e) {
            System.out.println("**** Exception caught *****");
            e.printStackTrace();
            throw new java.lang.Exception(e);
        }
    }

    public String deleteAccount(String acctNo) throws java.lang.Exception {
        ...
    }

    public String transferMoney(String acctNo, String amount,
                                String direction)
            throws java.lang.Exception {
        ...
    }

    public String listAccount() throws java.lang.Exception {
        ...
    }
}</pre></div></div><br class="example-break"></div></div><div class="section" title="18.1.4.&nbsp;System Level Configuration"><div class="titlepage"><div><div><h3 class="title"><a name="using_wsat-system_level_config"></a>18.1.4.&nbsp;System Level Configuration</h3></div></div></div><p>To specify SSL be used for WS-AT protocol exchanges set the
            <code class="code">wsat.ssl.enabled</code> system property to
            <code class="code">true</code>, i.e. start the server with
            <code class="code">-Dwsat.ssl.enabled=true</code>. The default value is
            <code class="code">false</code>.</p><p>To disabled WS-AT transaction logging and recovery set the
            <code class="code">wsat.recovery.enabled</code> system property to
            <code class="code">false</code>, i.e. start the server with
            <code class="code">-Dwsat.recovery.enabled=false</code>. The default value is
            <code class="code">true</code>.</p><p>The WS-C and WS-AT endpoints necessary for WS-AT are
            deployed only when the first web service is deployed to the
            container. Therefore, it is necessary to have at least one web
            service deployed to the target container for WS-AT to function
            properly even in the case where only clients are used in the Metro
            instance.</p></div><div class="section" title="18.1.5.&nbsp;Compatibility"><div class="titlepage"><div><div><h3 class="title"><a name="compatibility"></a>18.1.5.&nbsp;Compatibility</h3></div></div></div><p>Compatibility between the Metro 2.1 and pre-2.1 (submission
            version) WS-AT implementions is not supported.</p></div></div><div class="section" title="18.2.&nbsp;About the basicWSTX Example"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahiim"></a>18.2.&nbsp;About the basicWSTX Example</h2></div></div></div><p>The basicWSTX example shows the following on the
        client-side:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Developers use existing Java Transaction APIs (JTA).
                Invocations of transacted web service operations flow
                transactional context from client to web service. Persistent
                resources updated with client-created transactions are all
                committed or rolled back as a single atomic
                transaction.</p></li><li class="listitem"><p>After the client-side code commits or aborts the JTA
                transaction, the client confirms that all operations in the
                transaction succeeded or failed by using calls to
                <code class="code">verify</code> methods on the transacted web
                service.</p></li></ol></div><p><code class="code">SampleServiceClient</code>, a WSIT servlet that initiates
        the transaction, and <code class="code">msclient</code>, a client that performs the
        same operations but runs on the Microsoft side, both interact with the
        following components running on the service-side:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><code class="code">SimpleService</code>, a web service implemented as
                a Java servlet with transacted operations. The Edit Web
                Service Attributes feature in the NetBeans IDE WSIT plug-in is
                used to configure Transaction Attributes of each web service
                operation.</p></li><li class="listitem"><p><code class="code">SimpleServiceASCMTEJB</code>, a web service
                implemented as container-managed transaction enterprise bean
                (CMT EJB). No configuration is necessary for this case.</p></li><li class="listitem"><p><code class="code">LibraryFacadeWebServiceBean</code>, a web service
                that uses the Java Persistence API (JPA) with two JDBC
                resources</p></li><li class="listitem"><p>Managed Java EE resources participating in a distributed
                transaction having its transacted updates all committed or
                rolled back</p><p>The servlet and CMT EJB transacted web service
                operations manipulate two JMS resources:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">jms/ConnectionFactory</code>, an
                        <code class="code">XATransaction</code> connection factory</p></li><li class="listitem"><p><code class="code">jms/Queue</code>, a JMS queue</p></li></ul></div><p>The <code class="code">LibraryFacadeWebServiceBean</code> web service
                operations manipulate the JDBC resources:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">connectionPool</code>, an
                        <code class="code">XATransaction</code> JDBC connection pool</p></li><li class="listitem"><p><code class="code">jdbc/javaProgrammingLibrary</code>, a JDBC
                        connection resource</p></li></ul></div></li></ol></div><p>This example shows how to use <code class="code">XATransaction</code>
        -enabled JMS and JDBC. The first version of this example, showing
        WSIT-to-WSIT operations, has the <code class="code">SampleServiceClient</code>
        client configured to run on one GlassFish instance and the service
        running on the other GlassFish instance. Either the Java client or the
        Java web service could be replaced by a semantically equivalent
        Microsoft implementation. The Java client is, in fact, replaced by a
        Microsoft WCF client in the more advanced version of the
        example.</p><p>With the <code class="code">SampleServiceClient</code> client, the
        WS-Coordination/WS-AtomicTransaction protocol messages flow back and
        forth between the two GlassFish instances just as they do in the
        Microsoft-to-Sun transaction interoperability scenario with the
        <code class="code">msclient</code> client.</p><p>The <code class="code">basicWSTX</code> example was initially designed so it
        could be run in either one or in two GlassFish domains. If you run the
        example in one domain, only one coordinator is used; no
        WS-Coordination protocol messages will be exchanged. This chapter
        explains how to run the example in two domains so both protocols,
        WS-Coordination and WS-AtomicTransaction (WS-AT), are used, as shown
        in <a class="xref" href="#ahiin" title="Figure&nbsp;18.3.&nbsp;WS-Coordination and WS-AtomicTransaction Protocols in Two GlassFish Domains">WS-Coordination and WS-AtomicTransaction Protocols in Two
            GlassFish Domains</a>.</p><div class="figure"><a name="ahiin"></a><p class="title"><b>Figure&nbsp;18.3.&nbsp;WS-Coordination and WS-AtomicTransaction Protocols in Two
            GlassFish Domains</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/TX-flow.png" height="360" alt="WS-Coordination and WS-AtomicTransaction Protocols in Two GlassFish Domains"></td></tr></table></div></div></div><br class="figure-break"><p>The example also provides the <code class="code">msclient</code> client,
        which is the equivalent of the client servlet shown in Domain
        2.</p><p><a class="xref" href="#ahiio" title="Figure&nbsp;18.4.&nbsp;Components in the basicWSTX Example">Components in the basicWSTX Example</a> shows the
        components that make up the two domain example. Again, the
        <code class="code">msclient</code> client would be equivalent to the client servlet
        in Domain 2 in this figure as well.</p><div class="figure"><a name="ahiio"></a><p class="title"><b>Figure&nbsp;18.4.&nbsp;Components in the basicWSTX Example</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/example-architecture.png" height="360" alt="Components in the basicWSTX Example"></td></tr></table></div></div></div><br class="figure-break"><p>The service, which runs in domain1, is comprised of two
        components:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">SimpleService</code>, a web service that is
                implemented as a servlet with transacted operations</p></li><li class="listitem"><p><code class="code">SimpleServiceASCMTEJB</code>, a container-managed
                transaction enterprise bean (CMT EJB) web service</p></li></ul></div><p>The <code class="code">SimpleService</code> web service uses two JMS
        resources that are created in domain1:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">jms/ConnectionFactory</code>, an
                <code class="code">XATransaction</code> connection factory</p></li><li class="listitem"><p><code class="code">jms/Queue</code>, a JMS queue</p></li></ul></div><p>The <code class="code">LibraryFacadeWebServiceBean</code> web service uses
        the Java Persistence API (JPA) with two JDBC resources that are
        created in domain1:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><code class="code">connectionPool</code>, an
                <code class="code">XATransaction</code> JDBC connection pool</p></li><li class="listitem"><p><code class="code">jdbc/javaProgrammingLibrary</code>, a JDBC
                connection resource</p></li></ul></div><p>The client servlet, which runs in domain2, initiates the
        transaction.</p></div><div class="section" title="18.3.&nbsp;Building, Deploying and Running the basicWSTX Example"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahiip"></a>18.3.&nbsp;Building, Deploying and Running the basicWSTX Example</h2></div></div></div><p>Complete the following steps to configure your environment then
        build, deploy, and run the <code class="code">basicWSTX</code> example.</p><div class="task" title="To Build, Deploy, and Run the basicWSTX Example"><a name="gfred"></a><p class="title"><b>To Build, Deploy, and Run the basicWSTX Example</b></p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Download the <a class="link" href="http://java.net/projects/wsit-docs/sources/svn/content/trunk/www/releases/1.2/wsittutorial.zip" target="_top">wsittutorial.zip</a>
                    sample kit for this example.</strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Ensure that properties that
                    point to your local Application Server (or GlassFish) and
                    WSIT Tutorial installations have been
                    set.</strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 2.a"><p><span class="bold"><strong>Copy file
                            <code class="code">tut-install/wsittutorial/examples/bp-project/build.properties.sample</code>
                            to file
                            <code class="code">tut-install/wsittutorial/examples/bp-project/build.properties</code>.</strong></span></p></li><li class="step" title="Step 2.b"><p><span class="bold"><strong>Set the
                            <code class="code">javaee.home</code> and
                            <code class="code">wsit.tutorial.home</code> properties in the
                            file
                            <code class="code">tut-install/wsittutorial/examples/bp-project/build.properties</code>.</strong></span></p></li><li class="step" title="Step 2.c"><p><span class="bold"><strong>Ensure that Application
                            Server (or GlassFish) and at least Ant 1.6.5 have
                            been installed and are on the
                            path.</strong></span></p><p>Application Server (or GlassFish) includes Ant
                            1.6.5, which can be found in the
                            <code class="code">as-install/lib/ant/bin</code>
                            directory.</p></li></ol></li><li class="step" title="Step 3"><p>
                        <span class="bold"><strong>Set up your environment to run
                        the basicWSTX example.</strong></span>
                    </p><p>To configure your environment to run the
                    example:</p><ol type="a" class="substeps"><li class="step" title="Step 3.a"><p>
                                <span class="bold"><strong>Change to the
                                <code class="code">tut-install/wsittutorial/examples/wstx/basicWSTX/SampleService</code>
                                directory:</strong></span>
                            </p><pre class="programlisting"><span class="bold"><strong>cd <span class="emphasis"><em>tut-install</em></span>/wsittutorial/examples/wstx/basicWSTX/SampleService</strong></span></pre></li><li class="step" title="Step 3.b"><p>
                                <span class="bold"><strong>Issue the following command to
                                configure your environment to run the
                                example:</strong></span>
                            </p><pre class="programlisting"><span class="bold"><strong>ant setup</strong></span></pre></li></ol><p>This step performs the following configuration tasks
                    for you:</p><ul class="stepalternatives">
                        <li class="step" title="Step 3.1"><p>Starts domain1.</p></li>

                        <li class="step" title="Step 3.2"><p>Creates the resources (<code class="code">jms/Queue</code>
                            and <code class="code">XATransaction</code>
                            <code class="code">jms/ConnectionFactory</code>) used in the
                            example.</p></li>

                        <li class="step" title="Step 3.3"><p>Creates and sets up two Application Server (or
                            GlassFish) domains.</p><p>The domains can be created either on one
                            machine or on two different machines. These steps
                            show you how to do it on one machine. The first
                            domain, domain1, is created as part of the
                            Application Server (or GlassFish)
                            installation.</p></li>

                        <li class="step" title="Step 3.4"><p>Establishes trust between the two domains by
                            installing each domain's <code class="code">s1as</code> security
                            certificate in the other domain's truststore.</p></li>
                    </ul></li><li class="step" title="Step 4"><p><span class="bold"><strong>Use the NetBeans IDE to create
                    a database connection.</strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 4.a"><p><span class="bold"><strong>Start the NetBeans
                            IDE.</strong></span></p></li><li class="step" title="Step 4.b"><p><span class="bold"><strong>In the Services tab,
                            right-click Databases and select New Connection.
                            </strong></span></p><p>The New Database Connection dialog
                            displays.</p></li><li class="step" title="Step 4.c"><p><span class="bold"><strong>Select <code class="code">Java DB
                            (Network)</code> as name </strong></span></p></li><li class="step" title="Step 4.d"><p><span class="bold"><strong>Type
                            <code class="code">localhost</code> in the Host
                            field.</strong></span></p></li><li class="step" title="Step 4.e"><p><span class="bold"><strong>Type <code class="code">1527</code>
                            in the Port field.</strong></span></p></li><li class="step" title="Step 4.f"><p><span class="bold"><strong>Type
                            <code class="code">wstxSampleDB</code> in the Database
                            field.</strong></span></p></li><li class="step" title="Step 4.g"><p><span class="bold"><strong>Type <code class="code">app</code> in
                            the User Name field.</strong></span></p></li><li class="step" title="Step 4.h"><p><span class="bold"><strong>Type <code class="code">app</code> in
                            the Password field.</strong></span></p></li><li class="step" title="Step 4.i"><p><span class="bold"><strong>Select the Remember
                            password checkbox.</strong></span></p></li><li class="step" title="Step 4.j"><p><span class="bold"><strong>Click
                            OK.</strong></span></p></li></ol></li><li class="step" title="Step 5"><p><span class="bold"><strong>Register the Application
                    Server (or GlassFish) server instances (domain1 and
                    domain2) in the NetBeans IDE.</strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 5.a"><p><span class="bold"><strong>If Sun Java System
                            Application Server (domain1) is already registered,
                            go to Step 5j. If it is not, go to Step
                            4b.</strong></span></p></li><li class="step" title="Step 5.b"><p><span class="bold"><strong>In the Services tab,
                            right-click Servers, and select Add Server.
                            </strong></span></p><p>The Add Server Instance dialog appears.</p></li><li class="step" title="Step 5.c"><p><span class="bold"><strong>Choose the server (Sun
                            Java System Application Server (or GlassFish V2)
                            from the drop-down list and give it a descriptive
                            name, such as Sun Java System Application Server -
                            domain1 (Server), and then click
                            Next.</strong></span></p><p>The Platform Location dialog displays.</p></li><li class="step" title="Step 5.d"><p><span class="bold"><strong>ClickBrowse, navigate to
                            the location where the Application Server (or
                            GlassFish server) is installed, then click
                            Choose.</strong></span></p></li><li class="step" title="Step 5.e"><p><span class="bold"><strong>Make sure that the
                            Register Local Default Domain radio button has been
                            selected.</strong></span></p></li><li class="step" title="Step 5.f"><p><span class="bold"><strong>Use the drop-down list
                            to select domain1, then click
                            Next.</strong></span></p><p>The Domain Admin Login Info dialog
                            displays.</p></li><li class="step" title="Step 5.g"><p><span class="bold"><strong>Type <code class="code">admin</code>
                            in the Admin Username field.</strong></span></p></li><li class="step" title="Step 5.h"><p><span class="bold"><strong>Type
                            <code class="code">adminadmin</code> in the Admin Password
                            field.</strong></span></p></li><li class="step" title="Step 5.i"><p><span class="bold"><strong>Click
                            Finish.</strong></span></p><p>The server instance you just registered is the
                            one in which you will run the web service
                            (SampleService).</p></li><li class="step" title="Step 5.j"><p><span class="bold"><strong>Right-click Servers and
                            select Add Server.</strong></span></p><p>The Add Server Instance dialog appears.</p></li><li class="step" title="Step 5.k"><p><span class="bold"><strong>Choose the server (Sun
                            Java System Application Server (or GlassFish V2)
                            from the drop-down list and give it a descriptive
                            name, such as Sun Java System Application Server -
                            domain2 (Client), and then click
                            Next.</strong></span></p><p>The Platform Location dialog displays.</p></li><li class="step" title="Step 5.l"><p><span class="bold"><strong>ClickBrowse, navigate to
                            the location where the Application Server (or
                            GlassFish server) is installed, then click
                            Choose.</strong></span></p></li><li class="step" title="Step 5.m"><p><span class="bold"><strong>Make sure that the
                            Register Local Default Domain radio button has been
                            selected.</strong></span></p></li><li class="step" title="Step 5.n"><p><span class="bold"><strong>Use the drop-down list
                            to select domain2, then click
                            Next.</strong></span></p><p>The Domain Admin Login Info dialog
                            displays.</p></li><li class="step" title="Step 5.o"><p><span class="bold"><strong>Type <code class="code">admin</code>
                            in the Admin Username field.</strong></span></p></li><li class="step" title="Step 5.p"><p><span class="bold"><strong>Type
                            <code class="code">adminadmin</code> in the Admin Password
                            field.</strong></span></p></li><li class="step" title="Step 5.q"><p><span class="bold"><strong>Click
                            Finish.</strong></span></p><p>The server instance you just registered is the
                            one in which you will run the web service client
                            (SampleServiceClient).</p></li></ol></li><li class="step" title="Step 6"><p><span class="bold"><strong>Open the SampleService project
                    and associate the SampleService web service with the
                    appropriate instance (domain1) of the Application Server
                    (or GlassFish server).</strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 6.a"><p><span class="bold"><strong>Select File, then Open
                            Project.</strong></span></p></li><li class="step" title="Step 6.b"><p><span class="bold"><strong>Browse to the
                            <code class="code">tut-install/wsittutorial/examples/wstx/basicWSTX/</code>
                            directory and select the SampleService
                            project.</strong></span></p></li><li class="step" title="Step 6.c"><p><span class="bold"><strong>Select the Open as Main
                            Project check box.</strong></span></p></li><li class="step" title="Step 6.d"><p><span class="bold"><strong>Select the Open Required
                            Projects check box.</strong></span></p></li><li class="step" title="Step 6.e"><p><span class="bold"><strong>Click Open
                            Project.</strong></span></p><p>The SampleService project and two required
                            projects, SampleService-ejb and SampleService-war,
                            are opened and are shown in the Projects tab.</p></li><li class="step" title="Step 6.f"><p><span class="bold"><strong>In the Projects tab,
                            right-click SampleService, select Properties, then
                            select the Run category.</strong></span></p></li><li class="step" title="Step 6.g"><p><span class="bold"><strong>Use the Server drop-down
                            list to point to the default domain, domain1, for
                            the Application Server (or Glassfish) server
                            instance you registered in Step 5.</strong></span></p></li><li class="step" title="Step 6.h"><p><span class="bold"><strong>Click
                            OK.</strong></span></p></li></ol></li><li class="step" title="Step 7"><p><span class="bold"><strong>Resolve references to or add
                    the Toplink Essentials Library to the SampleService-ejb
                    project.</strong></span></p><p>The SampleService-ejb project references the Toplink
                    Essentials Library Module that is included with NetBeans
                    IDE. To verify whether the reference to this library is
                    resolved in your NetBeans IDE environment:</p><ol type="a" class="substeps"><li class="step" title="Step 7.a"><p><span class="bold"><strong>Right click the
                            SampleService-ejb project and select
                            Properties.</strong></span></p></li><li class="step" title="Step 7.b"><p><span class="bold"><strong>Select the Libraries
                            category.</strong></span></p><p>You should see Toplink Essentials in the
                            Compile-time Libraries pane of the Compile
                            tab.</p></li><li class="step" title="Step 7.c"><p><span class="bold"><strong>If you do not see the
                            library, click Add Library to display the Add
                            Library dialog.</strong></span></p></li><li class="step" title="Step 7.d"><p><span class="bold"><strong>Locate and select
                            Toplink Essentials and then click Add
                            Library.</strong></span></p><p>You should now see Toplink Essentials in the
                            Compile-time Libraries pane of the Compile
                            tab.</p></li><li class="step" title="Step 7.e"><p><span class="bold"><strong>Click
                            OK.</strong></span></p></li></ol><p>To verify that you have Toplink Essentials library
                    in NetBeans IDE, select Tools and then Library Manager.
                    You should see "Toplink Essentials" in the left pane. If
                    you don't, you can create the library yourself using the
                    two Toplink JAR files in the Application Server (or
                    GlassFish) <code class="code">lib</code> directory and then resolve the
                    reference to the newly created library.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong>Set the proper transaction
                    attributes for each mapping (<code class="code">wsdl:binding
                    /wsdl:operation</code>) in the
                    <code class="code">SimpleService-war</code> web
                    service.</strong></span></p><p>To set the transaction attributes for the
                    <code class="code">SampleService-war</code> web service:</p><ol type="a" class="substeps"><li class="step" title="Step 8.a"><p><span class="bold"><strong>In the Projects tab,
                            expand the SampleService-war node.</strong></span></p></li><li class="step" title="Step 8.b"><p><span class="bold"><strong>Expand the Web Services
                            node.</strong></span></p></li><li class="step" title="Step 8.c"><p><span class="bold"><strong>Right-click Simple
                            Service and select Edit Web Service
                            Attributes.</strong></span></p></li><li class="step" title="Step 8.d"><p><span class="bold"><strong>In the Quality of
                            Service tab, expand the five operation nodes and
                            then expand the method nodes under each operation
                            node. Use the Transaction drop-down list to set the
                            appropriate transaction attribute for each
                            method:</strong></span></p><ul class="stepalternatives">
                                <li class="step" title="Step 8.d.a"><p>Set <code class="code">init</code> to Required.</p></li>

                                <li class="step" title="Step 8.d.b"><p>Set <code class="code">publishRequired</code> to
                                    Required.</p></li>

                                <li class="step" title="Step 8.d.c"><p>Set <code class="code">publishSupports</code> to
                                    Supported.</p></li>

                                <li class="step" title="Step 8.d.d"><p>Set <code class="code">verify</code> to Required.</p></li>

                                <li class="step" title="Step 8.d.e"><p>Set <code class="code">getMessage</code> to
                                    Required.</p></li>
                            </ul><p>If any other operations are displayed, ignore
                            them.</p></li><li class="step" title="Step 8.e"><p><span class="bold"><strong>Click
                            OK.</strong></span></p><p>Transaction attributes for
                            <code class="code">SampleServiceASCMTEJB</code> do not need to be
                            set; EJB 3.0 transaction attributes are used.</p></li></ol><p>The transaction attribute settings for the
                    <code class="code">SampleService-war</code> are stored in the file
                    <code class="code">SampleService\SampleService-war\web\WEB-INF\wsit-wstx.sample.service.Simple.xml</code>.</p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Deploy the SampleService web
                    service. </strong></span></p><p>Right-click SampleService and select Undeploy and
                    Deploy. NetBeans IDE will start domain1 and deploy the web
                    service to that domain.</p></li><li class="step" title="Step 10"><p><span class="bold"><strong>Register the
                    SampleServiceClient client with the appropriate instance
                    (domain2) of the Application Server (or GlassFish)
                    server.</strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 10.a"><p><span class="bold"><strong>Select File, then Open
                            Project.</strong></span></p></li><li class="step" title="Step 10.b"><p><span class="bold"><strong>Browse to the
                            <code class="code">tut-install/wsittutorial/examples/wstx/basicWSTX/</code>
                            directory and select the SampleServiceClient
                            project.</strong></span></p></li><li class="step" title="Step 10.c"><p><span class="bold"><strong>Select the Open as Main
                            Project check box.</strong></span></p></li><li class="step" title="Step 10.d"><p><span class="bold"><strong>Select the Open Required
                            Projects check box.</strong></span></p></li><li class="step" title="Step 10.e"><p><span class="bold"><strong>Click Open
                            Project.</strong></span></p><p>The SampleServiceClient project is opened and
                            is displayed in the Projects tab.</p></li><li class="step" title="Step 10.f"><p><span class="bold"><strong>In the Projects tab,
                            right-click SampleServiceClient, select Properties,
                            then select the Run category.</strong></span></p></li><li class="step" title="Step 10.g"><p><span class="bold"><strong>Use the Server drop-down
                            list to point to domain2.</strong></span></p></li><li class="step" title="Step 10.h"><p><span class="bold"><strong>Click
                            OK.</strong></span></p></li></ol></li><li class="step" title="Step 11"><p><span class="bold"><strong>Create web service references
                    for the client (three web service clients, a simpleServlet
                    and two CMT EJB clients) and generate the WSDL for
                    all.</strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 11.a"><p><span class="bold"><strong>In the Projects tab,
                            right-click SampleServiceClient, select New, then
                            select Web Service Client.</strong></span></p><p>The New Web Service Client dialog
                            displays.</p></li><li class="step" title="Step 11.b"><p><span class="bold"><strong>Click Browse next to the
                            Project field.</strong></span></p><p>The Browse Web Services dialog
                            displays.</p></li><li class="step" title="Step 11.c"><p><span class="bold"><strong>Expand
                            SampleService-war, select Simple, then click
                            OK.</strong></span></p></li><li class="step" title="Step 11.d"><p><span class="bold"><strong>In the Package field,
                            type <code class="code">wstx.sample.client</code>, then click
                            Finish.</strong></span></p></li><li class="step" title="Step 11.e"><p><span class="bold"><strong>Right-click
                            SampleServiceClient, select New, then select Web
                            Service Client.</strong></span></p><p>The New Web Service Client dialog
                            displays.</p></li><li class="step" title="Step 11.f"><p><span class="bold"><strong>Click Browse next to the
                            Project field.</strong></span></p><p>The Browse Web Services dialog
                            displays.</p></li><li class="step" title="Step 11.g"><p><span class="bold"><strong>Expand
                            SampleService-ejb, select SimpleAsCMTEjb, then click
                            OK.</strong></span></p></li><li class="step" title="Step 11.h"><p><span class="bold"><strong>In the Package field,
                            type <code class="code">wstx.sample.ejbclient</code>, then click
                            Finish.</strong></span></p></li><li class="step" title="Step 11.i"><p><span class="bold"><strong>Right-click
                            SampleServiceClient, select New, then select Web
                            Service Client.</strong></span></p><p>The New Web Service Client dialog
                            displays.</p></li><li class="step" title="Step 11.j"><p><span class="bold"><strong>Click Browse next to the
                            Project field.</strong></span></p><p>The New Web Service Client dialog
                            displays.</p></li><li class="step" title="Step 11.k"><p><span class="bold"><strong>Expand
                            SampleService-ejb, select
                            LibraryFacadeWebServiceBean, then click
                            OK.</strong></span></p></li><li class="step" title="Step 11.l"><p><span class="bold"><strong>In the Package field,
                            type <code class="code">wstx.sample.library</code>, then click
                            Finish.</strong></span></p></li></ol></li><li class="step" title="Step 12"><p><span class="bold"><strong>If transaction attributes for
                    the servlet (see Step 7) or CMT EJB web service have
                    changed, those services must be deployed and client web
                    service references refreshed to get new web service
                    attributes.</strong></span></p><p>To refresh the client web service references for
                    this example:</p><ol type="a" class="substeps"><li class="step" title="Step 12.a"><p><span class="bold"><strong>In the Projects tab,
                            open the SampleServiceClient, then open Web Service
                            References.</strong></span></p></li><li class="step" title="Step 12.b"><p><span class="bold"><strong>Right-click Simple and
                            select Refresh Client to refresh the client node and
                            regenerate the WSDL for the
                            simpleServlet.</strong></span></p></li><li class="step" title="Step 12.c"><p><span class="bold"><strong>Right-click
                            SimpleAsCMTEjb to do the same for the CMT EJB
                            client. </strong></span></p></li><li class="step" title="Step 12.d"><p><span class="bold"><strong>Right-click
                            LibraryFacadeWebServiceBean to do the same for the
                            LibraryFacadeWebServiceBean client.
                            </strong></span></p></li></ol></li><li class="step" title="Step 13"><p><span class="bold"><strong>Deploy and run the
                    client.</strong></span></p><p>Right-click SampleServiceClient and select
                    Run.</p><p>NetBeans IDE will start domain2, deploy the servlet
                    and EJB CMT clients to that domain, then display the
                    results for both in a pop-up browser window, as shown in
                    <a class="xref" href="#gfrdv" title="Figure&nbsp;18.5.&nbsp;basicWSTX Results">basicWSTX Results</a>.</p><div class="figure"><a name="gfrdv"></a><p class="title"><b>Figure&nbsp;18.5.&nbsp;basicWSTX Results</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/results_basicWSTX.png" height="360" alt="basicWSTX Results"></td></tr></table></div></div></div><br class="figure-break"></li></ol></div></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;19.&nbsp;Managing Policies"><div class="titlepage"><div><div><h2 class="title"><a name="policiesa"></a>Chapter&nbsp;19.&nbsp;Managing Policies</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#managing-policies">19.1. Managing Policies</a></span></dt><dd><dl><dt><span class="section"><a href="#introduction">19.1.1. Introduction</a></span></dt><dt><span class="section"><a href="#policy-references">19.1.2. Policy References</a></span></dt><dt><span class="section"><a href="#policies-wsdl-import">19.1.3. WSDL Import</a></span></dt><dt><span class="section"><a href="#external-policy-references">19.1.4. External Policy References</a></span></dt></dl></dd></dl></div><div class="section" title="19.1.&nbsp;Managing Policies"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="managing-policies"></a>19.1.&nbsp;Managing Policies</h2></div></div></div><div class="section" title="19.1.1.&nbsp;Introduction"><div class="titlepage"><div><div><h3 class="title"><a name="introduction"></a>19.1.1.&nbsp;Introduction</h3></div></div></div><p>The section <a class="xref" href="#ahifp" title="14.2.&nbsp;WSIT Configuration and WS-Policy Assertions">WSIT Configuration and WS-Policy Assertions</a> explained how WSIT functionality is
            configured using policies. If you are deploying a web service
            bundled with WSDL then all these policies are contained in the
            WSDL document. A web service that has no WSDL bundled will read
            the policies from a configuration file and then generate WSDL that
            contains these policies. This model works fine if you develop a
            few web services and do not want to share policies. NetBeans will
            generate the configuration with the policies for you and you do
            not need to be concerned with the details. Sometimes however,
            particularly in larger scale deployments, you will want to use the
            same policies for all web services or you might want to use an
            enterprise-wide policy. The following sections explain how to use
            externally defined policies.</p></div><div class="section" title="19.1.2.&nbsp;Policy References"><div class="titlepage"><div><div><h3 class="title"><a name="policy-references"></a>19.1.2.&nbsp;Policy References</h3></div></div></div><p>Policies are referenced using the XML element
            PolicyReference. Here is an example of a WSDL fragment that
            contains a policy and its reference: </p><div class="example"><a name="d0e17157"></a><p class="title"><b>Example&nbsp;19.1.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions
        xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/
                   oasis-200401-wss-wssecurity-utility-1.0.xsd"
        xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
        xmlns:tns="http://service.test.policy.ws.xml.sun.com/"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:wsp="http://schemas.xmlsoap.org/ws/2004/09/policy"
        xmlns="http://schemas.xmlsoap.org/wsdl/"
        targetNamespace="http://service.test.policy.ws.xml.sun.com/"
        name="TestServiceService"&gt;
   ...
   &lt;wsp:Policy
           wsu:Id="TestServicePortBindingPolicy"
           xmlns:wsaws="http://www.w3.org/2005/08/addressing"
           xmlns:wsrm="http://schemas.xmlsoap.org/ws/2005/02/rm/policy"&gt;
      &lt;wsp:ExactlyOne&gt;
         &lt;wsp:All&gt;
            &lt;wsaws:UsingAddressing
               xmlns:wsaws="http://www.w3.org/2006/05/addressing/wsdl"/&gt;
            &lt;wsrm:RMAssertion/&gt;
         &lt;/wsp:All&gt;
      &lt;/wsp:ExactlyOne&gt;
   &lt;/wsp:Policy&gt;
   ...
   &lt;binding name="TestServicePortBinding" type="tns:TestService"&gt;
      &lt;wsp:PolicyReference URI="#TestServicePortBindingPolicy"/&gt;
      &lt;soap:binding transport="http://schemas.xmlsoap.org/soap/http"
                    style="document"/&gt;
      &lt;operation name="echo"&gt;
         &lt;soap:operation soapAction=""/&gt;
         &lt;input&gt;
            &lt;soap:body use="literal"/&gt;
         &lt;/input&gt;
         &lt;output&gt;
            &lt;soap:body use="literal"/&gt;
         &lt;/output&gt;
      &lt;/operation&gt;
   &lt;/binding&gt;
   ...
&lt;/definitions&gt;</pre></div></div><p><br class="example-break"></p><p>Above you see one policy defined with the id <span class="bold"><strong>TestServicePortBindingPolicy</strong></span>. This policy
            is referenced by the <span class="bold"><strong>PolicyReference</strong></span> element in the WSDL binding
            section. You can see here that the policy reference <span class="bold"><strong>#TestServicePortBindingPolicy</strong></span> is relative
            as signified by the leading # character. This is telling the
            policy processor that it is to look for this policy only in the
            enclosing document.</p><p>An alternative to WS-Policy identifiers and relative
            references are <a class="link" href="http://www.w3.org/TR/2007/REC-ws-policy-20070904/#Policy_Identification" target="_top">WS-Policy
            Names</a>. A <span class="bold"><strong>Name</strong></span> is an
            absolute URI that can be resolved across document boundaries. Here
            is an example of a WSDL fragment that contains a policy identified
            by a Name and the corresponding PolicyReference: </p><div class="example"><a name="d0e17179"></a><p class="title"><b>Example&nbsp;19.2.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions
        xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/
                   oasis-200401-wss-wssecurity-utility-1.0.xsd"
        xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
        xmlns:tns="http://service.test.policy.ws.xml.sun.com/"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:wsp="http://schemas.xmlsoap.org/ws/2004/09/policy"
        xmlns="http://schemas.xmlsoap.org/wsdl/"
        targetNamespace="http://service.test.policy.ws.xml.sun.com/"
        name="TestServiceService"&gt;
   ...
   &lt;wsp:Policy
           Name="http://service.test.policy.ws.xml.sun.com/
                 TestServicePortBindingPolicy"
           xmlns:wsaws="http://www.w3.org/2005/08/addressing"
           xmlns:wsrm="http://schemas.xmlsoap.org/ws/2005/02/rm/policy"&gt;
      &lt;wsp:ExactlyOne&gt;
         &lt;wsp:All&gt;
            &lt;wsaws:UsingAddressing
               xmlns:wsaws="http://www.w3.org/2006/05/addressing/wsdl"/&gt;
            &lt;wsrm:RMAssertion/&gt;
         &lt;/wsp:All&gt;
      &lt;/wsp:ExactlyOne&gt;
   &lt;/wsp:Policy&gt;
   ...
   &lt;binding name="TestServicePortBinding" type="tns:TestService"&gt;
      &lt;wsp:PolicyReference
              URI="http://service.test.policy.ws.xml.sun.com/
                   TestServicePortBindingPolicy"/&gt;
      &lt;soap:binding transport="http://schemas.xmlsoap.org/soap/http"
                    style="document"/&gt;
      &lt;operation name="echo"&gt;
         &lt;soap:operation soapAction=""/&gt;
         &lt;input&gt;
            &lt;soap:body use="literal"/&gt;
         &lt;/input&gt;
         &lt;output&gt;
            &lt;soap:body use="literal"/&gt;
         &lt;/output&gt;
      &lt;/operation&gt;
   &lt;/binding&gt;
   ...
&lt;/definitions&gt;</pre></div></div><p><br class="example-break"></p><p>The mechanism of using a PolicyReference element to
            reference a policy is defined in <a class="link" href="http://www.w3.org/TR/2007/REC-ws-policy-20070904/#Policy_References" target="_top">WS-Policy</a>.
            The PolicyReference element in the above examples is a direct
            child element of the WSDL binding element. That effectively means
            that we attached the policy with id TestServicePortBindingPolicy
            to this particular WSDL binding element. In theory, policies could
            be attached to any WSDL element using that technique. In practice
            however, policies may only be attached to a few select elements,
            depending on the policy assertions that the policy contains. In
            the example above we have one addressing and one reliable
            messaging assertion. Both may only be attached to WSDL port and
            WSDL binding elements.</p></div><div class="section" title="19.1.3.&nbsp;WSDL Import"><div class="titlepage"><div><div><h3 class="title"><a name="policies-wsdl-import"></a>19.1.3.&nbsp;WSDL Import</h3></div></div></div><p>The <a class="link" href="http://www.w3.org/TR/wsdl#_document-n" target="_top">WSDL
            import</a> statement lets us to manage policies in one central
            document and refer to these policies from any other WSDL document.
            The policies contained in a separate WSDL document are best
            identified using the WS-Policy Name attribute because that allows
            to reference these policies by an absolute URI that does not
            depend on the location of the imported WSDL document. Here is an
            example of how this may look.</p><div class="example"><a name="d0e17196"></a><p class="title"><b>Example&nbsp;19.3.&nbsp;policies.wsdl</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions xmlns:tns="http://policies.test.policy.ws.xml.sun.com/"
             xmlns:wsp="http://schemas.xmlsoap.org/ws/2004/09/policy"
             xmlns="http://schemas.xmlsoap.org/wsdl/"
             targetNamespace="http://policies.test.policy.ws.xml.sun.com/"
             name="Policies"&gt;

   &lt;wsp:Policy
           Name="http://policies.test.policy.ws.xml.sun.com/
                 ReliableMessagingPolicy"
           xmlns:wsaws="http://www.w3.org/2005/08/addressing"
           xmlns:wsrm="http://schemas.xmlsoap.org/ws/2005/02/rm/policy"&gt;
      &lt;wsp:ExactlyOne&gt;
         &lt;wsp:All&gt;
            &lt;wsaws:UsingAddressing
               xmlns:wsaws="http://www.w3.org/2006/05/addressing/wsdl"/&gt;
            &lt;wsrm:RMAssertion/&gt;
         &lt;/wsp:All&gt;
      &lt;/wsp:ExactlyOne&gt;
   &lt;/wsp:Policy&gt;

   &lt;wsp:Policy
        Name="http://policies.test.policy.ws.xml.sun.com/SecurePolicy"
        xmlns:sp="http://schemas.xmlsoap.org/ws/2005/07/securitypolicy"&gt;
      &lt;wsp:ExactlyOne&gt;
         &lt;wsp:All&gt;
            &lt;wsaws:UsingAddressing
               xmlns:wsaws="http://www.w3.org/2006/05/addressing/wsdl"/&gt;
            &lt;sp:SymmetricBinding&gt;
               &lt;wsp:Policy&gt;
                  &lt;sp:ProtectionToken&gt;
                     &lt;wsp:Policy&gt;
                        &lt;sp:X509Token
                            sp:IncludeToken="http://schemas.xmlsoap.org/
                            ws/2005/07/securitypolicy/IncludeToken/Never"&gt;
                           &lt;wsp:Policy&gt;
                              &lt;sp:WssX509V3Token10/&gt;
                           &lt;/wsp:Policy&gt;
                        &lt;/sp:X509Token&gt;
                     &lt;/wsp:Policy&gt;
                  &lt;/sp:ProtectionToken&gt;
                  &lt;sp:Layout&gt;
                     &lt;wsp:Policy&gt;
                        &lt;sp:Strict/&gt;
                     &lt;/wsp:Policy&gt;
                  &lt;/sp:Layout&gt;
                  &lt;sp:IncludeTimestamp/&gt;
                  &lt;sp:OnlySignEntireHeadersAndBody/&gt;
                  &lt;sp:AlgorithmSuite&gt;
                     &lt;wsp:Policy&gt;
                        &lt;sp:Basic128/&gt;
                     &lt;/wsp:Policy&gt;
                  &lt;/sp:AlgorithmSuite&gt;
               &lt;/wsp:Policy&gt;
            &lt;/sp:SymmetricBinding&gt;
            &lt;sp:Wss11&gt;
               &lt;wsp:Policy&gt;
                  &lt;sp:MustSupportRefKeyIdentifier/&gt;
                  &lt;sp:MustSupportRefIssuerSerial/&gt;
                  &lt;sp:MustSupportRefThumbprint/&gt;
                  &lt;sp:MustSupportRefEncryptedKey/&gt;
               &lt;/wsp:Policy&gt;
            &lt;/sp:Wss11&gt;
         &lt;/wsp:All&gt;
      &lt;/wsp:ExactlyOne&gt;
   &lt;/wsp:Policy&gt;

&lt;/definitions&gt;</pre></div></div><p><br class="example-break"></p><div class="example"><a name="d0e17202"></a><p class="title"><b>Example&nbsp;19.4.&nbsp;reliable-service.wsdl</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
             xmlns:xsd="http://www.w3.org/2001/XMLSchema"
             xmlns:wsp="http://schemas.xmlsoap.org/ws/2004/09/policy"
             xmlns="http://schemas.xmlsoap.org/wsdl/"
             xmlns:tns="http://reliable.service.test.policy.ws.xml.sun.com/"
             targetNamespace="http://reliable.service.test.policy.ws.xml.sun.com/"
             name="ReliableService"&gt;
   ...
   &lt;import namespace="http://reliable.service.test.policy.ws.xml.sun.com/"
           location=".../policies.wsdl"/&gt;
   ...
   &lt;binding name="ReliableServicePortBinding"
            type="tns:ReliableService"&gt;
      &lt;wsp:PolicyReference
              URI="http://policies.test.policy.ws.xml.sun.com/
                   ReliableMessagingPolicy"/&gt;
      &lt;soap:binding transport="http://schemas.xmlsoap.org/soap/http"
                    style="document"/&gt;
      &lt;operation name="echo"&gt;
         &lt;soap:operation soapAction=""/&gt;
         &lt;input&gt;
            &lt;soap:body use="literal"/&gt;
         &lt;/input&gt;
         &lt;output&gt;
            &lt;soap:body use="literal"/&gt;
         &lt;/output&gt;
      &lt;/operation&gt;
   &lt;/binding&gt;
   ...
&lt;/definitions&gt;</pre></div></div><p><br class="example-break"></p><div class="example"><a name="d0e17208"></a><p class="title"><b>Example&nbsp;19.5.&nbsp;secure-service.wsdl</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
             xmlns:xsd="http://www.w3.org/2001/XMLSchema"
             xmlns:wsp="http://schemas.xmlsoap.org/ws/2004/09/policy"
             xmlns="http://schemas.xmlsoap.org/wsdl/"
             xmlns:tns="http://secure.service.test.policy.ws.xml.sun.com/"
             targetNamespace="http://secure.service.test.policy.ws.xml.sun.com/"
             name="SecureService"&gt;
   ...
   &lt;import namespace="http://secure.service.test.policy.ws.xml.sun.com/"
           location=".../policies.wsdl"/&gt;
   ...
   &lt;binding name="SecureServicePortBinding" type="tns:SecureService"&gt;
      &lt;wsp:PolicyReference
              URI="http://policies.test.policy.ws.xml.sun.com/SecurePolicy"/&gt;
      &lt;soap:binding transport="http://schemas.xmlsoap.org/soap/http"
                    style="document"/&gt;
      &lt;operation name="echo"&gt;
         &lt;soap:operation soapAction=""/&gt;
         &lt;input&gt;
            &lt;soap:body use="literal"/&gt;
         &lt;/input&gt;
         &lt;output&gt;
            &lt;soap:body use="literal"/&gt;
         &lt;/output&gt;
      &lt;/operation&gt;
   &lt;/binding&gt;
   ...
&lt;/definitions&gt;</pre></div></div><p><br class="example-break"></p></div><div class="section" title="19.1.4.&nbsp;External Policy References"><div class="titlepage"><div><div><h3 class="title"><a name="external-policy-references"></a>19.1.4.&nbsp;External Policy References</h3></div></div></div><p>Since the PolicyReference is a URI, it comes natural to use
            an absolute URI instead of a relative URI. This is exactly how you
            would attach an external policy, i.e. a policy that is not
            contained in the same document as the PolicyReference. You still
            need to reference the policy ID by attaching it to the URI of the
            document. Here is an example of a file that contains the same
            policy as the one that was inside the WSDL document previously:
            </p><div class="example"><a name="d0e17218"></a><p class="title"><b>Example&nbsp;19.6.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;wsp:Policy wsu:Id="TestServicePortBindingPolicy"
            xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/
                       oasis-200401-wss-wssecurity-utility-1.0.xsd"
            xmlns:wsp="http://schemas.xmlsoap.org/ws/2004/09/policy"
            xmlns:wsaws="http://www.w3.org/2005/08/addressing"
            xmlns:wsrm="http://schemas.xmlsoap.org/ws/2005/02/rm/policy"&gt;
   &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
         &lt;wsaws:UsingAddressing
                 xmlns:wsaws="http://www.w3.org/2006/05/addressing/wsdl"/&gt;
         &lt;wsrm:RMAssertion/&gt;
      &lt;/wsp:All&gt;
   &lt;/wsp:ExactlyOne&gt;
&lt;/wsp:Policy&gt;</pre></div></div><p><br class="example-break"></p><p>Let's assume the document above can be retrieved from the
            URI http://example.test/policy. You could now write a WSDL
            document like this: </p><div class="example"><a name="d0e17223"></a><p class="title"><b>Example&nbsp;19.7.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;definitions xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/"
             xmlns:tns="http://service.test.policy.ws.xml.sun.com/"
             xmlns:xsd="http://www.w3.org/2001/XMLSchema"
             xmlns:wsp="http://schemas.xmlsoap.org/ws/2004/09/policy"
             xmlns="http://schemas.xmlsoap.org/wsdl/"
             targetNamespace="http://service.test.policy.ws.xml.sun.com/"
             name="TestServiceService"&gt;
   ...
   &lt;binding name="TestServicePortBinding" type="tns:TestService"&gt;
      &lt;wsp:PolicyReference
              URI="http://example.test/policy#TestServicePortBindingPolicy"/&gt;
      &lt;soap:binding transport="http://schemas.xmlsoap.org/soap/http"
                    style="document"/&gt;
      &lt;operation name="echo"&gt;
         &lt;soap:operation soapAction=""/&gt;
         &lt;input&gt;
            &lt;soap:body use="literal"/&gt;
         &lt;/input&gt;
         &lt;output&gt;
            &lt;soap:body use="literal"/&gt;
         &lt;/output&gt;
      &lt;/operation&gt;
   &lt;/binding&gt;
   ...
&lt;/definitions&gt;</pre></div></div><p><br class="example-break"></p><p>Note that the PolicyReference above uses an absolute URI. It
            references the document URI appended with the # character and the
            ID of the policy. The fact that you need to state the particular
            ID allows to contain multiple policies inside one document and
            reference single policies out of that document. Here is an example
            of a document with more than one policy: </p><div class="example"><a name="d0e17228"></a><p class="title"><b>Example&nbsp;19.8.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;policies xmlns:wsp="http://schemas.xmlsoap.org/ws/2004/09/policy"
          xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/
                     oasis-200401-wss-wssecurity-utility-1.0.xsd"
          xmlns:wsoma="http://schemas.xmlsoap.org/ws/2004/09/policy/
                       optimizedmimeserialization"
          xmlns:wsaws="http://www.w3.org/2006/05/addressing/wsdl"
          xmlns:wsrm="http://schemas.xmlsoap.org/ws/2005/02/rm/policy"&gt;

   &lt;wsp:Policy wsu:Id="GlobalRMPolicy"&gt;
      &lt;wsp:ExactlyOne&gt;
         &lt;wsp:All&gt;
            &lt;wsaws:UsingAddressing
                    xmlns:wsaws="http://www.w3.org/2006/05/addressing/wsdl"/&gt;
            &lt;wsrm:RMAssertion/&gt;
         &lt;/wsp:All&gt;
      &lt;/wsp:ExactlyOne&gt;
   &lt;/wsp:Policy&gt;

   &lt;wsp:Policy wsu:Id="GlobalMtomPolicy"&gt;
      &lt;wsp:ExactlyOne&gt;
         &lt;wsp:All&gt;
            &lt;wsoma:OptimizedMimeSerialization/&gt;
         &lt;/wsp:All&gt;
      &lt;/wsp:ExactlyOne&gt;
   &lt;/wsp:Policy&gt;

&lt;/policies&gt;</pre></div></div><p><br class="example-break"></p><p>The policies are contained by a policies element so that
            this document is valid XML. This root element may actually have
            any name. Assuming that this document has the absolute URI
            http://example.test/policies, you can now create references for
            both policies: <code class="code">&lt;PolicyReference
            URI="http://example.test/policies#GlobalRMPolicy"/&gt;</code> and
            <code class="code">&lt;PolicyReference
            URI="http://example.test/policies#GlobalMtomPolicy"/&gt;</code>.</p><p>Note that unlike the approach discussed in section <a class="xref" href="#policies-wsdl-import" title="19.1.3.&nbsp;WSDL Import">WSDL Import</a>,
            external policy references may not be interoperable with other
            products.</p></div></div></div><div lang="en" class="chapter" title="Chapter&nbsp;20.&nbsp;Monitoring and Management"><div class="titlepage"><div><div><h2 class="title"><a name="monitoringandmanagement"></a>Chapter&nbsp;20.&nbsp;Monitoring and Management</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#monitoring-intro">20.1. Introduction to Metro JMX Monitoring</a></span></dt><dt><span class="section"><a href="#monitoring-enabling">20.2. Enabling and Disabling Monitoring</a></span></dt><dd><dl><dt><span class="section"><a href="#monitoring-enabling-properties">20.2.1. Enabling and disabling Metro monitoring via system
            properties</a></span></dt><dt><span class="section"><a href="#monitoring-enabling-policy-endpoint">20.2.2. Enabling and disabling endpoint monitoring via
            policy</a></span></dt><dt><span class="section"><a href="#monitoring-enabling-policy-client">20.2.3. Enabling and disabling client monitoring via policy</a></span></dt></dl></dd><dt><span class="section"><a href="#monitoring-identifiers">20.3. Monitoring Identifiers</a></span></dt><dd><dl><dt><span class="section"><a href="#monitoring-identifiers-endpoints">20.3.1. Endpoint Monitoring Identifiers</a></span></dt><dt><span class="section"><a href="#monitoring-identifiers-clients">20.3.2. Client monitoring identifiers</a></span></dt><dt><span class="section"><a href="#monitoring-identifier-character-mapping">20.3.3. Identifier Character Mapping</a></span></dt><dt><span class="section"><a href="#monitoring-resolving-name-conflicts">20.3.4. Resolving Monitoring Root Name Conflicts</a></span></dt></dl></dd><dt><span class="section"><a href="#monitoring-available-information">20.4. Available Monitoring Information</a></span></dt><dd><dl><dt><span class="section"><a href="#monitoring-wsclient-information">20.4.1. WSClient Information</a></span></dt><dt><span class="section"><a href="#monitoring-wsendpoint-information">20.4.2. WSEndpoint Information</a></span></dt><dt><span class="section"><a href="#monitoring-wsnoncemanager-information">20.4.3. WSNonceManager Information</a></span></dt><dt><span class="section"><a href="#monitoring-wsrmscsessionmanager-information">20.4.4. WSRMSCSessionManager Information</a></span></dt><dt><span class="section"><a href="#monitoring-wsrmssequencemanager-information">20.4.5. WSRMSequenceManager Information</a></span></dt></dl></dd><dt><span class="section"><a href="#monitoring-notes">20.5. Notes</a></span></dt></dl></div><div class="section" title="20.1.&nbsp;Introduction to Metro JMX Monitoring"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="monitoring-intro"></a>20.1.&nbsp;Introduction to Metro JMX Monitoring</h2></div></div></div><p>JMX monitoring and management is built into Metro-based services
        and clients. Monitoring allows one to view the state of parts of Metro
        runtime system while it is in operation. Management allows one to
        change values dynamically. The rest of this document will refer to
        Metro monitoring and management as simply "monitoring".</p><p>Metro monitoring should not be confused with Metro's Web Service
        Configuration Management (Metro CM). Monitoring enables one to view
        the state of the Metro runtime, whereas Metro CM is for
        (re)configuring a web service.</p></div><div class="section" title="20.2.&nbsp;Enabling and Disabling Monitoring"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="monitoring-enabling"></a>20.2.&nbsp;Enabling and Disabling Monitoring</h2></div></div></div><p>Metro-based services have monitoring turned
        <span class="emphasis"><em>on</em></span> by default.</p><p>Metro-based clients have monitoring turned
        <span class="emphasis"><em>off</em></span> by default.</p><p>Clients are off by default because there is no standard way to
        dispose of a client and release its resources. Metro does include a
        proprietary method for disposing a proxy. Assuming you have an
        <code class="code">AddNumbers</code> service:</p><div class="example"><a name="d0e17272"></a><p class="title"><b>Example&nbsp;20.1.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">AddNumbersPortType port = new AddNumbersService().getAddNumbersPort();
...            
((java.io.Closeable)port).close();</pre></div></div><br class="example-break"><p>If you enable client monitoring it is recommended you
        <code class="code">close</code> client proxies when they are no longer used.</p><div class="section" title="20.2.1.&nbsp;Enabling and disabling Metro monitoring via system properties"><div class="titlepage"><div><div><h3 class="title"><a name="monitoring-enabling-properties"></a>20.2.1.&nbsp;Enabling and disabling Metro monitoring via system
            properties</h3></div></div></div><p>Metro has two system properties for controlling monitoring
            scoped to the JVM:</p><div class="example"><a name="d0e17285"></a><p class="title"><b>Example&nbsp;20.2.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">com.sun.xml.ws.monitoring.endpoint
com.sun.xml.ws.monitoring.client</pre></div></div><br class="example-break"><p>Setting either to <code class="code">false</code> will disable all
            monitoring for Metro-based endpoints (i.e., web services) or
            clients, respectively, in a JVM.</p></div><div class="section" title="20.2.2.&nbsp;Enabling and disabling endpoint monitoring via policy"><div class="titlepage"><div><div><h3 class="title"><a name="monitoring-enabling-policy-endpoint"></a>20.2.2.&nbsp;Enabling and disabling endpoint monitoring via
            policy</h3></div></div></div><p>Metro includes a policy assertion for enabling and disabling
            monitoring for specific services and endpoints. For an endpoint
            (using an <code class="code">AddNumbersService</code> as an example):</p><div class="example"><a name="d0e17301"></a><p class="title"><b>Example&nbsp;20.3.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;service name="AddNumbersService"&gt;
    &lt;port name="AddNumbersPort" binding="tns:AddNumbersPortBinding"&gt;
        &lt;wsp:Policy&gt;
            &lt;sunman:ManagedService
                xmlns:sunman="http://java.sun.com/xml/ns/metro/management"
                management="false"
                monitoring="true"&gt;
            &lt;/sunman:ManagedService&gt;
        &lt;/wsp:Policy&gt;
        ...
    &lt;/port&gt;
&lt;/service&gt;</pre></div></div><br class="example-break"><p>The <code class="code">ManagedService</code> assertion is placed inside
            (or referenced from) the <code class="code">port</code> element in the
            endpoint's WSDL (if creating a service from WSDL) or in the
            endpoint's configuration file (if creating a service from
            Java).</p><p>This assertion is used by both Metro CM and monitoring. See
            Metro CM for the meaning and operation of the
            <code class="code">management</code> attribute.</p><p>Metro monitoring is turned off for the specific endpoint if
            the <code class="code">monitoring</code> attribute is set to
            <code class="code">false</code>. If the policy assertion or the
            <code class="code">monitoring</code> attribute is not present, or the
            <code class="code">monitoring</code> attribute is set to <code class="code">true</code> then
            monitoring is turned on for that endpoint (unless endpoint
            monitoring is turned off for the JVM).</p></div><div class="section" title="20.2.3.&nbsp;Enabling and disabling client monitoring via policy"><div class="titlepage"><div><div><h3 class="title"><a name="monitoring-enabling-policy-client"></a>20.2.3.&nbsp;Enabling and disabling client monitoring via policy</h3></div></div></div><p>For a client the <code class="code">ManagedClient</code> assertion is
            used:</p><div class="example"><a name="d0e17342"></a><p class="title"><b>Example&nbsp;20.4.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sunman:ManagedClient
        xmlns:sunman="http://java.sun.com/xml/ns/metro/management"
        management="false"
        monitoring="true"
        &gt;
&lt;/sunman:ManagedClient&gt;</pre></div></div><br class="example-break"><p>This is placed inside the
            <code class="code">&lt;service&gt;/&lt;port&gt;</code> element of the
            <code class="code">*.xml</code> file corresponding to the service referenced
            from the <code class="code">src/java/META-INF/wsit-client.xml</code>
            configuration file. (Note: the example path to the
            <code class="code">wsit-client.xml</code> file is where the file is located
            when building using NetBeans.)</p><p>When the <code class="code">monitoring</code> attribute of
            <code class="code">ManagedClient</code> is set to <code class="code">true</code> then
            monitoring will be turned on for that specific client (unless the
            client JVM property is set to <code class="code">false</code>).</p></div></div><div class="section" title="20.3.&nbsp;Monitoring Identifiers"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="monitoring-identifiers"></a>20.3.&nbsp;Monitoring Identifiers</h2></div></div></div><div class="section" title="20.3.1.&nbsp;Endpoint Monitoring Identifiers"><div class="titlepage"><div><div><h3 class="title"><a name="monitoring-identifiers-endpoints"></a>20.3.1.&nbsp;Endpoint Monitoring Identifiers</h3></div></div></div><div class="section" title="20.3.1.1.&nbsp;Default Endpoint Monitoring Identifiers"><div class="titlepage"><div><div><h4 class="title"><a name="monitoring-identifiers-endpoints-default"></a>20.3.1.1.&nbsp;Default Endpoint Monitoring Identifiers</h4></div></div></div><p>Each endpoint is given a unique monitoring identifier
                (also call "root name"). That identifier is made up of (in
                order):</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The context path (if it is available).</p></li><li class="listitem"><p>The local part of the service name.</p></li><li class="listitem"><p>The local part of the port name.</p></li></ul></div><p>For example, suppose one creates a web application with
                a context path of <code class="code">/AddNumbersService</code> and a Metro
                web service is deployed under that context path with an
                <code class="code">AddNumbersService</code> service name and a
                <code class="code">AddNumbersPort</code> port name. Then the identifier
                will be:</p><div class="example"><a name="d0e17405"></a><p class="title"><b>Example&nbsp;20.5.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">/AddNumbersService-AddNumbersService-AddNumbersPort</pre></div></div><br class="example-break"><p>When deploying in GlassFish an <code class="code">INFO</code> log
                message is output to GlassFish's <code class="code">server.log</code> file
                when the monitoring root is created. In this example the
                message would be:</p><div class="example"><a name="d0e17416"></a><p class="title"><b>Example&nbsp;20.6.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">Metro monitoring rootname successfully set to: amx:pp=/mon/server-mon[server],type=WSEndpoint,name=/AddNumbersService-AddNumbersService-AddNumbersPort</pre></div></div><br class="example-break"><p>The <code class="code">name</code> part is the identifier. The
                <code class="code">amx:pp=...</code> part reflects that this Metro endpoint
                is federated under GlassFish's AMX tree. Note: when deploying
                in non-GlassFish containers then Metro monitoring will be
                under a top-level node: <code class="code">com.sun.metro</code>.</p></div><div class="section" title="20.3.1.2.&nbsp;User-assigned Endpoint Monitoring Identifiers"><div class="titlepage"><div><div><h4 class="title"><a name="monitoring-identifiers-endpoints-user-assigned"></a>20.3.1.2.&nbsp;User-assigned Endpoint Monitoring Identifiers</h4></div></div></div><p>It is possible to give user-assigned identifiers to
                monitoring endpoints. Include an <code class="code">id</code> attribute in
                the <code class="code">ManagedService</code> policy assertion. For
                example:</p><div class="example"><a name="d0e17441"></a><p class="title"><b>Example&nbsp;20.7.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sunman:ManagedService
        xmlns:sunman="http://java.sun.com/xml/ns/metro/management"
        management="false"
        monitoring="true"
        id="ExampleService"
        &gt;
&lt;/sunman:ManagedService&gt;</pre></div></div><br class="example-break"><p>In this case, the <code class="code">INFO</code> log will say:</p><div class="example"><a name="d0e17449"></a><p class="title"><b>Example&nbsp;20.8.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">Metro monitoring rootname successfully set to: amx:pp=/mon/server-mon[server],type=WSEndpoint,name=ExampleService</pre></div></div><br class="example-break"></div></div><div class="section" title="20.3.2.&nbsp;Client monitoring identifiers"><div class="titlepage"><div><div><h3 class="title"><a name="monitoring-identifiers-clients"></a>20.3.2.&nbsp;Client monitoring identifiers</h3></div></div></div><div class="section" title="20.3.2.1.&nbsp;Default Client Monitoring Identifiers"><div class="titlepage"><div><div><h4 class="title"><a name="monitoring-identifiers-clients-default"></a>20.3.2.1.&nbsp;Default Client Monitoring Identifiers</h4></div></div></div><p>Each client stub is given a unique monitoring
                identifier. That identifier is the endpoint address of the
                service it will communicate with. For example, for a client of
                the <code class="code">AddNumbersService</code> above the identifier, as
                shown in GlassFish's log, will be:</p><div class="example"><a name="d0e17463"></a><p class="title"><b>Example&nbsp;20.9.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">Metro monitoring rootname successfully set to: amx:pp=/mon/server-mon[server],type=WSClient,name=http-//localhost-8080/AddNumbersService/AddNumbersService</pre></div></div><br class="example-break"><p>(Note that ':' characters have been replaced with '-'.
                See below for more info.)</p></div><div class="section" title="20.3.2.2.&nbsp;User-assigned Client Monitoring Identifiers"><div class="titlepage"><div><div><h4 class="title"><a name="monitoring-identifiers-clients-user-assigned"></a>20.3.2.2.&nbsp;User-assigned Client Monitoring Identifiers</h4></div></div></div><p>To give a user-assigned identifier use the
                <code class="code">id</code> attribute in the <code class="code">ManagedClient</code>
                policy assertion.</p></div></div><div class="section" title="20.3.3.&nbsp;Identifier Character Mapping"><div class="titlepage"><div><div><h3 class="title"><a name="monitoring-identifier-character-mapping"></a>20.3.3.&nbsp;Identifier Character Mapping</h3></div></div></div><p>Some characters in a root name are converted to the '-'
            character. This is to avoid the need to quote characters that are
            not legal in JMX. The regular expression used to find and replace
            those characters is:</p><div class="example"><a name="d0e17484"></a><p class="title"><b>Example&nbsp;20.10.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">"\n|\\|\"|\\*|\\?|:|=|,"</pre></div></div><br class="example-break"></div><div class="section" title="20.3.4.&nbsp;Resolving Monitoring Root Name Conflicts"><div class="titlepage"><div><div><h3 class="title"><a name="monitoring-resolving-name-conflicts"></a>20.3.4.&nbsp;Resolving Monitoring Root Name Conflicts</h3></div></div></div><p>It is possible that two root names can be the same. This can
            happen when deploying web services with the same service name and
            port name under different context paths in non-GlassFish
            containers because the context path is not available to the naming
            mechanism when in other containers. This can also happen when two
            different proxies are communicating with the same service.</p><p>When root names clash, then the rootname has
            <code class="code">-&lt;N&gt;</code> appended, where <code class="code">N</code> is a unique
            integer.</p></div></div><div class="section" title="20.4.&nbsp;Available Monitoring Information"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="monitoring-available-information"></a>20.4.&nbsp;Available Monitoring Information</h2></div></div></div><p>To show what monitoring information is available we will use two
        tools:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="link" href="http://www.openjdk.org/tools/svc/jconsole/index.html" target="_top">
                JConsole</a></p></li><li class="listitem"><p><a class="link" href="http://www.cyclopsgroup.org/projects/jmxterm/" target="_top">
                Jmxterm</a></p></li></ul></div><p>Neither of these tools is officially supported by GlassFish nor
        Metro. However, they are useful for browsing the mbeans in a
        JVM.</p><p>The following screenshot shows one client and two services
        running inside the same instance of GlassFish.</p><div class="figure"><a name="f0.4755328135644029"></a><p class="title"><b>Figure&nbsp;20.1.&nbsp;Monitoring - One client and two services running inside
                the same instance of GlassFish</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/jconsole-overview.png" height="360" alt="Monitoring - One client and two services running inside the same instance of GlassFish"></td></tr></table></div></div></div><p><br class="figure-break"></p><p>Metro has five mbean types:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>WSClient </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>General information for a client.</p></li></ul></div></li><li class="listitem"><p>WSEndpoint </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>General information for an endpoint.</p></li></ul></div></li><li class="listitem"><p>WSNonceManager </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p><a class="link" href="http://en.wikipedia.org/wiki/Cryptographic_nonce" target="_top">
                            Nonce</a> manager used by endpoints to prevent
                            replay attacks.</p></li><li class="listitem"><p>This only exists on the endpoint side, scoped
                            per-endpoint.</p></li></ul></div></li><li class="listitem"><p>WSRMSCSessionManager </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Manages Reliable Messaging (RM) and/or Secure
                            Conversation (SC) sessions.</p></li><li class="listitem"><p>This only exists on the endpoint side, scoped
                            per-endpoint.</p></li></ul></div></li><li class="listitem"><p>WSRMSequenceManager </p><div class="itemizedlist"><ul class="itemizedlist" type="circle"><li class="listitem"><p>Manages Reliable Messaging sequences.</p></li><li class="listitem"><p>This exists on both client and endpoints
                            sides, scoped per-stub and per-endpoint
                            respectively.</p></li></ul></div></li></ul></div><p>In the screenshot there is</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>one client that is connected to the
                <code class="code">AddNumbersService</code></p></li><li class="listitem"><p>two endpoints: a <code class="code">/s17...</code> service and an
                <code class="code">ExampleService</code></p></li><li class="listitem"><p>one <code class="code">WSNonceManager</code> associated with the
                <code class="code">/s17...</code> service</p></li><li class="listitem"><p>two <code class="code">WSRMSCSessionManager</code>s, one for each of
                the two services</p></li><li class="listitem"><p>two <code class="code">WSRMSequenceManager</code>s, one associated
                with the client, the other with
                <code class="code">ExampleService</code>.</p></li></ul></div><p>Using Jmxterm you can find these same mbeans (note: the output
        of <code class="code">beans</code> show a lot of beans, this has been edited to
        only show Metro's mbeans):</p><div class="example"><a name="d0e17619"></a><p class="title"><b>Example&nbsp;20.11.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">java -jar &lt;Jmxterm-jar&gt;
Welcome to JMX terminal. Type "help" for available commands.
$&gt;open localhost:8686
#Connection to localhost:8686 is opened
$&gt;beans
...
#domain = amx:
amx:name=/s17-PingService-PingPort,pp=/mon/server-mon[server],type=WSEndpoint

amx:name=ExampleService,pp=/mon/server-mon[server],type=WSEndpoint

amx:name=NonceManager,pp=/mon/server-mon[server]/WSEndpoint[/s17-PingService-PingPort],type=WSNonceManager

amx:name=RMSequenceManager,pp=/mon/server-mon[server]/WSClient[http-//localhost-8080/AddNumbersService/AddNumbersService],type=WSRMSequenceManager

amx:name=RMSequenceManager,pp=/mon/server-mon[server]/WSEndpoint[ExampleService],type=WSRMSequenceManager

amx:name=RM_SC_SessionManager,pp=/mon/server-mon[server]/WSEndpoint[/s17-PingService-PingPort],type=WSRMSCSessionManager

amx:name=RM_SC_SessionManager,pp=/mon/server-mon[server]/WSEndpoint[ExampleService],type=WSRMSCSessionManager

amx:name=http-//localhost-8080/AddNumbersService/AddNumbersService,pp=/mon/server-mon[server],type=WSClient
...    </pre></div></div><br class="example-break"><div class="section" title="20.4.1.&nbsp;WSClient Information"><div class="titlepage"><div><div><h3 class="title"><a name="monitoring-wsclient-information"></a>20.4.1.&nbsp;WSClient Information</h3></div></div></div><p>The following screenshot shows the top-level information
            available for each client:</p><div class="figure"><a name="f0.2892391260409608"></a><p class="title"><b>Figure&nbsp;20.2.&nbsp;Monitoring - top-level information available for
                    each client</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/jconsole-wsclient.png" height="360" alt="Monitoring - top-level information available for each client"></td></tr></table></div></div></div><p><br class="figure-break"></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Children: the <code class="code">WSRMSequenceManager</code> that
                    is used by this client.</p></li><li class="listitem"><p>Container: the container in which the client is
                    deployed---in this case: GlassFish. Note that the actual
                    container object has not been instrumented with monitoring
                    so it Java class@address is printed.</p></li><li class="listitem"><p>Name: the root name given for this client.</p></li><li class="listitem"><p>Parent: show the <code class="code">WSClient</code> under the AMX
                    mbean.</p></li><li class="listitem"><p>qnameToPortInfoMap: an internal map used by the
                    runtime system.</p></li><li class="listitem"><p>serviceClass: The SEI (service endpoint
                    interface).</p></li><li class="listitem"><p>serviceName: From the WSDL.</p></li><li class="listitem"><p>wsdlDocumentLocation: Where the WSDL used to create
                    the client lives. (Note: when a service is created using
                    NetBeans it makes a local copy of the WSDL, therefore the
                    example shows a <code class="code">file</code> instead of an
                    <code class="code">http</code> location.)</p></li><li class="listitem"><p>wsdlService: an internal data structure that is not
                    instrumented.</p></li></ul></div><p>To see these attributes in jmxterm:</p><div class="example"><a name="d0e17676"></a><p class="title"><b>Example&nbsp;20.12.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">$&gt;bean amx:name=http-//localhost-8080/AddNumbersService/AddNumbersService,pp=/mon/server-mon[server],type=WSClient

$&gt;info
#class name = WSClient
# attributes
  %0   - Children ([Ljavax.management.ObjectName;, r)
  %1   - Container (java.lang.String, r)
  %2   - Name (java.lang.String, r)
  %3   - Parent (javax.management.ObjectName, r)
  %4   - qnameToPortInfoMap (javax.management.openmbean.TabularData, r)
  %5   - serviceClass (java.lang.String, r)
  %6   - serviceName (java.lang.String, r)
  %7   - wsdlDocumentLocation (java.lang.String, r)
  %8   - wsdlService (java.lang.String, r)

$&gt;get Name

Name = http-//localhost-8080/AddNumbersService/AddNumbersService;</pre></div></div><br class="example-break"></div><div class="section" title="20.4.2.&nbsp;WSEndpoint Information"><div class="titlepage"><div><div><h3 class="title"><a name="monitoring-wsendpoint-information"></a>20.4.2.&nbsp;WSEndpoint Information</h3></div></div></div><div class="figure"><a name="f0.3177156319073998"></a><p class="title"><b>Figure&nbsp;20.3.&nbsp;Monitoring - WSEndpoint information</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/jconsole-wsendpoint.png" height="360" alt="Monitoring - WSEndpoint information"></td></tr></table></div></div></div><p><br class="figure-break"></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Children: in this example there are two other mbeans
                    associated with the example service.</p></li><li class="listitem"><p>addressingVersion: generally this will be
                    <code class="code">W3C</code> unless explicitly using a different
                    version of addressing.</p></li><li class="listitem"><p>bindingID: the namespace for the type of binding
                    used for the service.</p></li><li class="listitem"><p>dumpHTTPMessages: when set to <code class="code">true</code> then
                    HTTP messages received and sent by this service are
                    "dumped" into the log file. It is possible to dynamically
                    set this value. Just click on the value, type in the value
                    and hit return using JConsole. In jmxterm: </p><div class="example"><a name="d0e17708"></a><p class="title"><b>Example&nbsp;20.13.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">$&gt;bean amx:name=ExampleService,pp=/mon/server-mon[server],type=WSEndpoint

$&gt;set dumpHTTPMessages true</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>features: the "features" (see the JAX-WS
                    specification) used in this endpoint. Using jmxterm
                    (assuming the bean has been set as in dump above: </p><div class="example"><a name="d0e17714"></a><p class="title"><b>Example&nbsp;20.14.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">$&gt;get features
features = [ { 
  enabled = true;
  iD = http://www.w3.org/2005/08/addressing/module;
 }, { 
  enabled = true;
  iD = com.sun.xml.ws.rm.ReliableMessagingFeature;
 } ];</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>jaxwsRuntimeVersion: the version of the JAX-WS
                    specification which is implemented by Metro.</p></li><li class="listitem"><p>policy: A representation of the policy used by the
                    endpoint. The entire policy is more easily viewed using
                    jmxterm: <code class="code">$&gt;get policy</code>. Note: the format of
                    the policy output <span class="bold"><strong>can and will
                    change</strong></span>.</p></li><li class="listitem"><p>portName: The WSDL port name.</p></li><li class="listitem"><p>seiModelWSDLLocation: not currently
                    supported.</p></li><li class="listitem"><p>serviceDefinitionImports: a list of any of files
                    imported by the main WSDL file for this service.</p></li><li class="listitem"><p>serviceDefinitionURL: the service's WSDL.</p></li><li class="listitem"><p>serviceName: The WSDL service name.</p></li><li class="listitem"><p>soapVersionHttpBindingId: The namespace of the HTTP
                    binding.</p></li><li class="listitem"><p>wsdlEndpointAddress: this generally will not contain
                    the real address since it depends on a client calling the
                    service to exist and the value is taken before that
                    happens.</p></li><li class="listitem"><p>wsdlPortTypeName: The WSDL port type.</p></li></ul></div></div><div class="section" title="20.4.3.&nbsp;WSNonceManager Information"><div class="titlepage"><div><div><h3 class="title"><a name="monitoring-wsnoncemanager-information"></a>20.4.3.&nbsp;WSNonceManager Information</h3></div></div></div><p>This allows one to examine the contents of a nonce manager
            of a specific service. Using jmxterm:</p><div class="example"><a name="d0e17758"></a><p class="title"><b>Example&nbsp;20.15.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">$&gt;bean amx:name=NonceManager,pp=/mon/server-mon[server]/WSEndpoint[/s17-PingService-PingPort],type=WSNonceManager

$&gt;get NonceCache

NonceCache = { 
  maxNonceAge = 900000;
  nonceCache = { 
    ( F2jz9MkcI9Gcshk1K0snDPhC ) = { 
      key = F2jz9MkcI9Gcshk1K0snDPhC;
      value = 2009-12-03T22:21:39Z;
     };
   };
  oldNonceCache = { 
   };
  scheduled = true;
  wasCanceled = false;
 };</pre></div></div><br class="example-break"></div><div class="section" title="20.4.4.&nbsp;WSRMSCSessionManager Information"><div class="titlepage"><div><div><h3 class="title"><a name="monitoring-wsrmscsessionmanager-information"></a>20.4.4.&nbsp;WSRMSCSessionManager Information</h3></div></div></div><p>Examine reliable messaging and secure conversation keys and
            sessions for a specific service. Using jmxterm:</p><div class="example"><a name="d0e17766"></a><p class="title"><b>Example&nbsp;20.16.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">$&gt;bean amx:name=RM_SC_SessionManager,pp=/mon/server-mon[server]/WSEndpoint[ExampleService],type=WSRMSCSessionManager

$&gt;get keys

keys = [ uuid:8593cea6-9328-41fe-986a-abf0745c4470, uuid:0987fa78-cd7d-4c1c-9ec2-e849b7f68881 ];

$&gt;get sessions

sessions = [ { 
  creationTime = 1259879310907;
  lastAccessedTime = 1259879310907;
  securityInfo = { 
    creationTime = null;
    expirationTime = null;
    externalId = null;
    identifier = null;
    issuedTokenContext = null;
    secret = null;
   };
  sessionKey = uuid:8593cea6-9328-41fe-986a-abf0745c4470;
 }, { 
  creationTime = 1259866808000;
  lastAccessedTime = 1259866808000;
  securityInfo = { 
    creationTime = null;
    expirationTime = null;
    externalId = null;
    identifier = null;
    issuedTokenContext = null;
    secret = null;
   };
  sessionKey = uuid:0987fa78-cd7d-4c1c-9ec2-e849b7f68881;
 } ];</pre></div></div><br class="example-break"></div><div class="section" title="20.4.5.&nbsp;WSRMSequenceManager Information"><div class="titlepage"><div><div><h3 class="title"><a name="monitoring-wsrmssequencemanager-information"></a>20.4.5.&nbsp;WSRMSequenceManager Information</h3></div></div></div><div class="figure"><a name="f0.5153231558395726"></a><p class="title"><b>Figure&nbsp;20.4.&nbsp;Monitoring - WSRMSequenceManager
                    Information</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/jconsole-wsrmsequencemanager.png" height="360" alt="Monitoring - WSRMSequenceManager Information"></td></tr></table></div></div></div><p><br class="figure-break"></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>boundSequences: generally an inbound sequence will
                    be bound to an outbound sequence so that requests
                    <span class="emphasis"><em>and</em></span> replies are reliable. This table
                    gives the sequence identifiers for those pairs.</p></li><li class="listitem"><p>concurrentlyOpenedInbound: the number of inbound
                    sequences opened.</p></li><li class="listitem"><p>persistent: true if using Metro's persistent
                    reliable messaging.</p></li><li class="listitem"><p>sequences: a map from a sequence identifier to
                    information on that sequence. In jmxterm: </p><div class="example"><a name="d0e17795"></a><p class="title"><b>Example&nbsp;20.17.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">$&gt;bean amx:name=RMSequenceManager,pp=/mon/server-mon[server]/WSEndpoint[ExampleService],type=WSRMSequenceManager

$&gt;get sequences

sequences = { 
  ( uuid:5145de4e-618b-4da3-9004-c715770934d2 ) = { 
    key = uuid:5145de4e-618b-4da3-9004-c715770934d2;
    value = { 
      ackRequested = false;
      boundSecurityTokenReferenceId = null;
      closed = false;
      expired = false;
      hasUnacknowledgedMessages = true;
      id = uuid:5145de4e-618b-4da3-9004-c715770934d2;
      lastActivityTime = 1259880084724;
      lastMessageNumber = 1;
      state = CREATED;
     };
   };
  ( uuid:d16b0fb9-7e80-4598-a3e2-789c9bac9474 ) = { 
    key = uuid:d16b0fb9-7e80-4598-a3e2-789c9bac9474;
    value = { 
      ackRequested = false;
      boundSecurityTokenReferenceId = null;
      closed = false;
      expired = false;
      hasUnacknowledgedMessages = false;
      id = uuid:d16b0fb9-7e80-4598-a3e2-789c9bac9474;
      lastActivityTime = 1259880084724;
      lastMessageNumber = 1;
      state = CREATED;
     };
   };
 };</pre></div></div><p><br class="example-break"></p></li><li class="listitem"><p>uniqueEndpointId: An identifier used by the reliable
                    messaging implementation. Note: this is
                    <span class="emphasis"><em>not</em></span> related to client and endpoint
                    root name identifiers</p></li></ul></div></div></div><div class="section" title="20.5.&nbsp;Notes"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="monitoring-notes"></a>20.5.&nbsp;Notes</h2></div></div></div><p>The AMX mbean is created lazily. Therefore, if one deploys an
        endpoint in GlassFish and then looks for the Metro
        <code class="code">WSEndpoint</code> mbeans using JConsole there are times where
        the AMX mbean does not appear. To activate it start up the asadmin GUI
        or CLI. Or use jmxterm and issue its <code class="code">domains</code>
        command.</p><p>In some cases Metro endpoint mbeans will not appear until the
        endpoint receives its first client invocation.</p><p><code class="code">WSClient</code> mbeans can appear and disappear quickly if
        the stub is just used for one call then closed immediately. A stub
        that uses reliable messaging or secure conversation generally stays
        active longer since it will most likely be used for multiple
        calls.</p></div></div><div lang="en" class="chapter" title="Chapter&nbsp;21.&nbsp;Using Metro With Spring"><div class="titlepage"><div><div><h2 class="title"><a name="springa"></a>Chapter&nbsp;21.&nbsp;Using Metro With Spring</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#spring-introduction">21.1. Spring Introduction</a></span></dt><dt><span class="section"><a href="#springa1">21.2. Using Metro With Spring and NetBeans 6.1</a></span></dt><dd><dl><dt><span class="section"><a href="#spring-netbeans-6.1-introduction">21.2.1. Spring NetBeans 6.1 Introduction</a></span></dt><dt><span class="section"><a href="#creating-a-netbeans-6.1-spring-project">21.2.2. Creating a Netbeans 6.1 Spring Project</a></span></dt><dt><span class="section"><a href="#adding-a-web-service">21.2.3. Adding a Web Service</a></span></dt></dl></dd><dt><span class="section"><a href="#springa2">21.3. Using Metro With Spring and NetBeans 6.5</a></span></dt><dd><dl><dt><span class="section"><a href="#spring-netbeans-6.5-introduction">21.3.1. Spring NetBeans 6.5 Introduction</a></span></dt><dt><span class="section"><a href="#creating-a-netbeans-6.5-spring-project">21.3.2. Creating a NetBeans 6.5 Spring Project</a></span></dt><dt><span class="section"><a href="#adding-a-web-service-">21.3.3. Adding a Web Service</a></span></dt></dl></dd><dt><span class="section"><a href="#using-wsit-functionality-with-spring">21.4. Using WSIT Functionality With Spring</a></span></dt></dl></div><div class="section" title="21.1.&nbsp;Spring Introduction"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="spring-introduction"></a>21.1.&nbsp;Spring Introduction</h2></div></div></div><p>This <a class="link" href="http://jax-ws-commons.java.net/spring/" target="_top">project</a>
        allows you to deploy a JAX-WS endpoint as a <a class="link" href="http://www.springframework.org/" target="_top">Spring</a> Service
        Bean. We won't repeat the information that is on the <a class="link" href="http://jax-ws-commons.java.net/spring/" target="_top">site</a>
        already and instead focus on how to get more out of the Spring
        integration in the following sections.</p></div><div class="section" title="21.2.&nbsp;Using Metro With Spring and NetBeans 6.1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="springa1"></a>21.2.&nbsp;Using Metro With Spring and NetBeans 6.1</h2></div></div></div><div class="section" title="21.2.1.&nbsp;Spring NetBeans 6.1 Introduction"><div class="titlepage"><div><div><h3 class="title"><a name="spring-netbeans-6.1-introduction"></a>21.2.1.&nbsp;Spring NetBeans 6.1 Introduction</h3></div></div></div><p><a class="link" href="http://www.netbeans.org/" target="_top">NetBeans</a>
            provides <a class="link" href="http://www.netbeans.org/kb/61/web/quickstart-webapps-spring.html" target="_top">Spring
            support</a> out of the box. You just need to make sure you have
            the NetBeans plugins installed (Spring Framework Library, Spring
            Beans and Spring Web MVC). The following section explains how to
            create a JAX-WS endpoint with a Spring Web MVC application. The
            instructions assume NetBeans 6.1 but should work with NetBeans 6.0
            as well.</p></div><div class="section" title="21.2.2.&nbsp;Creating a Netbeans 6.1 Spring Project"><div class="titlepage"><div><div><h3 class="title"><a name="creating-a-netbeans-6.1-spring-project"></a>21.2.2.&nbsp;Creating a Netbeans 6.1 Spring Project</h3></div></div></div><p>The Spring Web MVC support built into NetBeans is fully
            integrated into the IDE. That means in order to create a NetBeans
            project that integrates Spring, all we need to do is create an
            ordinary Web Application:</p><div class="figure"><a name="f0.3909234054066213"></a><p class="title"><b>Figure&nbsp;21.1.&nbsp;Netbeans 6.1 - Creating a Web Application</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/spring-new-project.png" height="360" alt="Netbeans 6.1 - Creating a Web Application"></td></tr></table></div></div></div><p><br class="figure-break"></p><p>We are choosing the "Use Dedicated Folder for Storing
            Libraries" option in the next step because we need to add a few
            libraries later:</p><div class="figure"><a name="f0.14436660694298054"></a><p class="title"><b>Figure&nbsp;21.2.&nbsp;Netbeans 6.1 - Creating a Web Application</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/spring-new-webapp.png" height="360" alt="Netbeans 6.1 - Creating a Web Application"></td></tr></table></div></div></div><p><br class="figure-break"></p><p>In the third screen, I am sticking with the defaults.
            Finally, in the last step, we get to choose the Spring Web MVC
            framework:</p><div class="figure"><a name="f0.9597861719931743"></a><p class="title"><b>Figure&nbsp;21.3.&nbsp;Netbeans 6.1 - Creating a Web Application - Spring
                    dependencies</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/spring-new-framework.png" height="360" alt="Netbeans 6.1 - Creating a Web Application - Spring dependencies"></td></tr></table></div></div></div><p><br class="figure-break"></p><p>Now we still need to add the JAX-WS Spring library to the
            project. You can download the library from <a class="link" href="http://maven2-repository.java.net/source/browse/maven2-repository/trunk/www/repository/org/jvnet/jax-ws-commons/spring/jaxws-spring/" target="_top">http://maven2-repository.java.net/source/browse/maven2-repository/trunk/www/repository/org/jvnet/jax-ws-commons/spring/jaxws-spring/</a>.
            Then move the library (in my case jaxws-spring-1.8.jar) into the
            lib directory of the NetBeans project. Next, right-click on the
            project in the NetBeans navigator and select Properties. In the
            Properties dialog, select the Libraries category and press the Add
            JAR/Folder button. Here you can select the library and add it to
            the project.</p><div class="figure"><a name="f0.48554218961773654"></a><p class="title"><b>Figure&nbsp;21.4.&nbsp;Netbeans 6.1 - Creating a Web Application - Adding
                    libraries</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/spring-add-lib.png" height="360" alt="Netbeans 6.1 - Creating a Web Application - Adding libraries"></td></tr></table></div></div></div><p><br class="figure-break"></p><p>The JAX-WS Spring library has a dependency on <a class="link" href="http://geronimo.apache.org/xbean/" target="_top">XBean</a>. That
            means we need an additional library. I downloaded <a class="link" href="http://people.apache.org/repo/m2-ibiblio-rsync-repository/org/apache/xbean/xbean-spring/3.4/xbean-spring-3.4.jar" target="_top">this
            version</a>. Remember to add this library to the project as
            well.</p></div><div class="section" title="21.2.3.&nbsp;Adding a Web Service"><div class="titlepage"><div><div><h3 class="title"><a name="adding-a-web-service"></a>21.2.3.&nbsp;Adding a Web Service</h3></div></div></div><p>Now that we created a web application project in the
            previous section, we can add a JAX-WS Web Service. Simply
            right-click on the MySpringApp project that we created previously
            and select New -&gt; Web Service... We get a dialog where you must
            enter the name of the Web Service class and the Java package
            name:</p><div class="figure"><a name="f0.2952713070263785"></a><p class="title"><b>Figure&nbsp;21.5.&nbsp;Netbeans 6.1 - Adding a Webservice</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/spring-new-webservice.png" height="360" alt="Netbeans 6.1 - Adding a Webservice"></td></tr></table></div></div></div><p><br class="figure-break"></p><p>All that NetBeans really does when you create the Web
            Service is generate a skeleton class with the WebService
            annotation. You can now add methods to that class etc.</p><p>At this point we could actually package and deploy our
            application to GlassFish and we would get a working Web Service
            because GlassFish recognizes the WebService annotation and
            automatically instantiates the Web Service. However, we want to
            use Spring of course, so we need to go through a few additional
            steps to instantiate the Web Service as a Spring Bean.</p><p>NetBeans already created basic web.xml and
            applicationContext.xml files. My web.xml file looks like this:
            </p><div class="example"><a name="d0e17920"></a><p class="title"><b>Example&nbsp;21.1.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app version="2.5" xmlns="http://java.sun.com/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
         http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"&gt;
   &lt;context-param&gt;
      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
      &lt;param-value&gt;/WEB-INF/applicationContext.xml&lt;/param-value&gt;
   &lt;/context-param&gt;
   &lt;listener&gt;
      &lt;listener-class&gt;
         org.springframework.web.context.ContextLoaderListener
      &lt;/listener-class&gt;
   &lt;/listener&gt;
   &lt;servlet&gt;
      &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
      &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet
      &lt;/servlet-class&gt;
      &lt;load-on-startup&gt;2&lt;/load-on-startup&gt;
   &lt;/servlet&gt;
   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
      &lt;url-pattern&gt;*.html&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;
   &lt;session-config&gt;
      &lt;session-timeout&gt;
         30
      &lt;/session-timeout&gt;
   &lt;/session-config&gt;
   &lt;welcome-file-list&gt;
      &lt;welcome-file&gt;redirect.jsp&lt;/welcome-file&gt;
   &lt;/welcome-file-list&gt;
&lt;/web-app&gt;</pre></div></div><p><br class="example-break"></p><p>All that needs to be added to the web.xml is the following:
            </p><div class="example"><a name="d0e17925"></a><p class="title"><b>Example&nbsp;21.2.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;servlet&gt;
    &lt;servlet-name&gt;jaxws-servlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;
        com.sun.xml.ws.transport.http.servlet.WSSpringServlet
    &lt;/servlet-class&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;jaxws-servlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/ws&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</pre></div></div><p><br class="example-break"> The WSSpringServlet plugs JAX-WS into Spring. The
            servlet-mapping is mapping the servlet to the subpath /ws.</p><p>The applicationContext.xml that was created by NetBeans
            looks like this: </p><div class="example"><a name="d0e17931"></a><p class="title"><b>Example&nbsp;21.3.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
       http://www.springframework.org/schema/aop
       http://www.springframework.org/schema/aop/spring-aop-2.5.xsd
       http://www.springframework.org/schema/tx
       http://www.springframework.org/schema/tx/spring-tx-2.5.xsd"&gt;

   &lt;bean id="propertyConfigurer"
class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"
         p:location="/WEB-INF/jdbc.properties"/&gt;

   &lt;bean id="dataSource"
         class="org.springframework.jdbc.datasource.DriverManagerDataSource"
         p:driverClassName="${jdbc.driverClassName}"
         p:url="${jdbc.url}"
         p:username="${jdbc.username}"
         p:password="${jdbc.password}"/&gt;

   &lt;!-- ADD PERSISTENCE SUPPORT HERE (jpa, hibernate, etc) --&gt;

&lt;/beans&gt;</pre></div></div><p><br class="example-break"> To enable the Web Service implementation it is
            sufficient to add the following to the applicationContext.xml:
            </p><div class="example"><a name="d0e17935"></a><p class="title"><b>Example&nbsp;21.4.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;wss:binding url="/ws"&gt;
    &lt;wss:service&gt;
        &lt;ws:service bean="#webService"/&gt;
    &lt;/wss:service&gt;
&lt;/wss:binding&gt;

&lt;!-- this bean implements web service methods --&gt;
&lt;bean id="webService"
      class="com.sun.xml.ws.test.MyWebService"/&gt;</pre></div></div><p><br class="example-break"> The above binds the Web Service Bean to the /ws
            subpath that we defined in the web.xml and it defines the actual
            implementation class (the one that has the WebService annotation).
            We need to add a couple of namespace declarations to the
            applicationContext.xml as well. The final product should look like
            this: </p><div class="example"><a name="d0e17939"></a><p class="title"><b>Example&nbsp;21.5.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:ws="http://jax-ws.java.net/spring/core"
       xmlns:wss="http://jax-ws.java.net/spring/servlet"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
       http://www.springframework.org/schema/aop
       http://www.springframework.org/schema/aop/spring-aop-2.5.xsd
       http://www.springframework.org/schema/tx
       http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
       http://jax-ws.java.net/spring/core
       http://jax-ws.java.net/spring/core.xsd
       http://jax-ws.java.net/spring/servlet
       http://jax-ws.java.net/spring/servlet.xsd"&gt;

   &lt;bean id="propertyConfigurer"
class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"
         p:location="/WEB-INF/jdbc.properties"/&gt;

   &lt;bean id="dataSource"
         class="org.springframework.jdbc.datasource.DriverManagerDataSource"
         p:driverClassName="${jdbc.driverClassName}"
         p:url="${jdbc.url}"
         p:username="${jdbc.username}"
         p:password="${jdbc.password}"/&gt;

   &lt;!-- ADD PERSISTENCE SUPPORT HERE (jpa, hibernate, etc) --&gt;

   &lt;wss:binding url="/ws"&gt;
      &lt;wss:service&gt;
         &lt;ws:service bean="#webService"/&gt;
      &lt;/wss:service&gt;
   &lt;/wss:binding&gt;

   &lt;!-- this bean implements web service methods --&gt;
   &lt;bean id="webService" class="com.sun.xml.ws.test.MyWebService"/&gt;
&lt;/beans&gt;&gt;</pre></div></div><p><br class="example-break"></p><p>If you built and deployed your web application to GlassFish,
            you should be able to see a human-readable entry page if you point
            your browser at <a class="link" href="http://localhost:8080/MySpringApp/ws" target="_top">http://localhost:8080/MySpringApp/ws</a>.
            You can find more details on how to configure JAX-WS for Spring
            <a class="link" href="http://jax-ws-commons.java.net/spring/" target="_top">here</a>.</p></div></div><div class="section" title="21.3.&nbsp;Using Metro With Spring and NetBeans 6.5"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="springa2"></a>21.3.&nbsp;Using Metro With Spring and NetBeans 6.5</h2></div></div></div><div class="section" title="21.3.1.&nbsp;Spring NetBeans 6.5 Introduction"><div class="titlepage"><div><div><h3 class="title"><a name="spring-netbeans-6.5-introduction"></a>21.3.1.&nbsp;Spring NetBeans 6.5 Introduction</h3></div></div></div><p>If you downloaded <a class="link" href="http://www.netbeans.org/" target="_top">NetBeans</a> with the Web
            &amp; Java EE pack it already comes equipped with everything you
            need to develop Spring web applications. Otherwise make sure that
            you have the NetBeans plugins installed (Spring Framework Library,
            Spring Beans and Spring Web MVC). The following section explains
            how to create a JAX-WS endpoint with a Spring Web MVC application.
            The instructions assume NetBeans 6.5. See <a class="xref" href="#springa1" title="21.2.&nbsp;Using Metro With Spring and NetBeans 6.1">Using Metro With Spring and NetBeans 6.1</a> for instructions for NetBeans
            6.1.</p></div><div class="section" title="21.3.2.&nbsp;Creating a NetBeans 6.5 Spring Project"><div class="titlepage"><div><div><h3 class="title"><a name="creating-a-netbeans-6.5-spring-project"></a>21.3.2.&nbsp;Creating a NetBeans 6.5 Spring Project</h3></div></div></div><p>The Spring Web MVC support built into NetBeans is fully
            integrated into the IDE. That means in order to create a NetBeans
            project that integrates Spring, all we need to do is create an
            ordinary Web Application:</p><div class="figure"><a name="f0.6896137896548253"></a><p class="title"><b>Figure&nbsp;21.6.&nbsp;Netbeans 6.5 - Creating a Web Application</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/spring-nb65-new-project.png" height="360" alt="Netbeans 6.5 - Creating a Web Application"></td></tr></table></div></div></div><p><br class="figure-break"></p><p>We are choosing the "Use Dedicated Folder for Storing
            Libraries" option in the next step because we need to add a few
            libraries later:</p><div class="figure"><a name="f0.44980859181463606"></a><p class="title"><b>Figure&nbsp;21.7.&nbsp;Netbeans 6.5 - Creating a Web Application</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/spring-nb65-new-webapp.png" height="360" alt="Netbeans 6.5 - Creating a Web Application"></td></tr></table></div></div></div><p><br class="figure-break"></p><p>In the third screen, you may stick with the defaults:</p><div class="figure"><a name="f0.7488236063243116"></a><p class="title"><b>Figure&nbsp;21.8.&nbsp;Netbeans 6.5 - Creating a Web Application - Servers
                    and Settings</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/spring-nb65-new-webapp-2.png" height="360" alt="Netbeans 6.5 - Creating a Web Application - Servers and Settings"></td></tr></table></div></div></div><p><br class="figure-break"></p><p>Finally, in the last step, you get to choose the Spring Web
            MVC framework:</p><div class="figure"><a name="f0.70966785130944"></a><p class="title"><b>Figure&nbsp;21.9.&nbsp;Netbeans 6.5 - Creating a Web Application - Spring
                    dependencies</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/spring-nb65-new-framework.png" height="360" alt="Netbeans 6.5 - Creating a Web Application - Spring dependencies"></td></tr></table></div></div></div><p><br class="figure-break"></p><p>Now you still need to add the JAX-WS Spring library to the
            project. You can download the library from <a class="link" href="http://maven2-repository.java.net/source/browse/maven2-repository/trunk/www/repository/org/jvnet/jax-ws-commons/spring/jaxws-spring/" target="_top">http://maven2-repository.java.net/source/browse/maven2-repository/trunk/www/repository/org/jvnet/jax-ws-commons/spring/jaxws-spring/</a>.
            Then move the library (i.e. jaxws-spring-1.8.jar) into the lib
            directory of the NetBeans project. Next, right-click on the
            project in the NetBeans navigator and select Properties. In the
            Properties dialog, select the Libraries category and press the Add
            JAR/Folder button. Here you can select the library and add it to
            the project.</p><div class="figure"><a name="f0.12494192198301834"></a><p class="title"><b>Figure&nbsp;21.10.&nbsp;Netbeans 6.5 - Creating a Web Application - Adding
                    libraries</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/spring-nb65-add-lib.png" height="360" alt="Netbeans 6.5 - Creating a Web Application - Adding libraries"></td></tr></table></div></div></div><p><br class="figure-break"></p><p>The JAX-WS Spring library has a dependency on <a class="link" href="http://geronimo.apache.org/xbean/" target="_top">XBean</a>. That
            means you need an additional library. You can download <a class="link" href="http://people.apache.org/repo/m2-ibiblio-rsync-repository/org/apache/xbean/xbean-spring/3.4/xbean-spring-3.4.jar" target="_top">this
            version</a>. Remember to add this library to the project as
            well.</p></div><div class="section" title="21.3.3.&nbsp;Adding a Web Service"><div class="titlepage"><div><div><h3 class="title"><a name="adding-a-web-service-"></a>21.3.3.&nbsp;Adding a Web Service</h3></div></div></div><p>Now that you created a web application project in the
            previous section, you can add a JAX-WS Web Service. Simply
            right-click on the MySpringApp project that you created previously
            and select New -&gt; Web Service... You get a dialog where you
            must enter the name of the Web Service class and the Java package
            name:</p><div class="figure"><a name="f0.8720359728656875"></a><p class="title"><b>Figure&nbsp;21.11.&nbsp;Netbeans 6.5 - Adding a Web Service</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/spring-nb65-new-webservice.png" height="360" alt="Netbeans 6.5 - Adding a Web Service"></td></tr></table></div></div></div><p><br class="figure-break"></p><p>All that NetBeans really does when you create the Web
            Service is generate a skeleton class with the WebService
            annotation. You can now add methods to that class etc.</p><p>After you added an operation to the web service you could
            actually package and deploy our application to GlassFish and you
            would get a working Web Service because GlassFish recognizes the
            WebService annotation and automatically instantiates the Web
            Service. However, since this is a Spring tutorial, you need to go
            through a few additional steps to instantiate the Web Service as a
            Spring Bean.</p><p>NetBeans already created basic web.xml and
            applicationContext.xml files. The web.xml ought to look like this:
            </p><div class="example"><a name="d0e18040"></a><p class="title"><b>Example&nbsp;21.6.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app version="2.5" xmlns="http://java.sun.com/xml/ns/javaee"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
         http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"&gt;
   &lt;context-param&gt;
      &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
      &lt;param-value&gt;/WEB-INF/applicationContext.xml&lt;/param-value&gt;
   &lt;/context-param&gt;
   &lt;listener&gt;
      &lt;listener-class&gt;
         org.springframework.web.context.ContextLoaderListener
      &lt;/listener-class&gt;
   &lt;/listener&gt;
   &lt;servlet&gt;
      &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
      &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet
      &lt;/servlet-class&gt;
      &lt;load-on-startup&gt;2&lt;/load-on-startup&gt;
   &lt;/servlet&gt;
   &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;dispatcher&lt;/servlet-name&gt;
      &lt;url-pattern&gt;*.htm&lt;/url-pattern&gt;
   &lt;/servlet-mapping&gt;
   &lt;session-config&gt;
      &lt;session-timeout&gt;
         30
      &lt;/session-timeout&gt;
   &lt;/session-config&gt;
   &lt;welcome-file-list&gt;
      &lt;welcome-file&gt;redirect.jsp&lt;/welcome-file&gt;
   &lt;/welcome-file-list&gt;
&lt;/web-app&gt;</pre></div></div><p><br class="example-break"></p><p>All that needs to be added to the web.xml is the following:
            </p><div class="example"><a name="d0e18045"></a><p class="title"><b>Example&nbsp;21.7.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;servlet&gt;
    &lt;servlet-name&gt;jaxws-servlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;
       com.sun.xml.ws.transport.http.servlet.WSSpringServlet
    &lt;/servlet-class&gt;
&lt;/servlet&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;jaxws-servlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/ws&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;</pre></div></div><p><br class="example-break"> The WSSpringServlet plugs JAX-WS into Spring. The
            servlet-mapping is mapping the servlet to the subpath /ws.</p><p>The applicationContext.xml that was created by NetBeans
            looks like this: </p><div class="example"><a name="d0e18051"></a><p class="title"><b>Example&nbsp;21.8.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
       http://www.springframework.org/schema/aop
       http://www.springframework.org/schema/aop/spring-aop-2.5.xsd
       http://www.springframework.org/schema/tx
       http://www.springframework.org/schema/tx/spring-tx-2.5.xsd"&gt;

   &lt;bean id="propertyConfigurer"
class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"
         p:location="/WEB-INF/jdbc.properties"/&gt;

   &lt;bean id="dataSource"
         class="org.springframework.jdbc.datasource.DriverManagerDataSource"
         p:driverClassName="${jdbc.driverClassName}"
         p:url="${jdbc.url}"
         p:username="${jdbc.username}"
         p:password="${jdbc.password}"/&gt;

   &lt;!-- ADD PERSISTENCE SUPPORT HERE (jpa, hibernate, etc) --&gt;

&lt;/beans&gt;</pre></div></div><p><br class="example-break"> To enable the Web Service implementation it is
            sufficient to add the following to the applicationContext.xml:
            </p><div class="example"><a name="d0e18055"></a><p class="title"><b>Example&nbsp;21.9.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;wss:binding url="/ws"&gt;
    &lt;wss:service&gt;
        &lt;ws:service bean="#webService"/&gt;
    &lt;/wss:service&gt;
&lt;/wss:binding&gt;

&lt;!-- this bean implements web service methods --&gt;
&lt;bean id="webService" class="example.test.MyWebService"/&gt;</pre></div></div><p><br class="example-break"> The above binds the Web Service Bean to the /ws
            subpath that we defined in the web.xml and it defines the actual
            implementation class (the one that has the WebService annotation).
            You need to add a couple of namespace declarations to the
            applicationContext.xml as well. The final product should look like
            this: </p><div class="example"><a name="d0e18059"></a><p class="title"><b>Example&nbsp;21.10.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:ws="http://jax-ws.java.net/spring/core"
       xmlns:wss="http://jax-ws.java.net/spring/servlet"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
       http://www.springframework.org/schema/aop
       http://www.springframework.org/schema/aop/spring-aop-2.5.xsd
       http://www.springframework.org/schema/tx
       http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
       http://jax-ws.java.net/spring/core
       http://jax-ws.java.net/spring/core.xsd
       http://jax-ws.java.net/spring/servlet
       http://jax-ws.java.net/spring/servlet.xsd"&gt;

   &lt;bean id="propertyConfigurer"
class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"
         p:location="/WEB-INF/jdbc.properties"/&gt;

   &lt;bean id="dataSource"
         class="org.springframework.jdbc.datasource.DriverManagerDataSource"
         p:driverClassName="${jdbc.driverClassName}"
         p:url="${jdbc.url}"
         p:username="${jdbc.username}"
         p:password="${jdbc.password}"/&gt;

   &lt;!-- ADD PERSISTENCE SUPPORT HERE (jpa, hibernate, etc) --&gt;

   &lt;wss:binding url="/ws"&gt;
      &lt;wss:service&gt;
         &lt;ws:service bean="#webService"/&gt;
      &lt;/wss:service&gt;
   &lt;/wss:binding&gt;

   &lt;!-- this bean implements web service methods --&gt;
   &lt;bean id="webService" class="example.test.MyWebService"/&gt;

&lt;/beans&gt;</pre></div></div><p><br class="example-break"></p><p>If you built and deployed your web application to GlassFish,
            you should be able to see a human-readable entry page if you point
            your browser at <a class="link" href="http://localhost:8080/MySpringApp/ws" target="_top">http://localhost:8080/MySpringApp/ws</a>.
            You can find more details on how to configure JAX-WS for Spring
            <a class="link" href="http://jax-ws-commons.java.net/spring/" target="_top">here</a>.</p></div></div><div class="section" title="21.4.&nbsp;Using WSIT Functionality With Spring"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="using-wsit-functionality-with-spring"></a>21.4.&nbsp;Using WSIT Functionality With Spring</h2></div></div></div><p>This section builds on <a class="xref" href="#springa1" title="21.2.&nbsp;Using Metro With Spring and NetBeans 6.1">Using Metro With Spring and NetBeans 6.1</a> or <a class="xref" href="#springa2" title="21.3.&nbsp;Using Metro With Spring and NetBeans 6.5">Using Metro With Spring and NetBeans 6.5</a> because the WSIT functionality is easiest
        to configure with NetBeans. But you should be able to apply the
        instructions when you are not using NetBeans as well.</p><p>We assume that you already have a working web application with a
        Web Service that you can deploy to Spring. If you followed the
        instructions on how to set up a NetBeans project, you can now select
        the Web Service in the Projects navigator under the Web Services node.
        All you need to do then is right-click on the Web Service and select
        Edit Web Service Attributes from the pop-up window:</p><div class="figure"><a name="f0.5173347854521261"></a><p class="title"><b>Figure&nbsp;21.12.&nbsp;Netbeans - Edit Web Service Attributes</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/spring-edit-attributes.png" height="360" alt="Netbeans - Edit Web Service Attributes"></td></tr></table></div></div></div><p><br class="figure-break"></p><p>See these chapters for guidance on the configuration options:
        </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a></p></li><li class="listitem"><p><a class="xref" href="#ahibx" title="Chapter&nbsp;8.&nbsp;Message Optimization"><i>Message Optimization</i></a></p></li><li class="listitem"><p><a class="xref" href="#using_rm" title="Chapter&nbsp;10.&nbsp;Using Reliable Messaging"><i>Using Reliable Messaging</i></a></p></li><li class="listitem"><p><a class="xref" href="#ahici" title="Chapter&nbsp;12.&nbsp;Using WSIT Security"><i>Using WSIT Security</i></a></p></li><li class="listitem"><p><a class="xref" href="#using_at" title="Chapter&nbsp;18.&nbsp;Using Atomic Transactions"><i>Using Atomic Transactions</i></a></p></li></ul></div><p>Once you have configured everything, you would simply build and
        deploy your application and Metro will pick up the configuration that
        was generated. If you need to create the configuration manually,
        create a file named wsit-<span class="emphasis"><em>package.service</em></span>.xml and
        put it into the WEB-INF directory of your application.
        <span class="emphasis"><em>package.service</em></span> needs to be replaced by the fully
        qualified name of the class that has the WebService annotation. If
        your class is named e.g. org.example.MyWebService, the file would need
        to be named wsit-<span class="emphasis"><em>org.example.MyWebService</em></span>. For
        more detailed instructions, see <a class="xref" href="#ahifl" title="Chapter&nbsp;14.&nbsp;WSIT Example Using a Web Container Without NetBeans IDE"><i>WSIT Example Using a Web Container Without NetBeans IDE</i></a>.</p></div></div><div lang="en" class="chapter" title="Chapter&nbsp;22.&nbsp;Further Information"><div class="titlepage"><div><div><h2 class="title"><a name="furtherinfo"></a>Chapter&nbsp;22.&nbsp;Further Information</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#ahifd">22.1. Links to more information</a></span></dt></dl></div><div class="section" title="22.1.&nbsp;Links to more information"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahifd"></a>22.1.&nbsp;Links to more information</h2></div></div></div><p>For more information on Metro, visit the Metro web site at <a class="link" href="http://metro.java.net/" target="_top"> http://metro.java.net/</a> .
        On that site, you will find information about the specifications
        implemented in Metro product, source code, support information, links
        to documentation updates, and much more.</p><p>Some other sources that contain blogs and/or screencasts about
        using Metro include the following:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Sun Metro Bloggers:</p><p><a class="link" href="http://planets.sun.com/webservices/" target="_top">
                http://planets.sun.com/webservices/</a></p></li><li class="listitem"><p>Metro: An Overview: (of the WSIT portion of
                Metro)</p><p><a class="link" href="http://wsit.java.net/docs/tango-overview.pdf" target="_top">
                http://wsit.java.net/docs/tango-overview.pdf</a></p></li><li class="listitem"><p>Web Services blog:</p><p><a class="link" href="http://blogs.sun.com/arungupta/category/webservices" target="_top">
                http://blogs.sun.com/arungupta/category/webservices</a></p></li><li class="listitem"><p>Manual Web Service Configuration Starting From Java Case
                (and others):</p><p><a class="link" href="http://blogs.sun.com/japod/date/20070226" target="_top">
                http://blogs.sun.com/japod/date/20070226</a></p></li><li class="listitem"><p>Develop WSTrust Application Using NetBeans (and
                others):</p><p><a class="link" href="http://blogs.sun.com/shyamrao/" target="_top">
                http://blogs.sun.com/shyamrao/</a></p></li><li class="listitem"><p>Security in Metro (and others):</p><p><a class="link" href="http://blogs.sun.com/ashutosh/" target="_top">
                http://blogs.sun.com/ashutosh/</a></p></li><li class="listitem"><p>Metro Screencasts:</p><p><a class="link" href="http://metro.java.net/discover/screencasts.html" target="_top">
                http://metro.java.net/discover/screencasts.html</a></p></li><li class="listitem"><p>WS-* Specifications Implemented by Metro:</p><p><a class="link" href="http://wsit.java.net/specification-links.html" target="_top">
                http://wsit.java.net/specification-links.html</a></p></li></ul></div></div></div></div></body></html>