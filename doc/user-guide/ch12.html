<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;12.&nbsp;Using WSIT Security</title><link rel="stylesheet" href="style/documentation.css" type="text/css"><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><link rel="home" href="index.html" title="Metro User Guide"><link rel="up" href="index.html" title="Metro User Guide"><link rel="prev" href="ch11.html" title="Chapter&nbsp;11.&nbsp;WS-MakeConnection support"><link rel="next" href="ch13.html" title="Chapter&nbsp;13.&nbsp;WSIT Security Features: Advanced: Topics"><script xmlns:fo="http://www.w3.org/1999/XSL/Format" type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2105126-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter&nbsp;12.&nbsp;Using WSIT Security</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch11.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch13.html">Next</a></td></tr></table><hr></div><small xmlns:fo="http://www.w3.org/1999/XSL/Format" class="small">Links: <a href="index.html">Table of Contents</a> | <a href="user-guide.html">Single HTML</a> | <a href="user-guide.pdf">Single PDF</a></small><div lang="en" class="chapter" title="Chapter&nbsp;12.&nbsp;Using WSIT Security"><div class="titlepage"><div><div><h2 class="title"><a name="ahici"></a>Chapter&nbsp;12.&nbsp;Using WSIT Security</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="ch12.html#ahicj">12.1. Configuring Security Using NetBeans IDE</a></span></dt><dt><span class="section"><a href="ch12.html#ahicm">12.2. Summary of Configuration Requirements</a></span></dt><dd><dl><dt><span class="section"><a href="ch12.html#ahicn">12.2.1. Summary of Service-Side Configuration Requirements</a></span></dt><dt><span class="section"><a href="ch12.html#ahicp">12.2.2. Summary of Client-Side Configuration Requirements</a></span></dt></dl></dd><dt><span class="section"><a href="ch12.html#ahicu">12.3. Security Mechanisms</a></span></dt><dd><dl><dt><span class="section"><a href="ch12.html#ahicv">12.3.1. Username Authentication with Symmetric Key</a></span></dt><dt><span class="section"><a href="ch12.html#ahicv1">12.3.2. Username Authentication with Password Derived Keys</a></span></dt><dt><span class="section"><a href="ch12.html#ahicw">12.3.3. Mutual Certificates Security</a></span></dt><dt><span class="section"><a href="ch12.html#SymmBindingKerberos">12.3.4. Symmetric Binding with Kerberos Tokens</a></span></dt><dt><span class="section"><a href="ch12.html#ahicx">12.3.5. Transport Security (SSL)</a></span></dt><dt><span class="section"><a href="ch12.html#ahicz">12.3.6. Message Authentication over SSL</a></span></dt><dt><span class="section"><a href="ch12.html#ahida">12.3.7. SAML Authorization over SSL</a></span></dt><dt><span class="section"><a href="ch12.html#ahidb">12.3.8. Endorsing Certificate</a></span></dt><dt><span class="section"><a href="ch12.html#ahidc">12.3.9. SAML Sender Vouches with Certificates</a></span></dt><dt><span class="section"><a href="ch12.html#ahidd">12.3.10. SAML Holder of Key</a></span></dt><dt><span class="section"><a href="ch12.html#ahide">12.3.11. STS Issued Token</a></span></dt><dt><span class="section"><a href="ch12.html#ahidf">12.3.12. STS Issued Token with Service Certificate</a></span></dt><dt><span class="section"><a href="ch12.html#ahidg">12.3.13. STS Issued Endorsing Token</a></span></dt></dl></dd><dt><span class="section"><a href="ch12.html#ahidh">12.4. Configuring SSL and Authorized Users</a></span></dt><dd><dl><dt><span class="section"><a href="ch12.html#ahidi">12.4.1. Configuring SSL For Your Applications</a></span></dt><dt><span class="section"><a href="ch12.html#ahidj">12.4.2. Adding Users to GlassFish</a></span></dt></dl></dd><dt><span class="section"><a href="ch12.html#ahidm">12.5. Configuring Keystores and Truststores</a></span></dt><dd><dl><dt><span class="section"><a href="ch12.html#ahido">12.5.1. Specifying Aliases with the Updated Stores</a></span></dt><dt><span class="section"><a href="ch12.html#ahidr">12.5.2. Configuring the Keystore and Truststore</a></span></dt><dt><span class="section"><a href="ch12.html#ahidx">12.5.3. Configuring Validators</a></span></dt></dl></dd><dt><span class="section"><a href="ch12.html#ConfiguringKerberos">12.6. Configuring Kerberos for Glassfish and Tomcat</a></span></dt><dd><dl><dt><span class="section"><a href="ch12.html#KerberosForGlassfish">12.6.1. For Glassfish</a></span></dt><dt><span class="section"><a href="ch12.html#KerberosForTomcat">12.6.2. For Tomcat</a></span></dt></dl></dd><dt><span class="section"><a href="ch12.html#ahidy">12.7. Securing Operations and Messages</a></span></dt><dd><dl><dt><span class="section"><a href="ch12.html#ahiea">12.7.1. Supporting Token Options</a></span></dt></dl></dd><dt><span class="section"><a href="ch12.html#ahieb">12.8. Configuring A Secure Token Service (STS)</a></span></dt><dt><span class="section"><a href="ch12.html#ahiei">12.9. Example Applications</a></span></dt><dd><dl><dt><span class="section"><a href="ch12.html#ahiej">12.9.1. Example: Username Authentication with Symmetric Key
            (UA)</a></span></dt><dt><span class="section"><a href="ch12.html#UsernameWithDigestPasswords">12.9.2. Example: Username with Digest Passwords</a></span></dt><dt><span class="section"><a href="ch12.html#ahiem">12.9.3. Example: Mutual Certificates Security (MCS)</a></span></dt><dt><span class="section"><a href="ch12.html#ahiep">12.9.4. Example: Transport Security (SSL)</a></span></dt><dt><span class="section"><a href="ch12.html#ahies">12.9.5. Example: SAML Authorization over SSL (SA)</a></span></dt><dt><span class="section"><a href="ch12.html#ahiev">12.9.6. Example: SAML Sender Vouches with Certificates (SV)</a></span></dt><dt><span class="section"><a href="ch12.html#ahiey">12.9.7. Example: STS Issued Token (STS)</a></span></dt><dt><span class="section"><a href="ch12.html#ahiex">12.9.8. Example: Broker Trust STS (BT)</a></span></dt><dt><span class="section"><a href="ch12.html#ahiez">12.9.9. Example: STS Issued Token With SecureConversation
            (STS+SC)</a></span></dt><dt><span class="section"><a href="ch12.html#gfzhh">12.9.10. Example: Kerberos Token (Kerb)</a></span></dt></dl></dd></dl></div><div class="section" title="12.1.&nbsp;Configuring Security Using NetBeans IDE"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahicj"></a>12.1.&nbsp;Configuring Security Using NetBeans IDE</h2></div></div></div><p>This section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#gfrdt" title="To Secure the Service">To Secure the Service</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrds" title="To Secure the Client">To Secure the Client</a></p></li></ul></div><div class="task" title="To Secure the Service"><a name="gfrdt"></a><p class="title"><b>To Secure the Service</b></p><div class="tasksummary">
                <p>To use the IDE to configure security for a web service
                and/or a web service operation, perform the following
                steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Create or open your web
                    service.</strong></span></p><p>If you need an example of how to create a web
                    service, refer to <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a>.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>When creating an application using the wizards
                        in NetBeans IDE and running on GlassFish, the Java EE
                        Version defaults to Java EE 5. This results in an
                        application compliant with JSR-109, Implementing
                        Enterprise Web Services, which can be read at <a class="link" href="http://jcp.org/en/jsr/detail?id=109" target="_top">http://jcp.org/en/jsr/detail?id=109</a>.
                        If you select a value other than the default, for
                        example, J2EE 1.4, the application that is created is
                        not JSR-109 compliant, which means that the
                        application is not JAX-WS, but is JAX-RPC.</p></div></li><li class="step" title="Step 2"><p><span class="bold"><strong>In the
                    <span class="guilabel">Projects</span> window, expand the
                    <span class="guilabel">Web Services</span> node.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Right-click the node for the
                    web service you want to secure.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select <span class="guimenuitem">Edit Web
                    Service Attributes</span>.</strong></span></p><p>When the <span class="guilabel">Web Service Attributes
                    Editor</span> is opened, the <span class="guilabel">Quality of
                    Service</span> options appear (see <a class="xref" href="ch12.html#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a>).</p><div class="figure"><a name="gfrct"></a><p class="title"><b>Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/tango_ws_edit_collapsed.png" height="360" alt="Web Service Attributes Editor Page"></td></tr></table></div></div></div><br class="figure-break"></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select <span class="guilabel">Secure
                    Service</span>.</strong></span></p><p>This option enables WSIT security for all of the
                    operations of a web service.</p><p>For information on how to secure selected
                    operations, refer to <a class="xref" href="ch12.html#ahidy" title="12.7.&nbsp;Securing Operations and Messages">Securing Operations and Messages</a>.</p></li><li class="step" title="Step 6"><p><span class="bold"><strong>Choose a <span class="guilabel">Security
                    Mechanism</span> from the list.</strong></span></p><p>Most of the mechanisms are fully functional without
                    further configuration, however, if you'd like to customize
                    the mechanism, click <span class="guilabel">Configure</span> to
                    specify the configuration for that mechanism.</p><p>Options in the <span class="guilabel">Configure</span> dialog
                    are discussed in <a class="xref" href="ch13.html#ahifj" title="13.3.&nbsp;Security Mechanism Configuration Options">Security Mechanism Configuration Options</a>.</p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Select <span class="guilabel">Use
                    Development Defaults</span>.</strong></span></p><p>Select this option to import certificates into the
                    GlassFish keystore and truststore so that they can be used
                    immediately for development. The WSIT message security
                    mechanisms require the use of v3 certificates. The default
                    GlassFish keystore and truststore do not contain v3
                    certificates at this time. In order to use message
                    security mechanisms with GlassFish, it is necessary to
                    obtain keystore and truststore files that contain v3
                    certificates and import the appropriate certificates into
                    the default GlassFish stores.</p><p>In addition to importing certificates, when this
                    option is selected a default user is created in the
                    <code class="code">file</code> realm with username
                    <code class="code">wsitUser</code>.</p><p>In a production environment, you should provide your
                    own certificates and user settings, however, in a
                    development environment you may find these defaults
                    useful.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Specify Keystore, Truststore,
                    STS, SSL, and/or user information as required for the
                    selected security mechanism. </strong></span></p><p>Refer to the entry for the selected security
                    mechanism in <a class="xref" href="ch12.html#ahico" title="Table&nbsp;12.1.&nbsp;Summary of Service-Side Configuration Requirements">Summary of Service-Side Configuration
                Requirements</a> . This table summarizes the
                    information that needs to be set up for each of the
                    security mechanisms.</p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Click
                    <span class="guibutton">OK</span> to save your
                    changes.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> Run the web application by
                    right-clicking the project node and selecting
                    <span class="guimenuitem">Run</span>. </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Verify the URL of the WSDL
                    file before proceeding with the creation of the web
                    service client. </strong></span></p><p>The client will be created from this WSDL file, and
                    will get the service's security policies through the web
                    service reference URL when the client is built or
                    refreshed.</p></li></ol></div></div><div class="task" title="To Secure the Client"><a name="gfrds"></a><p class="title"><b>To Secure the Client</b></p><div class="tasksummary">
                <p>All of the steps in <a class="xref" href="ch12.html#gfrdt" title="To Secure the Service">To Secure the Service</a> need to be completed before you
                create your web service client. The service's security
                policies are defined in its WSDL. You specify this WSDL file
                when you create the client application so that the client is
                configured to work with the service's security mechanism
                through the web service reference URL when the client is built
                or refreshed.</p>

                <p>To use the IDE to configure security for a web service
                client, perform the following steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Create a client for your web
                    service.</strong></span></p><p>If you need an example of how to do this, see <a class="xref" href="ch02.html#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> .</p><p>If you are creating a client for a mechanism that
                    will use SSL, specify the secure port for running the
                    client when completing the New Web Service Client step. To
                    do this, type <code class="code">https://</code>
                    <span class="emphasis"><em>fully_qualified_hostname</em></span>
                    <code class="code">:8181/</code> <span class="emphasis"><em>rest_of_url</em></span> in
                    the WSDL URL field of the New Web Service Client wizard.
                    For the example, this is the way to specify the secure URL
                    for <code class="code">CalculatorWSService</code> web service:</p><pre class="programlisting">https://<span class="emphasis"><em>fully_qualified_hostname</em></span>:8181/CalculatorApplication/CalculatorWSService?wsdl</pre><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you prefer to use <code class="code">localhost</code> in
                        place of the fully-qualified hostname when specifying
                        the URL for the service WSDL, you must follow the
                        workaround described in <a class="xref" href="ch12.html#ahicy" title="12.3.5.1.&nbsp;Transport Security (SSL) Workaround">Transport Security (SSL) Workaround</a>.</p></div></li><li class="step" title="Step 2"><p><span class="bold"><strong>In the Projects window, expand
                    the client node.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Expand the Web Service
                    References node.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Right-click the node for the
                    web service reference you want to secure.
                    </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Edit Web Service
                    Attributes.</strong></span></p><p>When the Web Service References Attributes Editor is
                    opened, select the Quality of Service tab to display the
                    security options (see <a class="xref" href="ch12.html#gfrda" title="Figure&nbsp;12.2.&nbsp;Web Service References Attributes Editor Page for Web Service Clients">Web Service References Attributes Editor Page
                        for Web Service Clients</a> ).</p><div class="figure"><a name="gfrda"></a><p class="title"><b>Figure&nbsp;12.2.&nbsp;Web Service References Attributes Editor Page
                        for Web Service Clients</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/web_svc_ref_wsit.png" height="360" alt="Web Service References Attributes Editor Page for Web Service Clients"></td></tr></table></div></div></div><br class="figure-break"></li><li class="step" title="Step 6"><p><span class="bold"><strong>Select Use Development
                    Defaults.</strong></span></p><p>Refer to <a class="xref" href="ch12.html#ahicq" title="Table&nbsp;12.2.&nbsp;Summary of Client-Side Configuration Requirements">Summary of Client-Side Configuration
                Requirements</a> for a summary of what options
                    are required on the client side. The configuration
                    requirements for the client are dependent upon which
                    security mechanism is specified on the server side.</p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click OK to save your
                    changes.</strong></span></p><p>The security configuration information is saved in
                    two files under Source Packages/META-INF. For more
                    information on the format and runtime usage of these
                    files, see <a class="xref" href="ch13.html#ahifi" title="13.2.2.&nbsp;Client-Side WSIT Configuration Files">Client-Side WSIT Configuration Files</a> .</p></li></ol></div></div></div><div class="section" title="12.2.&nbsp;Summary of Configuration Requirements"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahicm"></a>12.2.&nbsp;Summary of Configuration Requirements</h2></div></div></div><p>The following sections summarize the options that need to be
        configured for each of the security mechanisms on both the service and
        client side. The configuration requirements for the client are
        dependent upon which security mechanism is specified on the server
        side.</p><p>This section covers the following topics:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#ahicn" title="12.2.1.&nbsp;Summary of Service-Side Configuration Requirements">Summary of Service-Side Configuration Requirements</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahicp" title="12.2.2.&nbsp;Summary of Client-Side Configuration Requirements">Summary of Client-Side Configuration Requirements</a></p></li></ul></div><div class="section" title="12.2.1.&nbsp;Summary of Service-Side Configuration Requirements"><div class="titlepage"><div><div><h3 class="title"><a name="ahicn"></a>12.2.1.&nbsp;Summary of Service-Side Configuration Requirements</h3></div></div></div><p><a class="xref" href="ch12.html#ahico" title="Table&nbsp;12.1.&nbsp;Summary of Service-Side Configuration Requirements">Summary of Service-Side Configuration
                Requirements</a> summarizes
            the options that need to be configured for each security
            mechanism. Each of the columns is briefly discussed after the
            table.</p><div class="table"><a name="ahico"></a><p class="title"><b>Table&nbsp;12.1.&nbsp;Summary of Service-Side Configuration
                Requirements</b></p><div class="table-contents"><table summary="Summary of Service-Side Configuration&#xA;                Requirements" border="1"><colgroup><col><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th><p>Mechanism</p></th><th align="center"><p>Keystore</p></th><th align="center"><p>Truststore</p></th><th align="center"><p>STS</p></th><th align="center"><p>SSL</p></th><th align="center"><p>User in GlassFish</p></th><th align="center"><p>Kerberos</p></th></tr></thead><tbody><tr><td><p>Username Authentication with Symmetric
                            Key</p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td></tr><tr><td><p>Username Authentication with Password
                            Derived Keys</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td></tr><tr><td><p>Mutual Certificates</p></td><td align="center"><p> X </p></td><td align="center"><p> X (no alias) </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>Symmetric Binding with Kerberos
                            Tokens</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td></tr><tr><td><p>Transport Security</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td></tr><tr><td><p>Message Authentication over SSL -
                            Username Token</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td></tr><tr><td><p>Message Authentication over SSL - X.509
                            Token</p></td><td align="center">&nbsp;</td><td align="center"><p> X (no alias) </p></td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>SAML Authorization over
                            SSL</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>Endorsing Certificate</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>SAML Sender Vouches with
                            Certificate</p></td><td align="center"><p> X </p></td><td align="center"><p> X (no alias) </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>SAML Holder of Key</p></td><td align="center"><p> X </p></td><td align="center"><p> X (no alias) </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>STS Issued Token</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>STS Issued Token with Service
                            Cert.</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>STS Issued Endorsing
                            Token</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr></tbody></table></div></div><br class="table-break"><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Keystore</em></span>: If this column has an
                    X, select Use Development Defaults, or click the Keystore
                    button and configure the keystore to specify the alias
                    identifying the service certificate and private key. For
                    the GlassFish keystores, the file is
                    <code class="code">keystore.jks</code> and the alias is
                    <code class="code">xws-security-server</code>, assuming that you've
                    updated the GlassFish default certificate stores.</p></li><li class="listitem"><p><span class="emphasis"><em>Truststore</em></span> : If this column has
                    an X, select Use Development Defaults, or click the
                    Truststore button and configure the truststore to specify
                    the alias that contains the certificate and trusted roots
                    of the client. For the GlassFish keystores, the file is
                    <code class="code">cacerts.jks</code> and the alias is
                    <code class="code">xws-security-client</code> , assuming that you've
                    updated the GlassFish default certificate stores.</p></li><li class="listitem"><p><span class="emphasis"><em>STS</em></span> : If this column has an X,
                    you must have a Security Token Service that can be
                    referenced by the service. An example of an STS can be
                    found in the section <a class="xref" href="ch12.html#gfrlq" title="To Create and Secure the STS (STS)">To Create and Secure the STS (STS)</a> . The STS is secured using a
                    separate (non-STS) security mechanism. The security
                    configuration for the client-side of this application is
                    dependent upon the security mechanism selected for the
                    STS, and not on the security mechanism selected for the
                    application.</p></li><li class="listitem"><p><span class="emphasis"><em>SSL</em></span> : To use a mechanism that
                    uses secure transport (SSL), you must configure the
                    <span class="emphasis"><em>system</em></span> to point to the client and
                    server keystore and truststore files. Steps for doing this
                    are described in <a class="xref" href="ch12.html#ahidi" title="12.4.1.&nbsp;Configuring SSL For Your Applications">Configuring SSL For Your Applications</a> .</p></li><li class="listitem"><p><span class="emphasis"><em>User in Glassfish</em></span> : To use a
                    mechanism that requires a user database for
                    authentication, you can add a user to the file realm of
                    GlassFish. Select Use Development Defaults, or follow the
                    instructions for doing this at <a class="xref" href="ch12.html#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a> .</p></li><li class="listitem"><p><span class="emphasis"><em>Kerberos</em></span> : This option is only
                    valid for 'Symmetri Binding with Kerberos Tokens' Profile.
                    Click the Kerbeos button to specify the login module to be
                    used for this service. Login Modules can be specified in
                    $GLASSFISH_HOME/domains/domain1/config/login.conf for
                    Glassfish. An example showing use of Kerberos Tokens can
                    be found at <a class="xref" href="ch12.html#gfzhh" title="12.9.10.&nbsp;Example: Kerberos Token (Kerb)">Example: Kerberos Token (Kerb)</a>.</p></li></ul></div></div><div class="section" title="12.2.2.&nbsp;Summary of Client-Side Configuration Requirements"><div class="titlepage"><div><div><h3 class="title"><a name="ahicp"></a>12.2.2.&nbsp;Summary of Client-Side Configuration Requirements</h3></div></div></div><p><a class="xref" href="ch12.html#ahicq" title="Table&nbsp;12.2.&nbsp;Summary of Client-Side Configuration Requirements">Summary of Client-Side Configuration
                Requirements</a> summarizes
            the options that need to be configured for each of the security
            mechanisms on the client-side. Each of the columns is briefly
            discussed after the table.</p><div class="table"><a name="ahicq"></a><p class="title"><b>Table&nbsp;12.2.&nbsp;Summary of Client-Side Configuration
                Requirements</b></p><div class="table-contents"><table summary="Summary of Client-Side Configuration&#xA;                Requirements" border="1"><colgroup><col><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"><col align="center"></colgroup><thead><tr><th><p>Mechanism</p></th><th align="center"><p>Keystore</p></th><th align="center"><p>Truststore</p></th><th align="center"><p>Default User</p></th><th align="center"><p>SAML Callback Handler</p></th><th align="center"><p>STS</p></th><th align="center"><p>SSL</p></th><th align="center"><p>User in GlassFish</p></th><th align="center"><p>Kerberos</p></th></tr></thead><tbody><tr><td><p>Username Authentication with Symmetric
                            Key</p></td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td></tr><tr><td><p>Username Authentication with Password
                            Derived Keys</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td></tr><tr><td><p>Mutual Certificates</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>Symmetric Binding with Kerberos
                            Tokens</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td></tr><tr><td><p>Transport Security</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td></tr><tr><td><p>Message Authentication over SSL -
                            Username Token</p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td></tr><tr><td><p>Message Authentication over SSL - X.509
                            Token</p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>SAML Authorization over
                            SSL</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>Endorsing Certificate</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>SAML Sender Vouches with
                            Certificate</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>SAML Holder of Key</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>STS Issued Token</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>STS Issued Token with Service
                            Certificate</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr><tr><td><p>STS Issued Endorsing
                            Token</p></td><td align="center"><p> X </p></td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center"><p> X </p></td><td align="center">&nbsp;</td><td align="center">&nbsp;</td><td align="center">&nbsp;</td></tr></tbody></table></div></div><br class="table-break"><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Keystore</em></span>: If this column has an
                    X, select Use Development Defaults, or click Keystore to
                    configure the keystore to point to the alias for the
                    client certificate. For the GlassFish keystores, the
                    keystore file is <code class="code">keystore.jks</code> and the alias
                    is <code class="code">xws-security-client</code>, assuming that you've
                    updated the GlassFish default certificate stores.</p></li><li class="listitem"><p><span class="emphasis"><em>Truststore</em></span>: If this column has
                    an X, select Use Development Defaults, or click Truststore
                    to configure the truststore that contains the certificate
                    and trusted roots of the server. For the GlassFish
                    keystores, the file is <code class="code">cacerts.jks</code> and the
                    alias is <code class="code">xws-security-server</code> , assuming that
                    you've updated the GlassFish default certificate stores as
                    described in <a class="xref" href="ch12.html#gfrgz" title="To Manually Update GlassFish Certificates">To Manually Update GlassFish Certificates</a>.</p><p>When using an STS mechanism, the client specifies
                    the truststore and certificate alias for the STS, not the
                    service. For the GlassFish stores, the file is
                    <code class="code">cacerts.jks</code> and the alias is
                    <code class="code">wssip</code>.</p></li><li class="listitem"><p><span class="emphasis"><em>Default User</em></span>: When this column
                    has an X, you must configure either a default username and
                    password, a UsernameCallbackHandler, or leave these
                    options blank and specify a user at runtime. More
                    information on these options can be found at <a class="xref" href="ch12.html#ahicr" title="12.2.2.1.&nbsp;Configuring Username Authentication on the Client">Configuring Username Authentication on the
                Client</a>.</p></li><li class="listitem"><p><span class="emphasis"><em>SAML Callback Handler</em></span> : When
                    this column has an X, you must specify a SAML Callback
                    Handler. Examples of SAML Callback Handlers are described
                    in <a class="xref" href="ch12.html#ahict" title="12.2.2.2.&nbsp;Example SAML Callback Handlers">Example SAML Callback Handlers</a>.</p></li><li class="listitem"><p><span class="emphasis"><em>STS</em></span> : If this column has an X,
                    you must have a Security Token Service that can be
                    referenced by the service. An example of an STS can be
                    found in the section<a class="xref" href="ch12.html#gfrlq" title="To Create and Secure the STS (STS)">To Create and Secure the STS (STS)</a>. The STS is secured using a
                    separate (non-STS) security mechanism. The security
                    configuration for the client-side of this application is
                    dependent upon the security mechanism selected for the
                    STS, and not on the security mechanism selected for the
                    application. Note that on the service side, it is
                    optionally to set Issuer for the STS to be used. You only
                    need to configure the STS information on the client side
                    if Issuer if not available in the service wsdl. If both
                    configured, the service side Issuer takes high
                    priority.</p></li><li class="listitem"><p><span class="emphasis"><em>SSL</em></span> : To use a mechanism that
                    uses secure transport (SSL), you must configure the system
                    to point to the client and server keystore and truststore
                    files. Steps for doing this are described in <a class="xref" href="ch12.html#ahidi" title="12.4.1.&nbsp;Configuring SSL For Your Applications">Configuring SSL For Your Applications</a>.</p></li><li class="listitem"><p><span class="emphasis"><em>User in Glassfish</em></span>: To use a
                    mechanism that requires a user database for
                    authentication, select Use Development Defaults, or add a
                    user to the <code class="code">file</code> realm of GlassFish.
                    Instructions for doing this can be found at <a class="xref" href="ch12.html#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a>.</p></li><li class="listitem"><p><span class="emphasis"><em>Kerberos</em></span>: This option is only
                    valid for 'Symmetric Binding with Kerberos Tokens'
                    profile. Click Kerberos button to configure the Login
                    Module and Service Principal to be used by client, and if
                    credential delegation should be set. An example showing
                    use of Kerberos Tokens can be found at <a class="xref" href="ch12.html#gfzhh" title="12.9.10.&nbsp;Example: Kerberos Token (Kerb)">Example: Kerberos Token (Kerb)</a>.</p></li></ul></div><div class="section" title="12.2.2.1.&nbsp;Configuring Username Authentication on the Client"><div class="titlepage"><div><div><h4 class="title"><a name="ahicr"></a>12.2.2.1.&nbsp;Configuring Username Authentication on the
                Client</h4></div></div></div><p>On the client side, a user name and password must be
                configured for some of the security mechanisms. For this
                purpose, you can use the default Username and Password
                Callback Handlers (when deploying to GlassFish), specify a
                SAML Callback Handler, specify a default user name and
                password for development purposes, create and specify your own
                Callback Handlers if the container you are using does not
                provide defaults, or specify the username and password
                dynamically at runtime. When using any of these options, you
                must create an authorized user on GlassFish using the Admin
                Console, as described in <a class="xref" href="ch12.html#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a>.</p><div class="task" title="To Configure Username Authentication on the Client"><a name="gfrev"></a><p class="title"><b>To Configure Username Authentication on the
                    Client</b></p><div class="tasksummary">
                        <p>Once you've created an authorized user and
                        determined how your application needs to specify the
                        user, configure the Username Authentication options as
                        follows.</p>
                    </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>In the Projects window,
                            expand the node for the web service client.
                            </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Expand the Web Service
                            References node.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Right-click the node for
                            the web service reference for which you want to
                            configure security options. </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select Edit Web Service
                            Attributes.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select the Quality of
                            Service tab to display the WSIT Security options.
                            </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong>Expand the Security
                            section to specify the user name and password
                            information as required by the service. The dialog
                            appears as shown in <a class="xref" href="ch12.html#ahics" title="Figure&nbsp;12.3.&nbsp;Quality of Service - Client - Security">Quality of Service - Client -
                                    Security</a>. </strong></span> </p><div class="figure"><a name="ahics"></a><p class="title"><b>Figure&nbsp;12.3.&nbsp;Quality of Service - Client -
                                    Security</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/web_svc_ref_wsit.png" height="360" alt="Quality of Service - Client - Security"></td></tr></table></div></div></div><p><br class="figure-break"></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>The following options
                            are available.</strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Currently the GlassFish
                                    <code class="code">CallbackHandler</code> cannot handle the
                                    following: SAML Callbacks and Require ThumbPrint
                                    Reference assertions under an X.509 Token. This may
                                    be addressed in a future milestone.</p></div><ul class="stepalternatives">
                                <li class="step" title="Step 7.1"><p><span class="emphasis"><em>Use Development
                                    Defaults</em></span>:</p><p>Select this option to import certificates into
                                    the GlassFish keystore and truststore so that they
                                    can be used immediately for development. The WSIT
                                    message security mechanisms require the use of v3
                                    certificates. The default GlassFish keystore and
                                    truststore do not contain v3 certificates at this
                                    time. In order to use message security mechanisms
                                    with GlassFish, it is necessary to obtain keystore
                                    and truststore files that contain v3 certificates
                                    and import the appropriate certificates into the
                                    default GlassFish stores.</p><p>In addition to importing certificates, when
                                    this option is selected a default user is created in
                                    the <code class="code">file</code> realm with username
                                    <code class="code">wsitUser</code>.</p><p>In a production environment, you should
                                    provide your own certificates and user settings,
                                    however, in a development environment you may find
                                    these defaults useful.</p></li>

                                <li class="step" title="Step 7.2"><p><span class="emphasis"><em>Authentication
                                    Credentials</em></span>: Select Static or Dynamic.
                                    Select Static to supply a static username and
                                    password, or select Dynamic and specify the Username
                                    and Password CallbackHandlers. Select Static if you
                                    want to fill in the exact user credentials that the
                                    client is providing, and which cannot be changed
                                    after deployment. Static is useful to developing and
                                    testing applications prior to deployment. Select
                                    Dynamic to use CallbackHandlers to provide a dynamic
                                    way to provide credentials. Dynamic is useful if the
                                    credentials need to be obtained from some third
                                    party, for example, or if the developer doesn't want
                                    to store the user name and password in a
                                    configuration file because it might introduce a
                                    security risk.</p></li>

                                <li class="step" title="Step 7.3"><p><span class="emphasis"><em>Default Username</em></span>,
                                    <span class="emphasis"><em>Default Password</em></span> : These
                                    options are available when Static is selected as the
                                    Authentication Credential. Type the name of an
                                    authorized user and the password for this user. This
                                    option is best used only in the development
                                    environment. When the Default Username and Default
                                    Password are specified, the username and password
                                    are stored in the <code class="code">wsit-client.xml</code> file
                                    in clear text, which presents a security risk. Do
                                    not use this option for production.</p></li>

                                <li class="step" title="Step 7.4"><p><span class="emphasis"><em>Default Username Callback
                                    Handler</em></span>, <span class="emphasis"><em>Default Password
                                    Callback Handler</em></span> : These options are
                                    available when the Authentication Credential is
                                    Dynamic. If you create JSR-109-compliant web
                                    services and web service clients that run under an
                                    Application Server container (JSR-109 deployment),
                                    the container handles the callbacks and you do not
                                    need to configure Callback Handlers of your own. If
                                    you are using another container, select the Browse
                                    button to select the class implementing the
                                    <code class="code">javax.security.auth.callback.CallbackHandler</code>
                                    interface.</p></li>

                                <li class="step" title="Step 7.5"><p><span class="emphasis"><em>SAML Callback Handler</em></span> :
                                    To use a SAML Callback Handler, you need to create
                                    one, as there is no default. References to example
                                    SAML Callback Handlers are provided in <a class="xref" href="ch12.html#ahict" title="12.2.2.2.&nbsp;Example SAML Callback Handlers">Example SAML Callback Handlers</a>. An
                                    example that uses a SAML Callback Handler can be
                                    found in <a class="xref" href="ch12.html#ahies" title="12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)">Example: SAML Authorization over SSL (SA)</a>.</p></li>

                                <li class="step" title="Step 7.6"><p><span class="emphasis"><em>Timestamp Timeout</em></span>: This
                                    property specifies the duration(in seconds) for
                                    which timestamp should be considered valid. The
                                    default is 5 mins(300 seconds).</p></li>
                            </ul></li></ol></div></div></div><div class="section" title="12.2.2.2.&nbsp;Example SAML Callback Handlers"><div class="titlepage"><div><div><h4 class="title"><a name="ahict"></a>12.2.2.2.&nbsp;Example SAML Callback Handlers</h4></div></div></div><p>Creating a SAML Callback Handler is beyond the scope of
                this document. However, the following web pages may be helpful
                for this purpose:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>A client-side configuration, which includes a
                        SAML Callback Handler, can be viewed at the following
                        URL:</p><p><a class="link" href="http://java.net/projects/wsit/sources/svn/content/trunk/wsit/tests/e2e/testcases/xwss/s11/resources/wsit-client.xml" target="_top">http://java.net/projects/wsit/sources/svn/content/trunk/wsit/tests/e2e/testcases/xwss/s11/resources/wsit-client.xml</a></p></li><li class="listitem"><p>An example of a SAML Callback Handler can be
                        viewed and/or downloaded from the following
                        URL:</p><p><a class="link" href="http://xwss.java.net/servlets/ProjectDocumentList?folderID=6645&amp;expandFolder=6645&amp;folderID=6645" target="_top">http://xwss.java.net/servlets/ProjectDocumentList?folderID=6645&amp;expandFolder=6645&amp;folderID=6645</a></p></li><li class="listitem"><p>An example application in this tutorial that
                        uses a SAML Callback Handler can be found in <a class="xref" href="ch12.html#ahies" title="12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)">Example: SAML Authorization over SSL (SA)</a> .</p></li></ul></div><p>When writing SAML Callback Handlers for different
                security mechanisms, set the subject confirmation method to SV
                (Sender Vouches) or HOK (Holder of Key) and the appropriate
                SAML Assertion version depending on the SAML version and SAML
                Token Profile selected when setting the security mechanism for
                the service. When the subject confirmation method is HOK, a
                keystore and truststore file must be configured in the
                SAMLCallbackHandler. When the method is SV, you can either
                comment out the keystore and truststore information, or leave
                it, as it will not be used.</p><p>For example, the following code snippet for one of the
                SAMLCallbackHandlers listed above demonstrates how to set the
                subject confirmation method and sets the SAMLAssertion version
                to 1.0, profile 1.0.</p><div class="example"><a name="d0e6725"></a><p class="title"><b>Example&nbsp;12.1.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">if (callbacks[i] instanceof SAMLCallback) {
    try {

        SAMLCallback samlCallback = (SAMLCallback) callbacks[i];

        /*
         Set confirmation Method to SV [SenderVouches] or
         HOK[Holder of Key]
        */
        samlCallback.setConfirmationMethod(samlCallback
                .SV_ASSERTION_TYPE);

        if (samlCallback.getConfirmationMethod().equals
                (samlCallback.SV_ASSERTION_TYPE)) {
            
            samlCallback.setAssertionElement
                    (createSVSAMLAssertion());

            svAssertion_saml10 = samlCallback.getAssertionElement();
            /*
            samlCallback.setAssertionElement
                (createSVSAMLAssertion20());
            svAssertion_saml20 =
                 samlCallback.getAssertionElement();
            */
        } else if (samlCallback.getConfirmationMethod().equals
                (samlCallback.HOK_ASSERTION_TYPE)) {
            
            samlCallback.setAssertionElement
                    (createHOKSAMLAssertion());
            hokAssertion_saml10 = samlCallback
                    .getAssertionElement();
            /*
            samlCallback.setAssertionElement
                (createHOKSAMLAssertion20());
            hokAssertion_saml20 =
                 samlCallback.getAssertionElement();
            */
        }
    } catch (Exception e) {
        e.printStackTrace();
    }
} else {
    throw unsupportedCallback;
}</pre></div></div><br class="example-break"></div></div></div><div class="section" title="12.3.&nbsp;Security Mechanisms"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahicu"></a>12.3.&nbsp;Security Mechanisms</h2></div></div></div><p>This section describes security mechanisms you can implement
        with WSIT. This section provides an overview of the following
        mechanisms:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#ahicv" title="12.3.1.&nbsp;Username Authentication with Symmetric Key">Username Authentication with Symmetric Key</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahicv1" title="12.3.2.&nbsp;Username Authentication with Password Derived Keys">Username Authentication with Password Derived Keys</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahicw" title="12.3.3.&nbsp;Mutual Certificates Security">Mutual Certificates Security</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#SymmBindingKerberos" title="12.3.4.&nbsp;Symmetric Binding with Kerberos Tokens">Symmetric Binding with Kerberos Tokens</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahicx" title="12.3.5.&nbsp;Transport Security (SSL)">Transport Security (SSL)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahicz" title="12.3.6.&nbsp;Message Authentication over SSL">Message Authentication over SSL</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahida" title="12.3.7.&nbsp;SAML Authorization over SSL">SAML Authorization over SSL</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahidb" title="12.3.8.&nbsp;Endorsing Certificate">Endorsing Certificate</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahidc" title="12.3.9.&nbsp;SAML Sender Vouches with Certificates">SAML Sender Vouches with Certificates</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahidd" title="12.3.10.&nbsp;SAML Holder of Key">SAML Holder of Key</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahide" title="12.3.11.&nbsp;STS Issued Token">STS Issued Token</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahidf" title="12.3.12.&nbsp;STS Issued Token with Service Certificate">STS Issued Token with Service Certificate</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahidg" title="12.3.13.&nbsp;STS Issued Endorsing Token">STS Issued Endorsing Token</a></p></li></ul></div><p>A table that summarizes the configuration options on the server
        side is available in <a class="xref" href="ch12.html#ahicn" title="12.2.1.&nbsp;Summary of Service-Side Configuration Requirements">Summary of Service-Side Configuration Requirements</a>.</p><p>Some common communication issues that need to be addressed using
        security mechanisms are discussed in <a class="xref" href="ch13.html#ahiff" title="13.1.&nbsp;Using Security Mechanisms">Using Security Mechanisms</a>.</p><div class="section" title="12.3.1.&nbsp;Username Authentication with Symmetric Key"><div class="titlepage"><div><div><h3 class="title"><a name="ahicv"></a>12.3.1.&nbsp;Username Authentication with Symmetric Key</h3></div></div></div><p>The Username Authentication with Symmetric Key mechanism
            protects your application for integrity and confidentiality.
            Symmetric key cryptography relies on a single, shared secret key
            that is used to both sign and encrypt a message. Symmetric keys
            are usually faster than public key cryptography.</p><p>For this mechanism, the client does not possess any
            certificate/key of his own, but instead sends its
            username/password for authentication. The client shares a secret
            key with the server. The shared, symmetric key is generated at
            runtime and encrypted using the service's certificate. The client
            must specify the alias in the truststore by identifying the
            server's certificate alias.</p><p>See Also: <a class="xref" href="ch12.html#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a>.</p></div><div class="section" title="12.3.2.&nbsp;Username Authentication with Password Derived Keys"><div class="titlepage"><div><div><h3 class="title"><a name="ahicv1"></a>12.3.2.&nbsp;Username Authentication with Password Derived Keys</h3></div></div></div><p>This feature is same as "Username Authentication with
            Symmetric Key", except that the protection token is Username
            Token.This feature relies on a single, shared secret key that is
            derived using password, salt(a 16 byte random array),iterations(an
            int value).This key will be used for signing and encrypting a
            message.</p><p>For this mechanism, the client does not need to have any
            certificate/key of his own.A 160 bit secret key will be generated
            using password,salt and iterations. This secret key will be used
            for signature/encryption. In the request the username,salt and
            iterations will be send to the server.The server generates the
            same key using the password(which it already has),salt and
            iterations. Using this key the server is able to decrypt the
            message and verify the signature.The default value for iterations
            is 1000.Current Netbeans versions doesn't show this feature in the
            security features list.So for a detailed explanation about this
            feature and to know how to configure this , please visit the blog:
            <a class="link" href="http://blogs.sun.com/SureshMandalapu/entry/passwordderivedkeys_support_in_metro" target="_top">
            http://blogs.sun.com/SureshMandalapu/entry/passwordderivedkeys_support_in_metro
            </a></p></div><div class="section" title="12.3.3.&nbsp;Mutual Certificates Security"><div class="titlepage"><div><div><h3 class="title"><a name="ahicw"></a>12.3.3.&nbsp;Mutual Certificates Security</h3></div></div></div><p>The Mutual Certificates Security mechanism adds security
            through authentication and message protection that ensures
            integrity and confidentiality. When using mutual certificates, a
            keystore and truststore file must be configured for both the
            client and server sides of the application.</p><p>See Also: <a class="xref" href="ch12.html#ahiem" title="12.9.3.&nbsp;Example: Mutual Certificates Security (MCS)">Example: Mutual Certificates Security (MCS)</a>.</p></div><div class="section" title="12.3.4.&nbsp;Symmetric Binding with Kerberos Tokens"><div class="titlepage"><div><div><h3 class="title"><a name="SymmBindingKerberos"></a>12.3.4.&nbsp;Symmetric Binding with Kerberos Tokens</h3></div></div></div><p>Symmetric Binding with Kerberos Tokens does client
            authentication using Kerberos Tokens and integrity and
            confidentiality protection using symmetric keys generated with
            Kerberos V5 Protocol. This profile assumes that Kerberos
            authentication is supported by the underlying platform and a KDC
            is configured. When using Kerberos Tokens Profile, a Login Module
            must be configured for the service, and a Login Module and Service
            Principal must be specified for the client.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Kerberos is supported in Metro since 1.1 release.
                Netbeans support is available for Kerberos from Metro 1.3
                and Netbeans 6.5 release. Kerberos is NOT supported on AIX 
                systems.</p></div><p>See Also: <a class="xref" href="ch12.html#gfzhh" title="12.9.10.&nbsp;Example: Kerberos Token (Kerb)">Example: Kerberos Token (Kerb)</a>.</p></div><div class="section" title="12.3.5.&nbsp;Transport Security (SSL)"><div class="titlepage"><div><div><h3 class="title"><a name="ahicx"></a>12.3.5.&nbsp;Transport Security (SSL)</h3></div></div></div><p>The Transport Security mechanism protects your application
            during transport using SSL for authentication and confidentiality.
            Transport-layer security is provided by the transport mechanisms
            used to transmit information over the wire between clients and
            providers, thus transport-layer security relies on secure HTTP
            transport (HTTPS) using Secure Sockets Layer (SSL). Transport
            security is a point-to-point security mechanism that can be used
            for authentication, message integrity, and confidentiality. When
            running over an SSL-protected session, the server and client can
            authenticate one another and negotiate an encryption algorithm and
            cryptographic keys before the application protocol transmits or
            receives its first byte of data. Security is "live" from the time
            it leaves the consumer until it arrives at the provider, or vice
            versa. The problem is that it is not protected once it gets to its
            destination. For protection of data after it reaches its
            destination, use one of the security mechanisms that uses SSL and
            also secures data at the message level.</p><p>Digital certificates are necessary when running secure HTTP
            transport (HTTPS) using Secure Sockets Layer (SSL). The HTTPS
            service of most web servers will not run unless a digital
            certificate has been installed. Digital certificates have already
            been created for GlassFish, and the default certificates are
            sufficient for running this mechanism, and are required when using
            Atomic Transactions (see <a class="xref" href="ch18.html" title="Chapter&nbsp;18.&nbsp;Using Atomic Transactions"><i>Using Atomic Transactions</i></a> ). However, the message security
            mechanisms require a newer version of certificates than is
            available with GlassFish. You can download valid keystore and
            truststore files for the client and server as described in <a class="xref" href="ch12.html#gfrgz" title="To Manually Update GlassFish Certificates">To Manually Update GlassFish Certificates</a>.</p><p>To use this mechanism, follow the steps in <a class="xref" href="ch12.html#ahidi" title="12.4.1.&nbsp;Configuring SSL For Your Applications">Configuring SSL For Your Applications</a>.</p><p>See Also: <a class="xref" href="ch12.html#ahiep" title="12.9.4.&nbsp;Example: Transport Security (SSL)">Example: Transport Security (SSL)</a>.</p><div class="section" title="12.3.5.1.&nbsp;Transport Security (SSL) Workaround"><div class="titlepage"><div><div><h4 class="title"><a name="ahicy"></a>12.3.5.1.&nbsp;Transport Security (SSL) Workaround</h4></div></div></div><p>This note applies to cases where <code class="code">https</code> is
                the transport protocol used between a WSIT client and a secure
                web service using transport binding, and you are referencing
                <code class="code">localhost</code> when creating the client.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you use the fully-qualified hostname (FQHN) in
                    the URL for the service WSDL when you are adding the web
                    service client to the client application, this workaround
                    is not required. It is only required when you specify
                    <code class="code">localhost</code> in the URL for the service
                    WSDL.</p></div><p>During <span class="emphasis"><em>development</em></span> (not production)
                it is sometimes convenient to use certificates whose CN
                (Common Name) does <span class="emphasis"><em>not</em></span> match the host
                name in the URL.</p><p>A developer would want to use a CN which is different
                from the host name in the URL in WSIT when using
                <code class="code">https</code> addresses in Dispatch clients and during
                <code class="code">wsimport</code> . The below mentioned workaround is only
                for the Dispatch clients, which are also used in WS-Trust to
                communicate with STS. This has to be done even if the client's
                main service is not on https, but only the STS is on
                https.</p><p>Java by default verifies that the certificate CN (Common
                Name) is the same as host name in the URL. If the CN in the
                certificate is not the same as the host name, your web service
                client fails with the following exception:</p><div class="example"><a name="d0e6876"></a><p class="title"><b>Example&nbsp;12.2.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">javax.xml.ws.WebServiceException: java.io.IOException:
HTTPS hostname wrong: should be &lt;hostname as in the certificate&gt;</pre></div></div><br class="example-break"><p>The recommended way to overcome this issue is to
                generate the server certificate with the Common Name (CN)
                matching the host name.</p><p>To work around this only during development, in your
                client code, you can set the default host name verifier to a
                custom host name verifier which does a custom check. An
                example is given below. It is sometimes necessary to include
                this in the static block of your main Java class as shown
                below to set this verifier before any connections are made to
                the server.</p><div class="example"><a name="d0e6883"></a><p class="title"><b>Example&nbsp;12.3.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">static {
    //WORKAROUND. TO BE REMOVED.
    javax.net.ssl.HttpsURLConnection.setDefaultHostnameVerifier(
            new javax.net.ssl.HostnameVerifier(){
                public boolean verify(String hostname,
                                      javax.net.ssl.SSLSession sslSession) {
                    if (hostname.equals("mytargethostname")) {
                        return true;
                    }
                    return false;
                }
            });
}             </pre></div></div><br class="example-break"><p>Please remember to remove this code once you install
                valid certificates on the server.</p></div></div><div class="section" title="12.3.6.&nbsp;Message Authentication over SSL"><div class="titlepage"><div><div><h3 class="title"><a name="ahicz"></a>12.3.6.&nbsp;Message Authentication over SSL</h3></div></div></div><p>The Message Authentication over SSL mechanism attaches a
            cryptographically secured identity or authentication token with
            the message and use SSL for confidentiality protection.</p><p>By default, a Username Supporting Token will be used for
            message authentication. To use an X.509 Supporting Token instead,
            click the Configure button and select X509. Under this scenario,
            you will need to configure your system for using SSL as described
            in <a class="xref" href="ch12.html#ahidi" title="12.4.1.&nbsp;Configuring SSL For Your Applications">Configuring SSL For Your Applications</a>.</p></div><div class="section" title="12.3.7.&nbsp;SAML Authorization over SSL"><div class="titlepage"><div><div><h3 class="title"><a name="ahida"></a>12.3.7.&nbsp;SAML Authorization over SSL</h3></div></div></div><p>The SAML Authorization over SSL mechanism attaches an
            authorization token with the message and uses SSL for
            confidentiality protection. In this mechanism, the SAML token is
            expected to carry some authorization information about an end
            user. The sender of the token is actually vouching for the
            credentials in the SAML token.</p><p>To use this mechanism, configure SSL on the server, as
            described in <a class="xref" href="ch12.html#ahidi" title="12.4.1.&nbsp;Configuring SSL For Your Applications">Configuring SSL For Your Applications</a>,
            and, on the clients side, configure a SAMLCallbackHandler as
            described in <a class="xref" href="ch12.html#ahict" title="12.2.2.2.&nbsp;Example SAML Callback Handlers">Example SAML Callback Handlers</a>.</p><p>See Also: <a class="xref" href="ch12.html#ahies" title="12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)">Example: SAML Authorization over SSL (SA)</a>.</p></div><div class="section" title="12.3.8.&nbsp;Endorsing Certificate"><div class="titlepage"><div><div><h3 class="title"><a name="ahidb"></a>12.3.8.&nbsp;Endorsing Certificate</h3></div></div></div><p>This mechanism uses secure messages using symmetric key for
            integrity and confidentiality protection, and uses an endorsing
            client certificate to augment the claims provided by the token
            associated with the message signature. For this mechanism, the
            client knows the service's certificate, and requests need to be
            endorsed/authorized by a special identity. For example, all
            requests to a vendor must be endorsed by a purchase manager, so
            the certificate of the purchase manager should be used to endorse
            (or counter sign) the original request.</p></div><div class="section" title="12.3.9.&nbsp;SAML Sender Vouches with Certificates"><div class="titlepage"><div><div><h3 class="title"><a name="ahidc"></a>12.3.9.&nbsp;SAML Sender Vouches with Certificates</h3></div></div></div><p>This mechanism protects messages with mutual certificates
            for integrity and confidentiality and with a Sender Vouches SAML
            token for authorization. The Sender Vouches method establishes the
            correspondence between a SOAP message and the SAML assertions
            added to the SOAP message. The attesting entity provides the
            confirmation evidence that will be used to establish the
            correspondence between the subject of the SAML subject statements
            (in SAML assertions) and SOAP message content. The attesting
            entity, presumed to be different from the subject, vouches for the
            verification of the subject. The receiver has an existing trust
            relationship with the attesting entity. The attesting entity
            protects the assertions (containing the subject statements) in
            combination with the message content against modification by
            another party. For more information about the Sender Vouches
            method, read the SAML Token Profile document at <a class="link" href="http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.0.pdf" target="_top">http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.0.pdf</a>
            .</p><p>For this mechanism, the SAML token is included as part of
            the message signature as an authorization token and is sent only
            to the recipient. The message payload needs to be signed and
            encrypted. The requestor is vouching for the credentials (present
            in the SAML assertion) of the entity on behalf of which the
            requestor is acting.</p><p>The initiator token, which is an X.509 token, is used for
            signature. The recipient token, which is also an X.509 token, is
            used for encryption. For the server, this is reversed, the
            recipient token is the signature token and the initiator token is
            the encryption token. A SAML token is used for
            authorization.</p><p>See Also: <a class="xref" href="ch12.html#ahiev" title="12.9.6.&nbsp;Example: SAML Sender Vouches with Certificates (SV)">Example: SAML Sender Vouches with Certificates (SV)</a>.</p></div><div class="section" title="12.3.10.&nbsp;SAML Holder of Key"><div class="titlepage"><div><div><h3 class="title"><a name="ahidd"></a>12.3.10.&nbsp;SAML Holder of Key</h3></div></div></div><p>This mechanism protects messages with a signed SAML
            assertion (issued by a trusted authority) carrying client public
            key and authorization information with integrity and
            confidentiality protection using mutual certificates. The
            Holder-of-Key (HOK) method establishes the correspondence between
            a SOAP message and the SAML assertions added to the SOAP message.
            The attesting entity includes a signature that can be verified
            with the key information in the confirmation method of the subject
            statements of the SAML assertion referenced for key info for the
            signature. For more information about the Holder of Key method,
            read the SAML Token Profile document at <a class="link" href="http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.0.pdf" target="_top">http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.0.pdf</a>
            .</p><p>Under this scenario, the service does not trust the client
            directly, but requires the client to send a SAML assertion issued
            by a particular SAML authority. The client knows the recipient's
            public key, but does not share a direct trust relationship with
            the recipient. The recipient has a trust relationship with the
            authority that issues the SAML token. The request is signed with
            the client's private key and encrypted with the server
            certificate. The response is signed using the server's private key
            and encrypted using the key provided within the HOK SAML
            assertion.</p></div><div class="section" title="12.3.11.&nbsp;STS Issued Token"><div class="titlepage"><div><div><h3 class="title"><a name="ahide"></a>12.3.11.&nbsp;STS Issued Token</h3></div></div></div><p>This security mechanism protects messages using a token
            issued by a trusted Secure Token Service (STS) for message
            integrity and confidentiality protection.</p><p>An STS is a service that implements the protocol defined in
            the WS-Trust specification (you can find a link to this
            specification at <a class="link" href="http://wsit.java.net/" target="_top">http://wsit.java.net/</a> ).
            This protocol defines message formats and message exchange
            patterns for issuing, renewing, canceling, and validating security
            tokens.</p><p>Service providers and consumers are in potentially different
            managed environments but use a single STS to establish a chain of
            trust. The service does not trust the client directly, but instead
            trusts tokens issued by a designated STS. In other words, the STS
            is taking on the role of a second service with which the client
            has to securely authenticate. The issued tokens contain a key,
            which is encrypted for the server and which is used for deriving
            new keys for signing and encrypting.</p><p>To use this mechanism for the web service, you simply select
            this option as your security mechanism. However, you must have a
            Security Token Service that can be referenced by the service. An
            example of an STS can be found in the section <a class="xref" href="ch12.html#gfrlq" title="To Create and Secure the STS (STS)">To Create and Secure the STS (STS)</a> . In this section, you
            select a security mechanism for the STS. The security
            configuration for the client-side of this application is dependent
            upon the security mechanism selected for the STS, and not on the
            security mechanism selected for the application. The client
            truststore must contain the certificate of the STS, which has the
            alias of <code class="code">wssip</code> if you are using the updated GlassFish
            certificates.</p><p>See Also: <a class="xref" href="ch12.html#ahiey" title="12.9.7.&nbsp;Example: STS Issued Token (STS)">Example: STS Issued Token (STS)</a>.</p></div><div class="section" title="12.3.12.&nbsp;STS Issued Token with Service Certificate"><div class="titlepage"><div><div><h3 class="title"><a name="ahidf"></a>12.3.12.&nbsp;STS Issued Token with Service Certificate</h3></div></div></div><p>This security mechanism is similar to the one discussed in
            <a class="xref" href="ch12.html#ahide" title="12.3.11.&nbsp;STS Issued Token">STS Issued Token</a> , with the
            difference being that in addition to the service requiring the
            client to authenticate using a SAML token issued by a designated
            STS, confidentiality protection is achieved using a service
            certificate. A service certificate is Unhandled tag caution used
            by a client to authenticate the service and provide message
            protection. For GlassFish, a default certificate of
            <code class="code">s1as</code> is installed.</p><p>To use this mechanism for the web service, you simply select
            this option as your security mechanism. However, you must have a
            Security Token Service that can be referenced by the service. An
            example of an STS can be found in the section <a class="xref" href="ch12.html#gfrlq" title="To Create and Secure the STS (STS)">To Create and Secure the STS (STS)</a> . In this section, you
            select a security mechanism for the STS. The security
            configuration for the client-side of this application is dependent
            upon the security mechanism selected for the STS, and not on the
            security mechanism selected for the application. The client
            truststore must contain the certificate of the STS, which has the
            alias of <code class="code">wssip</code> if you are using the updated GlassFish
            certificates.</p></div><div class="section" title="12.3.13.&nbsp;STS Issued Endorsing Token"><div class="titlepage"><div><div><h3 class="title"><a name="ahidg"></a>12.3.13.&nbsp;STS Issued Endorsing Token</h3></div></div></div><p>This security mechanism is similar to the one discussed in
            <a class="xref" href="ch12.html#ahide" title="12.3.11.&nbsp;STS Issued Token">STS Issued Token</a> , with the
            difference being that the client authenticates using a SAML token
            that is issued by a designated STS. An endorsing token is used to
            sign the message signature.</p><p>In this mechanism, message integrity and confidentiality are
            protected using ephemeral keys encrypted for the service.
            Ephemeral keys use an algorithm where the exchange key value is
            purged from the cryptographic service provider (CSP) when the key
            handle is destroyed. The service requires messages to be endorsed
            by a SAML token issued by a designated STS.</p><p>Service providers and consumers are in potentially different
            managed environments. For this mechanism, the service requires
            that secure communications be endorsed by a trusted STS. The
            service does not trust the client directly, but instead trusts
            tokens issued by a designated STS. In other words, the STS is
            taking on the role of a second service with which the client has
            to securely authenticate.</p><p>For this mechanism, authentication of the client is achieved
            in this way:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>The client authenticates with the STS and obtains
                    the necessary token with credentials.</p></li><li class="listitem"><p>The client's request is signed and encrypted using
                    ephemeral key K.</p></li><li class="listitem"><p>The server's response is signed and encrypted using
                    the same K.</p></li><li class="listitem"><p>The primary signature of the request is endorsed
                    using the issued token.</p></li></ul></div><p>To use this mechanism for the web service, you simply select
            this option as your security mechanism. However, you must have a
            Security Token Service that can be referenced by the service. An
            example of an STS can be found in the section <a class="xref" href="ch12.html#gfrlq" title="To Create and Secure the STS (STS)">To Create and Secure the STS (STS)</a> . In this section, you
            select a security mechanism for the STS. The security
            configuration for the client-side of this application is dependent
            upon the security mechanism selected for the STS, and not on the
            security mechanism selected for the application. The client
            truststore must contain the certificate of the STS, which has the
            alias of <code class="code">wssip</code> if you are using the updated GlassFish
            certificates.</p></div></div><div class="section" title="12.4.&nbsp;Configuring SSL and Authorized Users"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahidh"></a>12.4.&nbsp;Configuring SSL and Authorized Users</h2></div></div></div><p>This section discusses configuring security for your web service
        and web service client using the WSIT security mechanisms. Some of
        these mechanisms require some configuration outside of NetBeans IDE.
        Depending upon which security mechanism you plan to use, some of the
        following tasks will need to be completed:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>If you are using the GlassFish container and
                <span class="emphasis"><em>message</em></span> security, you must update the
                GlassFish keystore and truststore by importing v3
                certificates. The procedure for updating the certificates is
                described in <a class="xref" href="ch12.html#gfrgz" title="To Manually Update GlassFish Certificates">To Manually Update GlassFish Certificates</a>.</p></li><li class="listitem"><p>If you are using a security mechanism that requires a
                user to enter a user name and password, create authorized
                users for your container. Steps for creating an authorized
                user for the GlassFish container are described in <a class="xref" href="ch12.html#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a>.</p></li><li class="listitem"><p>To use a mechanism that uses secure transport (SSL), you
                must configure the <span class="emphasis"><em>system</em></span> to point to the
                client and server keystore and truststore files. Steps for
                doing this are described in <a class="xref" href="ch12.html#ahidi" title="12.4.1.&nbsp;Configuring SSL For Your Applications">Configuring SSL For Your Applications</a>.</p></li></ul></div><p>This section covers the following topics:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#ahidi" title="12.4.1.&nbsp;Configuring SSL For Your Applications">Configuring SSL For Your Applications</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a></p></li></ul></div><div class="section" title="12.4.1.&nbsp;Configuring SSL For Your Applications"><div class="titlepage"><div><div><h3 class="title"><a name="ahidi"></a>12.4.1.&nbsp;Configuring SSL For Your Applications</h3></div></div></div><p>This section describes adding the steps to configure your
            application for SSL. These steps will need to be accomplished for
            any application that uses one of the mechanisms:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#ahicx" title="12.3.5.&nbsp;Transport Security (SSL)">Transport Security (SSL)</a>
                    (see <a class="xref" href="ch12.html#ahiep" title="12.9.4.&nbsp;Example: Transport Security (SSL)">Example: Transport Security (SSL)</a>
                    )</p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahicz" title="12.3.6.&nbsp;Message Authentication over SSL">Message Authentication over SSL</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahida" title="12.3.7.&nbsp;SAML Authorization over SSL">SAML Authorization over SSL</a>
                    (see <a class="xref" href="ch12.html#ahies" title="12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)">Example: SAML Authorization over SSL (SA)</a>
                    )</p></li></ul></div><div class="task" title="To Configure SSL for Your Application"><a name="gfrgq"></a><p class="title"><b>To Configure SSL for Your Application</b></p><div class="tasksummary">
                    <p>The following steps are generic to any application,
                    but have example configurations that will work with the
                    tutorial examples, in particular, <a class="xref" href="ch12.html#ahies" title="12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)">Example: SAML Authorization over SSL (SA)</a> and <a class="xref" href="ch12.html#ahiep" title="12.9.4.&nbsp;Example: Transport Security (SSL)">Example: Transport Security (SSL)</a>.</p>

                    <p>To configure SSL for your application, follow these
                    steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Select one of the
                        mechanisms that require SSL.</strong></span></p><p>These include <a class="xref" href="ch12.html#ahicx" title="12.3.5.&nbsp;Transport Security (SSL)">Transport Security (SSL)</a>, <a class="xref" href="ch12.html#ahicz" title="12.3.6.&nbsp;Message Authentication over SSL">Message Authentication over SSL</a>, and<a class="xref" href="ch12.html#ahida" title="12.3.7.&nbsp;SAML Authorization over SSL">SAML Authorization over SSL</a>.</p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Server
                        Configuration</strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 2.1"><p>GlassFish is already configured for SSL. No
                                further SSL configuration is necessary if you are
                                using Transport Security. However, if you are using
                                one of the Message Security mechanisms with SSL, you
                                must update the GlassFish certificates as described
                                in <a class="xref" href="ch12.html#gfrgz" title="To Manually Update GlassFish Certificates">To Manually Update GlassFish Certificates</a>.</p></li>

                            <li class="step" title="Step 2.2"><p>Configure a user on GlassFish as described in
                                <a class="xref" href="ch12.html#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a>.</p></li>
                        </ul></li><li class="step" title="Step 3"><p><span class="bold"><strong>Client
                        Configuration</strong></span></p><p>For configuring your system for SSL in order to
                        work through the examples in this tutorial, the same
                        keystore and truststore files are used for both the
                        client and the service. This makes it unnecessary to
                        set system properties to point to the client stores,
                        as both GlassFish and NetBeans IDE are aware of these
                        certificates and point to them by default.</p><p>In general, for the client side of SSL you will
                        not be using the same certificates for the client and
                        the service. In that case, you need to define the
                        client certificate stores by setting the system
                        properties <code class="code">-Djavax.net.ssl.trustStore</code> ,
                        <code class="code">-Djavax.net.ssl.keyStore</code> ,
                        <code class="code">-Djavax.net.ssl.trustStorePassword</code> , and
                        <code class="code">-Djavax.net.ssl.keyStorePassword</code> in the
                        application client container.</p><p>You can specify the environment variables for
                        keystore and truststore by setting the environment
                        variable <code class="code">VMARGS</code> through the shell
                        environment or inside an Ant script, or by passing
                        them in when you start NetBeans IDE from the command
                        line. For example, in the latter case, you would
                        specify the property settings as follows:</p><pre class="programlisting"><span class="bold"><strong><span class="emphasis"><em>netbeans-install</em></span>/bin/netbeans.exe
-J-Djavax.net.ssl.trustStore=<span class="emphasis"><em>as-install</em></span>/domains/domain1/config/cacerts.jks
-J-Djavax.net.ssl.keyStore=<span class="emphasis"><em>as-install</em></span>/domains/domain1/config/keystore.jks
-J-Djavax.net.ssl.trustStorePassword=changeit
-J-Djavax.net.ssl.keyStorePassword=changeit</strong></span></pre><p>Use the hard-coded path to the keystore and
                        truststore files, not variables.</p><p>For the SSL mechanism, the browser will prompt
                        you to accept the server alias
                        <code class="code">s1as</code>.</p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Service
                        Configuration</strong></span></p><p>To require the service to use the HTTPS
                        protocol, you must select a security mechanism that
                        uses SSL (as described in a previous step), and you
                        have to specify the security requirements in the
                        service's application deployment descriptor. This file
                        is <code class="code">ejb-jar.xml</code> for a web service that is
                        implemented as an EJB endpoint, and
                        <code class="code">web.xml</code> for a web service implemented as
                        a servlet. To specify the security information, follow
                        these steps:</p><ol type="a" class="substeps"><li class="step" title="Step 4.a"><p><span class="bold"><strong>From your web service
                                application, expand Web Pages |
                                WEB-INF.</strong></span></p></li><li class="step" title="Step 4.b"><p><span class="bold"><strong> Double-click
                                <code class="code">web.xml</code> (or <code class="code">ejb-jar.xml</code> )
                                to open it in the editor. </strong></span></p></li><li class="step" title="Step 4.c"><p><span class="bold"><strong>Select the Security
                                tab.</strong></span></p></li><li class="step" title="Step 4.d"><p><span class="bold"><strong> On the Security
                                Constraints line, expand the node for SSL transport
                                for CalculatorWSService. This will display when a
                                security mechanism that requires SSL is selected.
                                This constraint will be sufficient for the example
                                applications. This sections walks you through making
                                some changes in the event that you would like to
                                customize the security constraint for your
                                application. </strong></span></p></li><li class="step" title="Step 4.e"><p><span class="bold"><strong>Under Web Resource
                                Collection, click Edit.</strong></span></p></li><li class="step" title="Step 4.f"><p><span class="bold"><strong> Change the URL Pattern
                                to be protected (for example, <code class="code">/*</code> ).
                                Select which HTTP Methods to protect, for example,
                                POST. Click OK to close this dialog.
                                </strong></span></p></li><li class="step" title="Step 4.g"><p><span class="bold"><strong> Unselect Enable
                                Authentication Constraint. Ensure that the Enable
                                User Data Constraint box is checked. Verify that
                                CONFIDENTIAL is selected for the Transport Guarantee
                                to specify that the application uses SSL because the
                                application requires that data be transmitted so as
                                to prevent other entities from observing the
                                contents of the transmission. </strong></span></p><p>The IDE appears as shown in <a class="xref" href="ch12.html#gfrgi" title="Figure&nbsp;12.4.&nbsp;Deployment Descriptor Page">Deployment Descriptor Page</a>.</p><div class="figure"><a name="gfrgi"></a><p class="title"><b>Figure&nbsp;12.4.&nbsp;Deployment Descriptor Page</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/security-web-xml.png" height="360" alt="Deployment Descriptor Page"></td></tr></table></div></div></div><br class="figure-break"></li><li class="step" title="Step 4.h"><p><span class="bold"><strong> Click the XML tab to
                                display the additions to <code class="code">web.xml</code> . The
                                security constraint looks like this:
                                </strong></span></p><div class="example"><a name="d0e7235"></a><p class="title"><b>Example&nbsp;12.4.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;security-constraint&gt;
    &lt;display-name&gt;Constraint1&lt;/display-name&gt;
    &lt;web-resource-collection&gt;
        &lt;web-resource-name&gt;CalcWebResource&lt;/web-resource-name&gt;
        &lt;description/&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
        &lt;http-method&gt;POST&lt;/http-method&gt;
    &lt;/web-resource-collection&gt;
    &lt;user-data-constraint&gt;
        &lt;description/&gt;
        &lt;transport-guarantee&gt;CONFIDENTIAL&lt;/transport-guarantee&gt;
    &lt;/user-data-constraint&gt;
&lt;/security-constraint&gt;</pre></div></div><br class="example-break"></li><li class="step" title="Step 4.i"><p><span class="bold"><strong> When you run this
                                project (right-click, select Run), the browser will
                                ask you to accept the server certificate of
                                <code class="code">s1as</code> . Accept this certificate. The
                                WSDL appears in the browser. </strong></span></p></li></ol></li><li class="step" title="Step 5"><p><span class="bold"><strong>Creating a
                        Client</strong></span></p><p>When creating your client application, use the
                        fully-qualified hostname to specify the secure WSDL
                        location (use <code class="code">https://</code>
                        <span class="emphasis"><em>fully_qualified_hostname</em></span>
                        <code class="code">:8181/CalculatorApplication/CalculatorWSService?wsdl</code>
                        , for example, in place of
                        <code class="code">http://localhost:8080/CalculatorApplication/CalculatorWSService?wsdl</code>
                        ).</p><p>In some cases, you might get an error dialog
                        telling you that the URL <code class="code">https://</code>
                        <span class="emphasis"><em>fully_qualified_hostname</em></span>
                        <code class="code">:8181/CalculatorApplication/CalculatorWSService?wsdl</code>
                        couldn't be downloaded. However, this is the correct
                        URL, and it does load when you run the service. So,
                        when this error occurs, repeat the steps that create
                        the Web Service Client using the secure WSDL. The
                        second time, the web service reference is created and
                        you can continue creating the client.</p></li></ol></div></div></div><div class="section" title="12.4.2.&nbsp;Adding Users to GlassFish"><div class="titlepage"><div><div><h3 class="title"><a name="ahidj"></a>12.4.2.&nbsp;Adding Users to GlassFish</h3></div></div></div><p>This section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#gfxzy" title="To Add a User to GlassFish for Development">To Add a User to GlassFish for Development</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrib" title="To Add Users to GlassFish Using the Admin Console">To Add Users to GlassFish Using the Admin
                Console</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrgr" title="To Add Users to GlassFish From the Command Line">To Add Users to GlassFish From the Command Line</a></p></li></ul></div><div class="task" title="To Add a User to GlassFish for Development"><a name="gfxzy"></a><p class="title"><b>To Add a User to GlassFish for Development</b></p><div class="tasksummary">
                    <p>To create a user in the GlassFish file realm to be
                    used for testing and development purposes, follow these
                    steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> In NetBeans IDE,
                        right-click the web service, select Edit Web Service
                        Attributes. </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Select Use Development
                        Defaults.</strong></span></p><p>In addition to setting up keystore and
                        truststore files, this option creates a default user
                        on GlassFish. The user has the name
                        <code class="code">wsitUser</code> and the password of
                        <code class="code">changeit</code> .</p></li></ol></div></div><div class="task" title="To Add Users to GlassFish Using the Admin Console"><a name="gfrib"></a><p class="title"><b>To Add Users to GlassFish Using the Admin
                Console</b></p><div class="tasksummary">
                    <p>To add users to GlassFish using the Admin Console,
                    follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Start GlassFish if you
                        haven't already done so.</strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong> Start the Admin Console
                        if you haven't already done so. </strong></span></p><p>You can start the Admin Console by starting a
                        web browser and specifying the URL
                        <code class="code">http://localhost:4848/asadmin</code> . If you
                        changed the default Admin port during installation,
                        type the correct port number in place of 4848.</p></li><li class="step" title="Step 3"><p><span class="bold"><strong> To log in to the Admin
                        Console, type the user name and password of a user in
                        the <code class="code">admin-realm</code> who belongs to the
                        <code class="code">asadmin</code> group. </strong></span></p><p>The name ( <code class="code">admin</code> ) and password (
                        <code class="code">adminadmin</code> ) entered during installation
                        will work, as will any users added to this realm and
                        group subsequent to installation.</p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Expand the Configuration
                        node in the Admin Console tree.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Expand the Security node
                        in the Admin Console tree.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Expand the Realms node,
                        then select the <code class="code">file</code> realm.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click the Manage Users
                        button.</strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong>Click New to add a new
                        user to the realm.</strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong> Type the correct
                        information into the User ID, Password, and Group(s)
                        fields. </strong></span></p><p>The example applications reference a user with
                        the following attributes:</p><ul class="stepalternatives">
                            <li class="step" title="Step 9.1"><p>User ID = <code class="code">wsitUser</code></p></li>

                            <li class="step" title="Step 9.2"><p>Group List = <code class="code">wsit</code></p></li>

                            <li class="step" title="Step 9.3"><p>New Password = <code class="code">changeit</code></p></li>

                            <li class="step" title="Step 9.4"><p>Confirm New Password =
                                <code class="code">changeit</code></p></li>
                        </ul></li><li class="step" title="Step 10"><p><span class="bold"><strong> Click OK to add this user
                        to the list of users in the realm. </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong>Click Logout when you have
                        completed this task.</strong></span></p></li></ol></div></div><div class="task" title="To Add Users to GlassFish From the Command Line"><a name="gfrgr"></a><p class="title"><b>To Add Users to GlassFish From the Command Line</b></p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Make sure GlassFish is
                        running, then type the following command: </strong></span>
                        </p><pre class="programlisting"><span class="bold"><strong><span class="emphasis"><em>as-install</em></span>/bin/asadmin create-file-user --groups wsit wsitUser</strong></span></pre></li><li class="step" title="Step 2"><p><span class="bold"><strong> When you are prompted for
                        the password, type <code class="code">changeit</code> .
                        </strong></span></p></li></ol></div></div></div></div><div class="section" title="12.5.&nbsp;Configuring Keystores and Truststores"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahidm"></a>12.5.&nbsp;Configuring Keystores and Truststores</h2></div></div></div><p>This section describes configuring keystores and truststores.
        Security mechanisms that use certificates require keystore and
        truststore files for deployment.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>For GlassFish, default keystore and truststore files
                come bundled. However, WSIT security mechanisms for
                <span class="emphasis"><em>message</em></span> security require X.509 version 3
                certificates. GlassFish contains version 1 certificates.
                Therefore, to enable the WSIT applications to run on
                GlassFish, you will need to follow the instructions in <a class="xref" href="ch12.html#gfrgz" title="To Manually Update GlassFish Certificates">To Manually Update GlassFish Certificates</a> .</p></li><li class="listitem"><p>For Tomcat, keystore and truststore files do not come
                bundled with this container, so they must be provided. You can
                download valid keystore and truststore files for the client
                and server from <a class="link" href="http://xwss.java.net/" target="_top">http://xwss.java.net/</a>
                .</p></li></ul></div><p>This section covers the following topics:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#gfxyu" title="To Automatically Update GlassFish Certificates">To Automatically Update GlassFish Certificates</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrgz" title="To Manually Update GlassFish Certificates">To Manually Update GlassFish Certificates</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahido" title="12.5.1.&nbsp;Specifying Aliases with the Updated Stores">Specifying Aliases with the Updated Stores</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahidr" title="12.5.2.&nbsp;Configuring the Keystore and Truststore">Configuring the Keystore and Truststore</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahidx" title="12.5.3.&nbsp;Configuring Validators">Configuring Validators</a></p></li></ul></div><div class="task" title="To Automatically Update GlassFish Certificates"><a name="gfxyu"></a><p class="title"><b>To Automatically Update GlassFish Certificates</b></p><div class="tasksummary">
                <p>You can have NetBeans automatically update the GlassFish
                certificates to the version needed to work with message
                security. To do this, follow these steps:</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> In NetBeans IDE, right-click
                    the web service, select Edit Web Service Attributes.
                    </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Secure
                    Service.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Select Use Development
                    Defaults.</strong></span></p><p>This option imports certificates into the GlassFish
                    keystore and truststore so that they can be used
                    immediately for development.</p><p>In a production environment, you should provide your
                    own certificates and user settings, however, in a
                    development environment you may find these defaults
                    useful.</p></li></ol></div></div><div class="task" title="To Manually Update GlassFish Certificates"><a name="gfrgz"></a><p class="title"><b>To Manually Update GlassFish Certificates</b></p><div class="tasksummary">
                <p>The WSIT message security mechanisms require the use of
                v3 certificates. The default GlassFish keystore and truststore
                Unhandled tag varname do not contain v3 certificates at this
                time (but should before FCS). (GlassFish instances installed
                using JDK 1.6 do have a v3 certificate but the certificate
                lacks a particular extension required for supporting some
                secure WSIT mechanisms.) In order to use message security
                mechanisms with GlassFish, it is necessary to download
                keystore and truststore files that contain v3 certificates and
                import the appropriate certificates into the default GlassFish
                stores.</p>

                <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The XWSS keystores are <span class="emphasis"><em>sample</em></span>
                    keystores containing sample v3 certificates. These sample
                    keystores can be used for development and testing of
                    security with WSIT technology. Once an application is in
                    production, you should definitely use your own v3
                    certificates issued by a trusted authority. In order to
                    use WSIT security on GlassFish, you will have to import
                    your trusted stores into GlassFish's keystore and specify
                    those certificates from NetBeans IDE.</p></div>

                <p>To manually update the GlassFish certificates, follow
                these steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Download the zip file that
                    contains the certificates and the Ant scripts (
                    <code class="code">copyv3.zip</code> ) by going to this URL:
                    </strong></span></p><p><a class="link" href="https://xwss.java.net/servlets/ProjectDocumentList?folderID=6645&amp;expandFolder=6645&amp;folderID=6645" target="_top">https://xwss.java.net/servlets/ProjectDocumentList?folderID=6645&amp;expandFolder=6645&amp;folderID=6645</a></p></li><li class="step" title="Step 2"><p><span class="bold"><strong> Unzip this file and change
                    into its directory, <code class="code">copyv3</code> .
                    </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Set the variable to the
                    location where GlassFish is installed, as described in the
                    <code class="code">README.txt</code> file in this directory.
                    </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> From the <code class="code">copyv3</code>
                    directory, execute the Ant command that will copy the
                    keystore and truststore files to the appropriate location,
                    and import the appropriate certificates into the GlassFish
                    keystore and truststore. </strong></span></p><p>This Ant command is as follows:</p><pre class="programlisting"><span class="bold"><strong><span class="emphasis"><em>as-install</em></span>/lib/ant/bin/ant</strong></span></pre><p>The command window will echo back the certificates
                    that are being added to the keystore and truststore files,
                    and should look something like this:</p><pre class="programlisting">[echo] WARNING: currently we add non-CA certs to GF truststore, this
will not be required in later releases when WSIT starts supporting CertStore(s)
[java] Added Key Entry  :xws-security-server
[java] Added Key Entry  :xws-security-client
[java] Added Trusted Entry  :xwss-certificate-authority
[java] Added Key Entry  :wssip
[java] Added Trusted Entry  :xws-security-client
[java] Added Trusted Entry  :xws-security-server
[java] Added Trusted Entry  :wssip
[echo] Adding JVM Option for https outbound alias, this will take at least
One Minute.
...</pre></li><li class="step" title="Step 5"><p><span class="bold"><strong> To verify that the updates
                    were successful, follow these steps: </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 5.a"><p><span class="bold"><strong> Change to the directory
                            containing the GlassFish keystore and truststore
                            files, <code class="code"> as-install /domains/domain1/config
                            </code> . </strong></span></p></li><li class="step" title="Step 5.b"><p><span class="bold"><strong> Verify that the v3
                            certificate has been imported into the GlassFish
                            truststore. To do this, run the following
                            <code class="code">keytool</code> command (all on one line):
                            </strong></span></p><pre class="programlisting"><span class="bold"><strong><span class="emphasis"><em>java-home</em></span>/bin/keytool -list -keystore cacerts.jks -alias wssip -storepass changeit</strong></span></pre><p>If the certificates are
                            <span class="emphasis"><em>successfully</em></span> updated, your
                            response will look something like this:</p><pre class="programlisting">wssip, Aug 20, 2007, trustedCertEntry,
Certificate fingerprint (MD5): 1A:0E:E9:69:7D:D0:80:AD:5C:85:47:91:EB:0D:11:B1</pre><p>If the certificates were
                            <span class="emphasis"><em>not</em></span> successfully update, your
                            response will look something like this:</p><pre class="programlisting">keytool error: java.lang.Exception: Alias &lt;wssip&gt; does not exist</pre></li><li class="step" title="Step 5.c"><p><span class="bold"><strong> Verify that the v3
                            certificate has been imported into the GlassFish
                            keystore. To do this, run the following
                            <code class="code">keytool</code> commands: </strong></span></p><pre class="programlisting"><span class="bold"><strong><span class="emphasis"><em>java-home</em></span>/bin/keytool -list -keystore keystore.jks
-alias xws-security-server -storepass changeit
<span class="emphasis"><em>java-home</em></span>/bin/keytool -list -keystore keystore.jks
-alias xws-security-client -storepass changeit</strong></span></pre><p>If the certificates were
                            <span class="emphasis"><em>successfully</em></span> updated, your
                            response should look something like this:</p><pre class="programlisting">xws-security-server, Aug 20, 2007, PrivateKeyEntry,
Certificate fingerprint (MD5): E4:E3:A9:02:3C:B0:36:0C:C1:48:6E:0E:3E:5C:5E:84</pre><p>If your certificates were
                            <span class="emphasis"><em>not</em></span> successfully updated, your
                            response will look more like this:</p><pre class="programlisting">keytool error: java.lang.Exception: Alias &lt;xws-security-server&gt; does not exist</pre></li></ol></li></ol></div></div><div class="section" title="12.5.1.&nbsp;Specifying Aliases with the Updated Stores"><div class="titlepage"><div><div><h3 class="title"><a name="ahido"></a>12.5.1.&nbsp;Specifying Aliases with the Updated Stores</h3></div></div></div><p>The configuration of the aliases for all containers (Tomcat,
            GlassFish) and for all applications (JSR-109-compliant and
            non-JSR-109-compliant), except for applications that use a
            Security Token Service (STS) mechanism, is as shown in <a class="xref" href="ch12.html#ahidp" title="Table&nbsp;12.3.&nbsp;Keystore and Truststore Aliases">Keystore and Truststore Aliases</a> .</p><div class="table"><a name="ahidp"></a><p class="title"><b>Table&nbsp;12.3.&nbsp;Keystore and Truststore Aliases</b></p><div class="table-contents"><table summary="Keystore and Truststore Aliases" border="1"><colgroup><col><col><col></colgroup><thead><tr><th><p></p></th><th><p>Keystore Alias</p></th><th><p>Truststore Alias</p></th></tr></thead><tbody><tr><td><p>Client-Side
                            Configuration</p></td><td><p>xws-security-client</p></td><td><p>xws-security-server</p></td></tr><tr><td><p>Server-Side
                            Configuration</p></td><td><p>xws-security-server</p></td><td><p>xws-security-client</p></td></tr></tbody></table></div></div><br class="table-break"><p>The configuration of the aliases for applications that use a
            Security Token Service (STS) mechanism is as shown in <a class="xref" href="ch12.html#ahidq" title="Table&nbsp;12.4.&nbsp;Keystore and Truststore Aliases for STS">Keystore and Truststore Aliases for STS</a> .</p><div class="table"><a name="ahidq"></a><p class="title"><b>Table&nbsp;12.4.&nbsp;Keystore and Truststore Aliases for STS</b></p><div class="table-contents"><table summary="Keystore and Truststore Aliases for STS" border="1"><colgroup><col><col><col></colgroup><thead><tr><th><p></p></th><th><p>Keystore Alias</p></th><th><p>Truststore Alias</p></th></tr></thead><tbody><tr><td><p>Client-Side
                            Configuration</p></td><td><p>xws-security-client</p></td><td><p>xws-security-server</p></td></tr><tr><td><p>STS Configuration</p></td><td><p>xws-security-client</p></td><td><p>wssip</p></td></tr></tbody></table></div></div><br class="table-break"></div><div class="section" title="12.5.2.&nbsp;Configuring the Keystore and Truststore"><div class="titlepage"><div><div><h3 class="title"><a name="ahidr"></a>12.5.2.&nbsp;Configuring the Keystore and Truststore</h3></div></div></div><p>NetBeans IDE already knows the location of the default
            keystore file and its password, but you need to specify which
            alias is to be used. The following sections discuss configuring
            the keystore on the service and on the client.</p><div class="task" title="To Configure the Keystore on a Service Automatically"><a name="gfxzl"></a><p class="title"><b>To Configure the Keystore on a Service
                Automatically</b></p><div class="tasksummary">
                    <p>To have NetBeans IDE configure the keystore to its
                    default values, follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> In NetBeans IDE,
                        right-click the web service, select Edit Web Service
                        Attributes. </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Select Use Development
                        Defaults.</strong></span></p><p>This option imports certificates into the
                        GlassFish keystore and truststore so that they can be
                        used immediately for development. This option also
                        inserts the location and alias of the keystore and
                        truststore files into the configuration file.</p><p>In a production environment, you should provide
                        your own certificates and user settings, however, in a
                        development environment you may find these defaults
                        useful.</p></li></ol></div></div><div class="task" title="To Configure the Keystore on a Service Manually"><a name="gfril"></a><p class="title"><b>To Configure the Keystore on a Service Manually</b></p><div class="tasksummary">
                    <p>A keystore is a database of private keys and their
                    associated X.509 certificate chains authenticating the
                    corresponding public keys. A key is a piece of information
                    that controls the operation of a cryptographic algorithm.
                    For example, in encryption, a key specifies the particular
                    transformation of plaintext into ciphertext, or vice versa
                    during decryption. Keys are used in digital signatures for
                    authentication.</p>

                    <p>To configure a keystore on a service, perform the
                    following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Check the table in <a class="xref" href="ch12.html#ahicn" title="12.2.1.&nbsp;Summary of Service-Side Configuration Requirements">Summary of Service-Side Configuration Requirements</a> to see if
                        a keystore needs to be configured for the selected
                        security mechanism. If so, continue.
                        </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong> Right-click the web
                        service and select Edit Web Service Attributes.
                        </strong></span></p><p>The Web Service Attributes editor is
                        displayed.</p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Enable Secure Service,
                        then select a security mechanism.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Check the table in <a class="xref" href="ch12.html#ahicn" title="12.2.1.&nbsp;Summary of Service-Side Configuration Requirements">Summary of Service-Side Configuration Requirements</a> to see
                        what keystore configuration, if any, is required for
                        that mechanism. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Unselect Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Click the Keystore
                        button. The dialog shown in <a class="xref" href="ch12.html#ahidt" title="Figure&nbsp;12.5.&nbsp;Keystore Configuration Dialog">Keystore Configuration Dialog</a> displays. </strong></span>
                        </p><div class="figure"><a name="ahidt"></a><p class="title"><b>Figure&nbsp;12.5.&nbsp;Keystore Configuration Dialog</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/security-keystore-configuration.png" height="360" alt="Keystore Configuration Dialog"></td></tr></table></div></div></div><p><br class="figure-break"></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Depending on what is
                        required for the selected mechanism, you may specify
                        the following information in the Keystore
                        Configuration dialog: </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 7.1"><p><span class="emphasis"><em>Keystore Password</em></span> :
                                Specifies the password for the keystore file. If you
                                are running under GlassFish, GlassFish's password is
                                already entered. If you have changed the keystore's
                                password from the default, you must specify the
                                correct value in this field.</p></li>

                            <li class="step" title="Step 7.2"><p><span class="emphasis"><em>Load Aliases</em></span> : Click the
                                Load Aliases button to populate the Alias field with
                                the aliases contained in the keystore file. The
                                Location and Store Password fields must be specified
                                correctly for this option to work.</p></li>

                            <li class="step" title="Step 7.3"><p><span class="emphasis"><em>Alias</em></span> : Specifies the
                                alias of the certificate in the specified keystore
                                to be used for authentication. Refer to the table in
                                <a class="xref" href="ch12.html#ahido" title="12.5.1.&nbsp;Specifying Aliases with the Updated Stores">Specifying Aliases with the Updated Stores</a> to
                                determine which alias to choose for the selected
                                security mechanism.</p></li>

                            <li class="step" title="Step 7.4"><p><span class="emphasis"><em>Key Password</em></span> : Specifies
                                the password of the key within the keystore. For
                                this sample, leave this blank. For this field, the
                                default assumes the key password is the same as the
                                store password, so you only need to specify this
                                field when the key password is different.</p></li>
                        </ul><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The Key Password field enables you to specify
                            a password for the keystore used by the application.
                            When specified, this password is stored in a WSIT
                            configuration file in clear text, which is a
                            security risk. Setting the keystore password in the
                            development environment is fine, however, when you
                            go into production, remember to use the container's
                            Callback Handler to obtain the keys from the
                            keystore. This eliminates the need for the keystore
                            passwords to be supplied by the users. You can also
                            specify the passwords for keystores and truststores
                            by specifying a Callback Handler class that
                            implements the
                            <code class="code">javax.security.auth.callback.CallbackHandler</code>
                            interface in the Key Password or Store Password
                            fields.</p></div><p>When creating JSR-109-compliant application,
                        GlassFish will only use the default CallbackHandlers
                        and Validators, and you cannot override the location
                        of the keystore and truststore files. Any attempt to
                        override the default location will be ignored. You do,
                        however, need to specify the keystore and truststore
                        locations in these dialogs in order to specify the
                        alias.</p><p>When creating non-JSR-109-compliant application,
                        you can specify the passwords for keystores and
                        truststores by specifying a
                        <code class="code">CallbackHandler</code> class that implements the
                        <code class="code">javax.security.auth.callback.CallbackHandler</code>
                        interface in the Key Password or Store Password
                        fields.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong>Click OK to close the
                        dialog.</strong></span></p></li></ol></div></div><div class="task" title="To Configure the Truststore on a Service Automatically"><a name="gfxyn"></a><p class="title"><b>To Configure the Truststore on a Service
                Automatically</b></p><div class="tasksummary">
                    <p>To have NetBeans IDE configure the truststore to its
                    default values, follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> In NetBeans IDE,
                        right-click the web service, select Edit Web Service
                        Attributes. </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Select Use Development
                        Defaults.</strong></span></p><p>This option imports certificates into the
                        GlassFish keystore and truststore so that they can be
                        used immediately for development. This option also
                        inserts the location and alias of the keystore and
                        truststore files into the configuration file, when
                        required for a selected security mechanism.</p><p>In a production environment, you should provide
                        your own certificates and user settings, however, in a
                        development environment you may find these defaults
                        useful.</p></li></ol></div></div><div class="task" title="To Configure the Truststore on a Service Manually"><a name="gfrgu"></a><p class="title"><b>To Configure the Truststore on a Service
                Manually</b></p><div class="tasksummary">
                    <p>A truststore is a database of trusted entities and
                    their associated X.509 certificate chains authenticating
                    the corresponding public keys.</p>

                    <p>The truststore contains the Certificate Authority
                    (CA) certificates and the certificates of the other party
                    to which this entity intends to send encrypted
                    (confidential) data. This file must contain the public key
                    certificates of the CA and the client's public key
                    certificate. Any kind of encryption without
                    WS-SecureConversation will generally require that a
                    truststore be configured on the client side. Any kind of
                    signature without WS-SecureConversation will generally
                    require a truststore on the server side.</p>

                    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>For this release, place the trusted certificates
                        of other parties in GlassFish's truststore,
                        <code class="code">cacerts.jks</code> . This is not normally a
                        recommended practice because any certificate you add
                        to the <code class="code">cacerts.jks</code> file effectively means
                        it can be a trusted root for any and all certificate
                        chains, which can be a security problem. In future
                        releases, trusted certificates from other parties will
                        be placed in a certstore, and only trusted roots will
                        be placed inside <code class="code">cacerts.jks</code> .</p></div>

                    <p>To set the truststore configuration options on a
                    service, perform the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Check the table in <a class="xref" href="ch12.html#ahicn" title="12.2.1.&nbsp;Summary of Service-Side Configuration Requirements">Summary of Service-Side Configuration Requirements</a> to see if
                        a truststore is required for the selected security
                        mechanism. If so, continue. </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong> Right-click the web
                        service and select Edit Web Service Attributes.
                        </strong></span></p><p>The Web Service Attributes editor is
                        displayed.</p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Enable Secure
                        Service.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Unselect Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Click the Truststore
                        button.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> On the Truststore
                        Configuration page, specify the following options:
                        </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 6.1"><p><span class="emphasis"><em>Location</em></span> : By default,
                                the location and name of the truststore that stores
                                the public key certificates of the CA and the
                                client's public key certificate is already entered.
                                The GlassFish truststore file is <code class="code">as-install
                                /domains/domain1/config/cacerts.jks</code>.</p></li>

                            <li class="step" title="Step 6.2"><p><span class="emphasis"><em>Store Password</em></span> :
                                Specifies the password for the truststore. If you
                                are using GlassFish, the value of
                                <code class="code">changeit</code> is already entered. If you
                                have changed the value of the truststore password,
                                you must type the new value in this field.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The Store Password field enables you to
                                    specify a password for the truststore used by the
                                    application. When specified, this password is stored
                                    in a WSIT configuration file in clear text, which is
                                    a security risk. Setting the truststore password in
                                    the development environment is fine, however, when
                                    you go into production, remember to use the
                                    container's Callback Handler to obtain the keys from
                                    the truststore. This eliminates the need for the
                                    truststore passwords to be supplied by the users.
                                    You can also specify the passwords for keystores and
                                    truststores by specifying a CallbackHandler class
                                    that implements the
                                    <code class="code">javax.security.auth.callback.CallbackHandler</code>
                                    interface in the Key Password or Store Password
                                    fields.</p><p>When creating JSR-109-compliant application,
                                    GlassFish will only use the default CallbackHandlers
                                    and Validators, and you cannot override the location
                                    of the keystore and truststore files. Any attempt to
                                    override the default location will be ignored. You
                                    do, however, need to specify the keystore and
                                    truststore locations in these dialogs in order to
                                    specify the alias.</p></div></li>

                            <li class="step" title="Step 6.3"><p><span class="emphasis"><em>Load Aliases</em></span> : Click the
                                Load Aliases button to populate the Alias field with
                                the aliases contained in the truststore file. The
                                Location and Store Password fields must be specified
                                correctly for this option to work.</p></li>

                            <li class="step" title="Step 6.4"><p><span class="emphasis"><em>Alias</em></span> : Unhandled tag tip
                                Specifies the peer alias of the certificate in the
                                truststore that is to be used when the client needs
                                to send encrypted data. Refer to the table in <a class="xref" href="ch12.html#ahido" title="12.5.1.&nbsp;Specifying Aliases with the Updated Stores">Specifying Aliases with the Updated Stores</a> to
                                determine which alias is appropriate for the
                                selected security mechanism. A truststore contains
                                trusted other-party certificates and certificates of
                                Certificate Authorities (CA). A peer alias is the
                                alias of the other party (peer) that the sending
                                party needs to use to encrypt the request.</p></li>
                        </ul></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click OK to close the
                        dialog.</strong></span></p></li></ol></div></div><div class="task" title="To Configure the Keystore and Truststore on a Client"><a name="gfrgh"></a><p class="title"><b>To Configure the Keystore and Truststore on a
                Client</b></p><div class="tasksummary">
                    <p>On the client side, a keystore and truststore file
                    must be configured for some of the security mechanisms.
                    Refer to the table in <a class="xref" href="ch12.html#ahicp" title="12.2.2.&nbsp;Summary of Client-Side Configuration Requirements">Summary of Client-Side Configuration Requirements</a> for information on which
                    mechanisms require the configuration of keystores and
                    truststores.</p>

                    <p>If the mechanism configured for the service requires
                    the configuration of keystores and truststores, follow
                    these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Check the table in <a class="xref" href="ch12.html#ahicp" title="12.2.2.&nbsp;Summary of Client-Side Configuration Requirements">Summary of Client-Side Configuration Requirements</a> to see if
                        a keystore needs to be configured for the client for
                        the selected security mechanism. If so, continue.
                        </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong> In the Projects window,
                        expand the node for the web service client.
                        </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Expand the Web Service
                        References node.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Right-click the node for
                        the web service reference for which you want to
                        configure security options. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Edit Web Service
                        Attributes.</strong></span></p><p>When the Web Service References Attributes
                        Editor is opened, select the Quality of Service tab to
                        display the WSIT Security options.</p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Click Keystore or
                        Truststore to specify the keystore or truststore
                        information if required by the service.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Depending on what is
                        required for the selected mechanism, you may specify
                        the following information: </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 7.1"><p><span class="emphasis"><em>Keystore Location</em></span> : The
                                directory and file name containing the certificate
                                key to be used to authenticate the client. By
                                default, the location is already set to the default
                                GlassFish keystore, <code class="code"> as-install
                                /domains/domain1/config/keystore.jks </code>
                                .</p></li>

                            <li class="step" title="Step 7.2"><p><span class="emphasis"><em>Keystore Password</em></span> : The
                                password for the keystore used by the client. By
                                default, the password for the GlassFish keystore is
                                already entered. This password is
                                <code class="code">changeit</code> .</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>When specified, this password is stored in a
                                    WSIT configuration file in clear text. Setting the
                                    keystore password in the development environment is
                                    fine, however, when you go into production, remember
                                    to use the container's default
                                    <code class="code">CallbackHandler</code> to obtain the keys from
                                    the keystore. This eliminates the need for the
                                    keystore passwords to be supplied by the users. You
                                    can also specify the passwords for keystores and
                                    truststores by specifying a
                                    <code class="code">CallbackHandler</code> class that implements
                                    the
                                    <code class="code">javax.security.auth.callback.CallbackHandler</code>
                                    interface in the Keystore Password, Truststore
                                    Password, or Key Password fields.</p></div></li>

                            <li class="step" title="Step 7.3"><p><span class="emphasis"><em>Load Aliases</em></span> : Click this
                                button to populate the Alias list with all of the
                                certificates available in the selected keystore.
                                This option will only work if the keystore location
                                and password are correct.</p></li>

                            <li class="step" title="Step 7.4"><p><span class="emphasis"><em>Keystore Alias</em></span> : Select
                                the alias in the keystore. Refer to the table in
                                <a class="xref" href="ch12.html#ahido" title="12.5.1.&nbsp;Specifying Aliases with the Updated Stores">Specifying Aliases with the Updated Stores</a> to
                                determine which alias is appropriate for the
                                selected security mechanism.</p></li>

                            <li class="step" title="Step 7.5"><p><span class="emphasis"><em>Key Password</em></span> : If the
                                client key has been password-protected, type the
                                password for this key. The GlassFish certificate key
                                password is <code class="code">changeit</code> .</p></li>

                            <li class="step" title="Step 7.6"><p><span class="emphasis"><em>Truststore Location</em></span> : The
                                directory and file name of the client truststore
                                containing the certificate of the server. By
                                default, this field points to the default GlassFish
                                truststore, <code class="code"> as-install
                                /domains/domain1/config/cacerts.jks</code>.</p></li>

                            <li class="step" title="Step 7.7"><p><span class="emphasis"><em>Truststore Password</em></span> : The
                                password for the truststore used by the client. By
                                default, the password for the GlassFish truststore
                                is already specified. The password is
                                <code class="code">changeit</code> .</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>When specified, this password is stored in a
                                    WSIT configuration file in clear text. Setting the
                                    truststore password in the development environment
                                    is fine; however, when you go into production,
                                    remember to use the container's default
                                    <code class="code">CallbackHandler</code> to obtain the keys from
                                    the keystore. This eliminates the need for the
                                    keystore passwords to be supplied by the users. You
                                    can also specify the passwords for keystores and
                                    truststores by specifying a
                                    <code class="code">CallbackHandler</code> class that implements
                                    the
                                    <code class="code">javax.security.auth.callback.CallbackHandler</code>
                                    interface in the Keystore Password, Truststore
                                    Password, or Key Password fields.</p></div></li>

                            <li class="step" title="Step 7.8"><p><span class="emphasis"><em>Load Aliases</em></span> : Click this
                                button to populate the Alias list with all of the
                                certificates available in the selected keystore.
                                This option will only work if the truststore
                                location and password are correct.</p></li>

                            <li class="step" title="Step 7.9"><p><span class="emphasis"><em>Truststore Alias</em></span> : Select
                                the alias of the server certificate and private key
                                in the client truststore. Refer to the table in
                                <a class="xref" href="ch12.html#ahido" title="12.5.1.&nbsp;Specifying Aliases with the Updated Stores">Specifying Aliases with the Updated Stores</a> to
                                determine which alias is appropriate for the
                                selected security mechanism.</p></li>
                        </ul></li><li class="step" title="Step 8"><p><span class="bold"><strong>Click OK to close the
                        dialog.</strong></span></p></li></ol></div></div></div><div class="section" title="12.5.3.&nbsp;Configuring Validators"><div class="titlepage"><div><div><h3 class="title"><a name="ahidx"></a>12.5.3.&nbsp;Configuring Validators</h3></div></div></div><p>A validator is an optional set of classes used to check the
            validity of a token, a certificate, a timestamp, or a username and
            password. The Validators button will be enabled when all of the
            following are true:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Security is enabled for the service.</p></li><li class="listitem"><p>Target server for the service is not
                    GlassFish.</p></li><li class="listitem"><p>Development defaults are disabled.</p></li><li class="listitem"><p>Security profile for the service is not one of the
                    three STS based profiles.</p></li></ul></div><p>Applications that run under a GlassFish 9.1 or higher
            container do not need to configure Callback Handlers and
            Validators when using the IDE with WSIT enabled. This is because
            the container handles the callbacks and validation. You only need
            to make sure that the certificates are available at locations that
            GlassFish requires and/or create authorized users using the Admin
            Console (described in <a class="xref" href="ch12.html#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a> .</p><p>Validators are always optional because there are defaults in
            the runtime (regardless of the container and regardless of whether
            the application is a JSR-109 or a non-JSR-109 deployment.) For
            non-JSR-109 deployment, you only need to specify a validator when
            you want to override the default validators. For JSR-109
            deployments, there is no point in specifying an overriding
            validator, as these will be overridden back to the defaults by
            GlassFish, thus the Validators button is not available when the
            selected web service is a JSR-109-compliant application.</p><div class="task" title="To Set Validator Configuration Options"><a name="gfrhe"></a><p class="title"><b>To Set Validator Configuration Options</b></p><div class="tasksummary">
                    <p>To set the validator configuration options for a
                    non-JSR-109-compliant application (such as a J2SE client),
                    perform the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Right-click the web
                        service and select Edit Web Service Attributes.
                        </strong></span></p><p>The Web Service Attributes editor is
                        displayed.</p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Enable Secure
                        Service.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Unselect Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Click the Validator
                        button.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> On the Validator
                        Configuration page, specify the following options,
                        when necessary: </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 5.1"><p><span class="emphasis"><em> Username Validator </em></span> :
                                Specifies the validator class to be used to validate
                                username and password on the server side. This
                                option is only used by a web service.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>When using the default Username Validator,
                                    make sure that the username and password of the
                                    client are registered with GlassFish (using Admin
                                    Console, described in <a class="xref" href="ch12.html#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a> ) if using GlassFish, or
                                    is included in the <code class="code">tomcat-users.xml</code>
                                    file if using Tomcat.</p></div></li>

                            <li class="step" title="Step 5.2"><p><span class="emphasis"><em>Timestamp Validator</em></span> :
                                Specifies the validator class to be used to check
                                the token timestamp to determine whether the token
                                has expired or is still valid.</p></li>

                            <li class="step" title="Step 5.3"><p><span class="emphasis"><em> Certificate Validator </em></span> :
                                Specifies the validator class to be used to validate
                                the certificate supplied by the client or the web
                                service.</p></li>

                            <li class="step" title="Step 5.4"><p><span class="emphasis"><em> SAML Validator: </em></span>
                                Specifies the validator class to be used to validate
                                SAML token supplied by the client or the web
                                service.</p></li>
                        </ul></li><li class="step" title="Step 6"><p><span class="bold"><strong>Click OK to close the
                        dialog.</strong></span></p></li></ol></div></div></div></div><div class="section" title="12.6.&nbsp;Configuring Kerberos for Glassfish and Tomcat"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ConfiguringKerberos"></a>12.6.&nbsp;Configuring Kerberos for Glassfish and Tomcat</h2></div></div></div><p>This section explains how to setup Glassfish or Tomcat to use
        Kerberos Authentication. It assumes that the underlying infrastructure
        has Kerberos Authentication available. If you need information on how
        to setup Kerberos in Solaris or Ubuntu Linux environments, refer to
        the following links: </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="link" href="http://blogs.sun.com/tdh/entry/installing_a_kerberos_kdc_and" target="_top">Solaris
                    10: Installing a Kerberos KDC</a></p></li><li class="listitem"><p><a class="link" href="http://www.alittletooquiet.net/text/kerberos-on-ubuntu/" target="_top">Ubuntu
                    Linux: Kerberos On Ubuntu</a></p></li></ul></div><p>Note that in a Windows environment you can set up a Kerberos KDC
        only on Window Server editions 2000, 2003 and 2008. The KDC is bundled
        in these editions with its own Kerberos implementation as part of
        Active Directory. You can not install MIT Kerberos KDC on Windows. A
        Windows XP/Vista system can act as a client of the Windows Server
        editions KDC. Alternatively, you can install a client module of MIT
        Kerberos for Windows -- see <a class="link" href="http://web.mit.edu/Kerberos/kfw-3.2/kfw-3.2.2.html" target="_top">Kerberos
        for Windows Release 3.2.2</a>.You can then use the client module to
        authenticate against a KDC that was set up on a UNIX system.</p><div class="section" title="12.6.1.&nbsp;For Glassfish"><div class="titlepage"><div><div><h3 class="title"><a name="KerberosForGlassfish"></a>12.6.1.&nbsp;For Glassfish</h3></div></div></div><p>Specify the JAAS login modules to be used for Kerberos in
            the $GLASSFISH_HOME/domains/domain1/config/login.conf file, as
            follows: </p><pre class="programlisting">KerberosClient {
    com.sun.security.auth.module.Krb5LoginModule required
    useTicketCache=true;
}

KerberosServer {
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true keyTab="/etc/krb5.keytab"
    doNotPrompt=true storeKey=true
    principal="websvc/service@INDIA.SUN.LOCAL";
}</pre><p>You can give any names to the login modules, that is,
            instead of KerberosClient and KerberosServer. You need to refer to
            these names in the &lt;sc:KerberosConfig&gt; assertion in the WSDL
            file and in the wsit-client.xml file.</p><p>Also edit the principal in
            <span class="emphasis"><em>KerberosServer</em></span> to the
            <span class="emphasis"><em>service_principal</em></span> that you created, and
            specify the correct location of <span class="emphasis"><em>krb5.keytab</em></span>
            file.</p></div><div class="section" title="12.6.2.&nbsp;For Tomcat"><div class="titlepage"><div><div><h3 class="title"><a name="KerberosForTomcat"></a>12.6.2.&nbsp;For Tomcat</h3></div></div></div><p>Glassfish picks the login modules from
            $GLASSFISH_HOME/domains/domain1/config/login.conf. In Tomcat we
            need to specify the file explicitly using
            java.security.auth.login.config system property. Here are the
            steps:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Create a file jaas.conf , and place it in
                    $CATALINA_HOME/conf. Here's what jaas.conf looks like:
                    </p><pre class="programlisting">KerberosClient {
    com.sun.security.auth.module.Krb5LoginModule required
    useTicketCache=true;
};
KerberosServer {
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true keyTab="/etc/krb5.keytab"
    doNotPrompt=true storeKey=true
    principal="websvc/service@INDIA.SUN.COM";
};</pre></li><li class="listitem"><p>Add following line to the catalina.sh script (or
                    specify the mentioned JAVA_OPTS property):
                    </p><pre class="programlisting">JAVA_OPTS="$JAVA_OPTS "-Djava.security.auth.login.config=$CATALINA_HOME/conf/jaas.conf</pre></li><li class="listitem"><p>Specify the following system property in your client
                    code: </p><pre class="programlisting">-Djava.security.policy=${tomcat.home}/conf/catalina.policy
-Djava.security.auth.login.config=${tomcat.home}/conf/jaas.conf</pre></li></ul></div></div></div><div class="section" title="12.7.&nbsp;Securing Operations and Messages"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahidy"></a>12.7.&nbsp;Securing Operations and Messages</h2></div></div></div><p>This section explains how to specify security mechanisms at the
        operation level and at the message level.</p><p>You can specify security mechanisms at the following
        levels:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Operation</em></span></p><p>At times, you may need to configure different operations
                with different supporting tokens. You may wish to configure
                security at the operation level, for example, in the situation
                where only one operation requires a UsernameToken to be passed
                and the rest of the operations do not require this, or in the
                situation where only one operation needs to be endorsed by a
                special token and the others do not.</p></li><li class="listitem"><p><span class="emphasis"><em> Input Message and Output Message
                </em></span></p><p>Security mechanisms at this level are used to specify
                what is being protected and the level of protection
                required.</p><p>In this section, you can specify parts of a message that
                require integrity protection (digital signature) and/or
                confidentiality (encryption). When you do this, the specified
                part of the message, outside of security headers, requires
                signature and/or encryption. For example, a message producer
                might submit an order that contains an <code class="code">orderID</code>
                header. The producer signs and/or encrypts the
                <code class="code">orderID</code> header (the SOAP message header) and the
                body of the request (the SOAP message body). Parts that can be
                signed and/or encrypted include the body, the header, the
                local name of the SOAP header, and the namespace of the SOAP
                header.</p><p>You can also specify arbitrary elements in the message
                that require integrity protection and/or confidentiality.
                Because of the mutability of some SOAP headers, a message
                producer may decide not to sign and/or encrypt the SOAP
                message header or body as a whole, but instead sign and/or
                encrypt elements within the header and body. Elements that can
                be signed and/or encrypted include an XPath expression or a
                URI which indicates the version of XPath to use.</p></li></ul></div><p>This section covers the following topics:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#gfrhv" title="To Specify Security at the Operation, Input Message, or Output Message Level">To Specify Security at the Operation, Input Message, or
            Output Message Level</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahiea" title="12.7.1.&nbsp;Supporting Token Options">Supporting Token Options</a></p></li></ul></div><div class="task" title="To Specify Security at the Operation, Input Message, or Output Message Level"><a name="gfrhv"></a><p class="title"><b>To Specify Security at the Operation, Input Message, or
            Output Message Level</b></p><div class="tasksummary">
                <p>To specify security mechanisms at the level of the
                operation, input message, or output message, perform the
                following steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Right-click the web service
                    and select Web Service Attributes.</strong></span></p><p>The Web Service Attributes editor is
                    displayed.</p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Secure
                    Service.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Select a security
                    mechanism.</strong></span></p><p>The following mechanisms do not support Input
                    message level protection:</p><ul class="stepalternatives">
                        <li class="step" title="Step 3.1"><p><a class="xref" href="ch12.html#ahicv" title="12.3.1.&nbsp;Username Authentication with Symmetric Key">Username Authentication with Symmetric Key</a></p></li>

                        <li class="step" title="Step 3.2"><p><a class="xref" href="ch12.html#ahicv1" title="12.3.2.&nbsp;Username Authentication with Password Derived Keys">Username Authentication with Password Derived Keys</a></p></li>

                        <li class="step" title="Step 3.3"><p><a class="xref" href="ch12.html#ahicx" title="12.3.5.&nbsp;Transport Security (SSL)">Transport Security (SSL)</a></p></li>

                        <li class="step" title="Step 3.4"><p><a class="xref" href="ch12.html#ahicz" title="12.3.6.&nbsp;Message Authentication over SSL">Message Authentication over SSL</a></p></li>

                        <li class="step" title="Step 3.5"><p><a class="xref" href="ch12.html#ahida" title="12.3.7.&nbsp;SAML Authorization over SSL">SAML Authorization over SSL</a></p></li>

                        <li class="step" title="Step 3.6"><p><a class="xref" href="ch12.html#ahidc" title="12.3.9.&nbsp;SAML Sender Vouches with Certificates">SAML Sender Vouches with Certificates</a></p></li>
                    </ul></li><li class="step" title="Step 4"><p><span class="bold"><strong> Expand the
                    <span class="emphasis"><em>operation</em></span> Operation node (for
                    example, the <code class="code">add Operation</code> node.) It should
                    look like <a class="xref" href="ch12.html#gfrgy" title="Figure&nbsp;12.6.&nbsp;Web Service Attributes Editor Page: Operation Level">Web Service Attributes Editor Page: Operation
                            Level</a>. </strong></span> </p><div class="figure"><a name="gfrgy"></a><p class="title"><b>Figure&nbsp;12.6.&nbsp;Web Service Attributes Editor Page: Operation
                            Level</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/security-operation-level.png" height="360" alt="Web Service Attributes Editor Page: Operation Level"></td></tr></table></div></div></div><p><br class="figure-break"></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> Expand the
                    <span class="emphasis"><em>operation</em></span> section. </strong></span></p><p>The section will be grayed out if Secure Service is
                    not selected.</p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select an option from the
                    Transactions list to specify a level at which transactions
                    will be secured. </strong></span></p><p>For this release, transactions will only use SSL for
                    security. Transactions are discussed in <a class="xref" href="ch18.html" title="Chapter&nbsp;18.&nbsp;Using Atomic Transactions"><i>Using Atomic Transactions</i></a>.</p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Expand the Input Message
                    section.</strong></span></p><p>This section will be grayed out if Secure Service is
                    not selected.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong>Specify the following options,
                    as appropriate:</strong></span></p><ul class="stepalternatives">
                        <li class="step" title="Step 8.1"><p><span class="emphasis"><em>Authentication Token</em></span> :
                            Specifies which supporting token will be used to
                            sign and/or encrypt the specified message parts.
                            Options include Username, X509, SAML, Issued, or
                            None. For further description of these options, read
                            <a class="xref" href="ch12.html#ahiea" title="12.7.1.&nbsp;Supporting Token Options">Supporting Token Options</a>.</p></li>

                        <li class="step" title="Step 8.2"><p><span class="emphasis"><em>Signed</em></span> : Specifies that
                            the authentication token must be a signed,
                            supporting token. A signed, supporting token is
                            signed by the primary signature token and is part of
                            primary signature.</p></li>

                        <li class="step" title="Step 8.3"><p><span class="emphasis"><em>Endorsing</em></span> : Specifies
                            that the authentication token must be endorsed. With
                            an endorsing supporting token, the key represented
                            by the token is used to endorse/sign the primary
                            message signature.</p></li>

                        <li class="step" title="Step 8.4"><p><span class="emphasis"><em>Encrypted</em></span>: Specifies that
                            the authentication token must be an encrypted
                            supporting token.</p></li>
                    </ul><p>One can select any (or none) combination of the
                    three options above. If both Signed and Endorsing are
                    selected, the authentication token must be a signed,
                    endorsing, supporting token. In this situation, the token
                    is signed by the primary signature. The key represented by
                    the token is used to endorse/sign the primary message
                    signature. If Encrypted is selected as well, the
                    supporting token is also encrypted in the request
                    message.</p></li><li class="step" title="Step 9"><p><span class="bold"><strong> For the Input Message and/or
                    Output Message, click the Message Parts button to specify
                    which parts of the message need to be encrypted, signed,
                    and/or required. </strong></span></p><p>See the following section for more information on
                    the options in the Message Parts dialog.</p><p>The Message Parts dialog appears. It should look
                    like <a class="xref" href="ch12.html#gfrhz" title="Figure&nbsp;12.7.&nbsp;Web Service Attributes Editor Page: Message Parts">Web Service Attributes Editor Page: Message
                        Parts</a>.</p><div class="figure"><a name="gfrhz"></a><p class="title"><b>Figure&nbsp;12.7.&nbsp;Web Service Attributes Editor Page: Message
                        Parts</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/security-message-parts.png" height="360" alt="Web Service Attributes Editor Page: Message Parts"></td></tr></table></div></div></div><br class="figure-break"></li><li class="step" title="Step 10"><p><span class="bold"><strong> Click in a checkbox to the
                    right of the message part or element that you would like
                    to sign, encrypt or require. </strong></span></p><ul class="stepalternatives">
                        <li class="step" title="Step 10.1"><p>Select Sign to specify the parts or elements
                            of a message that require integrity protection
                            (digital signature).</p></li>

                        <li class="step" title="Step 10.2"><p>Select Encrypt to specify the parts or
                            elements of a message that require confidentiality
                            (encryption).</p></li>

                        <li class="step" title="Step 10.3"><p>Select Require to specify the set of parts
                            and/or elements that a message must contain.</p></li>
                    </ul></li><li class="step" title="Step 11"><p><span class="bold"><strong>Click Add Body to add a row
                    for the message body.</strong></span></p><p>This will only be necessary if the row has been
                    removed.</p></li><li class="step" title="Step 12"><p><span class="bold"><strong> Click Add Header to add a row
                    for either a specific SOAP header part or for all SOAP
                    header parts. </strong></span></p><p>This will only be necessary if the SOAP header row
                    in question has been deleted. The header parts that are
                    available to sign and/or encrypt before clicking the Add
                    Header button include To (Addressing), From (Addressing),
                    FaultTo (Addressing), ReplyTo (Addressing), MessageID
                    (Addressing), RelatesTo (Addressing), and Action
                    (Addressing). After clicking Add Header, and then clicking
                    All Headers, you may also specify AckRequested (RM),
                    SequenceAcknowledgement (RM), and Sequence (RM).</p></li><li class="step" title="Step 13"><p><span class="bold"><strong> Click Add Attachments to add
                    a row the SOAP attachments. </strong></span></p><p>This is useful if the web service has MIME
                    attachments which should be protected. All the attachments
                    in the message are secured on selecting this option. This
                    option is only available for the specification version of
                    Security Policy, supported in Netbeans IDE from 6.5
                    version.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Attachments Protection is not supported in .NET
                        3.0 and 3.5. So it is best to avoid this feature for
                        interop with .NET.</p></div></li><li class="step" title="Step 14"><p><span class="bold"><strong> There are no XPath elements
                    displayed by default. Click Add XPath to add rows that
                    enable you to specify signature and/or encryption for an
                    XPath expression or a URI which indicates the version of
                    XPath to use. </strong></span></p><p>By default, the Required field is selected. This is
                    an editable field. Double-click the XPath row to specify
                    the XPath expression or URI. Only one XPath element is
                    allowed.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>There is a limitation when specifying XPath
                        elements. To use XPath elements, switch off Optimize
                        Security manually by adding the
                        <code class="code">disableStreamingSecurity</code> policy
                        assertion. For information on how to do this, refer to
                        <a class="link" href="https://blogs.oracle.com/ashutosh/entry/custom_security_policy_assertions_in" target="_top">http://blogs.sun.com/venu/</a>
                        for more information on
                        <code class="code">disableStreamingSecurity</code>.</p></div></li><li class="step" title="Step 15"><p><span class="bold"><strong> To remove an element, select
                    it in the Message Part section, and then click Remove to
                    remove it from message security. </strong></span></p></li><li class="step" title="Step 16"><p><span class="bold"><strong>Click OK to save these
                    settings.</strong></span></p></li></ol></div></div><div class="section" title="12.7.1.&nbsp;Supporting Token Options"><div class="titlepage"><div><div><h3 class="title"><a name="ahiea"></a>12.7.1.&nbsp;Supporting Token Options</h3></div></div></div><p>You can use one of the following options for supporting
            tokens:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>Username Token</em></span>: A username
                    token is used to identify the requestor by their username,
                    and optionally using a password (or shared secret, or
                    password equivalent) to authenticate that identity. When
                    using a username token, the user must be configured on
                    GlassFish. For information on configuring users on
                    GlassFish, read <a class="xref" href="ch12.html#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a>.</p></li><li class="listitem"><p><span class="emphasis"><em>X.509 Certificate</em></span>: An X.509
                    certificate specifies a binding between a public key and a
                    set of attributes that includes (at least) a subject name,
                    issuer name, serial number, and validity interval. An
                    X.509 certificate may be used to validate a public key
                    that may be used to authenticate a SOAP message or to
                    identify the public key with a SOAP message that has been
                    encrypted. When this option is selected, you must specify
                    a truststore. For information on specifying a truststore,
                    read <a class="xref" href="ch12.html#gfrgu" title="To Configure the Truststore on a Service Manually">To Configure the Truststore on a Service
                Manually</a>.</p></li><li class="listitem"><p><span class="emphasis"><em>Issued Token</em></span> : An issued token
                    is a token issued by a trusted Secure Token Service (STS).
                    The service does not trust the client directly, but
                    instead trusts tokens issued by a designated STS. In other
                    words, the STS is taking on the role of a second service
                    with which the client has to securely authenticate. The
                    issued tokens contain a key, which is encrypted for the
                    server and which is used for deriving new keys for signing
                    and encrypting.</p></li><li class="listitem"><p><span class="emphasis"><em>SAML Token</em></span> : A SAML Token uses
                    Security Assertion Markup Language (SAML) assertions as
                    security tokens.</p></li></ul></div></div></div><div class="section" title="12.8.&nbsp;Configuring A Secure Token Service (STS)"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahieb"></a>12.8.&nbsp;Configuring A Secure Token Service (STS)</h2></div></div></div><p>A Secure Token Service (STS) is a Web service that issues
        security tokens. That is, it makes assertions based on evidence that
        it trusts, to whoever trusts it (or to specific recipients). To
        communicate trust, a service requires proof, such as a signature, to
        prove knowledge of a security token or set of security tokens. A
        service itself can generate tokens or it can rely on a separate STS to
        issue a security token with its own trust statement (note that for
        some security token formats this can just be a re-issuance or
        co-signature). This forms the basis of trust brokering.</p><p>The issued token security model includes a target service, a
        client, and a trusted third party called a Security Token Service
        (STS). Policy flows from service to client, and from STS to client.
        Policy may be embedded inside an issued token assertion, or acquired
        out-of-hand. There must be an explicit trust relationship between the
        service and the STS and the client and the STS. There does not need to
        be a trust relationship between the client and service.</p><p>When the web service being referenced by the client uses any of
        the STS security mechanisms (refer to tables in <a class="xref" href="ch12.html#ahicn" title="12.2.1.&nbsp;Summary of Service-Side Configuration Requirements">Summary of Service-Side Configuration Requirements</a> and <a class="xref" href="ch12.html#ahicp" title="12.2.2.&nbsp;Summary of Client-Side Configuration Requirements">Summary of Client-Side Configuration Requirements</a> ), an STS must be specified. You can
        specify the STS in the following ways.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>On the service side, specify the endpoint of the Issuer
                element and/or specify the Issuer Metadata Exchange (Mex)
                address of the STS.</p><p>If you need to create a third-party STS, follow the
                steps in <a class="xref" href="ch12.html#gfrig" title="To Create a Third-Party STS">To Create a Third-Party STS</a>
                .</p><p>For more information on managing the STS, see <a class="xref" href="ch12.html#sts-managing-multiple-services" title="Managing multiple services with Metro based STS">Managing multiple services with Metro based STS</a> .</p><p>If you already have an STS that you want to use, follow
                the steps in <a class="xref" href="ch12.html#gfrgl" title="To Specify an STS on the Service Side">To Specify an STS on the Service Side</a>
                .</p><p>An example that creates and uses an STS can be found at
                <a class="xref" href="ch12.html#ahiey" title="12.9.7.&nbsp;Example: STS Issued Token (STS)">Example: STS Issued Token (STS)</a> .</p><p>An example that shows how to achieve the trust brokering
                between different domains using an STS can be found at <a class="xref" href="ch12.html#ahiex" title="12.9.8.&nbsp;Example: Broker Trust STS (BT)">Example: Broker Trust STS (BT)</a> .</p><p>An example that shows how to use SecureConversation with
                an STS can be found at <a class="xref" href="ch12.html#ahiez" title="12.9.9.&nbsp;Example: STS Issued Token With SecureConversation (STS+SC)">Example: STS Issued Token With SecureConversation
            (STS+SC)</a> .</p></li><li class="listitem"><p>On the client side, specify the information for a
                preconfigured STS. This is mainly used for a local STS that is
                in the same domain as the client. Configuring the STS for the
                client is described in <a class="xref" href="ch12.html#gghnt" title="To Specify an STS on the Client Side">To Specify an STS on the Client Side</a> .</p></li></ul></div><p>This section covers the following topics:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#gfrig" title="To Create a Third-Party STS">To Create a Third-Party STS</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrgl" title="To Specify an STS on the Service Side">To Specify an STS on the Service Side</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gghnt" title="To Specify an STS on the Client Side">To Specify an STS on the Client Side</a></p></li></ul></div><div class="task" title="To Create a Third-Party STS"><a name="gfrig"></a><p class="title"><b>To Create a Third-Party STS</b></p><div class="tasksummary">
                <p>Use the STS wizard to create an STS. When using the STS
                wizard, provide the name of the STS implementation class. This
                class must extend
                <code class="code">com.sun.xml.ws.security.trust.sts.BaseSTSImpl</code> .
                After completing the steps of the wizard, your application
                will contain a new service that is an STS and includes a
                provider implementation class, STS WSDL, and a WSIT
                configuration file with a predefined set of policies.</p>

                <p>To use the STS wizard to create an STS, follow these
                steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create a new project for the
                    STS by selecting File | New Project. </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Java Web, then Web
                    Application, then Next.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Type a Project Name, then
                    Next, then the desired Server. Click
                    Finish.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Right-click the STS Project,
                    and select New, then select Other. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Web Services from the
                    Categories list.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select Secure Token Service
                    (STS) from the File Type(s) list. </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click Next.</strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong>Type a name for the Web
                    Service Class Name.</strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Type or select a name for the
                    Package list.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong>Click
                    Finish.</strong></span></p><p>The IDE takes a while to create the STS. When
                    created, it appears under the project's Web Services node
                    as <span class="emphasis"><em>your_STS</em></span> <code class="code">Service</code> ,
                    and the Java file appears in the right pane.</p></li><li class="step" title="Step 11"><p><span class="bold"><strong> The STS wizard creates an
                    implementation of the provider class. </strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong> Back in the Projects window,
                    expand the STS project folder, expand the Web Services
                    node, right-click on the web service, and select Edit Web
                    Service Attributes to configure the STS.
                    </strong></span></p></li><li class="step" title="Step 13"><p><span class="bold"><strong> Select the "Version
                    Compatibility" to ".NET 3.5 / Metro 1.3" ( e.g. see <a class="xref" href="ch12.html#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a> ) . It will
                    use WS-SX version of all WS-* specifications.
                    </strong></span></p></li><li class="step" title="Step 14"><p><span class="bold"><strong>Make sure Secure Service is
                    selected.</strong></span></p></li><li class="step" title="Step 15"><p><span class="bold"><strong> Select a Security Mechanism
                    that is NOT one of the STS mechanisms. The example
                    application uses Username Authentication with Symmetric
                    Key. </strong></span></p></li><li class="step" title="Step 16"><p><span class="bold"><strong> Select the Configure button.
                    For the Algorithm Suite option, specify a value that
                    matches the value of the web service. Set the Key Size to
                    128 if you have not configured Unlimited Strength
                    Encryption. Select OK to close the configuration dialog.
                    </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Some of the algorithm suite settings require
                            that Unlimited Strength Encryption be configured in
                            the Java Runtime Environment (JRE), particularly the
                            algorithm suites that use 256 bit encryption.
                            Download the Java Cryptography Extension (JCE)
                            Unlimited Strength Jurisdiction Policy Files.
                            Installation instructions are provided in the JCE
                            zip file. You can download JCE from this URL: <a class="link" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_top">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a></p></div></li><li class="step" title="Step 17"><p>
                        <span class="bold"><strong>Make sure Act as Secure Token
                        Service (STS) is selected.</strong></span>
                    </p><p>The default values will create a valid STS.</p><p>Optionally, you can change the following
                    configuration options by clicking the Configure
                    button:</p><ul class="stepalternatives">
                        <li class="step" title="Step 17.1"><p><span class="emphasis"><em>Issuer</em></span> : Specify an
                            identifier for the issuer for the issued token. This
                            value can be any string that uniquely identifies the
                            STS, for example, <code class="code">MySTS</code> .</p></li>

                        <li class="step" title="Step 17.2"><p><span class="emphasis"><em>Contract Implementation
                            Class</em></span> : Specify the actual implementation
                            class for the <code class="code">WSTrustContract</code> interface
                            that will handle token issuance, validation, and the
                            like. Default value is
                            <code class="code">com.sun.xml.ws.security.trust.impl.WSTRustContractImpl</code>
                            for issuing SAML assertions, or click Browse to
                            browse to another contract implementation
                            class.</p></li>

                        <li class="step" title="Step 17.3"><p><span class="emphasis"><em>Life Time of Issued
                            Tokens</em></span> : The life span of the token
                            issued by the STS. Default value is 36,000
                            ms.</p></li>

                        <li class="step" title="Step 17.4"><p><span class="emphasis"><em>Encrypt Issued Key</em></span> :
                            Select this option if the issued key should be
                            encrypted using the service certificate. Default is
                            true.</p></li>

                        <li class="step" title="Step 17.5"><p><span class="emphasis"><em>Encrypt Issued Token</em></span> :
                            Select this option if the issued token should be
                            encrypted using the service certificate. Default is
                            false.</p></li>
                    </ul><p>Optionally, to add one or more Service Providers
                    that have a trust relationship with the STS, click the Add
                    button, and specify the following configuration
                    options:</p><ul class="stepalternatives">
                        <li class="step" title="Step 17.1"><p><span class="emphasis"><em>Provider Endpoint URI</em></span> :
                            The endpoint URI of the service provider.</p></li>

                        <li class="step" title="Step 17.2"><p><span class="emphasis"><em>Certificate Alias</em></span> : The
                            alias of the certificate of the service provider in
                            the keystore.</p></li>

                        <li class="step" title="Step 17.3"><p><span class="emphasis"><em>Token Type</em></span> : The type of
                            token the service provider requires, for example,
                            <code class="code">urn:oasis:names:tc:SAML1.0:assertion</code>
                            .</p></li>

                        <li class="step" title="Step 17.4"><p><span class="emphasis"><em>Key Type</em></span> : The type of
                            key the service provider requires. The choices are
                            public key or symmetric key. Symmetric key
                            cryptography relies on a shared secret and is
                            usually faster than public key cryptography. Public
                            key cryptography relies on a key that is made public
                            to all and is primarily used for encryption but can
                            be used for verifying signatures.</p></li>
                    </ul></li><li class="step" title="Step 18"><p><span class="bold"><strong> Click OK to close the Select
                    STS Service Provider dialog, if open. </strong></span></p></li><li class="step" title="Step 19"><p><span class="bold"><strong>Click OK to close the STS
                    Configuration dialog, if open.</strong></span></p></li><li class="step" title="Step 20"><p><span class="bold"><strong>Click the Keystore button to
                    configure the keystore.</strong></span></p><p>If you are using the GlassFish stores, click the
                    Load Aliases button and select <code class="code">wssip</code> .
                    Otherwise, browse to the location of your keystore and
                    enter the relevant information.</p><p>Click OK to close the dialog.</p></li><li class="step" title="Step 21"><p><span class="bold"><strong> Right-click the STS Project
                    and select Properties. Select the Run category, and type
                    the following in the Relative URL field: <code class="code">/</code>
                    <span class="emphasis"><em>your_STS</em></span> <code class="code">Service?wsdl</code> .
                    </strong></span></p></li><li class="step" title="Step 22"><p><span class="bold"><strong> Run the Project (right-click
                    the Project and select Run). The STS WSDL displays in a
                    browser window. </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you are receiving compilation errors during
                            the build, you may need to update your JRE's JAX-WS
                            version to the latest release version. See <a class="link" href="http://metro.java.net/guide/Using_JAX_WS_2_x___Metro_1_x_2_0_with_Java_SE_6.html#Endorsed_directory" target="_top">here</a>
                            for more details.</p></div></li></ol></div></div><p>Check <a class="xref" href="ch13.html#custom-sts" title="13.4.&nbsp;Building custom STS">Building custom STS</a> to
        build a custom STS to control the user attributes to be included in
        the SAML assertion.</p><div class="task" title="Managing multiple services with Metro based STS"><a name="sts-managing-multiple-services"></a><p class="title"><b>Managing multiple services with Metro based STS</b></p><div class="tasksummary">
                <p>Metro based STS can be used to secure multiple services.
                One need to register a service provider to an STS before the
                issued tokens of the STS can be used for that service.</p>

                <p>Each resgisted service comes up as a ServiceProvide in
                the STSConfiguration: </p><div class="example"><a name="d0e8914"></a><p class="title"><b>Example&nbsp;12.5.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;tc:STSConfiguration
        xmlns:tc="http://schemas.sun.com/ws/2006/05/trust/server"
        encryptIssuedKey="true" encryptIssuedToken="false"&gt;
   &lt;tc:LifeTime&gt;36000&lt;/tc:LifeTime&gt;
   &lt;tc:Contract&gt;com.sun.xml.ws.security.trust.impl.WSTrustContractImpl
   &lt;/tc:Contract&gt;
   &lt;tc:Issuer&gt;SunSTS&lt;/tc:Issuer&gt;
   &lt;tc:ServiceProviders&gt;
      &lt;tc:ServiceProvider endPoint="http://localhost:8080/jaxws-s5/simple"&gt;
         &lt;tc:CertAlias&gt;bob&lt;/tc:CertAlias&gt;
         &lt;tc:TokenType&gt;
            http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1
            #SAMLV1.1
         &lt;/tc:TokenType&gt;
      &lt;/tc:ServiceProvider&gt;
      &lt;!-- more service providers --&gt;
   &lt;/tc:ServiceProviders&gt;
&lt;/tc:STSConfiguration&gt;</pre></div></div><p><br class="example-break"></p>

                <p>At the minimum, you need to specify the endpoint as well
                as the cert alias for each service provider. At run time, the
                actual service is identified for each request RST from a
                client to the STS. The RST contains an AppliesTo element
                pointing to the endpoint of the targeted service. On the STS
                side, the certificate of the service is used to encrypt the
                issued tokens and proof keys for the service.</p>

                <p>With Netbeans, one can add Service Providers to an STS
                through the configuration panel for STS:</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Click Configure button besides Act as Secure Token
                    Service (STS).</p></li><li class="step" title="Step 2"><p>In the STS Configuration panel, click Add</p></li><li class="step" title="Step 3"><p>In the Select Service Provider panel, add
                    information of the service provider. Note that you must
                    import the certificate of the service provider to the
                    TrustStore of the STS.</p></li></ol></div></div><p>We provide a default Service Provider with endpoint="default".
        This default setting, working with any service providers, is for
        testing purpose only. In a product, you must remove it and add all the
        service providers to be secured by the STS. You may also implement
        STSConfigurationProvider with your own STSConfiguration and
        TrustSPMetada to configure STS and register service providers to a
        deployed STS at run time.</p><div class="task" title="To Specify an STS on the Service Side"><a name="gfrgl"></a><p class="title"><b>To Specify an STS on the Service Side</b></p><div class="tasksummary">
                <p>This section discusses how to specify a Security Token
                Service that can be referenced by the service. On the service
                side, you select a security mechanism that includes STS in its
                title.</p>

                <p>The STS itself is secured using a separate (non-STS)
                security mechanism. The security configuration of the
                client-side of this application is dependent upon the security
                mechanism selected for the STS, and not on the security
                mechanism selected for the application.</p>

                <p>To specify an STS for the web service, follow these
                steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong>Right-click the node for the
                    web service you want to secure.</strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Edit Web Service
                    Attributes.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Select the "Version
                    Compatibility" to ".NET 3.5 / Metro 1.3" ( e.g. see <a class="xref" href="ch12.html#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a> ) . It will
                    use WS-SX version of all WS-* specifications.
                    </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select Secure
                    Service.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> Select a Security Mechanism
                    that specifies STS from the list. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong>Click Configure to specify the
                    STS information.</strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Type the Issuer Address and/or
                    Issuer Metadata Address.</strong></span></p><p>When the Issuer Address and the Metadata values are
                    the same, you only need to type the Issuer Address. For
                    the example application, the Issuer Address would be
                    <code class="code">http://localhost:8080/MySTSProject/MySTSService</code>
                    .</p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Set the Algorithm Suite value
                    so that the algorithm suite value of the service matches
                    the algorithm suite value of the STS. Select 128 if you
                    have not installed Unlimited Strength Encryption.
                    </strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Click OK to close the
                    dialog.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong>Click OK.</strong></span></p><p>A new file is added to the project. To view the WSIT
                    configuration file, expand Web Pages | WEB-INF, then
                    double-click the file <code class="code"> wsit- package-name .
                    service-name .xml </code> and select the Source
                    page.</p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Right-click the project node
                    and select Run to compile the application and deploy it
                    onto GlassFish. A browser will open and display the WSDL
                    file for the application. </strong></span></p></li></ol></div></div><div class="task" title="To Specify an STS on the Client Side"><a name="gghnt"></a><p class="title"><b>To Specify an STS on the Client Side</b></p><div class="tasksummary">
                <p>Once you've determined whether it is required to
                configure an STS on the client side (see <a class="xref" href="ch12.html#ahicp" title="12.2.2.&nbsp;Summary of Client-Side Configuration Requirements">Summary of Client-Side Configuration Requirements</a>), configure the client Secure
                Token Service options. To configure the client-side with STS,
                you need to configure the clients for the service and STS
                follow these steps.</p>
            </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> In the Projects window,
                    expand the node for the web services client.
                    </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Expand the Web Service
                    References node.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Right-click the node for the
                    web service reference for which you want to configure
                    security options. </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select Edit Web Service
                    Attributes.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> When the Web Service
                    References Attributes Editor is opened, select the Quality
                    of Service tab. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Provide the service's
                    certificate by pointing to an alias in the client
                    truststore. For development purposes, click the Truststore
                    button,, click the Load Aliases button for the truststore
                    and select <code class="code">xws-security-server</code> from the Alias
                    list. </strong></span></p><ul class="stepalternatives">
                        <li class="step" title="Step 6.1"><p><span class="bold"><strong> In some instances,
                            NetBeans will not detect that this client is a
                            JSR-196 client, and thus will require that the
                            truststore entries be manually configured. To do
                            this, follow the steps in this section.
                            </strong></span></p></li>

                        <li class="step" title="Step 6.2"><p><span class="bold"><strong>Expand the client
                            project node, then expand Source
                            Packages/META-INF.</strong></span></p></li>

                        <li class="step" title="Step 6.3"><p><span class="bold"><strong> Double-click
                            <span class="emphasis"><em>&lt;service-project&gt;</em></span> ..xml
                            to open it in the Source window. Click the Source
                            tab to view the code. Find the
                            <code class="code">sc:TrustStore</code> elements. If these
                            elements contain parameters for
                            <code class="code">location</code> and <code class="code">storepass</code> ,
                            then just continue to the next section. If not, add
                            these attributes to this file. The following code
                            shows an example of how these elements could be
                            specified. </strong></span></p><div class="example"><a name="d0e9082"></a><p class="title"><b>Example&nbsp;12.6.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sc:TrustStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
   storepass="changeit" peeralias="xws-security-server"/&gt;</pre></div></div><br class="example-break"></li>
                    </ul></li><li class="step" title="Step 7"><p><span class="bold"><strong> Expand the Security Token
                    Service node to provide details for the STS to be used.
                    When the Endpoint and the Metadata values are the same,
                    you only need to enter the Endpoint value. For the example
                    application you would enter the following value in the
                    Endpoint field:
                    <code class="code">http://localhost:8080/MySTSProject/MySTSService</code>
                    . For WS Trust Version field, select 1.3 if STS endpoint
                    uses ".NET 3.5 / Metro 1.3" version compatibility.
                    Otherwise use the default WS Trust Version.
                    </strong></span></p><p>The Endpoint field is a mandatory field. Depending
                    on how you plan to configure the STS, you can provide
                    either Metadata information or information regarding the
                    WSDL Location, Service Name, Port Name and Namespace. The
                    examples following this section describe a few potential
                    STS configurations.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong>Click OK to close this
                    dialog.</strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong> The service requires a token
                    to be issued from the STS, which, for the example, is
                    <code class="code">http://localhost:8080/MySTSProject/MySTSService</code>
                    , with WSDL file
                    <code class="code">http://localhost:8080/MySTSProject/MySTSService?wsdl</code>
                    . To do this, follow these steps: </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 9.a"><p><span class="bold"><strong> Right-click the web
                            service client project node and select New | Web
                            Service Client. </strong></span></p><p>The New Web Service Client window
                            appears.</p></li><li class="step" title="Step 9.b"><p><span class="bold"><strong>Select the WSDL URL
                            option.</strong></span></p></li><li class="step" title="Step 9.c"><p><span class="bold"><strong> Cut and paste the URL
                            of the web service that you want the client to
                            consume into the WSDL URL field. For the tutorial
                            example, the URL for the <code class="code">MySTS</code> web
                            servicen is: </strong></span></p><pre class="programlisting">http://localhost:8080/MySTSProject/MySTSService?wsdl</pre></li><li class="step" title="Step 9.d"><p><span class="bold"><strong> Type the package name,
                            for example,
                            <code class="code">org.me.calculator.client.sts</code> , into the
                            Package field, then click Finish. </strong></span></p><p>The Projects window displays the new web
                            service client.</p></li></ol></li><li class="step" title="Step 10"><p><span class="bold"><strong> Drill down from the web
                    service client project node to the Web Service References
                    node. </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Right-click the node for the
                    STS service, and select Edit Web Service Attributes.
                    </strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong>Select the Quality of Service
                    tab.</strong></span></p></li><li class="step" title="Step 13"><p><span class="bold"><strong> If required, provide the
                    client's private key by pointing to an alias in the
                    keystore. For development purposes, click the Keystore
                    button, click the Load Aliases button, and select
                    <code class="code">xws-security-client</code> from the Alias list.
                    </strong></span></p></li><li class="step" title="Step 14"><p><span class="bold"><strong> Verify the STS's certificate
                    by pointing to an alias in the client truststore. For
                    development purposes, click the Truststore button,, click
                    the Load Aliases button and select <code class="code">wssip</code> from
                    the Alias list. </strong></span></p><ul class="stepalternatives">
                        <li class="step" title="Step 14.1"><p><span class="bold"><strong> In some instances,
                            NetBeans will not detect that this client is a
                            JSR-196 client, and thus will require that the
                            keystore and truststore entries be manually
                            configured. To do this, follow the steps in this
                            section. </strong></span></p></li>

                        <li class="step" title="Step 14.2"><p><span class="bold"><strong> Expand the web services
                            client project node, then Source Packages |
                            META-INF. </strong></span></p></li>

                        <li class="step" title="Step 14.3"><p><span class="bold"><strong> Double-click
                            <span class="emphasis"><em>&lt;sts-service&gt;</em></span> .xml to
                            open it in the Source window. Click the Source tab
                            to view the code. Find the <code class="code">sc:KeyStore</code>
                            and/or <code class="code">sc:TrustStore</code> elements. If these
                            elements contain parameters for
                            <code class="code">location</code> and <code class="code">storepass</code> ,
                            then just continue to the next section. If not, add
                            these attributes to this file. The following code
                            shows an example of how these elements could be
                            specified. </strong></span></p><div class="example"><a name="d0e9195"></a><p class="title"><b>Example&nbsp;12.7.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sc:TrustStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
   storepass="changeit" peeralias="wssip"/&gt;
&lt;sc:KeyStore
 wspp:visibility="private"
 location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\truststore.jks"
 storepass="changeit" alias="xws-security-client"/&gt;</pre></div></div><br class="example-break"></li>
                    </ul></li><li class="step" title="Step 15"><p><span class="bold"><strong>If required, enter the default
                    user name and password.</strong></span></p><p>If you followed the steps in <a class="xref" href="ch12.html#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a> , this will be User Name
                    <code class="code">wsitUser</code> and Password <code class="code">changeit</code>
                    .</p></li><li class="step" title="Step 16"><p><span class="bold"><strong>Click OK to close this
                    dialog.</strong></span></p></li><li class="step" title="Step 17"><p><span class="bold"><strong> Compile and run this
                    application by right-clicking the web services client
                    project and selecting Run. </strong></span></p></li></ol></div></div></div><div class="section" title="12.9.&nbsp;Example Applications"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ahiei"></a>12.9.&nbsp;Example Applications</h2></div></div></div><p>The following example applications demonstrate configuring web
        services and web service clients for different security mechanisms. If
        you are going to work through the examples sequentially, you must
        manually undo the changes to the service and then refresh the client
        in order for the client to receive the most recent version of the
        service's WSDL file, which contains the latest security configuration
        information.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#UsernameWithDigestPasswords" title="12.9.2.&nbsp;Example: Username with Digest Passwords">Example: Username with Digest Passwords</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahiem" title="12.9.3.&nbsp;Example: Mutual Certificates Security (MCS)">Example: Mutual Certificates Security (MCS)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahiep" title="12.9.4.&nbsp;Example: Transport Security (SSL)">Example: Transport Security (SSL)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahies" title="12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)">Example: SAML Authorization over SSL (SA)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahiev" title="12.9.6.&nbsp;Example: SAML Sender Vouches with Certificates (SV)">Example: SAML Sender Vouches with Certificates (SV)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahiey" title="12.9.7.&nbsp;Example: STS Issued Token (STS)">Example: STS Issued Token (STS)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahiex" title="12.9.8.&nbsp;Example: Broker Trust STS (BT)">Example: Broker Trust STS (BT)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#ahiez" title="12.9.9.&nbsp;Example: STS Issued Token With SecureConversation (STS+SC)">Example: STS Issued Token With SecureConversation
            (STS+SC)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfzhh" title="12.9.10.&nbsp;Example: Kerberos Token (Kerb)">Example: Kerberos Token (Kerb)</a></p></li></ul></div><div class="section" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)"><div class="titlepage"><div><div><h3 class="title"><a name="ahiej"></a>12.9.1.&nbsp;Example: Username Authentication with Symmetric Key
            (UA)</h3></div></div></div><p>The section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#gfrhw" title="To Secure the Example Service Application (UA)">To Secure the Example Service Application (UA)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrkr" title="To Secure the Example Web Service Client Application (UA)">To Secure the Example Web Service Client Application
                (UA)</a></p></li></ul></div><div class="task" title="To Secure the Example Service Application (UA)"><a name="gfrhw"></a><p class="title"><b>To Secure the Example Service Application (UA)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    security to both the web service and to the web service
                    client.</p>

                    <p>For this example, the security mechanism of <a class="xref" href="ch12.html#ahicv" title="12.3.1.&nbsp;Username Authentication with Symmetric Key">Username Authentication with Symmetric Key</a> is used to
                    secure the application. To add security to the service
                    part of the example, follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> . </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet) </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, then right-click
                        the node for the web service (CalculatorWS) and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Deselect Reliable
                        Messaging if it is selected.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> In the
                        CalculatorWSPortBinding section, select Secure
                        Service. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select Username Authentication
                        with Symmetric Key. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select Use Development
                        Defaults to set up the keystore and truststore files,
                        and to create a user for this application, if needed.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Click OK to close the
                        <code class="code">CalculatorWSService</code> dialog.
                        </strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Web Pages | WEB-INF,
                        then double-click the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code> .
                        This file contains the security elements within
                        <code class="code">wsp:Policy</code> tags.</p><p>An example of this file can be viewed in the
                        tutorial by clicking this link: <a class="xref" href="ch13.html#ahifh" title="13.2.1.&nbsp;Service-Side WSIT Configuration Files">Service-Side WSIT Configuration Files</a> .</p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run. A browser
                        will open and display the WSDL file for the
                        application. </strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong> Follow the steps to
                        secure the client application as described in <a class="xref" href="ch12.html#gfrkr" title="To Secure the Example Web Service Client Application (UA)">To Secure the Example Web Service Client Application
                (UA)</a> .
                        </strong></span></p></li></ol></div></div><div class="task" title="To Secure the Example Web Service Client Application (UA)"><a name="gfrkr"></a><p class="title"><b>To Secure the Example Web Service Client Application
                (UA)</b></p><div class="tasksummary">
                    <p>This section demonstrates adding security to the web
                    service client that references the web service created in
                    the previous section. This web service is secured using
                    the security mechanism described in <a class="xref" href="ch12.html#ahicv" title="12.3.1.&nbsp;Username Authentication with Symmetric Key">Username Authentication with Symmetric Key</a> . When this security mechanism
                    is used with a web service, the web service client must
                    provide a username and password in addition to specifying
                    the certificate of the server.</p>

                    <p>To add security to the client that references this
                    web service, complete the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the client
                        application by following the steps described in <a class="xref" href="ch02.html#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> . </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Whenever you make changes on the service,
                                refresh the client so that the client will pick up
                                the change. To refresh the client, right-click the
                                node for the Web Service Reference for the client,
                                and select Refresh Client.</p></div></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand the node for the
                        web service client application,
                        CalculatorWSServletClient. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Expand the Web Service
                        References node.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Right-click on
                        CalculatorWSService, select Edit Web Service
                        Attributes. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> In the Security section
                        of the Quality of Service tab, select Use Development
                        Defaults. Click OK to close. </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>By default, the user name of
                                <span class="emphasis"><em>wsitUser</em></span> and the password of
                                <span class="emphasis"><em>changeit</em></span> will be entered in
                                this section. If the example doesn't run, make sure
                                that you have a user with this name and password set
                                up in the file realm of the Application Server or
                                GlassFish, as described in <a class="xref" href="ch12.html#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a> .</p></div></li><li class="step" title="Step 6"><p><span class="bold"><strong> If you'd like to, in the
                        tree, drill down from the project to Source Packages |
                        META-INF. Double-click on
                        <code class="code">CalculatorWSService.xml</code> , and verify that
                        lines similar to the following are present:
                        </strong></span></p><div class="example"><a name="d0e9424"></a><p class="title"><b>Example&nbsp;12.8.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;wsp:All&gt;
   &lt;sc:TrustStore
         wspp:visibility="private"
         location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
         storepass="changeit" peeralias="xws-security-server"/&gt;
   &lt;sc:CallbackHandlerConfiguration wspp:visibility="private"&gt;
      &lt;sc:CallbackHandler default="wsitUser" name="usernameHandler"/&gt;
      &lt;sc:CallbackHandler default="changeit" name="passwordHandler"/&gt;
   &lt;/sc:CallbackHandlerConfiguration&gt;
&lt;/wsp:All&gt;</pre></div></div><br class="example-break"><p>By selecting Use Development Defaults when
                        securing the service, these values are automatically
                        generated for you.</p><p>An example of this file can be viewed in the
                        tutorial by clicking this link: <a class="xref" href="ch13.html#ahifi" title="13.2.2.&nbsp;Client-Side WSIT Configuration Files">Client-Side WSIT Configuration Files</a> .</p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Right-click the
                        CalculatorWSServletClient node and select Run. The
                        result of the add operation will display in a browser
                        window. </strong></span></p></li></ol></div></div></div><div class="section" title="12.9.2.&nbsp;Example: Username with Digest Passwords"><div class="titlepage"><div><div><h3 class="title"><a name="UsernameWithDigestPasswords"></a>12.9.2.&nbsp;Example: Username with Digest Passwords</h3></div></div></div><p>This example is similar to <a class="xref" href="ch12.html#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a> except that digest passwords (along
            with Created and Nonce) are used in
            <span class="emphasis"><em>UsernameToken</em></span>, and
            <span class="emphasis"><em>UsernameToken</em></span> is not encrypted in the
            message.</p><p>To Secure the Service Application, all the steps remain
            same, except for step 6. For step 6, do the following:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="bold"><strong> Click on Configure, select
                    Support Hash Passwords. Click OK. </strong></span></p></li><li class="listitem"><p><span class="bold"><strong> Unselect Use Development
                    Defaults, if already selected. Specify the KeyStore. Click
                    on Validators, and specify the username validator.
                    </strong></span></p><p>The Username Validator created should extend
                    <span class="emphasis"><em>PasswordValidationCallback.WsitDigestPasswordValidator</em></span>.
                    Here is a sample UsernameValidator for Digest passwords.
                    </p><div class="example"><a name="d0e9467"></a><p class="title"><b>Example&nbsp;12.9.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">import com.sun.xml.wss.impl.callback.PasswordValidationCallback;

public class SampleWsitDigestPasswordValidator extends
        PasswordValidationCallback.WsitDigestPasswordValidator {
    public  void setPassword(PasswordValidationCallback.Request request){
        //Get this password from somewhere - for example a JDBC Realm
        String passwd = "abcd!1234";
        PasswordValidationCallback.DigestPasswordRequest req =
                (PasswordValidationCallback.DigestPasswordRequest)request;
        req.setPassword(passwd);
    }
}</pre></div></div><p><br class="example-break"> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Use of Digest Passwords can be supported for
                            any realm which store plain passwords (not hashed
                            ones). Currently this is supported for JDBC realm in
                            Glassfish. Or optionally, a user can write his own
                            custom realm.</p></div></li></ol></div><p>The steps for securing the client remain same as in <a class="xref" href="ch12.html#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a>.</p></div><div class="section" title="12.9.3.&nbsp;Example: Mutual Certificates Security (MCS)"><div class="titlepage"><div><div><h3 class="title"><a name="ahiem"></a>12.9.3.&nbsp;Example: Mutual Certificates Security (MCS)</h3></div></div></div><p>The section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#gfrlc" title="To Secure the Example Service Application (MCS)">To Secure the Example Service Application (MCS)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrkw" title="To Secure the Example Web Service Client Application (MCS)">To Secure the Example Web Service Client Application
                (MCS)</a></p></li></ul></div><div class="task" title="To Secure the Example Service Application (MCS)"><a name="gfrlc"></a><p class="title"><b>To Secure the Example Service Application (MCS)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    security to both the web service and to the web service
                    client.</p>

                    <p>For this example, the security mechanism of <a class="xref" href="ch12.html#ahicw" title="12.3.3.&nbsp;Mutual Certificates Security">Mutual Certificates Security</a> is used to
                    secure the application. To add security to the service
                    part of the example, follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> . </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet) </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, then right-click
                        the node for the web service, CalculatorWS, and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Deselect Reliable
                        Messaging if it is selected.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select Mutual Certificates
                        Security. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong>Select Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click OK to close the
                        dialog.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Web Pages | WEB-INF,
                        then double-click the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code> .
                        This file contains the security elements within
                        <code class="code">wsp:Policy</code> tags.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run.
                        </strong></span></p><p>A browser will open and display the WSDL file
                        for the application.</p></li><li class="step" title="Step 9"><p><span class="bold"><strong> Verify that the WSDL file
                        contains the <code class="code">AsymmetricBinding</code> element.
                        </strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> Follow the steps to
                        secure the client application as described in <a class="xref" href="ch12.html#gfrkw" title="To Secure the Example Web Service Client Application (MCS)">To Secure the Example Web Service Client Application
                (MCS)</a> .
                        </strong></span></p></li></ol></div></div><div class="task" title="To Secure the Example Web Service Client Application (MCS)"><a name="gfrkw"></a><p class="title"><b>To Secure the Example Web Service Client Application
                (MCS)</b></p><div class="tasksummary">
                    <p>This section demonstrates adding security to the web
                    service client that references the web service created in
                    the previous section. This web service is secured using
                    the security mechanism described in <a class="xref" href="ch12.html#ahicw" title="12.3.3.&nbsp;Mutual Certificates Security">Mutual Certificates Security</a> .</p>

                    <p>To add security to the client that references this
                    web service, complete the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the client
                        application following the steps described in <a class="xref" href="ch02.html#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> . </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Whenever you make changes on the service,
                                refresh the client so that the client will pick up
                                the change. To refresh the client, right-click the
                                node for the Web Service Reference for the client,
                                and select Refresh Client.</p></div></li><li class="step" title="Step 2"><p><span class="bold"><strong> If you'd like, in the
                        tree, drill down from the project to Source Packages |
                        META-INF. Double-click on
                        <code class="code">CalculatorWSService.xml</code> , click the
                        Source tab, and look at the section in the section
                        <code class="code">&lt;wsp:All&gt;</code> to see the WSIT code that
                        has been added to this configuration file.
                        </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Compile and run this
                        application by right-clicking the
                        CalculatorWSServletClient node and selecting Run. The
                        result of the add operation will display in a browser
                        window. </strong></span></p></li></ol></div></div></div><div class="section" title="12.9.4.&nbsp;Example: Transport Security (SSL)"><div class="titlepage"><div><div><h3 class="title"><a name="ahiep"></a>12.9.4.&nbsp;Example: Transport Security (SSL)</h3></div></div></div><p>This section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#gfrkg" title="To Secure the Example Service Application (SSL)">To Secure the Example Service Application (SSL)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrlg" title="To Secure the Example Web Service Client Application (SSL)">To Secure the Example Web Service Client Application
                (SSL)</a></p></li></ul></div><div class="task" title="To Secure the Example Service Application (SSL)"><a name="gfrkg"></a><p class="title"><b>To Secure the Example Service Application (SSL)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    transport security to both the web service and to the web
                    service client.</p>

                    <p>For this example, the security mechanism of <a class="xref" href="ch12.html#ahicx" title="12.3.5.&nbsp;Transport Security (SSL)">Transport Security (SSL)</a> is used to
                    secure the application. To add security to the service
                    part of the example, follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> : </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet) </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, then right-click
                        the node for the web service, CalculatorWS, and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Deselect Reliable
                        Messaging if it is selected.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select Transport Security
                        (SSL). </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong>Select Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click OK to close the
                        dialog.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Web Pages | WEB-INF,
                        then double-click the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code> .
                        This file contains the security elements within
                        <code class="code">wsp:Policy</code> tags.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong> To require the service to
                        use the HTTPS protocol, security requirements must be
                        specified in the service's application deployment
                        descriptor, which is <code class="code">web.xml</code> for a web
                        service implemented as a servlet. Selecting Use
                        Development Defaults takes care of this task for you.
                        </strong></span></p><p>To view or change the security information,
                        follow these steps:</p><ol type="a" class="substeps"><li class="step" title="Step 8.a"><p><span class="bold"><strong>From your web service
                                application, expand Web Pages |
                                WEB-INF.</strong></span></p></li><li class="step" title="Step 8.b"><p><span class="bold"><strong> Double-click
                                <code class="code">web.xml</code> to open it in the editor.
                                </strong></span></p></li><li class="step" title="Step 8.c"><p><span class="bold"><strong>Select the Security
                                tab.</strong></span></p></li><li class="step" title="Step 8.d"><p><span class="bold"><strong> Expand the Security
                                Constraint named <code class="code"> SSL transport for
                                CalculatorWSService </code> . </strong></span></p></li><li class="step" title="Step 8.e"><p><span class="bold"><strong> A Web Resource
                                Collection named <code class="code">Secure Area</code> contains
                                the URL Pattern to be protected,
                                <code class="code">/CalculatorWSService//*</code> and the HTTP
                                Methods to be protected, , POST. </strong></span></p></li><li class="step" title="Step 8.f"><p><span class="bold"><strong>Unselect Enable
                                Authentication Constraint if it is
                                selected.</strong></span></p></li><li class="step" title="Step 8.g"><p><span class="bold"><strong> The Enable User Data
                                Constraint box is checked and CONFIDENTIAL is chosen
                                as the Transport Guarantee to specify that the
                                application uses SSL. </strong></span></p></li><li class="step" title="Step 8.h"><p><span class="bold"><strong> Click the XML tab to
                                view the resulting deployment descriptor additions.
                                </strong></span></p></li></ol></li><li class="step" title="Step 9"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run. If the
                        server presents its certificate, s1as, accept this
                        certificate. A browser will open and display the WSDL
                        file for the application. </strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> Follow the steps to
                        secure the client application as described in <a class="xref" href="ch12.html#gfrlg" title="To Secure the Example Web Service Client Application (SSL)">To Secure the Example Web Service Client Application
                (SSL)</a> .
                        </strong></span></p></li></ol></div></div><div class="task" title="To Secure the Example Web Service Client Application (SSL)"><a name="gfrlg"></a><p class="title"><b>To Secure the Example Web Service Client Application
                (SSL)</b></p><div class="tasksummary">
                    <p>This section demonstrates adding security to the web
                    service client that references the web service created in
                    the previous section. This web service is secured using
                    the security mechanism described in <a class="xref" href="ch12.html#ahicx" title="12.3.5.&nbsp;Transport Security (SSL)">Transport Security (SSL)</a> .</p>

                    <p>To add security to the client that references this
                    web service, complete the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the client
                        application by following the steps described in <a class="xref" href="ch02.html#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> , with the exception that
                        you need to specify the secure WSDL when creating the
                        Web Service Client. </strong></span></p><p>To do this, create the client application up to
                        the step where you create the Servlet (step 5 as of
                        this writing) by following the steps described in
                        <a class="xref" href="ch02.html#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> , with the following
                        exception.</p><p>In the step where you are directed to cut and
                        paste the URL of the web service that you want the
                        client to consume into the WSDL URL field, type
                        <span class="emphasis"><em>https</em></span> <code class="code">://</code>
                        <span class="emphasis"><em>fully-qualified-hostname:8181</em></span>
                        <code class="code">/CalculatorApplication/CalculatorWSService?wsdl</code>
                        (changes indicated in bold) to indicate that this
                        client should reference the web service using the
                        secure port. The first time you access this service,
                        accept the certificate (s1as) when you are prompted.
                        This is the server certificate popping up to confirm
                        its identity to the client.</p><p>In some cases, you might get an error dialog
                        telling you that the URL <code class="code">https://</code>
                        <span class="emphasis"><em>fully-qualified-hostname</em></span>
                        <code class="code">:8181/CalculatorApplication/CalculatorWSService?wsdl</code>
                        couldn't be downloaded. However, this the correct URL,
                        and it does load when you run the service. So, when
                        this error occurs, repeat the steps that create the
                        Web Service Client using the secure WSDL. The second
                        time, the web service reference is created and you can
                        continue creating the client.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you prefer to use localhost in place of the
                            fully-qualified hostname (FQHN) in this example, you
                            must follow the steps in <a class="xref" href="ch12.html#ahicy" title="12.3.5.1.&nbsp;Transport Security (SSL) Workaround">Transport Security (SSL) Workaround</a> .</p></div></li><li class="step" title="Step 2"><p><span class="bold"><strong> Continue creating the
                        client following the remainder of the instructions in
                        <a class="xref" href="ch02.html#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> . </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Some users are working through this document
                                and just making the recommended changes and
                                refreshing the client. For this example, you must
                                create a new client so that you can specify the
                                secure WSDL to create the correct setup for the
                                client.</p><p>Whenever you make changes on the service,
                                refresh the client so that the client will pick up
                                the change. To refresh the client, right-click the
                                node for the Web Service Reference for the client,
                                and select Refresh Client.</p></div></li><li class="step" title="Step 3"><p><span class="bold"><strong> Compile and run this
                        application by right-clicking on the
                        CalculatorWSServletClient node and selecting Run. The
                        result of the add operation will display in a browser
                        window. </strong></span></p></li></ol></div></div></div><div class="section" title="12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)"><div class="titlepage"><div><div><h3 class="title"><a name="ahies"></a>12.9.5.&nbsp;Example: SAML Authorization over SSL (SA)</h3></div></div></div><p>This section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#gfrkp" title="To Secure the Example Service Application (SA)">To Secure the Example Service Application (SA)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrkm" title="To Secure the Example Web Service Client Application (SA)">To Secure the Example Web Service Client Application
                (SA)</a></p></li></ul></div><div class="task" title="To Secure the Example Service Application (SA)"><a name="gfrkp"></a><p class="title"><b>To Secure the Example Service Application (SA)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    security to both the web service and to the web service
                    client.</p>

                    <p>For this example, the security mechanism of <a class="xref" href="ch12.html#ahida" title="12.3.7.&nbsp;SAML Authorization over SSL">SAML Authorization over SSL</a> is used to
                    secure the application. The steps are similar to the ones
                    described in <a class="xref" href="ch12.html#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a> , with the addition of the
                    writing of a client-side SAML callback handler to populate
                    the client's request with a SAML assertion.</p>

                    <p>To add security to the service part of the example,
                    follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> : </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet) </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, right-click the
                        node for the web service, CalculatorWS, and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Deselect the Reliable
                        Messaging option if it is selected.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select SAML Authorization over
                        SSL. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select Use Development
                        Defaults to have the <code class="code">web.xml</code> file
                        modified to include a security constraint that forces
                        the use of SSL. </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click OK to exit the
                        editor.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Web Pages | WEB-INF,
                        then double-click the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code> .
                        This file contains the security elements within
                        <code class="code">wsp:Policy</code> tags.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong> To require the service to
                        use the HTTPS protocol, security requirements must be
                        specified in the service's application deployment
                        descriptor, which is <code class="code">web.xml</code> for a web
                        service implemented as a servlet. Selecting Use
                        Development Defaults takes care of this task for you.
                        </strong></span></p><p>To view or change the security information in
                        the deployment descriptor, follow these steps:</p><ol type="a" class="substeps"><li class="step" title="Step 8.a"><p><span class="bold"><strong>From your web service
                                application, expand Web Pages |
                                WEB-INF.</strong></span></p></li><li class="step" title="Step 8.b"><p><span class="bold"><strong> Double-click
                                <code class="code">web.xml</code> to open it in the editor.
                                </strong></span></p></li><li class="step" title="Step 8.c"><p><span class="bold"><strong>Select the Security
                                tab.</strong></span></p></li><li class="step" title="Step 8.d"><p><span class="bold"><strong> Expand the Security
                                Constraint named <code class="code"> SSL transport for
                                CalculatorWSService </code> . </strong></span></p></li><li class="step" title="Step 8.e"><p><span class="bold"><strong> A Web Resource
                                Collection named <code class="code">Secure Area</code> contains
                                the URL Pattern to be protected,
                                <code class="code">/CalculatorWSService//*</code> and the HTTP
                                Methods to be protected, , POST. </strong></span></p></li><li class="step" title="Step 8.f"><p><span class="bold"><strong>Unselect Enable
                                Authentication Constraint if it is
                                selected.</strong></span></p></li><li class="step" title="Step 8.g"><p><span class="bold"><strong> The Enable User Data
                                Constraint box is checked and CONFIDENTIAL is chosen
                                as the Transport Guarantee to specify that the
                                application uses SSL. </strong></span></p></li><li class="step" title="Step 8.h"><p><span class="bold"><strong> Click the XML tab to
                                view the resulting deployment descriptor additions.
                                </strong></span></p></li></ol></li><li class="step" title="Step 9"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run. Accept the
                        <code class="code">s1as</code> certificate if you are prompted to.
                        A browser will open and display the WSDL file for the
                        application. </strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> Follow the steps to
                        secure the client application as described in <a class="xref" href="ch12.html#gfrkm" title="To Secure the Example Web Service Client Application (SA)">To Secure the Example Web Service Client Application
                (SA)</a> .
                        </strong></span></p></li></ol></div></div><div class="task" title="To Secure the Example Web Service Client Application (SA)"><a name="gfrkm"></a><p class="title"><b>To Secure the Example Web Service Client Application
                (SA)</b></p><div class="tasksummary">
                    <p>This section demonstrates adding security to the web
                    service client that references the web service created in
                    the previous section. This web service is secured using
                    the security mechanism described in <a class="xref" href="ch12.html#ahida" title="12.3.7.&nbsp;SAML Authorization over SSL">SAML Authorization over SSL</a> .</p>

                    <p>To add security to the client that references this
                    web service, complete the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> This example uses a
                        non-JSR-109-compliant client for variety. To do this,
                        create the client application up to the step where you
                        create the Servlet (step 5 as of this writing) by
                        following the steps described in <a class="xref" href="ch02.html#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> , with the following
                        exceptions: </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> In the step where you
                                are directed to cut and paste the URL of the web
                                service that you want the client to consume into the
                                WSDL URL field, type <code class="code">https://</code>
                                <span class="emphasis"><em>fully-qualified-hostname</em></span>
                                <code class="code">:8181/CalculatorApplication/CalculatorWSService?wsdl</code>
                                , to indicate that this client should reference the
                                web service using the secure port.
                                </strong></span></p><p>The first time you access this service, accept
                                the certificate ( <code class="code">s1as</code> ) when you are
                                prompted. This is the server certificate popping up
                                to confirm its identity to the client.</p><p>In some cases, you might get an error dialog
                                telling you that the URL <code class="code">https://</code>
                                <span class="emphasis"><em>fully-qualified-hostname</em></span>
                                <code class="code">:8181/CalculatorApplication/CalculatorWSService?wsdl</code>
                                couldn't be downloaded. However, this the correct
                                URL, and it does load when you run the service. So,
                                when this error occurs, repeat the steps that create
                                the Web Service Client using the secure WSDL. The
                                second time, the web service reference is created
                                and you can continue creating the client.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you prefer to use <code class="code">localhost</code> in
                                    place of the fully-qualified hostname (FQHN) in this
                                    example, follow the steps in <a class="xref" href="ch12.html#ahicy" title="12.3.5.1.&nbsp;Transport Security (SSL) Workaround">Transport Security (SSL) Workaround</a> .</p></div></li><li class="step" title="Step 1.b"><p><span class="bold"><strong> Name the application
                                CalculatorClient (since it's not a servlet.).
                                </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Instead of creating a
                        client servlet as is described in <a class="xref" href="ch02.html#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> , just add the web service
                        operation to the generated <code class="code">index.jsp</code> file
                        to create a non-JSR-109 client. To do this, perform
                        these steps: </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 2.a"><p><span class="bold"><strong> If the
                                <code class="code">index.jsp</code> file is not open in the right
                                pane, expand Web Pages, then double-click
                                <code class="code">index.jsp</code> to open it.
                                </strong></span></p></li><li class="step" title="Step 2.b"><p><span class="bold"><strong> Drill down through the
                                Web Service References node until you get to the
                                <code class="code">add</code> operation. </strong></span></p></li><li class="step" title="Step 2.c"><p><span class="bold"><strong> Drag the
                                <code class="code">add</code> operation to the line immediately
                                following the following line: </strong></span></p><div class="example"><a name="d0e10112"></a><p class="title"><b>Example&nbsp;12.10.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;body&gt;</pre></div></div><br class="example-break"></li><li class="step" title="Step 2.d"><p><span class="bold"><strong> Edit the values for
                                <code class="code">i</code> and <code class="code">j</code> if you'd like.
                                </strong></span></p></li></ol></li><li class="step" title="Step 3"><p><span class="bold"><strong> Write a
                        <code class="code">SAMLCallback</code> handler for the client side
                        to populate a SAML assertion into the client's request
                        to the service. </strong></span></p><p>To create the <code class="code">SAMLCallbackHandler</code> ,
                        follow these steps:</p><ol type="a" class="substeps"><li class="step" title="Step 3.a"><p><span class="bold"><strong>Right-click the
                                CalculatorClient node.</strong></span></p></li><li class="step" title="Step 3.b"><p><span class="bold"><strong>Select New | Java
                                Package.</strong></span></p></li><li class="step" title="Step 3.c"><p><span class="bold"><strong> For Package Name, type
                                <code class="code">xwss.saml</code> and click Finish.
                                </strong></span></p></li><li class="step" title="Step 3.d"><p><span class="bold"><strong>Drill down from
                                CalculatorClient | Source Packages |
                                xwss.saml.</strong></span></p></li><li class="step" title="Step 3.e"><p><span class="bold"><strong>Right-click xwss.saml
                                and select New | Other.</strong></span></p></li><li class="step" title="Step 3.f"><p><span class="bold"><strong>From the Categories
                                list, select Java.</strong></span></p></li><li class="step" title="Step 3.g"><p><span class="bold"><strong> From the File Types
                                list, select Empty Java File and click Next.
                                </strong></span></p></li><li class="step" title="Step 3.h"><p><span class="bold"><strong> For Class Name, type
                                <code class="code">SamlCallbackHandler</code> and click Finish.
                                </strong></span></p><p>The empty file appears in the IDE.</p></li><li class="step" title="Step 3.i"><p><span class="bold"><strong> Download the example
                                file <code class="code">SamlCallbackHandler.java</code> from the
                                following URL: </strong></span></p><p><a class="link" href="http://xwss.java.net/servlets/ProjectDocumentList?folderID=6645&amp;expandFolder=6645&amp;folderID=6645" target="_top">http://xwss.java.net/servlets/ProjectDocumentList?folderID=6645&amp;expandFolder=6645&amp;folderID=6645</a></p></li><li class="step" title="Step 3.j"><p><span class="bold"><strong>Open the file in a text
                                editor.</strong></span></p></li><li class="step" title="Step 3.k"><p><span class="bold"><strong> Modify the
                                <code class="code">home</code> variable to provide the hard-coded
                                path to your GlassFish installation.
                                </strong></span></p><p>For example, modify the line:</p><div class="example"><a name="d0e10201"></a><p class="title"><b>Example&nbsp;12.11.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">String home = System.getProperty("WSIT_HOME");</pre></div></div><br class="example-break"><p>to</p><div class="example"><a name="d0e10206"></a><p class="title"><b>Example&nbsp;12.12.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">String home = "/home/glassfish";</pre></div></div><br class="example-break"></li><li class="step" title="Step 3.l"><p><span class="bold"><strong> Copy the contents of
                                this file into the
                                <code class="code">SamlCallbackHandler.java</code> window that is
                                displaying in the IDE. </strong></span></p></li></ol></li><li class="step" title="Step 4"><p><span class="bold"><strong>Drill down from
                        CalculatorClient | Web Service
                        References.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> Right-click
                        CalculatorWSService and select Edit Web Service
                        Attributes. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select the Quality of
                        Service tab of the CalculatorWSService dialog.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Unselect Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Enter the name of the
                        SAML Callback Handler written earlier in this section,
                        <code class="code">xwss.saml.SamlCallbackHandler</code> , into the
                        SAML Callback Handler field. </strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Click OK to close this
                        dialog.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> To view the WSIT
                        Configuration options, in the tree, drill down from
                        the project to Source Packages | META-INF.
                        Double-click <code class="code">CalculatorWSService.xml</code> ,
                        click the Source tab, and look for the lines where
                        <code class="code">xwss.saml.SamlCallbackHandler</code> is
                        specified as the SAML Callback Handler class for the
                        client. </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Compile and run this
                        application by right-clicking the CalculatorClient
                        node and selecting Run. The result of the
                        <code class="code">add</code> operation will display in a browser
                        window. </strong></span></p></li></ol></div></div></div><div class="section" title="12.9.6.&nbsp;Example: SAML Sender Vouches with Certificates (SV)"><div class="titlepage"><div><div><h3 class="title"><a name="ahiev"></a>12.9.6.&nbsp;Example: SAML Sender Vouches with Certificates (SV)</h3></div></div></div><p>This section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#gfrki" title="To Secure the Example Service Application (SV)">To Secure the Example Service Application (SV)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrjq" title="To Secure the Example Web Service Client Application (SV)">To Secure the Example Web Service Client Application
                (SV)</a></p></li></ul></div><div class="task" title="To Secure the Example Service Application (SV)"><a name="gfrki"></a><p class="title"><b>To Secure the Example Service Application (SV)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    security to both the web service and to the web service
                    client.</p>

                    <p>For this example, the security mechanism of <a class="xref" href="ch12.html#ahidc" title="12.3.9.&nbsp;SAML Sender Vouches with Certificates">SAML Sender Vouches with Certificates</a> is used to
                    secure the application. The steps are similar to the ones
                    described in <a class="xref" href="ch12.html#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a> , with the addition of the
                    writing of a client-side SAML callback handler to populate
                    the client's request with a SAML assertion.</p>

                    <p>To add security to the service part of the example,
                    follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> : </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet) </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, then right-click
                        the node for the web service, CalculatorWS, and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Deselect the Reliable
                        Messaging option if it is selected.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select SAML Sender Vouches
                        with Certificates. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select Use Development
                        Defaults. This step properly configures the keystore,
                        truststore, and default user for this security
                        mechanism. </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click
                        OK.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Web Pages | WEB-INF,
                        then double-click the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code> .
                        This file contains the security elements within
                        <code class="code">wsp:Policy</code> tags.</p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run. Accept the
                        <code class="code">s1as</code> certificate if you are prompted to.
                        </strong></span></p><p>A browser will open and display the WSDL file
                        for the application.</p></li><li class="step" title="Step 9"><p><span class="bold"><strong> Follow the steps to
                        secure the client application as described in <a class="xref" href="ch12.html#gfrjq" title="To Secure the Example Web Service Client Application (SV)">To Secure the Example Web Service Client Application
                (SV)</a> .
                        </strong></span></p></li></ol></div></div><div class="task" title="To Secure the Example Web Service Client Application (SV)"><a name="gfrjq"></a><p class="title"><b>To Secure the Example Web Service Client Application
                (SV)</b></p><div class="tasksummary">
                    <p>This section demonstrates adding security to the web
                    service client that references the web service created in
                    the previous section. This web service is secured using
                    the security mechanism described in <a class="xref" href="ch12.html#ahidc" title="12.3.9.&nbsp;SAML Sender Vouches with Certificates">SAML Sender Vouches with Certificates</a> .</p>

                    <p>To add security to the client that references this
                    web service, complete the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> This example uses a
                        non-JSR-109-compliant client. To do this, create the
                        client application up to the step where you create the
                        Servlet (step 5 as of this writing) by following the
                        steps described in <a class="xref" href="ch02.html#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> , with one exception: name
                        the application CalculatorClient (since it's not a
                        servlet.). </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong> Instead of creating a
                        client servlet as is described in <a class="xref" href="ch02.html#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> , just add the web service
                        operation to the generated <code class="code">index.jsp</code> file
                        to create a non-JSR-109 client. To do this, follow
                        these steps: </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 2.a"><p><span class="bold"><strong> If the
                                <code class="code">index.jsp</code> file is not open in the right
                                pane, double-click it to open it. </strong></span></p></li><li class="step" title="Step 2.b"><p><span class="bold"><strong> Drill down through the
                                Web Service References node until you get to the
                                <code class="code">add</code> operation. </strong></span></p></li><li class="step" title="Step 2.c"><p><span class="bold"><strong> Drag the
                                <code class="code">add</code> operation to the line immediately
                                following the following line: </strong></span></p><div class="example"><a name="d0e10422"></a><p class="title"><b>Example&nbsp;12.13.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;body&gt;</pre></div></div><br class="example-break"></li><li class="step" title="Step 2.d"><p><span class="bold"><strong> Edit the values for
                                <code class="code">i</code> and <code class="code">j</code> if you'd like.
                                </strong></span></p></li></ol></li><li class="step" title="Step 3"><p><span class="bold"><strong> Write a
                        <code class="code">SAMLCallback</code> handler for the client side
                        to populate a SAML assertion into the client's request
                        to the service. </strong></span></p><p>To create the <code class="code">SAMLCallbackHandler</code> ,
                        follow these steps:</p><ol type="a" class="substeps"><li class="step" title="Step 3.a"><p><span class="bold"><strong>Right-click the
                                CalculatorClient node.</strong></span></p></li><li class="step" title="Step 3.b"><p><span class="bold"><strong>Select New | Java
                                Package.</strong></span></p></li><li class="step" title="Step 3.c"><p><span class="bold"><strong> For Package Name, type
                                <code class="code">xwss.saml</code> and click Finish.
                                </strong></span></p></li><li class="step" title="Step 3.d"><p><span class="bold"><strong>Drill down from
                                CalculatorClient | Source Packages |
                                xwss.saml.</strong></span></p></li><li class="step" title="Step 3.e"><p><span class="bold"><strong>Right-click xwss.saml
                                and select New | Other.</strong></span></p></li><li class="step" title="Step 3.f"><p><span class="bold"><strong>From the Categories
                                list, select Java.</strong></span></p></li><li class="step" title="Step 3.g"><p><span class="bold"><strong> From the File Types
                                list, select Empty Java File and click Next.
                                </strong></span></p></li><li class="step" title="Step 3.h"><p><span class="bold"><strong> For Class Name, type
                                <code class="code">SamlCallbackHandler</code> and click Finish.
                                </strong></span></p><p>The empty file appears in the IDE.</p></li><li class="step" title="Step 3.i"><p><span class="bold"><strong> Download the example
                                file <code class="code">SamlCallbackHandler.java</code> from the
                                following URL: </strong></span></p><p><a class="link" href="http://xwss.java.net/servlets/ProjectDocumentList?folderID=6645&amp;expandFolder=6645&amp;folderID=6645" target="_top">http://xwss.java.net/servlets/ProjectDocumentList?folderID=6645&amp;expandFolder=6645&amp;folderID=6645</a></p></li><li class="step" title="Step 3.j"><p><span class="bold"><strong>Open the file in a text
                                editor.</strong></span></p></li><li class="step" title="Step 3.k"><p><span class="bold"><strong> Modify the
                                <code class="code">home</code> variable to provide the hard-coded
                                path to your GlassFish installation.
                                </strong></span></p><p>For example, modify the line:</p><div class="example"><a name="d0e10511"></a><p class="title"><b>Example&nbsp;12.14.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">String home = System.getProperty("WSIT_HOME");</pre></div></div><br class="example-break"><p>to</p><div class="example"><a name="d0e10516"></a><p class="title"><b>Example&nbsp;12.15.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">String home = "/home/glassfish";</pre></div></div><br class="example-break"></li><li class="step" title="Step 3.l"><p><span class="bold"><strong> Copy the contents of
                                this file into the
                                <code class="code">SamlCallbackHandler.java</code> window that is
                                displaying in the IDE. </strong></span></p></li></ol></li><li class="step" title="Step 4"><p><span class="bold"><strong>Drill down from
                        CalculatorClient | Web Service
                        References.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> Right-click on
                        CalculatorWSService and select Edit Web Service
                        Attributes. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select the Quality of
                        Service tab of the CalculatorWSService dialog.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> In the SAML Callback
                        Handler field, type the name of the class written in
                        step 3 above,
                        <code class="code">xwss.saml.SamlCallbackHandler</code> .
                        </strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Configure the keys: Click
                        on the keystore button, select the alias
                        "xws-security-client", enter the password "changeit",
                        in the password field. Submit this dialog; Click on
                        the truststore button, select the alias
                        "xws-security-server". Submit the dialog.
                        </strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Click OK to close this
                        dialog.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> In the tree, drill down
                        from the project to Source Packages | META-INF.
                        Double-click CalculatorWSService.xml, click the Source
                        tab, and look for that lines where
                        <code class="code">xwss.saml.SamlCallbackHandler</code> is
                        specified as the SAML Callback Handler class for the
                        client. In some instances, NetBeans will not correctly
                        specify the keystore and truststore information for
                        non-JSR-196 clients, and thus will require that the
                        keystore and truststore entries be manually
                        configured. To do this, follow the example in this
                        section. </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 10.1"><p><span class="bold"><strong> Find the
                                <code class="code">sc:KeyStore</code> and
                                <code class="code">sc:TrustStore</code> elements. If these
                                elements contain parameters for
                                <code class="code">location</code> and <code class="code">storepass</code> in
                                CalculatorWSService.xml, then just continue to the
                                next step. If not, replace the existing keystore and
                                truststore attributes to include these parameters.
                                The following code shows an example of how these
                                elements should be specified. </strong></span></p><div class="example"><a name="d0e10578"></a><p class="title"><b>Example&nbsp;12.16.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sc:TrustStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
   storepass="changeit" peeralias="xws-security-server"/&gt;
&lt;sc:KeyStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\keystore.jks"
   storepass="changeit" alias="xws-security-client"/&gt;</pre></div></div><br class="example-break"></li>
                        </ul></li><li class="step" title="Step 11"><p><span class="bold"><strong> Compile and run this
                        application by right-clicking the CalculatorClient
                        node and selecting Run. The result of the add
                        operation will display in a browser window.
                        </strong></span></p></li></ol></div></div></div><div class="section" title="12.9.7.&nbsp;Example: STS Issued Token (STS)"><div class="titlepage"><div><div><h3 class="title"><a name="ahiey"></a>12.9.7.&nbsp;Example: STS Issued Token (STS)</h3></div></div></div><p>This section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#gfrlq" title="To Create and Secure the STS (STS)">To Create and Secure the STS (STS)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrmw" title="To Secure the Example Service Application (STS)">To Secure the Example Service Application (STS)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrls" title="To Secure the Example Web Service Client Application (STS)">To Secure the Example Web Service Client Application
                (STS)</a></p></li></ul></div><p>Another STS example application can be found at the
            following URL: <a class="link" href="http://java.net/projects/wsit/sources/svn/show/trunk/wsit/samples/ws-trust" target="_top">http://java.net/projects/wsit/sources/svn/show/trunk/wsit/samples/ws-trust</a>
            .</p><div class="task" title="To Create and Secure the STS (STS)"><a name="gfrlq"></a><p class="title"><b>To Create and Secure the STS (STS)</b></p><div class="tasksummary">
                    <p>To create and secure a Security Token Service for
                    this example, follow these steps. </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>For development with NetBeans 6.8, there are
                            some temporary setup changes that will need to be
                            done--see <a class="link" href="http://old.nabble.com/Create-STS-with-Netbeans-6.8-and-Glassfish-V3-td27597150r0.html" target="_top">here</a>
                            for more details.</p></div>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create a new project for
                        the STS by selecting File | New Project.
                        </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Java Web, then Web
                        Application, then Next.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Type
                        <code class="code">MySTSProject</code> for the Project Name, then
                        Next, then the desired Server. Click
                        Finish.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Right-click the
                        <code class="code">MySTSProject</code> node, select New, then
                        select Other. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Web Services from
                        the Categories list.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select Secure Token
                        Service (STS) from the File Type(s) list, then click
                        Next. </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Type the name
                        <code class="code">MySTS</code> for the Web Service Class Name.
                        </strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Enter or select
                        <code class="code">org.me.my.sts</code> in the Package field, then
                        click Finish. If prompted to reload the
                        <code class="code">catalog.xml</code> file, click No.
                        </strong></span></p><p>The IDE takes a while to create the STS. When
                        created, it appears under the project's Web Services
                        node as <code class="code">MySTSService</code> .</p></li><li class="step" title="Step 9"><p><span class="bold"><strong> The STS wizard creates an
                        implementation of the provider class. To view it,
                        expand Source Packages, then org.me.my.sts.
                        Double-click <code class="code">MySTS.java</code> to open it in the
                        right pane. </strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> In the Projects window,
                        expand the MySTSProject node, then expand the Web
                        Services node. Right-click the
                        MySTSService[IMySTSService_Port] node and select Edit
                        Web Service Attributes to configure the STS.
                        </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Select the "Version
                        Compatibility" to ".NET 3.5 / Metro 1.3" ( e.g. see
                        <a class="xref" href="ch12.html#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a> ) .
                        It will use WS-SX version of all WS-* specifications.
                        </strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong>Select Secure Service if
                        it's not already selected.</strong></span></p></li><li class="step" title="Step 13"><p><span class="bold"><strong> Verify that the Security
                        Mechanism of Username Authentication with Symmetric
                        Key is selected. </strong></span></p></li><li class="step" title="Step 14"><p><span class="bold"><strong> Select the Configure
                        button. For Algorithm Suite, verify that Basic128 bit
                        is selected (so that it matches the value selected for
                        the service.) Select OK to close the configuration
                        dialog. </strong></span></p></li><li class="step" title="Step 15"><p><span class="bold"><strong> If not already selected,
                        select Act as Secure Token Service (STS). </strong></span>
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you'd like to use an STS other than the
                                default, click the STS Configure button, and click
                                the Add button to add a different service provider.
                                Click OK to close the STS Configuration
                                dialog.</p></div></li><li class="step" title="Step 16"><p><span class="bold"><strong> Click Configure. In the
                        Issuer field, enter MySTS. Click OK to close.
                        </strong></span></p></li><li class="step" title="Step 17"><p><span class="bold"><strong> Click the Keystore button
                        to provide your keystore with the alias identifying
                        the service certificate and private key. To do this,
                        click the Load Aliases button, select
                        <code class="code">wssip</code> , then click OK to close the
                        dialog. </strong></span></p></li><li class="step" title="Step 18"><p><span class="bold"><strong>Click
                        OK.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Configuration Files |
                        xml-resources | web-services | MySTS | wsdl, then
                        double-click the file <code class="code">MySTSService.wsdl</code> .
                        This file contains the
                        <code class="code">tc:STSConfiguration</code> element within the
                        <code class="code">wsp:Policy</code> elements..</p></li><li class="step" title="Step 19"><p><span class="bold"><strong> Right-click the
                        MySTSProject tab, select Properties. Select the Run
                        category, and type the following in the Relative URL
                        field: <code class="code">/MySTSService?wsdl</code> .
                        </strong></span></p></li><li class="step" title="Step 20"><p><span class="bold"><strong>Run the Project
                        (right-click the project and select
                        Run).</strong></span></p><p>The STS WSDL appears in the browser.</p></li></ol></div></div><p>Check <a class="xref" href="ch13.html#custom-sts" title="13.4.&nbsp;Building custom STS">Building custom STS</a>
            to build a custom STS to control the user attributes to be
            included in the SAML assertion.</p><div class="task" title="To Secure the Example Service Application (STS)"><a name="gfrmw"></a><p class="title"><b>To Secure the Example Service Application (STS)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    security to both the web service and to the web service
                    client.</p>

                    <p>For this example, the security mechanism of <a class="xref" href="ch12.html#ahide" title="12.3.11.&nbsp;STS Issued Token">STS Issued Token</a> is used to
                    secure the application. The steps are similar to the ones
                    described in <a class="xref" href="ch12.html#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a> , with the addition of
                    creating and securing an STS.</p>

                    <p>To add security to the service part of the example,
                    follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> . </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet). </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, then right-click
                        the node for the web service, CalculatorWS, and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Select the "Version
                        Compatibility" to ".NET 3.5 / Metro 1.3" ( e.g. see
                        <a class="xref" href="ch12.html#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a> ) .
                        It will use WS-SX version of all WS-* specifications.
                        </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Deselect the Reliable
                        Messaging option if it is selected.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select STS Issued Token.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Click Configure. For
                        Issuer Address and Issuer Metadata Address, enter
                        <code class="code">http://localhost:8080/MySTSProject/MySTSService</code>
                        . For Issuer Metadata, enter
                        <code class="code">http://localhost:8080/MySTSProject/MySTSService/mex</code>
                        </strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> For Algorithm Suite,
                        select Basic 128 bit. For Key Size, select 128 (the
                        algorithm suite value of the service must match the
                        algorithm suite value of the STS). Select OK to close
                        the configuration dialog. </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you have configured Unlimited Strength
                                Encryption as described in <a class="xref" href="ch12.html#gfrig" title="To Create a Third-Party STS">To Create a Third-Party STS</a> , you can leave the key
                                size at 256. Otherwise, you must set it to
                                128.</p></div></li><li class="step" title="Step 9"><p><span class="bold"><strong>Select Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong>Click
                        OK.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Web Pages | WEB-INF,
                        then double-click the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code>
                        and select the Source page. This file contains the
                        security elements within <code class="code">wsp:Policy</code>
                        tags.</p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run. This step
                        compiles the application and deploys it onto
                        GlassFish. A browser will open and display the WSDL
                        file for the application. </strong></span></p></li></ol></div></div><div class="task" title="To Secure the Example Web Service Client Application (STS)"><a name="gfrls"></a><p class="title"><b>To Secure the Example Web Service Client Application
                (STS)</b></p><div class="tasksummary">
                    <p>This section demonstrates adding security to the
                    CalculatorApplication's web service client. The service
                    was secured using the security mechanism described in
                    <a class="xref" href="ch12.html#ahide" title="12.3.11.&nbsp;STS Issued Token">STS Issued Token</a> .</p>

                    <p>To add security to the web service client, complete
                    the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the client
                        application by following the steps described in <a class="xref" href="ch02.html#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> . </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Whenever you make changes on the service,
                                refresh the client so that the client will pick up
                                the change. To refresh the client, right-click the
                                node for the Web Service Reference for the client,
                                and select Refresh Client.</p></div></li><li class="step" title="Step 2"><p><span class="bold"><strong> Drill down from
                        CalculatorWSServletClient | Web Service References.
                        </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Right-click
                        CalculatorWSService and select Edit Web Service
                        Attributes, then select the Quality of Service tab.
                        </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Provide the client's
                        private key by pointing to an alias in the keystore.
                        To do this, click the Keystore button, click the Load
                        Aliases button, and select
                        <code class="code">xws-security-client</code> from the Alias list.
                        </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> Provide the service's
                        certificate by pointing to an alias in the client
                        truststore. To do this, click the Truststore button,,
                        click the Load Aliases button for the truststore and
                        select <code class="code">xws-security-server</code> from the Alias
                        list. </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 5.1"><p><span class="bold"><strong> In some instances,
                                NetBeans will not detect that this client is a
                                JSR-196 client, and thus will require that the
                                keystore and truststore entries be manually
                                configured. To do this, follow the steps in this
                                section. </strong></span></p></li>

                            <li class="step" title="Step 5.2"><p><span class="bold"><strong>Expand
                                CalculatorWSServletClient | Source Packages |
                                META-INF.</strong></span></p></li>

                            <li class="step" title="Step 5.3"><p><span class="bold"><strong> Double-click
                                CalculatorWSService.xml to open it in the Source
                                window. Click the Source tab to view the code. Find
                                the <code class="code">sc:KeyStore</code> and
                                <code class="code">sc:TrustStore</code> elements. If these
                                elements contain parameters for
                                <code class="code">location</code> and <code class="code">storepass</code> ,
                                then just continue to the next section. If not, add
                                these attributes to this file. The following code
                                shows an example of how these elements should be
                                specified. </strong></span></p><div class="example"><a name="d0e10945"></a><p class="title"><b>Example&nbsp;12.17.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sc:TrustStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
   storepass="changeit" peeralias="xws-security-server"/&gt;
&lt;sc:KeyStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\keystore.jks"
   storepass="changeit" alias="xws-security-client"/&gt;</pre></div></div><br class="example-break"></li>
                        </ul></li><li class="step" title="Step 6"><p><span class="bold"><strong> Expand the Security Token
                        Service node to provide details for the STS to be
                        used. When the Endpoint and the Metadata values are
                        the same, you only need to enter the Endpoint value.
                        For the Endpoint field, enter the following value:
                        http://localhost:8080/MySTSProject/MySTSService. For
                        WS Trust Version field, select 1.3 if STS endpoint
                        uses ".NET 3.5 / Metro 1.3" version compatibility.
                        Otherwise use the default WS Trust Version.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong>Click OK to close this
                        dialog.</strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> The service requires a
                        token to be issued from the STS at
                        <code class="code">http://localhost:8080/MySTSProject/MySTSService</code>
                        , with WSDL file
                        <code class="code">http://localhost:8080/MySTSProject/MySTSService?wsdl</code>
                        . To do this, follow these steps: </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 8.a"><p><span class="bold"><strong> Right-click the
                                CalculatorWSServletClient node and select New | Web
                                Service Client. </strong></span></p><p>The New Web Service Client window
                                appears.</p></li><li class="step" title="Step 8.b"><p><span class="bold"><strong>Select the WSDL URL
                                option.</strong></span></p></li><li class="step" title="Step 8.c"><p><span class="bold"><strong> Cut and paste the URL
                                of the web service that you want the client to
                                consume into the WSDL URL field. For this example,
                                here is the URL for the <code class="code">MySTS</code> web
                                service: </strong></span></p><pre class="programlisting">http://localhost:8080/MySTSProject/MySTSService?wsdl</pre></li><li class="step" title="Step 8.d"><p><span class="bold"><strong> Type
                                <code class="code">org.me.calculator.client.sts</code> in the
                                Package field, then click Finish. </strong></span></p><p>The Projects window displays the new web
                                service client.</p></li></ol></li><li class="step" title="Step 9"><p><span class="bold"><strong> Drill down from
                        CalculatorWSServletClient | Web Service References.
                        </strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong>Right-click MySTSService
                        and select Edit Web Service
                        Attributes.</strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Select the Quality of
                        Service tab of the MySTSService dialog.
                        </strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong> Provide the client's
                        private key by pointing to an alias in the keystore.
                        To do this, click the Keystore button, click the Load
                        Aliases button, and select
                        <code class="code">xws-security-client</code> from the Alias list.
                        If the Keystore button is not selectable, follow the
                        instructions in the next step for adding the keystore
                        entry manually. </strong></span></p></li><li class="step" title="Step 13"><p><span class="bold"><strong> Verify the STS's
                        certificate by pointing to an alias in the client
                        truststore. To do this, click the Truststore button,,
                        click the Load Aliases button and select
                        <code class="code">wssip</code> from the Alias list.
                        </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 13.1"><p><span class="bold"><strong> In some instances,
                                NetBeans will not detect that this client is a
                                JSR-196 client, and thus will require that the
                                keystore and truststore entries be manually
                                configured. To do this, follow the steps in this
                                section. </strong></span></p></li>

                            <li class="step" title="Step 13.2"><p><span class="bold"><strong>Expand
                                CalculatorWSServletClient | Source Packages |
                                META-INF.</strong></span></p></li>

                            <li class="step" title="Step 13.3"><p><span class="bold"><strong> Double-click
                                MySTSService.xml to open it in the Source window.
                                Click the Source tab to view the code. Find the
                                <code class="code">sc:KeyStore</code> and
                                <code class="code">sc:TrustStore</code> elements. If these
                                elements contain parameters for
                                <code class="code">location</code> and <code class="code">storepass</code> ,
                                then just continue to the next section. If not, add
                                these attributes to this file. The following code
                                shows an example of how these elements should be
                                specified. </strong></span></p><div class="example"><a name="d0e11050"></a><p class="title"><b>Example&nbsp;12.18.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sc:TrustStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
   storepass="changeit" peeralias="wssip"/&gt;
&lt;sc:KeyStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\keystore.jks"
   storepass="changeit" alias="xws-security-client"/&gt;</pre></div></div><br class="example-break"></li>
                        </ul></li><li class="step" title="Step 14"><p><span class="bold"><strong>Enter the default user
                        name and password.</strong></span></p><p>If you followed the steps in <a class="xref" href="ch12.html#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a> , this
                        will be User Name <code class="code">wsitUser</code> and Password
                        <code class="code">changeit</code> .</p></li><li class="step" title="Step 15"><p><span class="bold"><strong>Click OK to close this
                        dialog.</strong></span></p></li><li class="step" title="Step 16"><p><span class="bold"><strong> Compile and run this
                        application by right-clicking the
                        CalculatorWSServletClient project and selecting Run.
                        The result of the add operation will display in a
                        browser window. </strong></span></p></li></ol></div></div></div><div class="section" title="12.9.8.&nbsp;Example: Broker Trust STS (BT)"><div class="titlepage"><div><div><h3 class="title"><a name="ahiex"></a>12.9.8.&nbsp;Example: Broker Trust STS (BT)</h3></div></div></div><p>Broker Trust STS example illustrates the interaction between
            client and server of different domains through STS's of
            corresponding domains. In this kind of scenarios, STS of different
            domains must have a trust relationship between them. Lets take
            client/STS2 are in domain A, and server/STS1 are in domain B.
            Here, STS1 is the remote STS on the server domain(B) and STS2 is
            the local STS on the client domain(B). There is a trust
            relationship between STS1 and STS2. Here are steps which client
            has to follow to comminicate with server. </p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="bold"><strong> Client wants to
                        communicate with Server. </strong></span></p></li><li class="listitem"><p><span class="bold"><strong> Server asks Client to get
                        a token from STS1 to comminicate with it.
                        </strong></span></p></li><li class="listitem"><p><span class="bold"><strong> Now Client would like to
                        communicate with remote STS (i.e. STS1).
                        </strong></span></p></li><li class="listitem"><p><span class="bold"><strong> STS1 asks Client to get a
                        token from Client's local STS (i.e. STS2) to
                        comminicate with it. </strong></span></p></li><li class="listitem"><p><span class="bold"><strong> Now Client sends a
                        request to local STS (i.e. STS2) asking for a token to
                        communicate with STS1. </strong></span></p></li><li class="listitem"><p><span class="bold"><strong> STS2 issues a token to
                        Client, which Client uses to comminicate with STS1.
                        </strong></span></p></li><li class="listitem"><p><span class="bold"><strong> STS1 issues a token to
                        Client, which Client uses to comminicate with Server.
                        </strong></span></p></li><li class="listitem"><p><span class="bold"><strong> Now Client comminicates
                        with server using a token issued by STS1, which Server
                        understands. </strong></span></p></li></ul></div><p>This section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#gfrla" title="To Create and Secure the First STS (BT)">To Create and Secure the First STS (BT)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrlb" title="To Create and Secure the Second STS (BT)">To Create and Secure the Second STS (BT)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrmp" title="To Secure the Example Service Application (BT)">To Secure the Example Service Application (BT)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrlr" title="To Secure the Example Web Service Client Application (BT)">To Secure the Example Web Service Client Application
                (BT)</a></p></li></ul></div><div class="task" title="To Create and Secure the First STS (BT)"><a name="gfrla"></a><p class="title"><b>To Create and Secure the First STS (BT)</b></p><div class="tasksummary">
                    <p>To create and secure a Security Token Service(i.e.
                    Remote STS) for this example, follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create a new project for
                        the STS by selecting File | New Project.
                        </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Web, then Web
                        Application, then Next.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Type <code class="code">
                        MySTS1Project</code> for the Project Name, then click
                        Finish. </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Right-click the <code class="code">
                        MySTS1Project</code> node, select New, then select
                        Other. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Web Services from
                        the Categories list.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select Secure Token
                        Service (STS) from the File Type(s) list, then click
                        Next. </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Type the name
                        <code class="code">MySTS1</code> for the Web Service Class Name.
                        </strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Enter or select
                        <code class="code">org.me.my.sts1</code> in the Package field, then
                        click Finish. If prompted to reload the
                        <code class="code">catalog.xml</code> file, click No.
                        </strong></span></p><p>The IDE takes a while to create the first STS.
                        When created, it appears under the project's Web
                        Services node as <code class="code">MySTS1Service</code> .</p></li><li class="step" title="Step 9"><p><span class="bold"><strong> The STS wizard creates an
                        implementation of the provider class. To view it,
                        expand Source Packages, then org.me.my.sts1.
                        Double-click <code class="code">MySTS1.java</code> to open it in
                        the right pane. </strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> In the Projects window,
                        expand the MySTS1Service node, then expand the Web
                        Services node. Right-click the
                        MySTS1Service[IMySTS1Service_Port] node and select
                        Edit Web Service Attributes to configure the STS.
                        </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Select the "Version
                        Compatibility" to ".NET 3.5 / Metro 1.3" ( e.g. see
                        <a class="xref" href="ch12.html#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a> ) .
                        It will use WS-SX version of all WS-* specifications.
                        </strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong>Select Secure Service if
                        it's not already selected.</strong></span></p></li><li class="step" title="Step 13"><p><span class="bold"><strong> Verify that the Security
                        Mechanism of "STS Issued Token" is selected.
                        </strong></span></p></li><li class="step" title="Step 14"><p><span class="bold"><strong> Select the Configure
                        button. For Algorithm Suite, verify that Basic128 bit
                        is selected (so that it matches the value selected for
                        the service.) Select OK to close the configuration
                        dialog. </strong></span></p></li><li class="step" title="Step 15"><p><span class="bold"><strong> If not already selected,
                        select Act as Secure Token Service (STS). </strong></span>
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you'd like to use an STS other than the
                                default, click the STS Configure button, and click
                                the Add button to add a different service provider.
                                Click OK to close the STS Configuration
                                dialog.</p></div></li><li class="step" title="Step 16"><p><span class="bold"><strong> Click Configure. In the
                        Issuer field, enter MySTS1. Click OK to close.
                        </strong></span></p></li><li class="step" title="Step 17"><p><span class="bold"><strong> Click the Keystore button
                        to provide your keystore with the alias identifying
                        the service certificate and private key. To do this,
                        click the Load Aliases button, select
                        <code class="code">wssip</code> , then click OK to close the
                        dialog. </strong></span></p></li><li class="step" title="Step 18"><p><span class="bold"><strong>Click
                        OK.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Configuration Files |
                        xml-resources | web-services | MySTS1 | wsdl, then
                        double-click the file <code class="code">MySTS1Service.wsdl</code>
                        . This file contains the
                        <code class="code">tc:STSConfiguration</code> element within the
                        <code class="code">wsp:Policy</code> elements..</p></li><li class="step" title="Step 19"><p><span class="bold"><strong> Right-click the
                        MySTS1Project tab, select Properties. Select the Run
                        category, and type the following in the Relative URL
                        field: <code class="code">/MySTS1Service?wsdl</code> .
                        </strong></span></p></li><li class="step" title="Step 20"><p><span class="bold"><strong>Run the Project
                        (right-click the project and select
                        Run).</strong></span></p><p>The STS WSDL appears in the browser.</p></li></ol></div></div><div class="task" title="To Create and Secure the Second STS (BT)"><a name="gfrlb"></a><p class="title"><b>To Create and Secure the Second STS (BT)</b></p><div class="tasksummary">
                    <p>To create and secure a Security Token Service(i.e.
                    local STS) for this example, follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create a new project for
                        the 2nd STS by selecting File | New Project.
                        </strong></span></p></li><li class="step" title="Step 2"><p><span class="bold"><strong>Select Web, then Web
                        Application, then Next.</strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Type <code class="code">
                        MySTS2Project</code> for the Project Name, then click
                        Finish. </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Right-click the <code class="code">
                        MySTS2Project</code> node, select New, then select
                        Other. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Web Services from
                        the Categories list.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select Secure Token
                        Service (STS) from the File Type(s) list, then click
                        Next. </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Type the name
                        <code class="code">MySTS2</code> for the Web Service Class Name.
                        </strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Enter or select
                        <code class="code">org.me.my.sts2</code> in the Package field, then
                        click Finish. If prompted to reload the
                        <code class="code">catalog.xml</code> file, click No.
                        </strong></span></p><p>The IDE takes a while to create the first STS.
                        When created, it appears under the project's Web
                        Services node as <code class="code">MySTS2Service</code> .</p></li><li class="step" title="Step 9"><p><span class="bold"><strong> The STS wizard creates an
                        implementation of the provider class. To view it,
                        expand Source Packages, then org.me.my.sts2.
                        Double-click <code class="code">MySTS2.java</code> to open it in
                        the right pane. </strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> In the Projects window,
                        expand the MySTS2Service node, then expand the Web
                        Services node. Right-click the
                        MySTS2Service[IMySTS2Service_Port] node and select
                        Edit Web Service Attributes to configure the STS.
                        </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Select the "Version
                        Compatibility" to ".NET 3.5 / Metro 1.3" ( e.g. see
                        <a class="xref" href="ch12.html#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a> ) .
                        It will use WS-SX version of all WS-* specifications.
                        </strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong>Select Secure Service if
                        it's not already selected.</strong></span></p></li><li class="step" title="Step 13"><p><span class="bold"><strong> Verify that the Security
                        Mechanism of Username Authentication with Symmetric
                        Key is selected. </strong></span></p></li><li class="step" title="Step 14"><p><span class="bold"><strong> Select the Configure
                        button. For Algorithm Suite, verify that Basic128 bit
                        is selected (so that it matches the value selected for
                        the service.) Select OK to close the configuration
                        dialog. </strong></span></p></li><li class="step" title="Step 15"><p><span class="bold"><strong> If not already selected,
                        select Act as Secure Token Service (STS). </strong></span>
                        </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you'd like to use an STS other than the
                                default, click the STS Configure button, and click
                                the Add button to add a different service provider.
                                Click OK to close the STS Configuration
                                dialog.</p></div></li><li class="step" title="Step 16"><p><span class="bold"><strong> Click Configure. In the
                        Issuer field, enter MySTS2. Click OK to close.
                        </strong></span></p></li><li class="step" title="Step 17"><p><span class="bold"><strong> Click the Keystore button
                        to provide your keystore with the alias identifying
                        the service certificate and private key. To do this,
                        click the Load Aliases button, select
                        <code class="code">wssip</code> , then click OK to close the
                        dialog. </strong></span></p></li><li class="step" title="Step 18"><p><span class="bold"><strong>Click
                        OK.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Configuration Files |
                        xml-resources | web-services | MySTS2 | wsdl, then
                        double-click the file <code class="code">MySTS2Service.wsdl</code>
                        . This file contains the
                        <code class="code">tc:STSConfiguration</code> element within the
                        <code class="code">wsp:Policy</code> elements..</p></li><li class="step" title="Step 19"><p><span class="bold"><strong> Right-click the
                        MySTS2Project tab, select Properties. Select the Run
                        category, and type the following in the Relative URL
                        field: <code class="code">/MySTS2Service?wsdl</code> .
                        </strong></span></p></li><li class="step" title="Step 20"><p><span class="bold"><strong>Run the Project
                        (right-click the project and select
                        Run).</strong></span></p><p>The STS WSDL appears in the browser.</p></li></ol></div></div><div class="task" title="To Secure the Example Service Application (BT)"><a name="gfrmp"></a><p class="title"><b>To Secure the Example Service Application (BT)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    security to both the web service and to the web service
                    client.</p>

                    <p>For this example, the security mechanism of <a class="xref" href="ch12.html#ahide" title="12.3.11.&nbsp;STS Issued Token">STS Issued Token</a> is used to
                    secure the application. The steps are similar to the ones
                    described in <a class="xref" href="ch12.html#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a>, with the addition of creating
                    and securing an STS.</p>

                    <p>To add security to the service part of the example,
                    follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> . </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet). </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, then right-click
                        the node for the web service, CalculatorWS, and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Select the "Version
                        Compatibility" to ".NET 3.5 / Metro 1.3" ( e.g. see
                        <a class="xref" href="ch12.html#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a> ) .
                        It will use WS-SX version of all WS-* specifications.
                        </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Deselect the Reliable
                        Messaging option if it is selected.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select STS Issued Token.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Click Configure. For
                        Issuer Address and Issuer Metadata Address, enter
                        <code class="code">http://localhost:8080/MySTS1Project/MySTS1Service</code>
                        . For Issuer Metadata, enter
                        <code class="code">http://localhost:8080/MySTS1Project/MySTS1Service/mex</code>
                        </strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> For Algorithm Suite,
                        select Basic 128 bit. For Key Size, select 128 (the
                        algorithm suite value of the service must match the
                        algorithm suite value of the STS). Select OK to close
                        the configuration dialog. </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you have configured Unlimited Strength
                                Encryption as described in <a class="xref" href="ch12.html#gfrig" title="To Create a Third-Party STS">To Create a Third-Party STS</a> , you can leave the key
                                size at 256. Otherwise, you must set it to
                                128.</p></div></li><li class="step" title="Step 9"><p><span class="bold"><strong>Select Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong>Click
                        OK.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Web Pages | WEB-INF,
                        then double-click the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code>
                        and select the Source page. This file contains the
                        security elements within <code class="code">wsp:Policy</code>
                        tags.</p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Properties.
                        Select the Run category, and type the following in the
                        Relative URL field:
                        <code class="code">/CalculatorWSService?wsdl</code> .
                        </strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run. This step
                        compiles the application and deploys it onto
                        GlassFish. A browser will open and display the WSDL
                        file for the application. </strong></span></p></li></ol></div></div><div class="task" title="To Secure the Example Web Service Client Application (BT)"><a name="gfrlr"></a><p class="title"><b>To Secure the Example Web Service Client Application
                (BT)</b></p><div class="tasksummary">
                    <p>This section demonstrates adding security to the
                    CalculatorApplication's web service client. The service
                    was secured using the security mechanism described in
                    <a class="xref" href="ch12.html#ahide" title="12.3.11.&nbsp;STS Issued Token">STS Issued Token</a> .</p>

                    <p>To add security to the web service client, complete
                    the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the client
                        application by following the steps described in <a class="xref" href="ch02.html#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a> . </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Whenever you make changes on the service,
                                refresh the client so that the client will pick up
                                the change. To refresh the client, right-click the
                                node for the Web Service Reference for the client,
                                and select Refresh Client.</p></div></li><li class="step" title="Step 2"><p><span class="bold"><strong> Drill down from
                        CalculatorWSServletClient | Web Service References.
                        </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Right-click
                        CalculatorWSService and select Edit Web Service
                        Attributes, then select the Quality of Service tab.
                        </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> Provide the client's
                        private key by pointing to an alias in the keystore.
                        To do this, click the Keystore button, click the Load
                        Aliases button, and select
                        <code class="code">xws-security-client</code> from the Alias list.
                        </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> Provide the service's
                        certificate by pointing to an alias in the client
                        truststore. To do this, click the Truststore button,,
                        click the Load Aliases button for the truststore and
                        select <code class="code">xws-security-server</code> from the Alias
                        list. </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 5.1"><p><span class="bold"><strong> In some instances,
                                NetBeans will not detect that this client is a
                                JSR-196 client, and thus will require that the
                                keystore and truststore entries be manually
                                configured. To do this, follow the steps in this
                                section. </strong></span></p></li>

                            <li class="step" title="Step 5.2"><p><span class="bold"><strong>Expand
                                CalculatorWSServletClient | Source Packages |
                                META-INF.</strong></span></p></li>

                            <li class="step" title="Step 5.3"><p><span class="bold"><strong> Double-click
                                CalculatorWSService.xml to open it in the Source
                                window. Click the Source tab to view the code. Find
                                the <code class="code">sc:KeyStore</code> and
                                <code class="code">sc:TrustStore</code> elements. If these
                                elements contain parameters for
                                <code class="code">location</code> and <code class="code">storepass</code> ,
                                then just continue to the next section. If not, add
                                these attributes to this file. The following code
                                shows an example of how these elements should be
                                specified. </strong></span></p><div class="example"><a name="d0e11606"></a><p class="title"><b>Example&nbsp;12.19.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sc:TrustStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
   storepass="changeit" peeralias="xws-security-server"/&gt;
&lt;sc:KeyStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\keystore.jks"
   storepass="changeit" alias="xws-security-client"/&gt;</pre></div></div><br class="example-break"></li>
                        </ul></li><li class="step" title="Step 6"><p><span class="bold"><strong>Click OK to close this
                        dialog.</strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> The service requires a
                        token to be issued from the first STS (i.e Remote STS)
                        at
                        <code class="code">http://localhost:8080/MySTS1Project/MySTS1Service</code>
                        , with WSDL file
                        <code class="code">http://localhost:8080/MySTS1Project/MySTS1Service?wsdl</code>.
                        To do this, follow these steps: </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 7.a"><p><span class="bold"><strong> Right-click the
                                CalculatorWSServletClient node and select New | Web
                                Service Client. </strong></span></p><p>The New Web Service Client window
                                appears.</p></li><li class="step" title="Step 7.b"><p><span class="bold"><strong>Select the WSDL URL
                                option.</strong></span></p></li><li class="step" title="Step 7.c"><p><span class="bold"><strong> Cut and paste the URL
                                of the web service that you want the client to
                                consume into the WSDL URL field. For this example,
                                here is the URL for the <code class="code">MySTS1</code> web
                                service: </strong></span></p><pre class="programlisting">http://localhost:8080/MySTS1Project/MySTS1Service?wsdl</pre></li><li class="step" title="Step 7.d"><p><span class="bold"><strong> Type
                                <code class="code">org.me.calculator.client.sts1</code> in the
                                Package field, then click Finish. </strong></span></p><p>The Projects window displays the new web
                                service client.</p></li></ol></li><li class="step" title="Step 8"><p><span class="bold"><strong> Drill down from
                        CalculatorWSServletClient | Web Service References.
                        </strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Right-click MySTS1Service
                        and select Edit Web Service
                        Attributes.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong> Select the Quality of
                        Service tab of the MySTS1Service dialog.
                        </strong></span></p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Provide the client's
                        private key by pointing to an alias in the keystore.
                        To do this, click the Keystore button, click the Load
                        Aliases button, and select
                        <code class="code">xws-security-client</code> from the Alias list.
                        If the Keystore button is not selectable, follow the
                        instructions in the next step for adding the keystore
                        entry manually. </strong></span></p></li><li class="step" title="Step 12"><p><span class="bold"><strong> Verify the STS's
                        certificate by pointing to an alias in the client
                        truststore. To do this, click the Truststore button,,
                        click the Load Aliases button and select
                        <code class="code">wssip</code> from the Alias list.
                        </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 12.1"><p><span class="bold"><strong> In some instances,
                                NetBeans will not detect that this client is a
                                JSR-196 client, and thus will require that the
                                keystore and truststore entries be manually
                                configured. To do this, follow the steps in this
                                section. </strong></span></p></li>

                            <li class="step" title="Step 12.2"><p><span class="bold"><strong>Expand
                                CalculatorWSServletClient | Source Packages |
                                META-INF.</strong></span></p></li>

                            <li class="step" title="Step 12.3"><p><span class="bold"><strong> Double-click
                                MySTSService.xml to open it in the Source window.
                                Click the Source tab to view the code. Find the
                                <code class="code">sc:KeyStore</code> and
                                <code class="code">sc:TrustStore</code> elements. If these
                                elements contain parameters for
                                <code class="code">location</code> and <code class="code">storepass</code> ,
                                then just continue to the next section. If not, add
                                these attributes to this file. The following code
                                shows an example of how these elements should be
                                specified. </strong></span></p><div class="example"><a name="d0e11707"></a><p class="title"><b>Example&nbsp;12.20.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sc:TrustStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
   storepass="changeit" peeralias="wssip"/&gt;
&lt;sc:KeyStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\keystore.jks"
   storepass="changeit" alias="xws-security-client"/&gt;</pre></div></div><br class="example-break"></li>
                        </ul></li><li class="step" title="Step 13"><p><span class="bold"><strong> Expand the Security Token
                        Service node to provide details for the second
                        STS(i.e. local STS) to be used. When the Endpoint and
                        the Metadata values are the same, you only need to
                        enter the Endpoint value. For the Endpoint field,
                        enter the following value:
                        http://localhost:8080/MySTS2Project/MySTS2Service. For
                        WS Trust Version field, select 1.3 if STS endpoint
                        uses ".NET 3.5 / Metro 1.3" version compatibility.
                        Otherwise use the default WS Trust Version.
                        </strong></span></p></li><li class="step" title="Step 14"><p><span class="bold"><strong>Click OK to close this
                        dialog.</strong></span></p></li><li class="step" title="Step 15"><p><span class="bold"><strong> The First STS(i.e. Remote
                        STS) requires a token to be issued from the second
                        STS(i.e. local STS) at
                        <code class="code">http://localhost:8080/MySTS2Project/MySTS2Service</code>
                        , with WSDL file
                        <code class="code">http://localhost:8080/MySTS2Project/MySTS2Service?wsdl</code>
                        . To do this, follow these steps: </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 15.a"><p><span class="bold"><strong> Right-click the
                                CalculatorWSServletClient node and select New | Web
                                Service Client. </strong></span></p><p>The New Web Service Client window
                                appears.</p></li><li class="step" title="Step 15.b"><p><span class="bold"><strong>Select the WSDL URL
                                option.</strong></span></p></li><li class="step" title="Step 15.c"><p><span class="bold"><strong> Cut and paste the URL
                                of the web service that you want the client to
                                consume into the WSDL URL field. For this example,
                                here is the URL for the <code class="code">MySTS2</code> web
                                service: </strong></span></p><pre class="programlisting">http://localhost:8080/MySTS2Project/MySTS2Service?wsdl</pre></li><li class="step" title="Step 15.d"><p><span class="bold"><strong> Type
                                <code class="code">org.me.calculator.client.sts2</code> in the
                                Package field, then click Finish. </strong></span></p><p>The Projects window displays the new web
                                service client.</p></li></ol></li><li class="step" title="Step 16"><p><span class="bold"><strong> Drill down from
                        CalculatorWSServletClient | Web Service References.
                        </strong></span></p></li><li class="step" title="Step 17"><p><span class="bold"><strong>Right-click MySTS2Service
                        and select Edit Web Service
                        Attributes.</strong></span></p></li><li class="step" title="Step 18"><p><span class="bold"><strong> Select the Quality of
                        Service tab of the MySTS2Service dialog.
                        </strong></span></p></li><li class="step" title="Step 19"><p><span class="bold"><strong> Provide the client's
                        private key by pointing to an alias in the keystore.
                        To do this, click the Keystore button, click the Load
                        Aliases button, and select
                        <code class="code">xws-security-client</code> from the Alias list.
                        If the Keystore button is not selectable, follow the
                        instructions in the next step for adding the keystore
                        entry manually. </strong></span></p></li><li class="step" title="Step 20"><p><span class="bold"><strong> Verify the STS's
                        certificate by pointing to an alias in the client
                        truststore. To do this, click the Truststore button,,
                        click the Load Aliases button and select
                        <code class="code">wssip</code> from the Alias list.
                        </strong></span></p><ul class="stepalternatives">
                            <li class="step" title="Step 20.1"><p><span class="bold"><strong> In some instances,
                                NetBeans will not detect that this client is a
                                JSR-196 client, and thus will require that the
                                keystore and truststore entries be manually
                                configured. To do this, follow the steps in this
                                section. </strong></span></p></li>

                            <li class="step" title="Step 20.2"><p><span class="bold"><strong>Expand
                                CalculatorWSServletClient | Source Packages |
                                META-INF.</strong></span></p></li>

                            <li class="step" title="Step 20.3"><p><span class="bold"><strong> Double-click
                                MySTS2Service.xml to open it in the Source window.
                                Click the Source tab to view the code. Find the
                                <code class="code">sc:KeyStore</code> and
                                <code class="code">sc:TrustStore</code> elements. If these
                                elements contain parameters for
                                <code class="code">location</code> and <code class="code">storepass</code> ,
                                then just continue to the next section. If not, add
                                these attributes to this file. The following code
                                shows an example of how these elements should be
                                specified. </strong></span></p><div class="example"><a name="d0e11812"></a><p class="title"><b>Example&nbsp;12.21.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;sc:TrustStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\cacerts.jks"
   storepass="changeit" peeralias="wssip"/&gt;
&lt;sc:KeyStore
   wspp:visibility="private"
   location="&lt;GF_HOME&gt;\glassfish\domains\domain1\config\keystore.jks"
   storepass="changeit" alias="xws-security-client"/&gt;</pre></div></div><br class="example-break"></li>
                        </ul></li><li class="step" title="Step 21"><p><span class="bold"><strong>Enter the default user
                        name and password.</strong></span></p><p>If you followed the steps in <a class="xref" href="ch12.html#ahidj" title="12.4.2.&nbsp;Adding Users to GlassFish">Adding Users to GlassFish</a> , this
                        will be User Name <code class="code">wsitUser</code> and Password
                        <code class="code">changeit</code> .</p></li><li class="step" title="Step 22"><p><span class="bold"><strong>Click OK to close this
                        dialog.</strong></span></p></li><li class="step" title="Step 23"><p><span class="bold"><strong> Compile and run this
                        application by right-clicking the
                        CalculatorWSServletClient project and selecting Run.
                        The result of the add operation will display in a
                        browser window. </strong></span></p></li></ol></div></div></div><div class="section" title="12.9.9.&nbsp;Example: STS Issued Token With SecureConversation (STS+SC)"><div class="titlepage"><div><div><h3 class="title"><a name="ahiez"></a>12.9.9.&nbsp;Example: STS Issued Token With SecureConversation
            (STS+SC)</h3></div></div></div><p>This example illustrates, how SecureConversation Token is
            used to interact with STS. To have a basic idea of
            SecureConversation, find this article : <span class="bold"><strong>
            <a class="link" href="http://blogs.sun.com/enterprisetechtips/entry/secure_conversations_for_web_services" target="_top">Secure
            Conversations for Web Services With Metro</a>
            </strong></span></p><p>This section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#gfrle" title="To Create and Secure the STS with SecureConversationToken (STS+SC)">To Create and Secure the STS with
                SecureConversationToken (STS+SC)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrlf" title="To Secure the Example Service Application (STS+SC)">To Secure the Example Service Application
                (STS+SC)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfrmg" title="To Secure the Example Web Service Client Application (STS+SC)">To Secure the Example Web Service Client Application
                (STS+SC)</a></p></li></ul></div><p title="To Create and Secure the STS with SecureConversationToken (STS+SC)"><a name="gfrle"></a><b>To Create and Secure the STS with
                SecureConversationToken (STS+SC).&nbsp;</b></p><p>Same as provided in <a class="xref" href="ch12.html#gfrlq" title="To Create and Secure the STS (STS)">To Create and Secure the STS (STS)</a></p><div class="task" title="To Secure the Example Service Application (STS+SC)"><a name="gfrlf"></a><p class="title"><b>To Secure the Example Service Application
                (STS+SC)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    security to both the web service and to the web service
                    client.</p>

                    <p>For this example, the security mechanism of <a class="xref" href="ch12.html#ahide" title="12.3.11.&nbsp;STS Issued Token">STS Issued Token</a> is used to
                    secure the application. The steps are similar to the ones
                    described in <a class="xref" href="ch12.html#ahiej" title="12.9.1.&nbsp;Example: Username Authentication with Symmetric Key (UA)">Example: Username Authentication with Symmetric Key
            (UA)</a> , with the addition of
                    creating and securing an STS.</p>

                    <p>To add security to the service part of the example,
                    follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> . </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet). </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, then right-click
                        the node for the web service, CalculatorWS, and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong> Select the "Version
                        Compatibility" to ".NET 3.5 / Metro 1.3" ( e.g. see
                        <a class="xref" href="ch12.html#gfrct" title="Figure&nbsp;12.1.&nbsp;Web Service Attributes Editor Page">Web Service Attributes Editor Page</a> ) .
                        It will use WS-SX version of all WS-* specifications.
                        </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Deselect the Reliable
                        Messaging option if it is selected.</strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Select Secure
                        Service.</strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select STS Issued Token.
                        </strong></span></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Click Configure. For
                        Issuer Address and Issuer Metadata Address, enter
                        <code class="code">http://localhost:8080/MySTSProject/MySTSService</code>
                        . For Issuer Metadata, enter
                        <code class="code">http://localhost:8080/MySTSProject/MySTSService/mex</code>
                        </strong></span></p></li><li class="step" title="Step 8"><p><span class="bold"><strong> Select the Configure
                        button and do the following :</strong></span></p><p><span class="bold"><strong> For Algorithm Suite,
                        verify that Basic128 bit is selected (so that it
                        matches the value selected for the
                        service.)</strong></span></p><p><span class="bold"><strong> Check the Establish
                        Secure Session (Secure Conversation) check box to
                        enable the secure conversaion
                        feature</strong></span></p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you have configured Unlimited Strength
                            Encryption as described in <a class="xref" href="ch12.html#gfrig" title="To Create a Third-Party STS">To Create a Third-Party STS</a> , you can leave the key
                            size at 256. Otherwise, you must set it to
                            128.</p></div><p><span class="bold"><strong> Select OK to close the
                        configuration dialog. </strong></span></p></li><li class="step" title="Step 9"><p><span class="bold"><strong>Select Use Development
                        Defaults.</strong></span></p></li><li class="step" title="Step 10"><p><span class="bold"><strong>Click
                        OK.</strong></span></p><p>A new file is added to the project. To view the
                        WSIT configuration file, expand Web Pages | WEB-INF,
                        then double-click the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code>
                        and select the Source page. This file contains the
                        security elements within <code class="code">wsp:Policy</code>
                        tags.</p></li><li class="step" title="Step 11"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run. This step
                        compiles the application and deploys it onto
                        GlassFish. A browser will open and display the WSDL
                        file for the application. </strong></span></p></li></ol></div></div><p title="To Secure the Example Web Service Client Application (STS+SC)"><a name="gfrmg"></a><b>To Secure the Example Web Service Client Application
                (STS+SC).&nbsp;</b></p><p>Same as provided in <a class="xref" href="ch12.html#gfrls" title="To Secure the Example Web Service Client Application (STS)">To Secure the Example Web Service Client Application
                (STS)</a></p></div><div class="section" title="12.9.10.&nbsp;Example: Kerberos Token (Kerb)"><div class="titlepage"><div><div><h3 class="title"><a name="gfzhh"></a>12.9.10.&nbsp;Example: Kerberos Token (Kerb)</h3></div></div></div><p>This section contains the steps for running a Kerberos Token
            Profile-based WS Security scenario. Kerberos support was added to
            Metro in 1.1 release. The Netbeans support for configuring a
            Kerberos Token based secure web service is available from Metro
            1.3 and Netbeans 6.5.</p><p>For an article discussing using Kerberos with WSIT, go to
            <a class="link" href="http://blogs.sun.com/enterprisetechtips/entry/building_kerberos_based_secure_services" target="_top">Building
            Kerberos-Based Secure Services Using Metro</a>. This article
            has a sample application, but does not use Netbeans IDE.</p><p>The section describes the following tasks:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a class="xref" href="ch12.html#gfzgj" title="To Set Up Your System for Kerberos Profile">To Set Up Your System for Kerberos Profile</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfzgt" title="To Secure the Example Service Application (Kerb)">To Secure the Example Service Application
                (Kerb)</a></p></li><li class="listitem"><p><a class="xref" href="ch12.html#gfzhj" title="To Secure the Example Web Service Client Application (Kerb)">To Secure the Example Web Service Client Application
                (Kerb)</a></p></li></ul></div><p title="To Set Up Your System for Kerberos Profile"><a name="gfzgj"></a><b>To Set Up Your System for Kerberos Profile.&nbsp;</b></p><p>If your system is not already set up to use Kerberos, refer
            to the steps mentioned in <a class="xref" href="ch12.html#ConfiguringKerberos" title="12.6.&nbsp;Configuring Kerberos for Glassfish and Tomcat">Configuring Kerberos for Glassfish and Tomcat</a>.</p><div class="task" title="To Secure the Example Service Application (Kerb)"><a name="gfzgt"></a><p class="title"><b>To Secure the Example Service Application
                (Kerb)</b></p><div class="tasksummary">
                    <p>The following example application starts with the
                    example provided in <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a> and demonstrates adding
                    security to both the web service and to the web service
                    client.</p>

                    <p>For this example, a Kerberos token is used to secure
                    the application. To add security to the service part of
                    the example, follow these steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the
                        CalculatorApplication example by following the steps
                        described in the following sections of <a class="xref" href="ch02.html#using_metro-developing_with_nb" title="2.3.&nbsp;Developing with NetBeans">Developing with NetBeans</a>. </strong></span></p><ol type="a" class="substeps"><li class="step" title="Step 1.a"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibp" title="2.3.2.&nbsp;Creating a Web Service">Creating a Web Service</a> </strong></span></p></li><li class="step" title="Step 1.b"><p><span class="bold"><strong>Skip the section on
                                adding Reliable Messaging.</strong></span></p></li><li class="step" title="Step 1.c"><p><span class="bold"><strong> <a class="xref" href="ch02.html#ahibr" title="2.3.4.&nbsp;Deploying and Testing a Web Service">Deploying and Testing a Web Service</a> (first two steps only,
                                do not run the project yet) </strong></span></p></li></ol></li><li class="step" title="Step 2"><p><span class="bold"><strong> Expand
                        CalculatorApplication | Web Services, then right-click
                        the node for the web service (CalculatorWS) and select
                        Edit Web Service Attributes. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Deselect Reliable
                        Messaging if it is selected.</strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong> In the
                        CalculatorWSPortBinding section, select Secure
                        Service. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong> From the drop-down list
                        for Security Mechanism, select Symmetric Binding with
                        Kerberos Tokens. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> Select Kerberos button,
                        and specify the Login Module to be used for the
                        service. For details on Login Module to specify refer
                        <a class="xref" href="ch12.html#ConfiguringKerberos" title="12.6.&nbsp;Configuring Kerberos for Glassfish and Tomcat">Configuring Kerberos for Glassfish and Tomcat</a>. </strong></span> </p><div class="figure"><a name="kerberosServerConfig"></a><p class="title"><b>Figure&nbsp;12.8.&nbsp;Kerberos Configuration Attributes -
                                Service</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/kerberos_server_config.png" height="360" alt="Kerberos Configuration Attributes - Service"></td></tr></table></div></div></div><p><br class="figure-break"></p></li><li class="step" title="Step 7"><p><span class="bold"><strong> Click OK to close the
                        <code class="code">CalculatorWSService</code> dialog.
                        </strong></span></p><p>Expand Web Pages | WEB-INF, then double-click
                        the file
                        <code class="code">wsit-org.me.calculator.CalculatorWS.xml</code>
                        to open it in the edit window.The Binding level policy
                        looks like: (This section of code has been formatted
                        to fit the page)</p><div class="example"><a name="d0e12107"></a><p class="title"><b>Example&nbsp;12.22.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">&lt;wsp:Policy wsu:Id="IFinancialService_policy"&gt;
   &lt;wsp:ExactlyOne&gt;
      &lt;wsp:All&gt;
         &lt;wsaws:UsingAddressing
                 xmlns:wsaws="http://www.w3.org/2006/05/addressing/wsdl"/&gt;
         &lt;sp:SymmetricBinding&gt;
            &lt;wsp:Policy&gt;
               &lt;sp:ProtectionToken&gt;
                  &lt;wsp:Policy&gt;
                     &lt;sp:KerberosToken
                             sp:IncludeToken="http://docs.oasis-open.org/
                        ws-sx/ws-securitypolicy/200702/IncludeToken/Once"&gt;
                        &lt;wsp:Policy&gt;
                           &lt;sp:WssGssKerberosV5ApReqToken11/&gt;
                        &lt;/wsp:Policy&gt;
                     &lt;/sp:KerberosToken&gt;
                  &lt;/wsp:Policy&gt;
               &lt;/sp:ProtectionToken&gt;
               &lt;sp:Layout&gt;
                  &lt;wsp:Policy&gt;
                     &lt;sp:Strict/&gt;
                  &lt;/wsp:Policy&gt;
               &lt;/sp:Layout&gt;
               &lt;sp:IncludeTimestamp/&gt;
               &lt;sp:OnlySignEntireHeadersAndBody/&gt;
               &lt;sp:AlgorithmSuite&gt;
                  &lt;wsp:Policy&gt;
                     &lt;sp:Basic128/&gt;
                  &lt;/wsp:Policy&gt;
               &lt;/sp:AlgorithmSuite&gt;
            &lt;/wsp:Policy&gt;
         &lt;/sp:SymmetricBinding&gt;
         &lt;sp:Wss11&gt;
            &lt;wsp:Policy&gt;
               &lt;sp:MustSupportRefKeyIdentifier/&gt;
               &lt;sp:MustSupportRefIssuerSerial/&gt;
               &lt;sp:MustSupportRefThumbprint/&gt;
               &lt;sp:MustSupportRefEncryptedKey/&gt;
            &lt;/wsp:Policy&gt;
         &lt;/sp:Wss11&gt;
         &lt;sc:KerberosConfig xmlns:
                            sc="http://schemas.sun.com/2006/03/wss/server"
                            loginModule="KerberosServer"/&gt;
      &lt;/wsp:All&gt;
   &lt;/wsp:ExactlyOne&gt;
&lt;/wsp:Policy&gt;</pre></div></div><br class="example-break"></li><li class="step" title="Step 8"><p><span class="bold"><strong> Right-click the
                        CalculatorApplication node and select Run. A browser
                        will open and display the WSDL file for the
                        application. </strong></span></p><p>If the application doesn't build, expand
                        CalculatorApplication | Web Pages | WEB-INF, and
                        double-click <code class="code">web.xml</code> to open it in the
                        right pane. Select the Security tab, and remove any
                        existing security constraints. Then run the project
                        again.</p></li><li class="step" title="Step 9"><p><span class="bold"><strong> Follow the steps to
                        secure the client application as described in <a class="xref" href="ch12.html#gfzhj" title="To Secure the Example Web Service Client Application (Kerb)">To Secure the Example Web Service Client Application
                (Kerb)</a>.
                        </strong></span></p></li></ol></div></div><div class="task" title="To Secure the Example Web Service Client Application (Kerb)"><a name="gfzhj"></a><p class="title"><b>To Secure the Example Web Service Client Application
                (Kerb)</b></p><div class="tasksummary">
                    <p>This section demonstrates adding security to the web
                    service client that references the web service created in
                    the previous section. . This section also assumes that
                    Kerberos environment has already been setup on the system.
                    Refer to <a class="xref" href="ch12.html#ConfiguringKerberos" title="12.6.&nbsp;Configuring Kerberos for Glassfish and Tomcat">Configuring Kerberos for Glassfish and Tomcat</a> for more details.</p>

                    <p>To add security to the client that references this
                    web service, complete the following steps.</p>
                </div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p><span class="bold"><strong> Create the client
                        application by following the steps described in <a class="xref" href="ch02.html#wsit_example_with_nb-creating_wsit_client" title="2.3.5.&nbsp;Creating a Client to Consume a WSIT-Enabled Web Service">Creating a Client to Consume a WSIT-Enabled Web
            Service</a>. </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Whenever you make changes on the service,
                                refresh the client so that the client will pick up
                                the change. To refresh the client, right-click the
                                node for the Web Service Reference for the client,
                                and select Refresh Client.</p></div></li><li class="step" title="Step 2"><p><span class="bold"><strong>Expand the node for the
                        web service client application,
                        CalculatorWSServletClient. </strong></span></p></li><li class="step" title="Step 3"><p><span class="bold"><strong>Expand the Web Service
                        References node. </strong></span></p></li><li class="step" title="Step 4"><p><span class="bold"><strong>Right-click on
                        CalculatorWSService, select Edit Web Service
                        Attributes. </strong></span></p></li><li class="step" title="Step 5"><p><span class="bold"><strong>Expand the Web Service
                        References node. </strong></span></p></li><li class="step" title="Step 6"><p><span class="bold"><strong> In the Security section
                        of the Quality of Service tab, select Kerberos.
                        Specify Login Module, Service Principal and check the
                        box if credentials should be delegated.
                        </strong></span></p><p>Specify the Login Module to the one you created
                        in <span class="emphasis"><em>login.conf</em></span> file for the client
                        in the section <a class="xref" href="ch12.html#ConfiguringKerberos" title="12.6.&nbsp;Configuring Kerberos for Glassfish and Tomcat">Configuring Kerberos for Glassfish and Tomcat</a>, and the service principal
                        for which the ticket needs to be obtained.</p><p>Kerberos support in Metro security supports
                        credential delegation from client to service, such
                        that the server can initiate other security contexts
                        on behalf of the client. This feature is useful for
                        single sign-on in a multi-tier environment. Select the
                        checkbox for credential delegation.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>At the service, we can obtain the delegated
                            credentials from the <a class="link" href="http://download.oracle.com/javase/6/docs/api/javax/security/auth/Subject.html" target="_top">Subject</a>
                            of the authenticated user. The PrivateCredential set
                            of the will have the delegated client credentials
                            (as <a class="link" href="http://download.oracle.com/javase/6/docs/api/org/ietf/jgss/GSSCredential.html" target="_top">GSSCredential</a>).
                            We can pass this GSSCredential to <a class="link" href="http://download.oracle.com/javase/6/docs/api/org/ietf/jgss/GSSManager.html" target="_top">GSSManager</a>.createContext()
                            pretending to be the client.</p><p>Also, the PublicCredential set of the
                            authenticated Subject will always have <a class="link" href="http://download.oracle.com/javase/6/docs/api/javax/security/auth/kerberos/KerberosPrincipal.html" target="_top">KerberosPrincipal</a>
                            corresponding to the client.</p></div><div class="figure"><a name="kerberosClientConfig"></a><p class="title"><b>Figure&nbsp;12.9.&nbsp;Kerberos Configuration Attributes -
                            Client</b></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="100%"><tr><td><img src="figures/kerberos_client_config.png" height="360" alt="Kerberos Configuration Attributes - Client"></td></tr></table></div></div></div><br class="figure-break"></li><li class="step" title="Step 7"><p><span class="bold"><strong> Right-click the
                        CalculatorWSServletClient node and select Run. The
                        result of the add operation will display in a browser
                        window. </strong></span> </p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If your client is a Java SE client, you need
                                to set the following system properties while running
                                your client code: </p><div class="example"><a name="d0e12216"></a><p class="title"><b>Example&nbsp;12.23.&nbsp;</b></p><div class="example-contents"><pre class="programlisting">-Djava.security.policy=${glassfish.home}/domains/domain1/config/server.policy

-Djava.security.auth.login.config=${glassfish.home}/domains/domain1/config/login.conf</pre></div></div><p><br class="example-break"> If it is WebApp deployed on
                                glassfish, nothing else needs to be done.</p></div></li></ol></div></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch11.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch13.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter&nbsp;11.&nbsp;WS-MakeConnection support&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;13.&nbsp;WSIT Security Features: Advanced: Topics</td></tr></table></div></body></html>